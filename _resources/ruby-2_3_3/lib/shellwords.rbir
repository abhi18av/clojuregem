s(:begin,
  s(:module,
    s(:const, nil, :Shellwords),
    s(:begin,
      s(:def, :shellsplit,
        s(:args,
          s(:arg, :line)),
        s(:begin,
          s(:lvasgn, :words,
            s(:array)),
          s(:lvasgn, :field,
            s(:send,
              s(:const, nil, :String), :new)),
          s(:block,
            s(:send,
              s(:lvar, :line), :scan,
              s(:regexp,
                s(:str, "\\G\\s*(?>([^\\s\\\\\\'\\\"]+)|'([^\\']*)'|\"((?:[^\\\"\\\\]|\\\\.)*)\"|(\\\\.?)|(\\S))(\\s|\\z)?"),
                s(:regopt, :m))),
            s(:args,
              s(:arg, :word),
              s(:arg, :sq),
              s(:arg, :dq),
              s(:arg, :esc),
              s(:arg, :garbage),
              s(:arg, :sep)),
            s(:begin,
              s(:if,
                s(:lvar, :garbage),
                s(:send, nil, :raise,
                  s(:const, nil, :ArgumentError),
                  s(:dstr,
                    s(:str, "Unmatched double quote: "),
                    s(:begin,
                      s(:send,
                        s(:lvar, :line), :inspect)))), nil),
              s(:send,
                s(:lvar, :field), :<<,
                s(:begin,
                  s(:or,
                    s(:or,
                      s(:lvar, :word),
                      s(:lvar, :sq)),
                    s(:send,
                      s(:begin,
                        s(:or,
                          s(:lvar, :dq),
                          s(:lvar, :esc))), :gsub,
                      s(:regexp,
                        s(:str, "\\\\(.)"),
                        s(:regopt)),
                      s(:str, "\\1"))))),
              s(:if,
                s(:lvar, :sep),
                s(:begin,
                  s(:send,
                    s(:lvar, :words), :<<,
                    s(:lvar, :field)),
                  s(:lvasgn, :field,
                    s(:send,
                      s(:const, nil, :String), :new))), nil))),
          s(:lvar, :words))),
      s(:alias,
        s(:sym, :shellwords),
        s(:sym, :shellsplit)),
      s(:send, nil, :module_function,
        s(:sym, :shellsplit),
        s(:sym, :shellwords)),
      s(:sclass,
        s(:self),
        s(:alias,
          s(:sym, :split),
          s(:sym, :shellsplit))),
      s(:def, :shellescape,
        s(:args,
          s(:arg, :str)),
        s(:begin,
          s(:lvasgn, :str,
            s(:send,
              s(:lvar, :str), :to_s)),
          s(:if,
            s(:send,
              s(:lvar, :str), :empty?),
            s(:return,
              s(:send,
                s(:str, "''"), :dup)), nil),
          s(:lvasgn, :str,
            s(:send,
              s(:lvar, :str), :dup)),
          s(:send,
            s(:lvar, :str), :gsub!,
            s(:regexp,
              s(:str, "([^A-Za-z0-9_\\-.,:/@\\n])"),
              s(:regopt)),
            s(:str, "\\\\\\1")),
          s(:send,
            s(:lvar, :str), :gsub!,
            s(:regexp,
              s(:str, "\\n"),
              s(:regopt)),
            s(:str, "'\n'")),
          s(:return,
            s(:lvar, :str)))),
      s(:send, nil, :module_function,
        s(:sym, :shellescape)),
      s(:sclass,
        s(:self),
        s(:alias,
          s(:sym, :escape),
          s(:sym, :shellescape))),
      s(:def, :shelljoin,
        s(:args,
          s(:arg, :array)),
        s(:send,
          s(:block,
            s(:send,
              s(:lvar, :array), :map),
            s(:args,
              s(:arg, :arg)),
            s(:send, nil, :shellescape,
              s(:lvar, :arg))), :join,
          s(:str, " "))),
      s(:send, nil, :module_function,
        s(:sym, :shelljoin)),
      s(:sclass,
        s(:self),
        s(:alias,
          s(:sym, :join),
          s(:sym, :shelljoin))))),
  s(:class,
    s(:const, nil, :String), nil,
    s(:begin,
      s(:def, :shellsplit,
        s(:args),
        s(:send,
          s(:const, nil, :Shellwords), :split,
          s(:self))),
      s(:def, :shellescape,
        s(:args),
        s(:send,
          s(:const, nil, :Shellwords), :escape,
          s(:self))))),
  s(:class,
    s(:const, nil, :Array), nil,
    s(:def, :shelljoin,
      s(:args),
      s(:send,
        s(:const, nil, :Shellwords), :join,
        s(:self)))))

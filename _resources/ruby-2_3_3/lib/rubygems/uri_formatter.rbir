s(:begin,
  s(:send, nil, :require,
    s(:str, "cgi")),
  s(:send, nil, :require,
    s(:str, "uri")),
  s(:class,
    s(:const,
      s(:const, nil, :Gem), :UriFormatter), nil,
    s(:begin,
      s(:send, nil, :attr_reader,
        s(:sym, :uri)),
      s(:def, :initialize,
        s(:args,
          s(:arg, :uri)),
        s(:ivasgn, :@uri,
          s(:lvar, :uri))),
      s(:def, :escape,
        s(:args),
        s(:begin,
          s(:if,
            s(:ivar, :@uri), nil,
            s(:return)),
          s(:send,
            s(:const, nil, :CGI), :escape,
            s(:ivar, :@uri)))),
      s(:def, :normalize,
        s(:args),
        s(:if,
          s(:begin,
            s(:send,
              s(:ivar, :@uri), :=~,
              s(:regexp,
                s(:str, "^(https?|ftp|file):"),
                s(:regopt, :i)))),
          s(:ivar, :@uri),
          s(:dstr,
            s(:str, "http://"),
            s(:begin,
              s(:ivar, :@uri))))),
      s(:def, :unescape,
        s(:args),
        s(:begin,
          s(:if,
            s(:ivar, :@uri), nil,
            s(:return)),
          s(:send,
            s(:const, nil, :CGI), :unescape,
            s(:ivar, :@uri)))))))

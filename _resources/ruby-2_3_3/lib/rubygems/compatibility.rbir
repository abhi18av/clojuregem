s(:begin,
  s(:module,
    s(:const, nil, :Gem),
    s(:and,
      s(:casgn, nil, :GEM_PRELUDE_SUCKAGE,
        s(:send,
          s(:const, nil, :RUBY_VERSION), :=~,
          s(:regexp,
            s(:str, "^1\\.9\\.2"),
            s(:regopt)))),
      s(:send,
        s(:const, nil, :RUBY_ENGINE), :==,
        s(:str, "ruby")))),
  s(:if,
    s(:and,
      s(:const,
        s(:const, nil, :Gem), :GEM_PRELUDE_SUCKAGE),
      s(:defined?,
        s(:const,
          s(:const, nil, :Gem), :QuickLoader))),
    s(:begin,
      s(:send,
        s(:const,
          s(:const, nil, :Gem), :QuickLoader), :remove),
      s(:send,
        s(:gvar, :$LOADED_FEATURES), :delete,
        s(:send,
          s(:const,
            s(:const, nil, :Gem), :QuickLoader), :path_to_full_rubygems_library)),
      s(:if,
        s(:lvasgn, :path,
          s(:block,
            s(:send,
              s(:gvar, :$LOADED_FEATURES), :find),
            s(:args,
              s(:arg, :n)),
            s(:send,
              s(:lvar, :n), :end_with?,
              s(:str, "/rubygems.rb")))),
        s(:send, nil, :raise,
          s(:const, nil, :LoadError),
          s(:dstr,
            s(:str, "another rubygems is already loaded from "),
            s(:begin,
              s(:lvar, :path)))), nil),
      s(:sclass,
        s(:const, nil, :Gem),
        s(:if,
          s(:send,
            s(:const, nil, :Gem), :respond_to?,
            s(:sym, :try_activate),
            s(:true)),
          s(:send, nil, :remove_method,
            s(:sym, :try_activate)), nil))), nil),
  s(:module,
    s(:const, nil, :Gem),
    s(:begin,
      s(:casgn, nil, :RubyGemsVersion,
        s(:const, nil, :VERSION)),
      s(:casgn, nil, :RbConfigPriorities,
        s(:array,
          s(:str, "MAJOR"),
          s(:str, "MINOR"),
          s(:str, "TEENY"),
          s(:str, "EXEEXT"),
          s(:str, "RUBY_SO_NAME"),
          s(:str, "arch"),
          s(:str, "bindir"),
          s(:str, "datadir"),
          s(:str, "libdir"),
          s(:str, "ruby_install_name"),
          s(:str, "ruby_version"),
          s(:str, "rubylibprefix"),
          s(:str, "sitedir"),
          s(:str, "sitelibdir"),
          s(:str, "vendordir"),
          s(:str, "vendorlibdir"),
          s(:str, "rubylibdir"))),
      s(:if,
        s(:defined?,
          s(:const, nil, :ConfigMap)),
        s(:block,
          s(:send,
            s(:const, nil, :RbConfigPriorities), :each),
          s(:args,
            s(:arg, :key)),
          s(:send,
            s(:const, nil, :ConfigMap), :[]=,
            s(:send,
              s(:lvar, :key), :to_sym),
            s(:send,
              s(:const,
                s(:const, nil, :RbConfig), :CONFIG), :[],
              s(:lvar, :key)))),
        s(:casgn, nil, :ConfigMap,
          s(:block,
            s(:send,
              s(:const, nil, :Hash), :new),
            s(:args,
              s(:arg, :cm),
              s(:arg, :key)),
            s(:send,
              s(:lvar, :cm), :[]=,
              s(:lvar, :key),
              s(:send,
                s(:const,
                  s(:const, nil, :RbConfig), :CONFIG), :[],
                s(:send,
                  s(:lvar, :key), :to_s)))))),
      s(:casgn, nil, :RubyGemsPackageVersion,
        s(:const, nil, :VERSION)))))

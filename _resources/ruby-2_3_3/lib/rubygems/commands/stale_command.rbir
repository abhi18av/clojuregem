s(:begin,
  s(:send, nil, :require,
    s(:str, "rubygems/command")),
  s(:class,
    s(:const,
      s(:const,
        s(:const, nil, :Gem), :Commands), :StaleCommand),
    s(:const,
      s(:const, nil, :Gem), :Command),
    s(:begin,
      s(:def, :initialize,
        s(:args),
        s(:super,
          s(:str, "stale"),
          s(:str, "List gems along with access times"))),
      s(:def, :description,
        s(:args),
        s(:dstr,
          s(:str, "The stale command lists the latest access time for all the files in your\n"),
          s(:str, "installed gems.\n"),
          s(:str, "\n"),
          s(:str, "You can use this command to discover gems and gem versions you are no\n"),
          s(:str, "longer using.\n"))),
      s(:def, :usage,
        s(:args),
        s(:dstr,
          s(:begin,
            s(:send, nil, :program_name)))),
      s(:def, :execute,
        s(:args),
        s(:begin,
          s(:lvasgn, :gem_to_atime,
            s(:hash)),
          s(:block,
            s(:send,
              s(:const,
                s(:const, nil, :Gem), :Specification), :each),
            s(:args,
              s(:arg, :spec)),
            s(:begin,
              s(:lvasgn, :name,
                s(:send,
                  s(:lvar, :spec), :full_name)),
              s(:block,
                s(:send,
                  s(:send,
                    s(:const, nil, :Dir), :[],
                    s(:dstr,
                      s(:begin,
                        s(:send,
                          s(:lvar, :spec), :full_gem_path)),
                      s(:str, "/**/*.*"))), :each),
                s(:args,
                  s(:arg, :file)),
                s(:begin,
                  s(:if,
                    s(:send,
                      s(:const, nil, :File), :directory?,
                      s(:lvar, :file)),
                    s(:next), nil),
                  s(:lvasgn, :stat,
                    s(:send,
                      s(:const, nil, :File), :stat,
                      s(:lvar, :file))),
                  s(:or_asgn,
                    s(:send,
                      s(:lvar, :gem_to_atime), :[],
                      s(:lvar, :name)),
                    s(:send,
                      s(:lvar, :stat), :atime)),
                  s(:if,
                    s(:send,
                      s(:send,
                        s(:lvar, :gem_to_atime), :[],
                        s(:lvar, :name)), :<,
                      s(:send,
                        s(:lvar, :stat), :atime)),
                    s(:send,
                      s(:lvar, :gem_to_atime), :[]=,
                      s(:lvar, :name),
                      s(:send,
                        s(:lvar, :stat), :atime)), nil))))),
          s(:block,
            s(:send,
              s(:block,
                s(:send,
                  s(:lvar, :gem_to_atime), :sort_by),
                s(:args,
                  s(:arg, :_),
                  s(:arg, :atime)),
                s(:lvar, :atime)), :each),
            s(:args,
              s(:arg, :name),
              s(:arg, :atime)),
            s(:send, nil, :say,
              s(:dstr,
                s(:begin,
                  s(:lvar, :name)),
                s(:str, " at "),
                s(:begin,
                  s(:send,
                    s(:lvar, :atime), :strftime,
                    s(:str, "%c")))))))))))

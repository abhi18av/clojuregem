s(:begin,
  s(:send, nil, :require,
    s(:str, "rubygems/command")),
  s(:send, nil, :require,
    s(:str, "rubygems/package")),
  s(:class,
    s(:const,
      s(:const,
        s(:const, nil, :Gem), :Commands), :BuildCommand),
    s(:const,
      s(:const, nil, :Gem), :Command),
    s(:begin,
      s(:def, :initialize,
        s(:args),
        s(:begin,
          s(:super,
            s(:str, "build"),
            s(:str, "Build a gem from a gemspec")),
          s(:block,
            s(:send, nil, :add_option,
              s(:str, "--force"),
              s(:str, "skip validation of the spec")),
            s(:args,
              s(:arg, :value),
              s(:arg, :options)),
            s(:send,
              s(:lvar, :options), :[]=,
              s(:sym, :force),
              s(:true))))),
      s(:def, :arguments,
        s(:args),
        s(:str, "GEMSPEC_FILE  gemspec file name to build a gem for")),
      s(:def, :description,
        s(:args),
        s(:dstr,
          s(:str, "The build command allows you to create a gem from a ruby gemspec.\n"),
          s(:str, "\n"),
          s(:str, "The best way to build a gem is to use a Rakefile and the Gem::PackageTask\n"),
          s(:str, "which ships with RubyGems.\n"),
          s(:str, "\n"),
          s(:str, "The gemspec can either be created by hand or extracted from an existing gem\n"),
          s(:str, "with gem spec:\n"),
          s(:str, "\n"),
          s(:str, "  $ gem unpack my_gem-1.0.gem\n"),
          s(:str, "  Unpacked gem: '.../my_gem-1.0'\n"),
          s(:str, "  $ gem spec my_gem-1.0.gem --ruby > my_gem-1.0/my_gem-1.0.gemspec\n"),
          s(:str, "  $ cd my_gem-1.0\n"),
          s(:str, "  [edit gem contents]\n"),
          s(:str, "  $ gem build my_gem-1.0.gemspec\n"))),
      s(:def, :usage,
        s(:args),
        s(:dstr,
          s(:begin,
            s(:send, nil, :program_name)),
          s(:str, " GEMSPEC_FILE"))),
      s(:def, :execute,
        s(:args),
        s(:begin,
          s(:lvasgn, :gemspec,
            s(:send, nil, :get_one_gem_name)),
          s(:if,
            s(:send,
              s(:const, nil, :File), :exist?,
              s(:lvar, :gemspec)), nil,
            s(:if,
              s(:send,
                s(:const, nil, :File), :exist?,
                s(:send,
                  s(:lvar, :gemspec), :+,
                  s(:str, ".gemspec"))),
              s(:op_asgn,
                s(:lvasgn, :gemspec), :+,
                s(:str, ".gemspec")), nil)),
          s(:if,
            s(:send,
              s(:const, nil, :File), :exist?,
              s(:lvar, :gemspec)),
            s(:begin,
              s(:lvasgn, :spec,
                s(:send,
                  s(:const,
                    s(:const, nil, :Gem), :Specification), :load,
                  s(:lvar, :gemspec))),
              s(:if,
                s(:lvar, :spec),
                s(:send,
                  s(:const,
                    s(:const, nil, :Gem), :Package), :build,
                  s(:lvar, :spec),
                  s(:send,
                    s(:send, nil, :options), :[],
                    s(:sym, :force))),
                s(:begin,
                  s(:send, nil, :alert_error,
                    s(:str, "Error loading gemspec. Aborting.")),
                  s(:send, nil, :terminate_interaction,
                    s(:int, 1))))),
            s(:begin,
              s(:send, nil, :alert_error,
                s(:dstr,
                  s(:str, "Gemspec file not found: "),
                  s(:begin,
                    s(:lvar, :gemspec)))),
              s(:send, nil, :terminate_interaction,
                s(:int, 1)))))))))

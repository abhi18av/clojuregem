s(:class,
  s(:const,
    s(:const,
      s(:const, nil, :Gem), :Resolver), :DependencyRequest), nil,
  s(:begin,
    s(:send, nil, :attr_reader,
      s(:sym, :dependency)),
    s(:send, nil, :attr_reader,
      s(:sym, :requester)),
    s(:def, :initialize,
      s(:args,
        s(:arg, :dependency),
        s(:arg, :requester)),
      s(:begin,
        s(:ivasgn, :@dependency,
          s(:lvar, :dependency)),
        s(:ivasgn, :@requester,
          s(:lvar, :requester)))),
    s(:def, :==,
      s(:args,
        s(:arg, :other)),
      s(:case,
        s(:lvar, :other),
        s(:when,
          s(:const,
            s(:const, nil, :Gem), :Dependency),
          s(:send,
            s(:ivar, :@dependency), :==,
            s(:lvar, :other))),
        s(:when,
          s(:const,
            s(:const,
              s(:const, nil, :Gem), :Resolver), :DependencyRequest),
          s(:and,
            s(:send,
              s(:ivar, :@dependency), :==,
              s(:send,
                s(:lvar, :other), :dependency)),
            s(:send,
              s(:ivar, :@requester), :==,
              s(:send,
                s(:lvar, :other), :requester)))),
        s(:false))),
    s(:def, :development?,
      s(:args),
      s(:send,
        s(:send,
          s(:ivar, :@dependency), :type), :==,
        s(:sym, :development))),
    s(:def, :match?,
      s(:args,
        s(:arg, :spec),
        s(:optarg, :allow_prerelease,
          s(:false))),
      s(:send,
        s(:ivar, :@dependency), :match?,
        s(:lvar, :spec),
        s(:nil),
        s(:lvar, :allow_prerelease))),
    s(:def, :matches_spec?,
      s(:args,
        s(:arg, :spec)),
      s(:send,
        s(:ivar, :@dependency), :matches_spec?,
        s(:lvar, :spec))),
    s(:def, :name,
      s(:args),
      s(:send,
        s(:ivar, :@dependency), :name)),
    s(:def, :type,
      s(:args),
      s(:send,
        s(:ivar, :@dependency), :type)),
    s(:def, :explicit?,
      s(:args),
      s(:send,
        s(:ivar, :@requester), :nil?)),
    s(:def, :implicit?,
      s(:args),
      s(:send,
        s(:send, nil, :explicit?), :!)),
    s(:def, :request_context,
      s(:args),
      s(:if,
        s(:ivar, :@requester),
        s(:send,
          s(:ivar, :@requester), :request),
        s(:str, "(unknown)"))),
    s(:def, :pretty_print,
      s(:args,
        s(:arg, :q)),
      s(:block,
        s(:send,
          s(:lvar, :q), :group,
          s(:int, 2),
          s(:str, "[Dependency request "),
          s(:str, "]")),
        s(:args),
        s(:begin,
          s(:send,
            s(:lvar, :q), :breakable),
          s(:send,
            s(:lvar, :q), :text,
            s(:send,
              s(:ivar, :@dependency), :to_s)),
          s(:send,
            s(:lvar, :q), :breakable),
          s(:send,
            s(:lvar, :q), :text,
            s(:str, " requested by ")),
          s(:send,
            s(:lvar, :q), :pp,
            s(:ivar, :@requester))))),
    s(:def, :requirement,
      s(:args),
      s(:send,
        s(:ivar, :@dependency), :requirement)),
    s(:def, :to_s,
      s(:args),
      s(:send,
        s(:ivar, :@dependency), :to_s))))

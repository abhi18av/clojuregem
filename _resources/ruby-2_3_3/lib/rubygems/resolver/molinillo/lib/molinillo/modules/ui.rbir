s(:module,
  s(:const,
    s(:const,
      s(:const, nil, :Gem), :Resolver), :Molinillo),
  s(:module,
    s(:const, nil, :UI),
    s(:begin,
      s(:def, :output,
        s(:args),
        s(:const, nil, :STDOUT)),
      s(:def, :indicate_progress,
        s(:args),
        s(:if,
          s(:send, nil, :debug?), nil,
          s(:send,
            s(:send, nil, :output), :print,
            s(:str, ".")))),
      s(:def, :progress_rate,
        s(:args),
        s(:float, 0.33)),
      s(:def, :before_resolution,
        s(:args),
        s(:send,
          s(:send, nil, :output), :print,
          s(:str, "Resolving dependencies..."))),
      s(:def, :after_resolution,
        s(:args),
        s(:send,
          s(:send, nil, :output), :puts)),
      s(:def, :debug,
        s(:args,
          s(:optarg, :depth,
            s(:int, 0))),
        s(:if,
          s(:send, nil, :debug?),
          s(:begin,
            s(:lvasgn, :debug_info,
              s(:yield)),
            s(:if,
              s(:send,
                s(:lvar, :debug_info), :is_a?,
                s(:const, nil, :String)), nil,
              s(:lvasgn, :debug_info,
                s(:send,
                  s(:lvar, :debug_info), :inspect))),
            s(:send,
              s(:send, nil, :output), :puts,
              s(:block,
                s(:send,
                  s(:send,
                    s(:lvar, :debug_info), :split,
                    s(:str, "\n")), :map),
                s(:args,
                  s(:arg, :s)),
                s(:send,
                  s(:send,
                    s(:str, "  "), :*,
                    s(:lvar, :depth)), :+,
                  s(:lvar, :s))))), nil)),
      s(:def, :debug?,
        s(:args),
        s(:or_asgn,
          s(:ivasgn, :@debug_mode),
          s(:send,
            s(:const, nil, :ENV), :[],
            s(:str, "MOLINILLO_DEBUG")))))))

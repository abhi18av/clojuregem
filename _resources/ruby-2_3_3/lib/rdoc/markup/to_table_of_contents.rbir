s(:class,
  s(:const,
    s(:const,
      s(:const, nil, :RDoc), :Markup), :ToTableOfContents),
  s(:const,
    s(:const,
      s(:const, nil, :RDoc), :Markup), :Formatter),
  s(:begin,
    s(:ivasgn, :@to_toc,
      s(:nil)),
    s(:defs,
      s(:self), :to_toc,
      s(:args),
      s(:or_asgn,
        s(:ivasgn, :@to_toc),
        s(:send, nil, :new))),
    s(:send, nil, :attr_reader,
      s(:sym, :res)),
    s(:send, nil, :attr_accessor,
      s(:sym, :omit_headings_below)),
    s(:def, :initialize,
      s(:args),
      s(:begin,
        s(:super,
          s(:nil)),
        s(:ivasgn, :@omit_headings_below,
          s(:nil)))),
    s(:def, :accept_document,
      s(:args,
        s(:arg, :document)),
      s(:begin,
        s(:ivasgn, :@omit_headings_below,
          s(:send,
            s(:lvar, :document), :omit_headings_below)),
        s(:zsuper))),
    s(:def, :accept_heading,
      s(:args,
        s(:arg, :heading)),
      s(:if,
        s(:send, nil, :suppressed?,
          s(:lvar, :heading)), nil,
        s(:send,
          s(:ivar, :@res), :<<,
          s(:lvar, :heading)))),
    s(:def, :end_accepting,
      s(:args),
      s(:ivar, :@res)),
    s(:def, :start_accepting,
      s(:args),
      s(:begin,
        s(:ivasgn, :@omit_headings_below,
          s(:nil)),
        s(:ivasgn, :@res,
          s(:array)))),
    s(:def, :suppressed?,
      s(:args,
        s(:arg, :heading)),
      s(:begin,
        s(:if,
          s(:ivar, :@omit_headings_below), nil,
          s(:return,
            s(:false))),
        s(:send,
          s(:send,
            s(:lvar, :heading), :level), :>,
          s(:ivar, :@omit_headings_below)))),
    s(:alias,
      s(:sym, :accept_block_quote),
      s(:sym, :ignore)),
    s(:alias,
      s(:sym, :accept_raw),
      s(:sym, :ignore)),
    s(:alias,
      s(:sym, :accept_rule),
      s(:sym, :ignore)),
    s(:alias,
      s(:sym, :accept_blank_line),
      s(:sym, :ignore)),
    s(:alias,
      s(:sym, :accept_paragraph),
      s(:sym, :ignore)),
    s(:alias,
      s(:sym, :accept_verbatim),
      s(:sym, :ignore)),
    s(:alias,
      s(:sym, :accept_list_end),
      s(:sym, :ignore)),
    s(:alias,
      s(:sym, :accept_list_item_start),
      s(:sym, :ignore)),
    s(:alias,
      s(:sym, :accept_list_item_end),
      s(:sym, :ignore)),
    s(:alias,
      s(:sym, :accept_list_end_bullet),
      s(:sym, :ignore)),
    s(:alias,
      s(:sym, :accept_list_start),
      s(:sym, :ignore))))

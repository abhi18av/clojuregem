s(:class,
  s(:const,
    s(:const,
      s(:const, nil, :RDoc), :Markup), :ToTest),
  s(:const,
    s(:const,
      s(:const, nil, :RDoc), :Markup), :Formatter),
  s(:begin,
    s(:def, :start_accepting,
      s(:args),
      s(:begin,
        s(:ivasgn, :@res,
          s(:array)),
        s(:ivasgn, :@list,
          s(:array)))),
    s(:def, :end_accepting,
      s(:args),
      s(:ivar, :@res)),
    s(:def, :accept_paragraph,
      s(:args,
        s(:arg, :paragraph)),
      s(:send,
        s(:ivar, :@res), :<<,
        s(:send, nil, :convert_flow,
          s(:send,
            s(:ivar, :@am), :flow,
            s(:send,
              s(:lvar, :paragraph), :text))))),
    s(:def, :accept_raw,
      s(:args,
        s(:arg, :raw)),
      s(:send,
        s(:ivar, :@res), :<<,
        s(:send,
          s(:send,
            s(:lvar, :raw), :parts), :join))),
    s(:def, :accept_verbatim,
      s(:args,
        s(:arg, :verbatim)),
      s(:send,
        s(:ivar, :@res), :<<,
        s(:send,
          s(:send,
            s(:lvar, :verbatim), :text), :gsub,
          s(:regexp,
            s(:str, "^(\\S)"),
            s(:regopt)),
          s(:str, "  \\1")))),
    s(:def, :accept_list_start,
      s(:args,
        s(:arg, :list)),
      s(:send,
        s(:ivar, :@list), :<<,
        s(:case,
          s(:send,
            s(:lvar, :list), :type),
          s(:when,
            s(:sym, :BULLET),
            s(:str, "*")),
          s(:when,
            s(:sym, :NUMBER),
            s(:str, "1")),
          s(:send,
            s(:lvar, :list), :type)))),
    s(:def, :accept_list_end,
      s(:args,
        s(:arg, :list)),
      s(:send,
        s(:ivar, :@list), :pop)),
    s(:def, :accept_list_item_start,
      s(:args,
        s(:arg, :list_item)),
      s(:send,
        s(:ivar, :@res), :<<,
        s(:dstr,
          s(:begin,
            s(:send,
              s(:str, " "), :*,
              s(:begin,
                s(:send,
                  s(:send,
                    s(:ivar, :@list), :size), :-,
                  s(:int, 1))))),
          s(:begin,
            s(:send,
              s(:ivar, :@list), :last)),
          s(:str, ": ")))),
    s(:def, :accept_list_item_end,
      s(:args,
        s(:arg, :list_item)), nil),
    s(:def, :accept_blank_line,
      s(:args,
        s(:arg, :blank_line)),
      s(:send,
        s(:ivar, :@res), :<<,
        s(:str, "\n"))),
    s(:def, :accept_heading,
      s(:args,
        s(:arg, :heading)),
      s(:send,
        s(:ivar, :@res), :<<,
        s(:dstr,
          s(:begin,
            s(:send,
              s(:str, "="), :*,
              s(:send,
                s(:lvar, :heading), :level))),
          s(:str, " "),
          s(:begin,
            s(:send,
              s(:lvar, :heading), :text))))),
    s(:def, :accept_rule,
      s(:args,
        s(:arg, :rule)),
      s(:send,
        s(:ivar, :@res), :<<,
        s(:send,
          s(:str, "-"), :*,
          s(:send,
            s(:lvar, :rule), :weight))))))

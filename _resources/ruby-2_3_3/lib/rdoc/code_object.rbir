s(:class,
  s(:const,
    s(:const, nil, :RDoc), :CodeObject), nil,
  s(:begin,
    s(:send, nil, :include,
      s(:const,
        s(:const, nil, :RDoc), :Text)),
    s(:send, nil, :attr_reader,
      s(:sym, :comment)),
    s(:send, nil, :attr_reader,
      s(:sym, :document_children)),
    s(:send, nil, :attr_reader,
      s(:sym, :document_self)),
    s(:send, nil, :attr_reader,
      s(:sym, :done_documenting)),
    s(:send, nil, :attr_reader,
      s(:sym, :file)),
    s(:send, nil, :attr_reader,
      s(:sym, :force_documentation)),
    s(:send, nil, :attr_accessor,
      s(:sym, :line)),
    s(:send, nil, :attr_reader,
      s(:sym, :metadata)),
    s(:send, nil, :attr_accessor,
      s(:sym, :offset)),
    s(:send, nil, :attr_writer,
      s(:sym, :parent)),
    s(:send, nil, :attr_reader,
      s(:sym, :received_nodoc)),
    s(:send, nil, :attr_writer,
      s(:sym, :section)),
    s(:send, nil, :attr_reader,
      s(:sym, :store)),
    s(:send, nil, :attr_accessor,
      s(:sym, :viewer)),
    s(:def, :initialize,
      s(:args),
      s(:begin,
        s(:ivasgn, :@metadata,
          s(:hash)),
        s(:ivasgn, :@comment,
          s(:str, "")),
        s(:ivasgn, :@parent,
          s(:nil)),
        s(:ivasgn, :@parent_name,
          s(:nil)),
        s(:ivasgn, :@parent_class,
          s(:nil)),
        s(:ivasgn, :@section,
          s(:nil)),
        s(:ivasgn, :@section_title,
          s(:nil)),
        s(:ivasgn, :@file,
          s(:nil)),
        s(:ivasgn, :@full_name,
          s(:nil)),
        s(:ivasgn, :@store,
          s(:nil)),
        s(:ivasgn, :@track_visibility,
          s(:true)),
        s(:send, nil, :initialize_visibility))),
    s(:def, :initialize_visibility,
      s(:args),
      s(:begin,
        s(:ivasgn, :@document_children,
          s(:true)),
        s(:ivasgn, :@document_self,
          s(:true)),
        s(:ivasgn, :@done_documenting,
          s(:false)),
        s(:ivasgn, :@force_documentation,
          s(:false)),
        s(:ivasgn, :@received_nodoc,
          s(:false)),
        s(:ivasgn, :@ignored,
          s(:false)),
        s(:ivasgn, :@suppressed,
          s(:false)),
        s(:ivasgn, :@track_visibility,
          s(:true)))),
    s(:def, :comment=,
      s(:args,
        s(:arg, :comment)),
      s(:ivasgn, :@comment,
        s(:case,
          s(:lvar, :comment),
          s(:when,
            s(:const, nil, :NilClass),
            s(:str, "")),
          s(:when,
            s(:const,
              s(:const,
                s(:const, nil, :RDoc), :Markup), :Document),
            s(:lvar, :comment)),
          s(:when,
            s(:const,
              s(:const, nil, :RDoc), :Comment),
            s(:send,
              s(:lvar, :comment), :normalize)),
          s(:if,
            s(:and,
              s(:lvar, :comment),
              s(:send,
                s(:send,
                  s(:lvar, :comment), :empty?), :!)),
            s(:send, nil, :normalize_comment,
              s(:lvar, :comment)),
            s(:begin,
              s(:if,
                s(:and,
                  s(:and,
                    s(:send,
                      s(:const, nil, :String), :===,
                      s(:ivar, :@comment)),
                    s(:send,
                      s(:const, nil, :Object), :const_defined?,
                      s(:sym, :Encoding))),
                  s(:send,
                    s(:ivar, :@comment), :empty?)),
                s(:send,
                  s(:ivar, :@comment), :force_encoding,
                  s(:send,
                    s(:lvar, :comment), :encoding)), nil),
              s(:ivar, :@comment)))))),
    s(:def, :display?,
      s(:args),
      s(:and,
        s(:and,
          s(:ivar, :@document_self),
          s(:send,
            s(:ivar, :@ignored), :!)),
        s(:begin,
          s(:or,
            s(:send, nil, :documented?),
            s(:send,
              s(:ivar, :@suppressed), :!))))),
    s(:def, :document_children=,
      s(:args,
        s(:arg, :document_children)),
      s(:begin,
        s(:if,
          s(:ivar, :@track_visibility), nil,
          s(:return)),
        s(:if,
          s(:ivar, :@done_documenting), nil,
          s(:ivasgn, :@document_children,
            s(:lvar, :document_children))))),
    s(:def, :document_self=,
      s(:args,
        s(:arg, :document_self)),
      s(:begin,
        s(:if,
          s(:ivar, :@track_visibility), nil,
          s(:return)),
        s(:if,
          s(:ivar, :@done_documenting),
          s(:return), nil),
        s(:ivasgn, :@document_self,
          s(:lvar, :document_self)),
        s(:if,
          s(:send,
            s(:lvar, :document_self), :nil?),
          s(:ivasgn, :@received_nodoc,
            s(:true)), nil))),
    s(:def, :documented?,
      s(:args),
      s(:or,
        s(:ivar, :@received_nodoc),
        s(:send,
          s(:send,
            s(:ivar, :@comment), :empty?), :!))),
    s(:def, :done_documenting=,
      s(:args,
        s(:arg, :value)),
      s(:begin,
        s(:if,
          s(:ivar, :@track_visibility), nil,
          s(:return)),
        s(:ivasgn, :@done_documenting,
          s(:lvar, :value)),
        s(:ivasgn, :@document_self,
          s(:send,
            s(:lvar, :value), :!)),
        s(:ivasgn, :@document_children,
          s(:ivar, :@document_self)))),
    s(:def, :each_parent,
      s(:args),
      s(:begin,
        s(:lvasgn, :code_object,
          s(:self)),
        s(:while,
          s(:lvasgn, :code_object,
            s(:send,
              s(:lvar, :code_object), :parent)),
          s(:yield,
            s(:lvar, :code_object))),
        s(:self))),
    s(:def, :file_name,
      s(:args),
      s(:begin,
        s(:if,
          s(:ivar, :@file), nil,
          s(:return)),
        s(:send,
          s(:ivar, :@file), :absolute_name))),
    s(:def, :force_documentation=,
      s(:args,
        s(:arg, :value)),
      s(:if,
        s(:ivar, :@done_documenting), nil,
        s(:ivasgn, :@force_documentation,
          s(:lvar, :value)))),
    s(:def, :full_name=,
      s(:args,
        s(:arg, :full_name)),
      s(:ivasgn, :@full_name,
        s(:lvar, :full_name))),
    s(:def, :ignore,
      s(:args),
      s(:begin,
        s(:if,
          s(:ivar, :@track_visibility), nil,
          s(:return)),
        s(:ivasgn, :@ignored,
          s(:true)),
        s(:send, nil, :stop_doc))),
    s(:def, :ignored?,
      s(:args),
      s(:ivar, :@ignored)),
    s(:def, :options,
      s(:args),
      s(:if,
        s(:and,
          s(:ivar, :@store),
          s(:send,
            s(:ivar, :@store), :rdoc)),
        s(:send,
          s(:send,
            s(:ivar, :@store), :rdoc), :options),
        s(:send,
          s(:const,
            s(:const, nil, :RDoc), :Options), :new))),
    s(:def, :parent,
      s(:args),
      s(:begin,
        s(:if,
          s(:ivar, :@parent),
          s(:return,
            s(:ivar, :@parent)), nil),
        s(:if,
          s(:ivar, :@parent_name), nil,
          s(:return,
            s(:nil))),
        s(:if,
          s(:send,
            s(:ivar, :@parent_class), :==,
            s(:const,
              s(:const, nil, :RDoc), :TopLevel)),
          s(:ivasgn, :@parent,
            s(:send,
              s(:ivar, :@store), :add_file,
              s(:ivar, :@parent_name))),
          s(:begin,
            s(:ivasgn, :@parent,
              s(:send,
                s(:ivar, :@store), :find_class_or_module,
                s(:ivar, :@parent_name))),
            s(:if,
              s(:ivar, :@parent),
              s(:return,
                s(:ivar, :@parent)), nil),
            s(:kwbegin,
              s(:rescue,
                s(:ivasgn, :@parent,
                  s(:send,
                    s(:ivar, :@store), :load_class,
                    s(:ivar, :@parent_name))),
                s(:resbody,
                  s(:array,
                    s(:const,
                      s(:const,
                        s(:const, nil, :RDoc), :Store), :MissingFileError)), nil,
                  s(:nil)), nil)))))),
    s(:def, :parent_file_name,
      s(:args),
      s(:if,
        s(:ivar, :@parent),
        s(:send,
          s(:ivar, :@parent), :base_name),
        s(:str, "(unknown)"))),
    s(:def, :parent_name,
      s(:args),
      s(:if,
        s(:ivar, :@parent),
        s(:send,
          s(:ivar, :@parent), :full_name),
        s(:str, "(unknown)"))),
    s(:def, :record_location,
      s(:args,
        s(:arg, :top_level)),
      s(:begin,
        s(:ivasgn, :@ignored,
          s(:false)),
        s(:ivasgn, :@suppressed,
          s(:false)),
        s(:ivasgn, :@file,
          s(:lvar, :top_level)))),
    s(:def, :section,
      s(:args),
      s(:begin,
        s(:if,
          s(:ivar, :@section),
          s(:return,
            s(:ivar, :@section)), nil),
        s(:if,
          s(:send, nil, :parent),
          s(:ivasgn, :@section,
            s(:send,
              s(:send, nil, :parent), :add_section,
              s(:ivar, :@section_title))), nil))),
    s(:def, :start_doc,
      s(:args),
      s(:begin,
        s(:if,
          s(:ivar, :@done_documenting),
          s(:return), nil),
        s(:ivasgn, :@document_self,
          s(:true)),
        s(:ivasgn, :@document_children,
          s(:true)),
        s(:ivasgn, :@ignored,
          s(:false)),
        s(:ivasgn, :@suppressed,
          s(:false)))),
    s(:def, :stop_doc,
      s(:args),
      s(:begin,
        s(:if,
          s(:ivar, :@track_visibility), nil,
          s(:return)),
        s(:ivasgn, :@document_self,
          s(:false)),
        s(:ivasgn, :@document_children,
          s(:false)))),
    s(:def, :store=,
      s(:args,
        s(:arg, :store)),
      s(:begin,
        s(:ivasgn, :@store,
          s(:lvar, :store)),
        s(:if,
          s(:ivar, :@track_visibility), nil,
          s(:return)),
        s(:if,
          s(:send,
            s(:sym, :nodoc), :==,
            s(:send,
              s(:send, nil, :options), :visibility)),
          s(:begin,
            s(:send, nil, :initialize_visibility),
            s(:ivasgn, :@track_visibility,
              s(:false))), nil))),
    s(:def, :suppress,
      s(:args),
      s(:begin,
        s(:if,
          s(:ivar, :@track_visibility), nil,
          s(:return)),
        s(:ivasgn, :@suppressed,
          s(:true)),
        s(:send, nil, :stop_doc))),
    s(:def, :suppressed?,
      s(:args),
      s(:ivar, :@suppressed))))

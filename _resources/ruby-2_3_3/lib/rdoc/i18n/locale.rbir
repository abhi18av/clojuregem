s(:class,
  s(:const,
    s(:const,
      s(:const, nil, :RDoc), :I18n), :Locale), nil,
  s(:begin,
    s(:cvasgn, :@@locales,
      s(:hash)),
    s(:sclass,
      s(:self),
      s(:begin,
        s(:def, :[],
          s(:args,
            s(:arg, :locale_name)),
          s(:or_asgn,
            s(:send,
              s(:cvar, :@@locales), :[],
              s(:lvar, :locale_name)),
            s(:send, nil, :new,
              s(:lvar, :locale_name)))),
        s(:def, :[]=,
          s(:args,
            s(:arg, :locale_name),
            s(:arg, :locale)),
          s(:send,
            s(:cvar, :@@locales), :[]=,
            s(:lvar, :locale_name),
            s(:lvar, :locale))))),
    s(:send, nil, :attr_reader,
      s(:sym, :name)),
    s(:def, :initialize,
      s(:args,
        s(:arg, :name)),
      s(:begin,
        s(:ivasgn, :@name,
          s(:lvar, :name)),
        s(:ivasgn, :@messages,
          s(:hash)))),
    s(:def, :load,
      s(:args,
        s(:arg, :locale_directory)),
      s(:begin,
        s(:if,
          s(:send,
            s(:ivar, :@name), :nil?),
          s(:return,
            s(:false)), nil),
        s(:lvasgn, :po_file_candidates,
          s(:array,
            s(:send,
              s(:const, nil, :File), :join,
              s(:lvar, :locale_directory),
              s(:ivar, :@name),
              s(:str, "rdoc.po")),
            s(:send,
              s(:const, nil, :File), :join,
              s(:lvar, :locale_directory),
              s(:dstr,
                s(:begin,
                  s(:ivar, :@name)),
                s(:str, ".po"))))),
        s(:lvasgn, :po_file,
          s(:block,
            s(:send,
              s(:lvar, :po_file_candidates), :find),
            s(:args,
              s(:arg, :po_file_candidate)),
            s(:send,
              s(:const, nil, :File), :exist?,
              s(:lvar, :po_file_candidate)))),
        s(:if,
          s(:lvar, :po_file), nil,
          s(:return,
            s(:false))),
        s(:kwbegin,
          s(:rescue,
            s(:begin,
              s(:send, nil, :require,
                s(:str, "gettext/po_parser")),
              s(:send, nil, :require,
                s(:str, "gettext/mo"))),
            s(:resbody,
              s(:array,
                s(:const, nil, :LoadError)), nil,
              s(:begin,
                s(:send, nil, :warn,
                  s(:str, "Need gettext gem for i18n feature:")),
                s(:send, nil, :warn,
                  s(:str, "  gem install gettext")),
                s(:return,
                  s(:false)))), nil)),
        s(:lvasgn, :po_parser,
          s(:send,
            s(:const,
              s(:const, nil, :GetText), :POParser), :new)),
        s(:lvasgn, :messages,
          s(:send,
            s(:const,
              s(:const, nil, :GetText), :MO), :new)),
        s(:send,
          s(:lvar, :po_parser), :report_warning=,
          s(:false)),
        s(:send,
          s(:lvar, :po_parser), :parse_file,
          s(:lvar, :po_file),
          s(:lvar, :messages)),
        s(:send,
          s(:ivar, :@messages), :merge!,
          s(:lvar, :messages)),
        s(:true))),
    s(:def, :translate,
      s(:args,
        s(:arg, :message)),
      s(:or,
        s(:send,
          s(:ivar, :@messages), :[],
          s(:lvar, :message)),
        s(:lvar, :message)))))

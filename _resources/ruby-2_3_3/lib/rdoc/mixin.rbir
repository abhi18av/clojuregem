s(:class,
  s(:const,
    s(:const, nil, :RDoc), :Mixin),
  s(:const,
    s(:const, nil, :RDoc), :CodeObject),
  s(:begin,
    s(:send, nil, :attr_accessor,
      s(:sym, :name)),
    s(:def, :initialize,
      s(:args,
        s(:arg, :name),
        s(:arg, :comment)),
      s(:begin,
        s(:super),
        s(:ivasgn, :@name,
          s(:lvar, :name)),
        s(:send,
          s(:self), :comment=,
          s(:lvar, :comment)),
        s(:ivasgn, :@module,
          s(:nil)))),
    s(:def, :<=>,
      s(:args,
        s(:arg, :other)),
      s(:begin,
        s(:if,
          s(:send,
            s(:send,
              s(:self), :class), :===,
            s(:lvar, :other)), nil,
          s(:return)),
        s(:send,
          s(:send, nil, :name), :<=>,
          s(:send,
            s(:lvar, :other), :name)))),
    s(:def, :==,
      s(:args,
        s(:arg, :other)),
      s(:and,
        s(:send,
          s(:send,
            s(:self), :class), :===,
          s(:lvar, :other)),
        s(:send,
          s(:ivar, :@name), :==,
          s(:send,
            s(:lvar, :other), :name)))),
    s(:alias,
      s(:sym, :eql?),
      s(:sym, :==)),
    s(:def, :full_name,
      s(:args),
      s(:begin,
        s(:lvasgn, :m,
          s(:send,
            s(:self), :module)),
        s(:if,
          s(:send,
            s(:const,
              s(:const, nil, :RDoc), :ClassModule), :===,
            s(:lvar, :m)),
          s(:send,
            s(:lvar, :m), :full_name),
          s(:ivar, :@name)))),
    s(:def, :hash,
      s(:args),
      s(:send,
        s(:array,
          s(:ivar, :@name),
          s(:send,
            s(:self), :module)), :hash)),
    s(:def, :inspect,
      s(:args),
      s(:send,
        s(:str, "#<%s:0x%x %s.%s %s>"), :%,
        s(:array,
          s(:send,
            s(:self), :class),
          s(:send, nil, :object_id),
          s(:send, nil, :parent_name),
          s(:send,
            s(:send,
              s(:send,
                s(:self), :class), :name), :downcase),
          s(:ivar, :@name)))),
    s(:def, :module,
      s(:args),
      s(:begin,
        s(:if,
          s(:ivar, :@module),
          s(:return,
            s(:ivar, :@module)), nil),
        s(:if,
          s(:send, nil, :parent), nil,
          s(:return,
            s(:ivar, :@name))),
        s(:lvasgn, :full_name,
          s(:send,
            s(:send, nil, :parent), :child_name,
            s(:ivar, :@name))),
        s(:ivasgn, :@module,
          s(:send,
            s(:send,
              s(:ivar, :@store), :modules_hash), :[],
            s(:lvar, :full_name))),
        s(:if,
          s(:ivar, :@module),
          s(:return,
            s(:ivar, :@module)), nil),
        s(:if,
          s(:send,
            s(:ivar, :@name), :=~,
            s(:regexp,
              s(:str, "^::"),
              s(:regopt))),
          s(:return,
            s(:ivar, :@name)), nil),
        s(:lvasgn, :searched,
          s(:send,
            s(:block,
              s(:send,
                s(:send,
                  s(:send, nil, :parent), :includes), :take_while),
              s(:args,
                s(:arg, :i)),
              s(:send,
                s(:lvar, :i), :!=,
                s(:self))), :reverse)),
        s(:block,
          s(:send,
            s(:lvar, :searched), :each),
          s(:args,
            s(:arg, :i)),
          s(:begin,
            s(:lvasgn, :inc,
              s(:send,
                s(:lvar, :i), :module)),
            s(:if,
              s(:send,
                s(:const, nil, :String), :===,
                s(:lvar, :inc)),
              s(:next), nil),
            s(:lvasgn, :full_name,
              s(:send,
                s(:lvar, :inc), :child_name,
                s(:ivar, :@name))),
            s(:ivasgn, :@module,
              s(:send,
                s(:send,
                  s(:ivar, :@store), :modules_hash), :[],
                s(:lvar, :full_name))),
            s(:if,
              s(:ivar, :@module),
              s(:return,
                s(:ivar, :@module)), nil))),
        s(:lvasgn, :up,
          s(:send,
            s(:send, nil, :parent), :parent)),
        s(:while,
          s(:lvar, :up),
          s(:begin,
            s(:lvasgn, :full_name,
              s(:send,
                s(:lvar, :up), :child_name,
                s(:ivar, :@name))),
            s(:ivasgn, :@module,
              s(:send,
                s(:send,
                  s(:ivar, :@store), :modules_hash), :[],
                s(:lvar, :full_name))),
            s(:if,
              s(:ivar, :@module),
              s(:return,
                s(:ivar, :@module)), nil),
            s(:lvasgn, :up,
              s(:send,
                s(:lvar, :up), :parent)))),
        s(:ivar, :@name))),
    s(:def, :store=,
      s(:args,
        s(:arg, :store)),
      s(:begin,
        s(:zsuper),
        s(:if,
          s(:ivar, :@file),
          s(:ivasgn, :@file,
            s(:send,
              s(:ivar, :@store), :add_file,
              s(:send,
                s(:ivar, :@file), :full_name))), nil))),
    s(:def, :to_s,
      s(:args),
      s(:dstr,
        s(:begin,
          s(:send,
            s(:send,
              s(:send,
                s(:self), :class), :name), :downcase)),
        s(:str, " "),
        s(:ivar, :@name),
        s(:str, " in: "),
        s(:begin,
          s(:send, nil, :parent))))))

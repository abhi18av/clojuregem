s(:class,
  s(:const,
    s(:const, nil, :RDoc), :RD), nil,
  s(:begin,
    s(:defs,
      s(:self), :parse,
      s(:args,
        s(:arg, :rd)),
      s(:begin,
        s(:lvasgn, :rd,
          s(:send,
            s(:send,
              s(:lvar, :rd), :lines), :to_a)),
        s(:if,
          s(:and,
            s(:block,
              s(:send,
                s(:lvar, :rd), :find),
              s(:args,
                s(:arg, :i)),
              s(:send,
                s(:regexp,
                  s(:str, "\\S"),
                  s(:regopt)), :===,
                s(:lvar, :i))),
            s(:send,
              s(:block,
                s(:send,
                  s(:lvar, :rd), :find),
                s(:args,
                  s(:arg, :i)),
                s(:send,
                  s(:regexp,
                    s(:str, "^=begin\\b"),
                    s(:regopt)), :===,
                  s(:lvar, :i))), :!)),
          s(:send,
            s(:send,
              s(:lvar, :rd), :unshift,
              s(:str, "=begin\n")), :push,
            s(:str, "=end\n")), nil),
        s(:lvasgn, :parser,
          s(:send,
            s(:const,
              s(:const,
                s(:const, nil, :RDoc), :RD), :BlockParser), :new)),
        s(:lvasgn, :document,
          s(:send,
            s(:lvar, :parser), :parse,
            s(:lvar, :rd))),
        s(:if,
          s(:send,
            s(:const,
              s(:const,
                s(:const, nil, :RDoc), :Markup), :BlankLine), :===,
            s(:send,
              s(:send,
                s(:lvar, :document), :parts), :first)),
          s(:send,
            s(:send,
              s(:lvar, :document), :parts), :shift), nil),
        s(:if,
          s(:send,
            s(:const,
              s(:const,
                s(:const, nil, :RDoc), :Markup), :BlankLine), :===,
            s(:send,
              s(:send,
                s(:lvar, :document), :parts), :last)),
          s(:send,
            s(:send,
              s(:lvar, :document), :parts), :pop), nil),
        s(:lvar, :document))),
    s(:send, nil, :autoload,
      s(:sym, :BlockParser),
      s(:str, "rdoc/rd/block_parser")),
    s(:send, nil, :autoload,
      s(:sym, :InlineParser),
      s(:str, "rdoc/rd/inline_parser")),
    s(:send, nil, :autoload,
      s(:sym, :Inline),
      s(:str, "rdoc/rd/inline"))))

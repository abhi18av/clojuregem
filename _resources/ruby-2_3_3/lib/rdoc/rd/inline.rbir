s(:class,
  s(:const,
    s(:const,
      s(:const, nil, :RDoc), :RD), :Inline), nil,
  s(:begin,
    s(:send, nil, :attr_reader,
      s(:sym, :reference)),
    s(:send, nil, :attr_reader,
      s(:sym, :rdoc)),
    s(:defs,
      s(:self), :new,
      s(:args,
        s(:arg, :rdoc),
        s(:optarg, :reference,
          s(:lvar, :rdoc))),
      s(:if,
        s(:and,
          s(:send,
            s(:self), :===,
            s(:lvar, :rdoc)),
          s(:send,
            s(:lvar, :reference), :equal?,
            s(:lvar, :rdoc))),
        s(:lvar, :rdoc),
        s(:zsuper))),
    s(:def, :initialize,
      s(:args,
        s(:arg, :rdoc),
        s(:arg, :reference)),
      s(:begin,
        s(:ivasgn, :@reference,
          s(:if,
            s(:send,
              s(:lvar, :reference), :equal?,
              s(:lvar, :rdoc)),
            s(:send,
              s(:lvar, :reference), :dup),
            s(:lvar, :reference))),
        s(:if,
          s(:send,
            s(:send,
              s(:self), :class), :===,
            s(:ivar, :@reference)),
          s(:ivasgn, :@reference,
            s(:send,
              s(:ivar, :@reference), :reference)), nil),
        s(:ivasgn, :@rdoc,
          s(:lvar, :rdoc)))),
    s(:def, :==,
      s(:args,
        s(:arg, :other)),
      s(:and,
        s(:and,
          s(:send,
            s(:send,
              s(:self), :class), :===,
            s(:lvar, :other)),
          s(:send,
            s(:ivar, :@reference), :==,
            s(:send,
              s(:lvar, :other), :reference))),
        s(:send,
          s(:ivar, :@rdoc), :==,
          s(:send,
            s(:lvar, :other), :rdoc)))),
    s(:def, :append,
      s(:args,
        s(:arg, :more)),
      s(:begin,
        s(:case,
          s(:lvar, :more),
          s(:when,
            s(:const, nil, :String),
            s(:begin,
              s(:send,
                s(:ivar, :@reference), :<<,
                s(:lvar, :more)),
              s(:send,
                s(:ivar, :@rdoc), :<<,
                s(:lvar, :more)))),
          s(:when,
            s(:const,
              s(:const,
                s(:const, nil, :RDoc), :RD), :Inline),
            s(:begin,
              s(:send,
                s(:ivar, :@reference), :<<,
                s(:send,
                  s(:lvar, :more), :reference)),
              s(:send,
                s(:ivar, :@rdoc), :<<,
                s(:send,
                  s(:lvar, :more), :rdoc)))),
          s(:send, nil, :raise,
            s(:dstr,
              s(:str, "unknown thingy "),
              s(:begin,
                s(:lvar, :more))))),
        s(:self))),
    s(:def, :inspect,
      s(:args),
      s(:dstr,
        s(:str, "(inline: "),
        s(:begin,
          s(:self)),
        s(:str, ")"))),
    s(:alias,
      s(:sym, :to_s),
      s(:sym, :rdoc))))

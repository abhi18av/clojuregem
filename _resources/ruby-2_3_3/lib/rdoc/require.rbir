s(:class,
  s(:const,
    s(:const, nil, :RDoc), :Require),
  s(:const,
    s(:const, nil, :RDoc), :CodeObject),
  s(:begin,
    s(:send, nil, :attr_accessor,
      s(:sym, :name)),
    s(:def, :initialize,
      s(:args,
        s(:arg, :name),
        s(:arg, :comment)),
      s(:begin,
        s(:super),
        s(:ivasgn, :@name,
          s(:send,
            s(:lvar, :name), :gsub,
            s(:regexp,
              s(:str, "'|\""),
              s(:regopt)),
            s(:str, ""))),
        s(:ivasgn, :@top_level,
          s(:nil)),
        s(:send,
          s(:self), :comment=,
          s(:lvar, :comment)))),
    s(:def, :inspect,
      s(:args),
      s(:send,
        s(:str, "#<%s:0x%x require '%s' in %s>"), :%,
        s(:array,
          s(:send,
            s(:self), :class),
          s(:send, nil, :object_id),
          s(:ivar, :@name),
          s(:send, nil, :parent_file_name)))),
    s(:def, :to_s,
      s(:args),
      s(:dstr,
        s(:str, "require "),
        s(:begin,
          s(:send, nil, :name)),
        s(:str, " in: "),
        s(:begin,
          s(:send, nil, :parent)))),
    s(:def, :top_level,
      s(:args),
      s(:or_asgn,
        s(:ivasgn, :@top_level),
        s(:kwbegin,
          s(:lvasgn, :tl,
            s(:send,
              s(:send,
                s(:const,
                  s(:const, nil, :RDoc), :TopLevel), :all_files_hash), :[],
              s(:send,
                s(:send, nil, :name), :+,
                s(:str, ".rb")))),
          s(:if,
            s(:and,
              s(:send,
                s(:lvar, :tl), :nil?),
              s(:send,
                s(:send,
                  s(:send,
                    s(:send,
                      s(:const,
                        s(:const, nil, :RDoc), :TopLevel), :all_files), :first), :full_name), :=~,
                s(:regexp,
                  s(:str, "^lib/"),
                  s(:regopt)))),
            s(:lvasgn, :tl,
              s(:send,
                s(:send,
                  s(:const,
                    s(:const, nil, :RDoc), :TopLevel), :all_files_hash), :[],
                s(:send,
                  s(:send,
                    s(:str, "lib/"), :+,
                    s(:send, nil, :name)), :+,
                  s(:str, ".rb")))), nil),
          s(:lvar, :tl))))))

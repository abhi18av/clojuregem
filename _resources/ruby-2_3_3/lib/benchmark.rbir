s(:module,
  s(:const, nil, :Benchmark),
  s(:begin,
    s(:casgn, nil, :BENCHMARK_VERSION,
      s(:str, "2002-04-25")),
    s(:def, :benchmark,
      s(:args,
        s(:optarg, :caption,
          s(:str, "")),
        s(:optarg, :label_width,
          s(:nil)),
        s(:optarg, :format,
          s(:nil)),
        s(:restarg, :labels)),
      s(:ensure,
        s(:begin,
          s(:lvasgn, :sync,
            s(:send,
              s(:const, nil, :STDOUT), :sync)),
          s(:send,
            s(:const, nil, :STDOUT), :sync=,
            s(:true)),
          s(:or_asgn,
            s(:lvasgn, :label_width),
            s(:int, 0)),
          s(:op_asgn,
            s(:lvasgn, :label_width), :+,
            s(:int, 1)),
          s(:or_asgn,
            s(:lvasgn, :format),
            s(:const, nil, :FORMAT)),
          s(:if,
            s(:send,
              s(:lvar, :caption), :empty?), nil,
            s(:send, nil, :print,
              s(:send,
                s(:send,
                  s(:str, " "), :*,
                  s(:lvar, :label_width)), :+,
                s(:lvar, :caption)))),
          s(:lvasgn, :report,
            s(:send,
              s(:const, nil, :Report), :new,
              s(:lvar, :label_width),
              s(:lvar, :format))),
          s(:lvasgn, :results,
            s(:yield,
              s(:lvar, :report))),
          s(:and,
            s(:send,
              s(:const, nil, :Array), :===,
              s(:lvar, :results)),
            s(:block,
              s(:send,
                s(:send,
                  s(:lvar, :results), :grep,
                  s(:const, nil, :Tms)), :each),
              s(:args,
                s(:arg, :t)),
              s(:send, nil, :print,
                s(:send,
                  s(:begin,
                    s(:or,
                      s(:or,
                        s(:send,
                          s(:lvar, :labels), :shift),
                        s(:send,
                          s(:lvar, :t), :label)),
                      s(:str, ""))), :ljust,
                  s(:lvar, :label_width)),
                s(:send,
                  s(:lvar, :t), :format,
                  s(:lvar, :format))))),
          s(:send,
            s(:lvar, :report), :list)),
        s(:if,
          s(:send,
            s(:lvar, :sync), :nil?), nil,
          s(:send,
            s(:const, nil, :STDOUT), :sync=,
            s(:lvar, :sync))))),
    s(:def, :bm,
      s(:args,
        s(:optarg, :label_width,
          s(:int, 0)),
        s(:restarg, :labels),
        s(:blockarg, :blk)),
      s(:send, nil, :benchmark,
        s(:const, nil, :CAPTION),
        s(:lvar, :label_width),
        s(:const, nil, :FORMAT),
        s(:splat,
          s(:lvar, :labels)),
        s(:block_pass,
          s(:lvar, :blk)))),
    s(:def, :bmbm,
      s(:args,
        s(:optarg, :width,
          s(:int, 0))),
      s(:ensure,
        s(:begin,
          s(:lvasgn, :job,
            s(:send,
              s(:const, nil, :Job), :new,
              s(:lvar, :width))),
          s(:yield,
            s(:lvar, :job)),
          s(:lvasgn, :width,
            s(:send,
              s(:send,
                s(:lvar, :job), :width), :+,
              s(:int, 1))),
          s(:lvasgn, :sync,
            s(:send,
              s(:const, nil, :STDOUT), :sync)),
          s(:send,
            s(:const, nil, :STDOUT), :sync=,
            s(:true)),
          s(:send, nil, :puts,
            s(:send,
              s(:str, "Rehearsal "), :ljust,
              s(:send,
                s(:lvar, :width), :+,
                s(:send,
                  s(:const, nil, :CAPTION), :length)),
              s(:str, "-"))),
          s(:lvasgn, :ets,
            s(:send,
              s(:block,
                s(:send,
                  s(:send,
                    s(:lvar, :job), :list), :inject,
                  s(:send,
                    s(:const, nil, :Tms), :new)),
                s(:args,
                  s(:arg, :sum),
                  s(:mlhs,
                    s(:arg, :label),
                    s(:arg, :item))),
                s(:begin,
                  s(:send, nil, :print,
                    s(:send,
                      s(:lvar, :label), :ljust,
                      s(:lvar, :width))),
                  s(:lvasgn, :res,
                    s(:send,
                      s(:const, nil, :Benchmark), :measure,
                      s(:block_pass,
                        s(:lvar, :item)))),
                  s(:send, nil, :print,
                    s(:send,
                      s(:lvar, :res), :format)),
                  s(:send,
                    s(:lvar, :sum), :+,
                    s(:lvar, :res)))), :format,
              s(:str, "total: %tsec"))),
          s(:send, nil, :print,
            s(:send,
              s(:dstr,
                s(:str, " "),
                s(:begin,
                  s(:lvar, :ets)),
                s(:str, "\n\n")), :rjust,
              s(:send,
                s(:send,
                  s(:lvar, :width), :+,
                  s(:send,
                    s(:const, nil, :CAPTION), :length)), :+,
                s(:int, 2)),
              s(:str, "-"))),
          s(:send, nil, :print,
            s(:send,
              s(:send,
                s(:str, " "), :*,
                s(:lvar, :width)), :+,
              s(:const, nil, :CAPTION))),
          s(:block,
            s(:send,
              s(:send,
                s(:lvar, :job), :list), :map),
            s(:args,
              s(:arg, :label),
              s(:arg, :item)),
            s(:begin,
              s(:send,
                s(:const, nil, :GC), :start),
              s(:send, nil, :print,
                s(:send,
                  s(:lvar, :label), :ljust,
                  s(:lvar, :width))),
              s(:block,
                s(:send,
                  s(:send,
                    s(:const, nil, :Benchmark), :measure,
                    s(:lvar, :label),
                    s(:block_pass,
                      s(:lvar, :item))), :tap),
                s(:args,
                  s(:arg, :res)),
                s(:send, nil, :print,
                  s(:lvar, :res)))))),
        s(:if,
          s(:send,
            s(:lvar, :sync), :nil?), nil,
          s(:send,
            s(:const, nil, :STDOUT), :sync=,
            s(:lvar, :sync))))),
    s(:def, :measure,
      s(:args,
        s(:optarg, :label,
          s(:str, ""))),
      s(:begin,
        s(:masgn,
          s(:mlhs,
            s(:lvasgn, :t0),
            s(:lvasgn, :r0)),
          s(:array,
            s(:send,
              s(:const, nil, :Process), :times),
            s(:send,
              s(:const, nil, :Process), :clock_gettime,
              s(:const,
                s(:const, nil, :Process), :CLOCK_MONOTONIC)))),
        s(:yield),
        s(:masgn,
          s(:mlhs,
            s(:lvasgn, :t1),
            s(:lvasgn, :r1)),
          s(:array,
            s(:send,
              s(:const, nil, :Process), :times),
            s(:send,
              s(:const, nil, :Process), :clock_gettime,
              s(:const,
                s(:const, nil, :Process), :CLOCK_MONOTONIC)))),
        s(:send,
          s(:const,
            s(:const, nil, :Benchmark), :Tms), :new,
          s(:send,
            s(:send,
              s(:lvar, :t1), :utime), :-,
            s(:send,
              s(:lvar, :t0), :utime)),
          s(:send,
            s(:send,
              s(:lvar, :t1), :stime), :-,
            s(:send,
              s(:lvar, :t0), :stime)),
          s(:send,
            s(:send,
              s(:lvar, :t1), :cutime), :-,
            s(:send,
              s(:lvar, :t0), :cutime)),
          s(:send,
            s(:send,
              s(:lvar, :t1), :cstime), :-,
            s(:send,
              s(:lvar, :t0), :cstime)),
          s(:send,
            s(:lvar, :r1), :-,
            s(:lvar, :r0)),
          s(:lvar, :label)))),
    s(:def, :realtime,
      s(:args),
      s(:begin,
        s(:lvasgn, :r0,
          s(:send,
            s(:const, nil, :Process), :clock_gettime,
            s(:const,
              s(:const, nil, :Process), :CLOCK_MONOTONIC))),
        s(:yield),
        s(:send,
          s(:send,
            s(:const, nil, :Process), :clock_gettime,
            s(:const,
              s(:const, nil, :Process), :CLOCK_MONOTONIC)), :-,
          s(:lvar, :r0)))),
    s(:send, nil, :module_function,
      s(:sym, :benchmark),
      s(:sym, :measure),
      s(:sym, :realtime),
      s(:sym, :bm),
      s(:sym, :bmbm)),
    s(:class,
      s(:const, nil, :Job), nil,
      s(:begin,
        s(:def, :initialize,
          s(:args,
            s(:arg, :width)),
          s(:begin,
            s(:ivasgn, :@width,
              s(:lvar, :width)),
            s(:ivasgn, :@list,
              s(:array)))),
        s(:def, :item,
          s(:args,
            s(:optarg, :label,
              s(:str, "")),
            s(:blockarg, :blk)),
          s(:begin,
            s(:if,
              s(:send, nil, :block_given?), nil,
              s(:send, nil, :raise,
                s(:const, nil, :ArgumentError),
                s(:str, "no block"))),
            s(:lvasgn, :label,
              s(:send,
                s(:lvar, :label), :to_s)),
            s(:lvasgn, :w,
              s(:send,
                s(:lvar, :label), :length)),
            s(:if,
              s(:send,
                s(:ivar, :@width), :<,
                s(:lvar, :w)),
              s(:ivasgn, :@width,
                s(:lvar, :w)), nil),
            s(:send,
              s(:ivar, :@list), :<<,
              s(:array,
                s(:lvar, :label),
                s(:lvar, :blk))),
            s(:self))),
        s(:alias,
          s(:sym, :report),
          s(:sym, :item)),
        s(:send, nil, :attr_reader,
          s(:sym, :list)),
        s(:send, nil, :attr_reader,
          s(:sym, :width)))),
    s(:class,
      s(:const, nil, :Report), nil,
      s(:begin,
        s(:def, :initialize,
          s(:args,
            s(:optarg, :width,
              s(:int, 0)),
            s(:optarg, :format,
              s(:nil))),
          s(:masgn,
            s(:mlhs,
              s(:ivasgn, :@width),
              s(:ivasgn, :@format),
              s(:ivasgn, :@list)),
            s(:array,
              s(:lvar, :width),
              s(:lvar, :format),
              s(:array)))),
        s(:def, :item,
          s(:args,
            s(:optarg, :label,
              s(:str, "")),
            s(:restarg, :format),
            s(:blockarg, :blk)),
          s(:begin,
            s(:send, nil, :print,
              s(:send,
                s(:send,
                  s(:lvar, :label), :to_s), :ljust,
                s(:ivar, :@width))),
            s(:send,
              s(:ivar, :@list), :<<,
              s(:lvasgn, :res,
                s(:send,
                  s(:const, nil, :Benchmark), :measure,
                  s(:lvar, :label),
                  s(:block_pass,
                    s(:lvar, :blk))))),
            s(:send, nil, :print,
              s(:send,
                s(:lvar, :res), :format,
                s(:ivar, :@format),
                s(:splat,
                  s(:lvar, :format)))),
            s(:lvar, :res))),
        s(:alias,
          s(:sym, :report),
          s(:sym, :item)),
        s(:send, nil, :attr_reader,
          s(:sym, :list)))),
    s(:class,
      s(:const, nil, :Tms), nil,
      s(:begin,
        s(:casgn, nil, :CAPTION,
          s(:str, "      user     system      total        real\n")),
        s(:casgn, nil, :FORMAT,
          s(:str, "%10.6u %10.6y %10.6t %10.6r\n")),
        s(:send, nil, :attr_reader,
          s(:sym, :utime)),
        s(:send, nil, :attr_reader,
          s(:sym, :stime)),
        s(:send, nil, :attr_reader,
          s(:sym, :cutime)),
        s(:send, nil, :attr_reader,
          s(:sym, :cstime)),
        s(:send, nil, :attr_reader,
          s(:sym, :real)),
        s(:send, nil, :attr_reader,
          s(:sym, :total)),
        s(:send, nil, :attr_reader,
          s(:sym, :label)),
        s(:def, :initialize,
          s(:args,
            s(:optarg, :utime,
              s(:float, 0.0)),
            s(:optarg, :stime,
              s(:float, 0.0)),
            s(:optarg, :cutime,
              s(:float, 0.0)),
            s(:optarg, :cstime,
              s(:float, 0.0)),
            s(:optarg, :real,
              s(:float, 0.0)),
            s(:optarg, :label,
              s(:nil))),
          s(:begin,
            s(:masgn,
              s(:mlhs,
                s(:ivasgn, :@utime),
                s(:ivasgn, :@stime),
                s(:ivasgn, :@cutime),
                s(:ivasgn, :@cstime),
                s(:ivasgn, :@real),
                s(:ivasgn, :@label)),
              s(:array,
                s(:lvar, :utime),
                s(:lvar, :stime),
                s(:lvar, :cutime),
                s(:lvar, :cstime),
                s(:lvar, :real),
                s(:send,
                  s(:lvar, :label), :to_s))),
            s(:ivasgn, :@total,
              s(:send,
                s(:send,
                  s(:send,
                    s(:ivar, :@utime), :+,
                    s(:ivar, :@stime)), :+,
                  s(:ivar, :@cutime)), :+,
                s(:ivar, :@cstime))))),
        s(:def, :add,
          s(:args,
            s(:blockarg, :blk)),
          s(:send,
            s(:self), :+,
            s(:send,
              s(:const, nil, :Benchmark), :measure,
              s(:block_pass,
                s(:lvar, :blk))))),
        s(:def, :add!,
          s(:args,
            s(:blockarg, :blk)),
          s(:begin,
            s(:lvasgn, :t,
              s(:send,
                s(:const, nil, :Benchmark), :measure,
                s(:block_pass,
                  s(:lvar, :blk)))),
            s(:ivasgn, :@utime,
              s(:send,
                s(:send, nil, :utime), :+,
                s(:send,
                  s(:lvar, :t), :utime))),
            s(:ivasgn, :@stime,
              s(:send,
                s(:send, nil, :stime), :+,
                s(:send,
                  s(:lvar, :t), :stime))),
            s(:ivasgn, :@cutime,
              s(:send,
                s(:send, nil, :cutime), :+,
                s(:send,
                  s(:lvar, :t), :cutime))),
            s(:ivasgn, :@cstime,
              s(:send,
                s(:send, nil, :cstime), :+,
                s(:send,
                  s(:lvar, :t), :cstime))),
            s(:ivasgn, :@real,
              s(:send,
                s(:send, nil, :real), :+,
                s(:send,
                  s(:lvar, :t), :real))),
            s(:self))),
        s(:def, :+,
          s(:args,
            s(:arg, :other)),
          s(:send, nil, :memberwise,
            s(:sym, :+),
            s(:lvar, :other))),
        s(:def, :-,
          s(:args,
            s(:arg, :other)),
          s(:send, nil, :memberwise,
            s(:sym, :-),
            s(:lvar, :other))),
        s(:def, :*,
          s(:args,
            s(:arg, :x)),
          s(:send, nil, :memberwise,
            s(:sym, :*),
            s(:lvar, :x))),
        s(:def, :/,
          s(:args,
            s(:arg, :x)),
          s(:send, nil, :memberwise,
            s(:sym, :/),
            s(:lvar, :x))),
        s(:def, :format,
          s(:args,
            s(:optarg, :format,
              s(:nil)),
            s(:restarg, :args)),
          s(:begin,
            s(:lvasgn, :str,
              s(:send,
                s(:begin,
                  s(:or,
                    s(:lvar, :format),
                    s(:const, nil, :FORMAT))), :dup)),
            s(:block,
              s(:send,
                s(:lvar, :str), :gsub!,
                s(:regexp,
                  s(:str, "(%[-+.\\d]*)n"),
                  s(:regopt))),
              s(:args),
              s(:send,
                s(:dstr,
                  s(:begin,
                    s(:nth_ref, 1)),
                  s(:str, "s")), :%,
                s(:send, nil, :label))),
            s(:block,
              s(:send,
                s(:lvar, :str), :gsub!,
                s(:regexp,
                  s(:str, "(%[-+.\\d]*)u"),
                  s(:regopt))),
              s(:args),
              s(:send,
                s(:dstr,
                  s(:begin,
                    s(:nth_ref, 1)),
                  s(:str, "f")), :%,
                s(:send, nil, :utime))),
            s(:block,
              s(:send,
                s(:lvar, :str), :gsub!,
                s(:regexp,
                  s(:str, "(%[-+.\\d]*)y"),
                  s(:regopt))),
              s(:args),
              s(:send,
                s(:dstr,
                  s(:begin,
                    s(:nth_ref, 1)),
                  s(:str, "f")), :%,
                s(:send, nil, :stime))),
            s(:block,
              s(:send,
                s(:lvar, :str), :gsub!,
                s(:regexp,
                  s(:str, "(%[-+.\\d]*)U"),
                  s(:regopt))),
              s(:args),
              s(:send,
                s(:dstr,
                  s(:begin,
                    s(:nth_ref, 1)),
                  s(:str, "f")), :%,
                s(:send, nil, :cutime))),
            s(:block,
              s(:send,
                s(:lvar, :str), :gsub!,
                s(:regexp,
                  s(:str, "(%[-+.\\d]*)Y"),
                  s(:regopt))),
              s(:args),
              s(:send,
                s(:dstr,
                  s(:begin,
                    s(:nth_ref, 1)),
                  s(:str, "f")), :%,
                s(:send, nil, :cstime))),
            s(:block,
              s(:send,
                s(:lvar, :str), :gsub!,
                s(:regexp,
                  s(:str, "(%[-+.\\d]*)t"),
                  s(:regopt))),
              s(:args),
              s(:send,
                s(:dstr,
                  s(:begin,
                    s(:nth_ref, 1)),
                  s(:str, "f")), :%,
                s(:send, nil, :total))),
            s(:block,
              s(:send,
                s(:lvar, :str), :gsub!,
                s(:regexp,
                  s(:str, "(%[-+.\\d]*)r"),
                  s(:regopt))),
              s(:args),
              s(:send,
                s(:dstr,
                  s(:str, "("),
                  s(:begin,
                    s(:nth_ref, 1)),
                  s(:str, "f)")), :%,
                s(:send, nil, :real))),
            s(:if,
              s(:lvar, :format),
              s(:send,
                s(:lvar, :str), :%,
                s(:lvar, :args)),
              s(:lvar, :str)))),
        s(:def, :to_s,
          s(:args),
          s(:send, nil, :format)),
        s(:def, :to_a,
          s(:args),
          s(:array,
            s(:ivar, :@label),
            s(:ivar, :@utime),
            s(:ivar, :@stime),
            s(:ivar, :@cutime),
            s(:ivar, :@cstime),
            s(:ivar, :@real))),
        s(:send, nil, :protected),
        s(:def, :memberwise,
          s(:args,
            s(:arg, :op),
            s(:arg, :x)),
          s(:case,
            s(:lvar, :x),
            s(:when,
              s(:const,
                s(:const, nil, :Benchmark), :Tms),
              s(:send,
                s(:const,
                  s(:const, nil, :Benchmark), :Tms), :new,
                s(:send,
                  s(:send, nil, :utime), :__send__,
                  s(:lvar, :op),
                  s(:send,
                    s(:lvar, :x), :utime)),
                s(:send,
                  s(:send, nil, :stime), :__send__,
                  s(:lvar, :op),
                  s(:send,
                    s(:lvar, :x), :stime)),
                s(:send,
                  s(:send, nil, :cutime), :__send__,
                  s(:lvar, :op),
                  s(:send,
                    s(:lvar, :x), :cutime)),
                s(:send,
                  s(:send, nil, :cstime), :__send__,
                  s(:lvar, :op),
                  s(:send,
                    s(:lvar, :x), :cstime)),
                s(:send,
                  s(:send, nil, :real), :__send__,
                  s(:lvar, :op),
                  s(:send,
                    s(:lvar, :x), :real)))),
            s(:send,
              s(:const,
                s(:const, nil, :Benchmark), :Tms), :new,
              s(:send,
                s(:send, nil, :utime), :__send__,
                s(:lvar, :op),
                s(:lvar, :x)),
              s(:send,
                s(:send, nil, :stime), :__send__,
                s(:lvar, :op),
                s(:lvar, :x)),
              s(:send,
                s(:send, nil, :cutime), :__send__,
                s(:lvar, :op),
                s(:lvar, :x)),
              s(:send,
                s(:send, nil, :cstime), :__send__,
                s(:lvar, :op),
                s(:lvar, :x)),
              s(:send,
                s(:send, nil, :real), :__send__,
                s(:lvar, :op),
                s(:lvar, :x))))))),
    s(:casgn, nil, :CAPTION,
      s(:const,
        s(:const,
          s(:const, nil, :Benchmark), :Tms), :CAPTION)),
    s(:casgn, nil, :FORMAT,
      s(:const,
        s(:const,
          s(:const, nil, :Benchmark), :Tms), :FORMAT))))

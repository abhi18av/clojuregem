s(:module,
  s(:const, nil, :Base64),
  s(:begin,
    s(:send, nil, :module_function),
    s(:def, :encode64,
      s(:args,
        s(:arg, :bin)),
      s(:send,
        s(:array,
          s(:lvar, :bin)), :pack,
        s(:str, "m"))),
    s(:def, :decode64,
      s(:args,
        s(:arg, :str)),
      s(:send,
        s(:send,
          s(:lvar, :str), :unpack,
          s(:str, "m")), :first)),
    s(:def, :strict_encode64,
      s(:args,
        s(:arg, :bin)),
      s(:send,
        s(:array,
          s(:lvar, :bin)), :pack,
        s(:str, "m0"))),
    s(:def, :strict_decode64,
      s(:args,
        s(:arg, :str)),
      s(:send,
        s(:send,
          s(:lvar, :str), :unpack,
          s(:str, "m0")), :first)),
    s(:def, :urlsafe_encode64,
      s(:args,
        s(:arg, :bin),
        s(:kwoptarg, :padding,
          s(:true))),
      s(:begin,
        s(:lvasgn, :str,
          s(:send,
            s(:send, nil, :strict_encode64,
              s(:lvar, :bin)), :tr,
            s(:str, "+/"),
            s(:str, "-_"))),
        s(:if,
          s(:lvar, :padding), nil,
          s(:lvasgn, :str,
            s(:send,
              s(:lvar, :str), :delete,
              s(:str, "=")))),
        s(:lvar, :str))),
    s(:def, :urlsafe_decode64,
      s(:args,
        s(:arg, :str)),
      s(:begin,
        s(:lvasgn, :str,
          s(:send,
            s(:lvar, :str), :tr,
            s(:str, "-_"),
            s(:str, "+/"))),
        s(:if,
          s(:and,
            s(:send,
              s(:send,
                s(:lvar, :str), :end_with?,
                s(:str, "=")), :!),
            s(:send,
              s(:send,
                s(:send,
                  s(:lvar, :str), :length), :%,
                s(:int, 4)), :!=,
              s(:int, 0))),
          s(:lvasgn, :str,
            s(:send,
              s(:lvar, :str), :ljust,
              s(:send,
                s(:begin,
                  s(:send,
                    s(:send,
                      s(:lvar, :str), :length), :+,
                    s(:int, 3))), :&,
                s(:send,
                  s(:int, 3), :~)),
              s(:str, "="))), nil),
        s(:send, nil, :strict_decode64,
          s(:lvar, :str))))))

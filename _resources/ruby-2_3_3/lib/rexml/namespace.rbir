s(:begin,
  s(:send, nil, :require,
    s(:str, "rexml/xmltokens")),
  s(:module,
    s(:const, nil, :REXML),
    s(:module,
      s(:const, nil, :Namespace),
      s(:begin,
        s(:send, nil, :attr_reader,
          s(:sym, :name),
          s(:sym, :expanded_name)),
        s(:send, nil, :attr_accessor,
          s(:sym, :prefix)),
        s(:send, nil, :include,
          s(:const, nil, :XMLTokens)),
        s(:casgn, nil, :NAMESPLIT,
          s(:regexp,
            s(:str, "^(?:("),
            s(:begin,
              s(:const, nil, :NCNAME_STR)),
            s(:str, "):)?("),
            s(:begin,
              s(:const, nil, :NCNAME_STR)),
            s(:str, ")"),
            s(:regopt, :u))),
        s(:def, :name=,
          s(:args,
            s(:arg, :name)),
          s(:begin,
            s(:ivasgn, :@expanded_name,
              s(:lvar, :name)),
            s(:send,
              s(:lvar, :name), :=~,
              s(:const, nil, :NAMESPLIT)),
            s(:if,
              s(:nth_ref, 1),
              s(:ivasgn, :@prefix,
                s(:nth_ref, 1)),
              s(:begin,
                s(:ivasgn, :@prefix,
                  s(:str, "")),
                s(:ivasgn, :@namespace,
                  s(:str, "")))),
            s(:ivasgn, :@name,
              s(:nth_ref, 2)))),
        s(:def, :has_name?,
          s(:args,
            s(:arg, :other),
            s(:optarg, :ns,
              s(:nil))),
          s(:if,
            s(:lvar, :ns),
            s(:return,
              s(:begin,
                s(:and,
                  s(:send,
                    s(:send, nil, :namespace), :==,
                    s(:lvar, :ns)),
                  s(:send,
                    s(:send, nil, :name), :==,
                    s(:lvar, :other))))),
            s(:if,
              s(:send,
                s(:lvar, :other), :include?,
                s(:str, ":")),
              s(:return,
                s(:send,
                  s(:send, nil, :fully_expanded_name), :==,
                  s(:lvar, :other))),
              s(:return,
                s(:send,
                  s(:send, nil, :name), :==,
                  s(:lvar, :other)))))),
        s(:alias,
          s(:sym, :local_name),
          s(:sym, :name)),
        s(:def, :fully_expanded_name,
          s(:args),
          s(:begin,
            s(:lvasgn, :ns,
              s(:send, nil, :prefix)),
            s(:if,
              s(:send,
                s(:send,
                  s(:lvar, :ns), :size), :>,
                s(:int, 0)),
              s(:return,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :ns)),
                  s(:str, ":"),
                  s(:ivar, :@name))), nil),
            s(:return,
              s(:ivar, :@name))))))))

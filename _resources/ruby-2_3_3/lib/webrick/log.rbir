s(:module,
  s(:const, nil, :WEBrick),
  s(:begin,
    s(:class,
      s(:const, nil, :BasicLog), nil,
      s(:begin,
        s(:casgn, nil, :FATAL,
          s(:int, 1)),
        s(:casgn, nil, :ERROR,
          s(:int, 2)),
        s(:casgn, nil, :WARN,
          s(:int, 3)),
        s(:casgn, nil, :INFO,
          s(:int, 4)),
        s(:casgn, nil, :DEBUG,
          s(:int, 5)),
        s(:send, nil, :attr_accessor,
          s(:sym, :level)),
        s(:def, :initialize,
          s(:args,
            s(:optarg, :log_file,
              s(:nil)),
            s(:optarg, :level,
              s(:nil))),
          s(:begin,
            s(:ivasgn, :@level,
              s(:or,
                s(:lvar, :level),
                s(:const, nil, :INFO))),
            s(:case,
              s(:lvar, :log_file),
              s(:when,
                s(:const, nil, :String),
                s(:begin,
                  s(:ivasgn, :@log,
                    s(:send, nil, :open,
                      s(:lvar, :log_file),
                      s(:str, "a+"))),
                  s(:send,
                    s(:ivar, :@log), :sync=,
                    s(:true)),
                  s(:ivasgn, :@opened,
                    s(:true)))),
              s(:when,
                s(:const, nil, :NilClass),
                s(:ivasgn, :@log,
                  s(:gvar, :$stderr))),
              s(:ivasgn, :@log,
                s(:lvar, :log_file))))),
        s(:def, :close,
          s(:args),
          s(:begin,
            s(:if,
              s(:ivar, :@opened),
              s(:send,
                s(:ivar, :@log), :close), nil),
            s(:ivasgn, :@log,
              s(:nil)))),
        s(:def, :log,
          s(:args,
            s(:arg, :level),
            s(:arg, :data)),
          s(:if,
            s(:and,
              s(:ivar, :@log),
              s(:send,
                s(:lvar, :level), :<=,
                s(:ivar, :@level))),
            s(:begin,
              s(:if,
                s(:send,
                  s(:regexp,
                    s(:str, "\\n\\Z"),
                    s(:regopt)), :!~,
                  s(:lvar, :data)),
                s(:op_asgn,
                  s(:lvasgn, :data), :+,
                  s(:str, "\n")), nil),
              s(:send,
                s(:ivar, :@log), :<<,
                s(:lvar, :data))), nil)),
        s(:def, :<<,
          s(:args,
            s(:arg, :obj)),
          s(:send, nil, :log,
            s(:const, nil, :INFO),
            s(:send,
              s(:lvar, :obj), :to_s))),
        s(:def, :fatal,
          s(:args,
            s(:arg, :msg)),
          s(:send, nil, :log,
            s(:const, nil, :FATAL),
            s(:send,
              s(:str, "FATAL "), :<<,
              s(:send, nil, :format,
                s(:lvar, :msg))))),
        s(:def, :error,
          s(:args,
            s(:arg, :msg)),
          s(:send, nil, :log,
            s(:const, nil, :ERROR),
            s(:send,
              s(:str, "ERROR "), :<<,
              s(:send, nil, :format,
                s(:lvar, :msg))))),
        s(:def, :warn,
          s(:args,
            s(:arg, :msg)),
          s(:send, nil, :log,
            s(:const, nil, :WARN),
            s(:send,
              s(:str, "WARN  "), :<<,
              s(:send, nil, :format,
                s(:lvar, :msg))))),
        s(:def, :info,
          s(:args,
            s(:arg, :msg)),
          s(:send, nil, :log,
            s(:const, nil, :INFO),
            s(:send,
              s(:str, "INFO  "), :<<,
              s(:send, nil, :format,
                s(:lvar, :msg))))),
        s(:def, :debug,
          s(:args,
            s(:arg, :msg)),
          s(:send, nil, :log,
            s(:const, nil, :DEBUG),
            s(:send,
              s(:str, "DEBUG "), :<<,
              s(:send, nil, :format,
                s(:lvar, :msg))))),
        s(:def, :fatal?,
          s(:args),
          s(:send,
            s(:ivar, :@level), :>=,
            s(:const, nil, :FATAL))),
        s(:def, :error?,
          s(:args),
          s(:send,
            s(:ivar, :@level), :>=,
            s(:const, nil, :ERROR))),
        s(:def, :warn?,
          s(:args),
          s(:send,
            s(:ivar, :@level), :>=,
            s(:const, nil, :WARN))),
        s(:def, :info?,
          s(:args),
          s(:send,
            s(:ivar, :@level), :>=,
            s(:const, nil, :INFO))),
        s(:def, :debug?,
          s(:args),
          s(:send,
            s(:ivar, :@level), :>=,
            s(:const, nil, :DEBUG))),
        s(:send, nil, :private),
        s(:def, :format,
          s(:args,
            s(:arg, :arg)),
          s(:if,
            s(:send,
              s(:lvar, :arg), :is_a?,
              s(:const, nil, :Exception)),
            s(:send,
              s(:send,
                s(:dstr,
                  s(:begin,
                    s(:send,
                      s(:lvar, :arg), :class)),
                  s(:str, ": "),
                  s(:begin,
                    s(:send,
                      s(:lvar, :arg), :message)),
                  s(:str, "\n\t")), :<<,
                s(:send,
                  s(:send,
                    s(:lvar, :arg), :backtrace), :join,
                  s(:str, "\n\t"))), :<<,
              s(:str, "\n")),
            s(:if,
              s(:send,
                s(:lvar, :arg), :respond_to?,
                s(:sym, :to_str)),
              s(:send,
                s(:lvar, :arg), :to_str),
              s(:send,
                s(:lvar, :arg), :inspect)))))),
    s(:class,
      s(:const, nil, :Log),
      s(:const, nil, :BasicLog),
      s(:begin,
        s(:send, nil, :attr_accessor,
          s(:sym, :time_format)),
        s(:def, :initialize,
          s(:args,
            s(:optarg, :log_file,
              s(:nil)),
            s(:optarg, :level,
              s(:nil))),
          s(:begin,
            s(:super,
              s(:lvar, :log_file),
              s(:lvar, :level)),
            s(:ivasgn, :@time_format,
              s(:str, "[%Y-%m-%d %H:%M:%S]")))),
        s(:def, :log,
          s(:args,
            s(:arg, :level),
            s(:arg, :data)),
          s(:begin,
            s(:lvasgn, :tmp,
              s(:send,
                s(:send,
                  s(:const, nil, :Time), :now), :strftime,
                s(:ivar, :@time_format))),
            s(:send,
              s(:send,
                s(:lvar, :tmp), :<<,
                s(:str, " ")), :<<,
              s(:lvar, :data)),
            s(:super,
              s(:lvar, :level),
              s(:lvar, :tmp))))))))

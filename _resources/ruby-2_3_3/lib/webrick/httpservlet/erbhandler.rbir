s(:begin,
  s(:send, nil, :require,
    s(:str, "webrick/httpservlet/abstract.rb")),
  s(:send, nil, :require,
    s(:str, "erb")),
  s(:module,
    s(:const, nil, :WEBrick),
    s(:module,
      s(:const, nil, :HTTPServlet),
      s(:class,
        s(:const, nil, :ERBHandler),
        s(:const, nil, :AbstractServlet),
        s(:begin,
          s(:def, :initialize,
            s(:args,
              s(:arg, :server),
              s(:arg, :name)),
            s(:begin,
              s(:super,
                s(:lvar, :server),
                s(:lvar, :name)),
              s(:ivasgn, :@script_filename,
                s(:lvar, :name)))),
          s(:def, :do_GET,
            s(:args,
              s(:arg, :req),
              s(:arg, :res)),
            s(:begin,
              s(:if,
                s(:defined?,
                  s(:const, nil, :ERB)), nil,
                s(:begin,
                  s(:send,
                    s(:ivar, :@logger), :warn,
                    s(:dstr,
                      s(:begin,
                        s(:send,
                          s(:self), :class)),
                      s(:str, ": ERB not defined."))),
                  s(:send, nil, :raise,
                    s(:const,
                      s(:const, nil, :HTTPStatus), :Forbidden),
                    s(:str, "ERBHandler cannot work.")))),
              s(:kwbegin,
                s(:rescue,
                  s(:begin,
                    s(:lvasgn, :data,
                      s(:block,
                        s(:send, nil, :open,
                          s(:ivar, :@script_filename)),
                        s(:args,
                          s(:arg, :io)),
                        s(:send,
                          s(:lvar, :io), :read))),
                    s(:send,
                      s(:lvar, :res), :body=,
                      s(:send, nil, :evaluate,
                        s(:send,
                          s(:const, nil, :ERB), :new,
                          s(:lvar, :data)),
                        s(:lvar, :req),
                        s(:lvar, :res))),
                    s(:or_asgn,
                      s(:send,
                        s(:lvar, :res), :[],
                        s(:str, "content-type")),
                      s(:send,
                        s(:const, nil, :HTTPUtils), :mime_type,
                        s(:ivar, :@script_filename),
                        s(:send,
                          s(:ivar, :@config), :[],
                          s(:sym, :MimeTypes))))),
                  s(:resbody,
                    s(:array,
                      s(:const, nil, :StandardError)), nil,
                    s(:send, nil, :raise)),
                  s(:resbody,
                    s(:array,
                      s(:const, nil, :Exception)),
                    s(:lvasgn, :ex),
                    s(:begin,
                      s(:send,
                        s(:ivar, :@logger), :error,
                        s(:lvar, :ex)),
                      s(:send, nil, :raise,
                        s(:const,
                          s(:const, nil, :HTTPStatus), :InternalServerError),
                        s(:send,
                          s(:lvar, :ex), :message)))), nil)))),
          s(:alias,
            s(:sym, :do_POST),
            s(:sym, :do_GET)),
          s(:send, nil, :private),
          s(:def, :evaluate,
            s(:args,
              s(:arg, :erb),
              s(:arg, :servlet_request),
              s(:arg, :servlet_response)),
            s(:block,
              s(:send,
                s(:send,
                  s(:const, nil, :Module), :new), :module_eval),
              s(:args),
              s(:begin,
                s(:send,
                  s(:lvar, :servlet_request), :meta_vars),
                s(:send,
                  s(:lvar, :servlet_request), :query),
                s(:send,
                  s(:lvar, :erb), :result,
                  s(:send, nil, :binding))))))))))

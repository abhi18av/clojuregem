s(:begin,
  s(:send, nil, :require,
    s(:str, "shell/filter")),
  s(:class,
    s(:const, nil, :Shell), nil,
    s(:begin,
      s(:class,
        s(:const, nil, :BuiltInCommand),
        s(:const, nil, :Filter),
        s(:begin,
          s(:def, :wait?,
            s(:args),
            s(:false)),
          s(:def, :active?,
            s(:args),
            s(:true)))),
      s(:class,
        s(:const, nil, :Void),
        s(:const, nil, :BuiltInCommand),
        s(:begin,
          s(:def, :initialize,
            s(:args,
              s(:arg, :sh),
              s(:restarg, :opts)),
            s(:super,
              s(:lvar, :sh))),
          s(:def, :each,
            s(:args,
              s(:optarg, :rs,
                s(:nil))), nil))),
      s(:class,
        s(:const, nil, :Echo),
        s(:const, nil, :BuiltInCommand),
        s(:begin,
          s(:def, :initialize,
            s(:args,
              s(:arg, :sh),
              s(:restarg, :strings)),
            s(:begin,
              s(:super,
                s(:lvar, :sh)),
              s(:ivasgn, :@strings,
                s(:lvar, :strings)))),
          s(:def, :each,
            s(:args,
              s(:optarg, :rs,
                s(:nil))),
            s(:begin,
              s(:if,
                s(:lvar, :rs), nil,
                s(:lvasgn, :rs,
                  s(:send,
                    s(:ivar, :@shell), :record_separator))),
              s(:for,
                s(:lvasgn, :str),
                s(:ivar, :@strings),
                s(:yield,
                  s(:send,
                    s(:lvar, :str), :+,
                    s(:lvar, :rs)))))))),
      s(:class,
        s(:const, nil, :Cat),
        s(:const, nil, :BuiltInCommand),
        s(:begin,
          s(:def, :initialize,
            s(:args,
              s(:arg, :sh),
              s(:restarg, :filenames)),
            s(:begin,
              s(:super,
                s(:lvar, :sh)),
              s(:ivasgn, :@cat_files,
                s(:lvar, :filenames)))),
          s(:def, :each,
            s(:args,
              s(:optarg, :rs,
                s(:nil))),
            s(:if,
              s(:send,
                s(:ivar, :@cat_files), :empty?),
              s(:zsuper),
              s(:for,
                s(:lvasgn, :src),
                s(:ivar, :@cat_files),
                s(:block,
                  s(:send,
                    s(:ivar, :@shell), :foreach,
                    s(:lvar, :src),
                    s(:lvar, :rs)),
                  s(:args,
                    s(:arg, :l)),
                  s(:yield,
                    s(:lvar, :l)))))))),
      s(:class,
        s(:const, nil, :Glob),
        s(:const, nil, :BuiltInCommand),
        s(:begin,
          s(:def, :initialize,
            s(:args,
              s(:arg, :sh),
              s(:arg, :pattern)),
            s(:begin,
              s(:super,
                s(:lvar, :sh)),
              s(:ivasgn, :@pattern,
                s(:lvar, :pattern)))),
          s(:def, :each,
            s(:args,
              s(:optarg, :rs,
                s(:nil))),
            s(:begin,
              s(:if,
                s(:send,
                  s(:send,
                    s(:ivar, :@pattern), :[],
                    s(:int, 0)), :==,
                  s(:str, "/")),
                s(:ivasgn, :@files,
                  s(:send,
                    s(:const, nil, :Dir), :[],
                    s(:ivar, :@pattern))),
                s(:begin,
                  s(:lvasgn, :prefix,
                    s(:send,
                      s(:send,
                        s(:ivar, :@shell), :pwd), :+,
                      s(:str, "/"))),
                  s(:ivasgn, :@files,
                    s(:block,
                      s(:send,
                        s(:send,
                          s(:const, nil, :Dir), :[],
                          s(:send,
                            s(:lvar, :prefix), :+,
                            s(:ivar, :@pattern))), :collect),
                      s(:args,
                        s(:arg, :p)),
                      s(:send,
                        s(:lvar, :p), :sub,
                        s(:lvar, :prefix),
                        s(:str, "")))))),
              s(:if,
                s(:lvar, :rs), nil,
                s(:lvasgn, :rs,
                  s(:send,
                    s(:ivar, :@shell), :record_separator))),
              s(:for,
                s(:lvasgn, :f),
                s(:ivar, :@files),
                s(:yield,
                  s(:send,
                    s(:lvar, :f), :+,
                    s(:lvar, :rs)))))))),
      s(:class,
        s(:const, nil, :AppendIO),
        s(:const, nil, :BuiltInCommand),
        s(:begin,
          s(:def, :initialize,
            s(:args,
              s(:arg, :sh),
              s(:arg, :io),
              s(:arg, :filter)),
            s(:begin,
              s(:super,
                s(:lvar, :sh)),
              s(:ivasgn, :@input,
                s(:lvar, :filter)),
              s(:ivasgn, :@io,
                s(:lvar, :io)))),
          s(:def, :input=,
            s(:args,
              s(:arg, :filter)),
            s(:begin,
              s(:send,
                s(:ivar, :@input), :input=,
                s(:lvar, :filter)),
              s(:for,
                s(:lvasgn, :l),
                s(:ivar, :@input),
                s(:send,
                  s(:ivar, :@io), :<<,
                  s(:lvar, :l))))))),
      s(:class,
        s(:const, nil, :AppendFile),
        s(:const, nil, :AppendIO),
        s(:begin,
          s(:def, :initialize,
            s(:args,
              s(:arg, :sh),
              s(:arg, :to_filename),
              s(:arg, :filter)),
            s(:begin,
              s(:ivasgn, :@file_name,
                s(:lvar, :to_filename)),
              s(:lvasgn, :io,
                s(:send,
                  s(:lvar, :sh), :open,
                  s(:lvar, :to_filename),
                  s(:str, "a"))),
              s(:super,
                s(:lvar, :sh),
                s(:lvar, :io),
                s(:lvar, :filter)))),
          s(:def, :input=,
            s(:args,
              s(:arg, :filter)),
            s(:kwbegin,
              s(:ensure,
                s(:zsuper),
                s(:send,
                  s(:ivar, :@io), :close)))))),
      s(:class,
        s(:const, nil, :Tee),
        s(:const, nil, :BuiltInCommand),
        s(:begin,
          s(:def, :initialize,
            s(:args,
              s(:arg, :sh),
              s(:arg, :filename)),
            s(:begin,
              s(:super,
                s(:lvar, :sh)),
              s(:ivasgn, :@to_filename,
                s(:lvar, :filename)))),
          s(:def, :each,
            s(:args,
              s(:optarg, :rs,
                s(:nil))),
            s(:begin,
              s(:lvasgn, :to,
                s(:send,
                  s(:ivar, :@shell), :open,
                  s(:ivar, :@to_filename),
                  s(:str, "w"))),
              s(:kwbegin,
                s(:ensure,
                  s(:block,
                    s(:zsuper),
                    s(:args,
                      s(:arg, :l)),
                    s(:begin,
                      s(:send,
                        s(:lvar, :to), :<<,
                        s(:lvar, :l)),
                      s(:yield,
                        s(:lvar, :l)))),
                  s(:send,
                    s(:lvar, :to), :close))))))),
      s(:class,
        s(:const, nil, :Concat),
        s(:const, nil, :BuiltInCommand),
        s(:begin,
          s(:def, :initialize,
            s(:args,
              s(:arg, :sh),
              s(:restarg, :jobs)),
            s(:begin,
              s(:super,
                s(:lvar, :sh)),
              s(:ivasgn, :@jobs,
                s(:lvar, :jobs)))),
          s(:def, :each,
            s(:args,
              s(:optarg, :rs,
                s(:nil))),
            s(:while,
              s(:lvasgn, :job,
                s(:send,
                  s(:ivar, :@jobs), :shift)),
              s(:block,
                s(:send,
                  s(:lvar, :job), :each),
                s(:args,
                  s(:arg, :l)),
                s(:yield,
                  s(:lvar, :l))))))))))

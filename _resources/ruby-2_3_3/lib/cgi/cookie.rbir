s(:begin,
  s(:send, nil, :require,
    s(:str, "cgi/util")),
  s(:class,
    s(:const, nil, :CGI), nil,
    s(:class,
      s(:const, nil, :Cookie),
      s(:const, nil, :Array),
      s(:begin,
        s(:if,
          s(:defined?,
            s(:cvar, :@@accept_charset)), nil,
          s(:cvasgn, :@@accept_charset,
            s(:str, "UTF-8"))),
        s(:def, :initialize,
          s(:args,
            s(:optarg, :name,
              s(:str, "")),
            s(:restarg, :value)),
          s(:begin,
            s(:ivasgn, :@domain,
              s(:nil)),
            s(:ivasgn, :@expires,
              s(:nil)),
            s(:if,
              s(:send,
                s(:lvar, :name), :kind_of?,
                s(:const, nil, :String)),
              s(:begin,
                s(:ivasgn, :@name,
                  s(:lvar, :name)),
                s(:send,
                  s(:regexp,
                    s(:str, "^(.*/)"),
                    s(:regopt)), :match,
                  s(:send,
                    s(:const, nil, :ENV), :[],
                    s(:str, "SCRIPT_NAME"))),
                s(:ivasgn, :@path,
                  s(:begin,
                    s(:or,
                      s(:nth_ref, 1),
                      s(:str, "")))),
                s(:ivasgn, :@secure,
                  s(:false)),
                s(:ivasgn, :@httponly,
                  s(:false)),
                s(:return,
                  s(:super,
                    s(:lvar, :value)))), nil),
            s(:lvasgn, :options,
              s(:lvar, :name)),
            s(:if,
              s(:send,
                s(:lvar, :options), :has_key?,
                s(:str, "name")), nil,
              s(:send, nil, :raise,
                s(:const, nil, :ArgumentError),
                s(:str, "`name' required"))),
            s(:ivasgn, :@name,
              s(:send,
                s(:lvar, :options), :[],
                s(:str, "name"))),
            s(:lvasgn, :value,
              s(:send, nil, :Array,
                s(:send,
                  s(:lvar, :options), :[],
                  s(:str, "value")))),
            s(:if,
              s(:send,
                s(:lvar, :options), :[],
                s(:str, "path")),
              s(:ivasgn, :@path,
                s(:send,
                  s(:lvar, :options), :[],
                  s(:str, "path"))),
              s(:begin,
                s(:send,
                  s(:regexp,
                    s(:str, "^(.*/)"),
                    s(:regopt)), :match,
                  s(:send,
                    s(:const, nil, :ENV), :[],
                    s(:str, "SCRIPT_NAME"))),
                s(:ivasgn, :@path,
                  s(:begin,
                    s(:or,
                      s(:nth_ref, 1),
                      s(:str, "")))))),
            s(:ivasgn, :@domain,
              s(:send,
                s(:lvar, :options), :[],
                s(:str, "domain"))),
            s(:ivasgn, :@expires,
              s(:send,
                s(:lvar, :options), :[],
                s(:str, "expires"))),
            s(:ivasgn, :@secure,
              s(:send,
                s(:send,
                  s(:lvar, :options), :[],
                  s(:str, "secure")), :==,
                s(:true))),
            s(:ivasgn, :@httponly,
              s(:send,
                s(:send,
                  s(:lvar, :options), :[],
                  s(:str, "httponly")), :==,
                s(:true))),
            s(:super,
              s(:lvar, :value)))),
        s(:send, nil, :attr_accessor,
          s(:sym, :name)),
        s(:send, nil, :attr_accessor,
          s(:sym, :path)),
        s(:send, nil, :attr_accessor,
          s(:sym, :domain)),
        s(:send, nil, :attr_accessor,
          s(:sym, :expires)),
        s(:send, nil, :attr_reader,
          s(:sym, :secure)),
        s(:send, nil, :attr_reader,
          s(:sym, :httponly)),
        s(:def, :value,
          s(:args),
          s(:self)),
        s(:def, :value=,
          s(:args,
            s(:arg, :val)),
          s(:send, nil, :replace,
            s(:send, nil, :Array,
              s(:lvar, :val)))),
        s(:def, :secure=,
          s(:args,
            s(:arg, :val)),
          s(:begin,
            s(:if,
              s(:or,
                s(:send,
                  s(:lvar, :val), :==,
                  s(:true)),
                s(:send,
                  s(:lvar, :val), :==,
                  s(:false))),
              s(:ivasgn, :@secure,
                s(:lvar, :val)), nil),
            s(:ivar, :@secure))),
        s(:def, :httponly=,
          s(:args,
            s(:arg, :val)),
          s(:ivasgn, :@httponly,
            s(:send,
              s(:send,
                s(:lvar, :val), :!), :!))),
        s(:def, :to_s,
          s(:args),
          s(:begin,
            s(:lvasgn, :val,
              s(:send,
                s(:block,
                  s(:send, nil, :collect),
                  s(:args,
                    s(:arg, :v)),
                  s(:send,
                    s(:const, nil, :CGI), :escape,
                    s(:lvar, :v))), :join,
                s(:str, "&"))),
            s(:lvasgn, :buf,
              s(:dstr,
                s(:begin,
                  s(:ivar, :@name)),
                s(:str, "="),
                s(:begin,
                  s(:lvar, :val)))),
            s(:if,
              s(:ivar, :@domain),
              s(:send,
                s(:lvar, :buf), :<<,
                s(:dstr,
                  s(:str, "; domain="),
                  s(:begin,
                    s(:ivar, :@domain)))), nil),
            s(:if,
              s(:ivar, :@path),
              s(:send,
                s(:lvar, :buf), :<<,
                s(:dstr,
                  s(:str, "; path="),
                  s(:begin,
                    s(:ivar, :@path)))), nil),
            s(:if,
              s(:ivar, :@expires),
              s(:send,
                s(:lvar, :buf), :<<,
                s(:dstr,
                  s(:str, "; expires="),
                  s(:begin,
                    s(:send,
                      s(:const, nil, :CGI), :rfc1123_date,
                      s(:ivar, :@expires))))), nil),
            s(:if,
              s(:ivar, :@secure),
              s(:send,
                s(:lvar, :buf), :<<,
                s(:str, "; secure")), nil),
            s(:if,
              s(:ivar, :@httponly),
              s(:send,
                s(:lvar, :buf), :<<,
                s(:str, "; HttpOnly")), nil),
            s(:lvar, :buf))),
        s(:defs,
          s(:self), :parse,
          s(:args,
            s(:arg, :raw_cookie)),
          s(:begin,
            s(:lvasgn, :cookies,
              s(:send,
                s(:const, nil, :Hash), :new,
                s(:array))),
            s(:if,
              s(:lvar, :raw_cookie), nil,
              s(:return,
                s(:lvar, :cookies))),
            s(:block,
              s(:send,
                s(:send,
                  s(:lvar, :raw_cookie), :split,
                  s(:regexp,
                    s(:str, "[;,]\\s?"),
                    s(:regopt))), :each),
              s(:args,
                s(:arg, :pairs)),
              s(:begin,
                s(:masgn,
                  s(:mlhs,
                    s(:lvasgn, :name),
                    s(:lvasgn, :values)),
                  s(:send,
                    s(:lvar, :pairs), :split,
                    s(:str, "="),
                    s(:int, 2))),
                s(:if,
                  s(:and,
                    s(:lvar, :name),
                    s(:lvar, :values)), nil,
                  s(:next)),
                s(:lvasgn, :name,
                  s(:send,
                    s(:const, nil, :CGI), :unescape,
                    s(:lvar, :name))),
                s(:or_asgn,
                  s(:lvasgn, :values),
                  s(:str, "")),
                s(:lvasgn, :values,
                  s(:block,
                    s(:send,
                      s(:send,
                        s(:lvar, :values), :split,
                        s(:str, "&")), :collect),
                    s(:args,
                      s(:arg, :v)),
                    s(:send,
                      s(:const, nil, :CGI), :unescape,
                      s(:lvar, :v),
                      s(:cvar, :@@accept_charset)))),
                s(:if,
                  s(:send,
                    s(:lvar, :cookies), :has_key?,
                    s(:lvar, :name)),
                  s(:lvasgn, :values,
                    s(:send,
                      s(:send,
                        s(:send,
                          s(:lvar, :cookies), :[],
                          s(:lvar, :name)), :value), :+,
                      s(:lvar, :values))), nil),
                s(:send,
                  s(:lvar, :cookies), :[]=,
                  s(:lvar, :name),
                  s(:send,
                    s(:const, nil, :Cookie), :new,
                    s(:lvar, :name),
                    s(:splat,
                      s(:lvar, :values)))))),
            s(:lvar, :cookies))),
        s(:def, :inspect,
          s(:args),
          s(:dstr,
            s(:str, "#<CGI::Cookie: "),
            s(:begin,
              s(:send,
                s(:send,
                  s(:self), :to_s), :inspect)),
            s(:str, ">")))))))

s(:begin,
  s(:send, nil, :require,
    s(:str, "drb/drb")),
  s(:send, nil, :require,
    s(:str, "monitor")),
  s(:module,
    s(:const, nil, :DRb),
    s(:class,
      s(:const, nil, :ExtServ), nil,
      s(:begin,
        s(:send, nil, :include,
          s(:const, nil, :MonitorMixin)),
        s(:send, nil, :include,
          s(:const, nil, :DRbUndumped)),
        s(:def, :initialize,
          s(:args,
            s(:arg, :there),
            s(:arg, :name),
            s(:optarg, :server,
              s(:nil))),
          s(:begin,
            s(:super),
            s(:ivasgn, :@server,
              s(:or,
                s(:lvar, :server),
                s(:send,
                  s(:const, nil, :DRb), :primary_server))),
            s(:ivasgn, :@name,
              s(:lvar, :name)),
            s(:lvasgn, :ro,
              s(:send,
                s(:const, nil, :DRbObject), :new,
                s(:nil),
                s(:lvar, :there))),
            s(:block,
              s(:send, nil, :synchronize),
              s(:args),
              s(:ivasgn, :@invoker,
                s(:send,
                  s(:lvar, :ro), :regist,
                  s(:lvar, :name),
                  s(:send,
                    s(:const, nil, :DRbObject), :new,
                    s(:self),
                    s(:send,
                      s(:ivar, :@server), :uri))))))),
        s(:send, nil, :attr_reader,
          s(:sym, :server)),
        s(:def, :front,
          s(:args),
          s(:send,
            s(:const, nil, :DRbObject), :new,
            s(:nil),
            s(:send,
              s(:ivar, :@server), :uri))),
        s(:def, :stop_service,
          s(:args),
          s(:block,
            s(:send, nil, :synchronize),
            s(:args),
            s(:begin,
              s(:send,
                s(:ivar, :@invoker), :unregist,
                s(:ivar, :@name)),
              s(:lvasgn, :server,
                s(:ivar, :@server)),
              s(:ivasgn, :@server,
                s(:nil)),
              s(:send,
                s(:lvar, :server), :stop_service),
              s(:true)))),
        s(:def, :alive?,
          s(:args),
          s(:if,
            s(:ivar, :@server),
            s(:send,
              s(:ivar, :@server), :alive?),
            s(:false)))))))

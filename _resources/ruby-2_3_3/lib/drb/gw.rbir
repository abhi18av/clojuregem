s(:begin,
  s(:send, nil, :require,
    s(:str, "drb/drb")),
  s(:send, nil, :require,
    s(:str, "monitor")),
  s(:module,
    s(:const, nil, :DRb),
    s(:begin,
      s(:class,
        s(:const, nil, :GWIdConv),
        s(:const, nil, :DRbIdConv),
        s(:def, :to_obj,
          s(:args,
            s(:arg, :ref)),
          s(:begin,
            s(:if,
              s(:and,
                s(:send,
                  s(:const, nil, :Array), :===,
                  s(:lvar, :ref)),
                s(:send,
                  s(:send,
                    s(:lvar, :ref), :[],
                    s(:int, 0)), :==,
                  s(:sym, :DRbObject))),
              s(:return,
                s(:send,
                  s(:const, nil, :DRbObject), :new_with,
                  s(:send,
                    s(:lvar, :ref), :[],
                    s(:int, 1)),
                  s(:send,
                    s(:lvar, :ref), :[],
                    s(:int, 2)))), nil),
            s(:super,
              s(:lvar, :ref))))),
      s(:class,
        s(:const, nil, :GW), nil,
        s(:begin,
          s(:send, nil, :include,
            s(:const, nil, :MonitorMixin)),
          s(:def, :initialize,
            s(:args),
            s(:begin,
              s(:super),
              s(:ivasgn, :@hash,
                s(:hash)))),
          s(:def, :[],
            s(:args,
              s(:arg, :key)),
            s(:block,
              s(:send, nil, :synchronize),
              s(:args),
              s(:send,
                s(:ivar, :@hash), :[],
                s(:lvar, :key)))),
          s(:def, :[]=,
            s(:args,
              s(:arg, :key),
              s(:arg, :v)),
            s(:block,
              s(:send, nil, :synchronize),
              s(:args),
              s(:send,
                s(:ivar, :@hash), :[]=,
                s(:lvar, :key),
                s(:lvar, :v)))))),
      s(:class,
        s(:const, nil, :DRbObject), nil,
        s(:begin,
          s(:defs,
            s(:self), :_load,
            s(:args,
              s(:arg, :s)),
            s(:begin,
              s(:masgn,
                s(:mlhs,
                  s(:lvasgn, :uri),
                  s(:lvasgn, :ref)),
                s(:send,
                  s(:const, nil, :Marshal), :load,
                  s(:lvar, :s))),
              s(:if,
                s(:send,
                  s(:send,
                    s(:const, nil, :DRb), :uri), :==,
                  s(:lvar, :uri)),
                s(:return,
                  s(:if,
                    s(:lvar, :ref),
                    s(:send,
                      s(:const, nil, :DRb), :to_obj,
                      s(:lvar, :ref)),
                    s(:send,
                      s(:const, nil, :DRb), :front))), nil),
              s(:send,
                s(:self), :new_with,
                s(:send,
                  s(:const, nil, :DRb), :uri),
                s(:array,
                  s(:sym, :DRbObject),
                  s(:lvar, :uri),
                  s(:lvar, :ref))))),
          s(:def, :_dump,
            s(:args,
              s(:arg, :lv)),
            s(:if,
              s(:send,
                s(:send,
                  s(:const, nil, :DRb), :uri), :==,
                s(:ivar, :@uri)),
              s(:if,
                s(:and,
                  s(:send,
                    s(:const, nil, :Array), :===,
                    s(:ivar, :@ref)),
                  s(:send,
                    s(:send,
                      s(:ivar, :@ref), :[],
                      s(:int, 0)), :==,
                    s(:sym, :DRbObject))),
                s(:send,
                  s(:const, nil, :Marshal), :dump,
                  s(:array,
                    s(:send,
                      s(:ivar, :@ref), :[],
                      s(:int, 1)),
                    s(:send,
                      s(:ivar, :@ref), :[],
                      s(:int, 2)))),
                s(:send,
                  s(:const, nil, :Marshal), :dump,
                  s(:array,
                    s(:ivar, :@uri),
                    s(:ivar, :@ref)))),
              s(:send,
                s(:const, nil, :Marshal), :dump,
                s(:array,
                  s(:send,
                    s(:const, nil, :DRb), :uri),
                  s(:array,
                    s(:sym, :DRbObject),
                    s(:ivar, :@uri),
                    s(:ivar, :@ref)))))))))))

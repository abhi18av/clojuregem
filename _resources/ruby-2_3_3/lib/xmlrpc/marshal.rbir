s(:begin,
  s(:send, nil, :require,
    s(:str, "xmlrpc/parser")),
  s(:send, nil, :require,
    s(:str, "xmlrpc/create")),
  s(:send, nil, :require,
    s(:str, "xmlrpc/config")),
  s(:send, nil, :require,
    s(:str, "xmlrpc/utils")),
  s(:module,
    s(:const, nil, :XMLRPC),
    s(:class,
      s(:const, nil, :Marshal), nil,
      s(:begin,
        s(:send, nil, :include,
          s(:const, nil, :ParserWriterChooseMixin)),
        s(:sclass,
          s(:self),
          s(:begin,
            s(:def, :dump_call,
              s(:args,
                s(:arg, :methodName),
                s(:restarg, :params)),
              s(:send,
                s(:send, nil, :new), :dump_call,
                s(:lvar, :methodName),
                s(:splat,
                  s(:lvar, :params)))),
            s(:def, :dump_response,
              s(:args,
                s(:arg, :param)),
              s(:send,
                s(:send, nil, :new), :dump_response,
                s(:lvar, :param))),
            s(:def, :load_call,
              s(:args,
                s(:arg, :stringOrReadable)),
              s(:send,
                s(:send, nil, :new), :load_call,
                s(:lvar, :stringOrReadable))),
            s(:def, :load_response,
              s(:args,
                s(:arg, :stringOrReadable)),
              s(:send,
                s(:send, nil, :new), :load_response,
                s(:lvar, :stringOrReadable))),
            s(:alias,
              s(:sym, :dump),
              s(:sym, :dump_response)),
            s(:alias,
              s(:sym, :load),
              s(:sym, :load_response)))),
        s(:def, :initialize,
          s(:args,
            s(:optarg, :parser,
              s(:nil)),
            s(:optarg, :writer,
              s(:nil))),
          s(:begin,
            s(:send, nil, :set_parser,
              s(:lvar, :parser)),
            s(:send, nil, :set_writer,
              s(:lvar, :writer)))),
        s(:def, :dump_call,
          s(:args,
            s(:arg, :methodName),
            s(:restarg, :params)),
          s(:send,
            s(:send, nil, :create), :methodCall,
            s(:lvar, :methodName),
            s(:splat,
              s(:lvar, :params)))),
        s(:def, :dump_response,
          s(:args,
            s(:arg, :param)),
          s(:send,
            s(:send, nil, :create), :methodResponse,
            s(:send,
              s(:send,
                s(:lvar, :param), :kind_of?,
                s(:const,
                  s(:const, nil, :XMLRPC), :FaultException)), :!),
            s(:lvar, :param))),
        s(:def, :load_call,
          s(:args,
            s(:arg, :stringOrReadable)),
          s(:send,
            s(:send, nil, :parser), :parseMethodCall,
            s(:lvar, :stringOrReadable))),
        s(:def, :load_response,
          s(:args,
            s(:arg, :stringOrReadable)),
          s(:send,
            s(:send,
              s(:send, nil, :parser), :parseMethodResponse,
              s(:lvar, :stringOrReadable)), :[],
            s(:int, 1)))))))

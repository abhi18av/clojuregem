s(:begin,
  s(:send, nil, :require,
    s(:str, "irb/cmd/nop.rb")),
  s(:send, nil, :require,
    s(:str, "irb/ext/loader")),
  s(:module,
    s(:const, nil, :IRB),
    s(:module,
      s(:const, nil, :ExtendCommand),
      s(:begin,
        s(:class,
          s(:const, nil, :Load),
          s(:const, nil, :Nop),
          s(:begin,
            s(:send, nil, :include,
              s(:const, nil, :IrbLoader)),
            s(:def, :execute,
              s(:args,
                s(:arg, :file_name),
                s(:optarg, :priv,
                  s(:nil))),
              s(:return,
                s(:send, nil, :irb_load,
                  s(:lvar, :file_name),
                  s(:lvar, :priv)))))),
        s(:class,
          s(:const, nil, :Require),
          s(:const, nil, :Nop),
          s(:begin,
            s(:send, nil, :include,
              s(:const, nil, :IrbLoader)),
            s(:def, :execute,
              s(:args,
                s(:arg, :file_name)),
              s(:begin,
                s(:lvasgn, :rex,
                  s(:send,
                    s(:const, nil, :Regexp), :new,
                    s(:dstr,
                      s(:begin,
                        s(:send,
                          s(:const, nil, :Regexp), :quote,
                          s(:lvar, :file_name))),
                      s(:str, "(.o|.rb)?")))),
                s(:if,
                  s(:block,
                    s(:send,
                      s(:gvar, :$"), :find),
                    s(:args,
                      s(:arg, :f)),
                    s(:send,
                      s(:lvar, :f), :=~,
                      s(:lvar, :rex))),
                  s(:return,
                    s(:false)), nil),
                s(:case,
                  s(:lvar, :file_name),
                  s(:when,
                    s(:regexp,
                      s(:str, "\\.rb$"),
                      s(:regopt)),
                    s(:kwbegin,
                      s(:rescue,
                        s(:if,
                          s(:send, nil, :irb_load,
                            s(:lvar, :file_name)),
                          s(:begin,
                            s(:send,
                              s(:gvar, :$"), :push,
                              s(:lvar, :file_name)),
                            s(:return,
                              s(:true))), nil),
                        s(:resbody,
                          s(:array,
                            s(:const, nil, :LoadError)), nil, nil), nil))),
                  s(:when,
                    s(:regexp,
                      s(:str, "\\.(so|o|sl)$"),
                      s(:regopt)),
                    s(:return,
                      s(:send, nil, :ruby_require,
                        s(:lvar, :file_name)))), nil),
                s(:kwbegin,
                  s(:rescue,
                    s(:begin,
                      s(:send, nil, :irb_load,
                        s(:lvasgn, :f,
                          s(:send,
                            s(:lvar, :file_name), :+,
                            s(:str, ".rb")))),
                      s(:send,
                        s(:gvar, :$"), :push,
                        s(:lvar, :f)),
                      s(:return,
                        s(:true))),
                    s(:resbody,
                      s(:array,
                        s(:const, nil, :LoadError)), nil,
                      s(:return,
                        s(:send, nil, :ruby_require,
                          s(:lvar, :file_name)))), nil)))))),
        s(:class,
          s(:const, nil, :Source),
          s(:const, nil, :Nop),
          s(:begin,
            s(:send, nil, :include,
              s(:const, nil, :IrbLoader)),
            s(:def, :execute,
              s(:args,
                s(:arg, :file_name)),
              s(:send, nil, :source_file,
                s(:lvar, :file_name)))))))))

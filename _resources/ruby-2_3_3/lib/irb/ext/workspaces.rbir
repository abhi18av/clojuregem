s(:module,
  s(:const, nil, :IRB),
  s(:class,
    s(:const, nil, :Context), nil,
    s(:begin,
      s(:def, :irb_level,
        s(:args),
        s(:send,
          s(:send, nil, :workspace_stack), :size)),
      s(:def, :workspaces,
        s(:args),
        s(:if,
          s(:defined?,
            s(:ivar, :@workspaces)),
          s(:ivar, :@workspaces),
          s(:ivasgn, :@workspaces,
            s(:array)))),
      s(:def, :push_workspace,
        s(:args,
          s(:restarg, :_main)),
        s(:begin,
          s(:if,
            s(:send,
              s(:lvar, :_main), :empty?),
            s(:begin,
              s(:if,
                s(:send,
                  s(:send, nil, :workspaces), :empty?),
                s(:begin,
                  s(:send, nil, :print,
                    s(:str, "No other workspace\n")),
                  s(:return,
                    s(:nil))), nil),
              s(:lvasgn, :ws,
                s(:send,
                  s(:send, nil, :workspaces), :pop)),
              s(:send,
                s(:send, nil, :workspaces), :push,
                s(:ivar, :@workspace)),
              s(:ivasgn, :@workspace,
                s(:lvar, :ws)),
              s(:return,
                s(:send, nil, :workspaces))), nil),
          s(:send,
            s(:send, nil, :workspaces), :push,
            s(:ivar, :@workspace)),
          s(:ivasgn, :@workspace,
            s(:send,
              s(:const, nil, :WorkSpace), :new,
              s(:send,
                s(:ivar, :@workspace), :binding),
              s(:send,
                s(:lvar, :_main), :[],
                s(:int, 0)))),
          s(:if,
            s(:send,
              s(:send,
                s(:begin,
                  s(:sclass,
                    s(:send, nil, :main),
                    s(:send, nil, :ancestors))), :include?,
                s(:const, nil, :ExtendCommandBundle)), :!),
            s(:send,
              s(:send, nil, :main), :extend,
              s(:const, nil, :ExtendCommandBundle)), nil))),
      s(:def, :pop_workspace,
        s(:args),
        s(:begin,
          s(:if,
            s(:send,
              s(:send, nil, :workspaces), :empty?),
            s(:begin,
              s(:send, nil, :print,
                s(:str, "workspace stack empty\n")),
              s(:return)), nil),
          s(:ivasgn, :@workspace,
            s(:send,
              s(:send, nil, :workspaces), :pop)))))))

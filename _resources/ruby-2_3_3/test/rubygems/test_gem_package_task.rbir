s(:begin,
  s(:send, nil, :require,
    s(:str, "rubygems/test_case")),
  s(:send, nil, :require,
    s(:str, "rubygems")),
  s(:kwbegin,
    s(:rescue,
      s(:send, nil, :require,
        s(:str, "rubygems/package_task")),
      s(:resbody,
        s(:array,
          s(:const, nil, :LoadError)), nil, nil), nil)),
  s(:if,
    s(:defined?,
      s(:const,
        s(:const, nil, :Rake), :PackageTask)),
    s(:class,
      s(:const, nil, :TestGemPackageTask),
      s(:const,
        s(:const, nil, :Gem), :TestCase),
      s(:begin,
        s(:def, :setup,
          s(:args),
          s(:begin,
            s(:zsuper),
            s(:send,
              s(:const, nil, :Rake), :application=,
              s(:send,
                s(:const,
                  s(:const, nil, :Rake), :Application), :new)),
            s(:send,
              s(:const, nil, :RakeFileUtils), :verbose_flag=,
              s(:false)))),
        s(:def, :test_gem_package,
          s(:args),
          s(:begin,
            s(:lvasgn, :gem,
              s(:block,
                s(:send,
                  s(:const,
                    s(:const, nil, :Gem), :Specification), :new),
                s(:args,
                  s(:arg, :g)),
                s(:begin,
                  s(:send,
                    s(:lvar, :g), :name=,
                    s(:str, "pkgr")),
                  s(:send,
                    s(:lvar, :g), :version=,
                    s(:str, "1.2.3")),
                  s(:send,
                    s(:lvar, :g), :authors=,
                    s(:array,
                      s(:str, "author"))),
                  s(:send,
                    s(:lvar, :g), :files=,
                    s(:array,
                      s(:str, "x"))),
                  s(:send,
                    s(:lvar, :g), :summary=,
                    s(:str, "summary"))))),
            s(:lvasgn, :pkg,
              s(:block,
                s(:send,
                  s(:const,
                    s(:const, nil, :Gem), :PackageTask), :new,
                  s(:lvar, :gem)),
                s(:args,
                  s(:arg, :p)),
                s(:send,
                  s(:send,
                    s(:lvar, :p), :package_files), :<<,
                  s(:str, "y")))),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:str, "x"),
                s(:str, "y")),
              s(:send,
                s(:lvar, :pkg), :package_files)),
            s(:block,
              s(:send,
                s(:const, nil, :Dir), :chdir,
                s(:ivar, :@tempdir)),
              s(:args),
              s(:begin,
                s(:send,
                  s(:const, nil, :FileUtils), :touch,
                  s(:str, "x")),
                s(:send,
                  s(:const, nil, :FileUtils), :touch,
                  s(:str, "y")),
                s(:send,
                  s(:send,
                    s(:send,
                      s(:const, nil, :Rake), :application), :[],
                    s(:str, "package")), :invoke),
                s(:send, nil, :assert_path_exists,
                  s(:str, "pkg/pkgr-1.2.3.gem")))))),
        s(:def, :test_gem_package_with_current_platform,
          s(:args),
          s(:begin,
            s(:lvasgn, :gem,
              s(:block,
                s(:send,
                  s(:const,
                    s(:const, nil, :Gem), :Specification), :new),
                s(:args,
                  s(:arg, :g)),
                s(:begin,
                  s(:send,
                    s(:lvar, :g), :name=,
                    s(:str, "pkgr")),
                  s(:send,
                    s(:lvar, :g), :version=,
                    s(:str, "1.2.3")),
                  s(:send,
                    s(:lvar, :g), :files=,
                    s(:send,
                      s(:send,
                        s(:const,
                          s(:const, nil, :Rake), :FileList), :[],
                        s(:str, "x")), :resolve)),
                  s(:send,
                    s(:lvar, :g), :platform=,
                    s(:const,
                      s(:const,
                        s(:const, nil, :Gem), :Platform), :CURRENT))))),
            s(:lvasgn, :pkg,
              s(:block,
                s(:send,
                  s(:const,
                    s(:const, nil, :Gem), :PackageTask), :new,
                  s(:lvar, :gem)),
                s(:args,
                  s(:arg, :p)),
                s(:send,
                  s(:send,
                    s(:lvar, :p), :package_files), :<<,
                  s(:str, "y")))),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:str, "x"),
                s(:str, "y")),
              s(:send,
                s(:lvar, :pkg), :package_files)))),
        s(:def, :test_gem_package_with_ruby_platform,
          s(:args),
          s(:begin,
            s(:lvasgn, :gem,
              s(:block,
                s(:send,
                  s(:const,
                    s(:const, nil, :Gem), :Specification), :new),
                s(:args,
                  s(:arg, :g)),
                s(:begin,
                  s(:send,
                    s(:lvar, :g), :name=,
                    s(:str, "pkgr")),
                  s(:send,
                    s(:lvar, :g), :version=,
                    s(:str, "1.2.3")),
                  s(:send,
                    s(:lvar, :g), :files=,
                    s(:send,
                      s(:send,
                        s(:const,
                          s(:const, nil, :Rake), :FileList), :[],
                        s(:str, "x")), :resolve)),
                  s(:send,
                    s(:lvar, :g), :platform=,
                    s(:const,
                      s(:const,
                        s(:const, nil, :Gem), :Platform), :RUBY))))),
            s(:lvasgn, :pkg,
              s(:block,
                s(:send,
                  s(:const,
                    s(:const, nil, :Gem), :PackageTask), :new,
                  s(:lvar, :gem)),
                s(:args,
                  s(:arg, :p)),
                s(:send,
                  s(:send,
                    s(:lvar, :p), :package_files), :<<,
                  s(:str, "y")))),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:str, "x"),
                s(:str, "y")),
              s(:send,
                s(:lvar, :pkg), :package_files)))),
        s(:def, :test_package_dir_path,
          s(:args),
          s(:begin,
            s(:lvasgn, :gem,
              s(:block,
                s(:send,
                  s(:const,
                    s(:const, nil, :Gem), :Specification), :new),
                s(:args,
                  s(:arg, :g)),
                s(:begin,
                  s(:send,
                    s(:lvar, :g), :name=,
                    s(:str, "nokogiri")),
                  s(:send,
                    s(:lvar, :g), :version=,
                    s(:str, "1.5.0")),
                  s(:send,
                    s(:lvar, :g), :platform=,
                    s(:str, "java"))))),
            s(:lvasgn, :pkg,
              s(:send,
                s(:const,
                  s(:const, nil, :Gem), :PackageTask), :new,
                s(:lvar, :gem))),
            s(:send,
              s(:lvar, :pkg), :define),
            s(:send, nil, :assert_equal,
              s(:str, "pkg/nokogiri-1.5.0-java"),
              s(:send,
                s(:lvar, :pkg), :package_dir_path)))))), nil))

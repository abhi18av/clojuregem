s(:begin,
  s(:send, nil, :require,
    s(:str, "rubygems/test_case")),
  s(:send, nil, :require,
    s(:str, "rubygems")),
  s(:class,
    s(:const, nil, :TestConfig),
    s(:const,
      s(:const, nil, :Gem), :TestCase),
    s(:begin,
      s(:def, :test_datadir,
        s(:args),
        s(:begin,
          s(:send, nil, :util_make_gems),
          s(:lvasgn, :spec,
            s(:send,
              s(:const,
                s(:const, nil, :Gem), :Specification), :find_by_name,
              s(:str, "a"))),
          s(:send,
            s(:lvar, :spec), :activate),
          s(:send, nil, :assert_equal,
            s(:dstr,
              s(:begin,
                s(:send,
                  s(:lvar, :spec), :full_gem_path)),
              s(:str, "/data/a")),
            s(:send,
              s(:const, nil, :Gem), :datadir,
              s(:str, "a"))))),
      s(:def, :test_good_rake_path_is_escaped,
        s(:args),
        s(:begin,
          s(:lvasgn, :path,
            s(:send,
              s(:const,
                s(:const, nil, :Gem), :TestCase), :class_eval,
              s(:str, "@@good_rake"))),
          s(:send, nil, :assert_match,
            s(:regexp,
              s(:begin,
                s(:send,
                  s(:const, nil, :Gem), :ruby)),
              s(:str, " \"[^\"]*good_rake.rb\""),
              s(:regopt)),
            s(:lvar, :path)))),
      s(:def, :test_bad_rake_path_is_escaped,
        s(:args),
        s(:begin,
          s(:lvasgn, :path,
            s(:send,
              s(:const,
                s(:const, nil, :Gem), :TestCase), :class_eval,
              s(:str, "@@bad_rake"))),
          s(:send, nil, :assert_match,
            s(:regexp,
              s(:begin,
                s(:send,
                  s(:const, nil, :Gem), :ruby)),
              s(:str, " \"[^\"]*bad_rake.rb\""),
              s(:regopt)),
            s(:lvar, :path)))))))

s(:begin,
  s(:send, nil, :require,
    s(:str, "rubygems/test_case")),
  s(:class,
    s(:const, nil, :TestGemSourceFetchProblem),
    s(:const,
      s(:const, nil, :Gem), :TestCase),
    s(:def, :test_exception,
      s(:args),
      s(:begin,
        s(:lvasgn, :source,
          s(:send,
            s(:const,
              s(:const, nil, :Gem), :Source), :new,
            s(:ivar, :@gem_repo))),
        s(:lvasgn, :error,
          s(:send,
            s(:const, nil, :RuntimeError), :new,
            s(:str, "test"))),
        s(:lvasgn, :sf,
          s(:send,
            s(:const,
              s(:const, nil, :Gem), :SourceFetchProblem), :new,
            s(:lvar, :source),
            s(:lvar, :error))),
        s(:lvasgn, :e,
          s(:block,
            s(:send, nil, :assert_raises,
              s(:const, nil, :RuntimeError)),
            s(:args),
            s(:send, nil, :raise,
              s(:lvar, :sf)))),
        s(:send, nil, :assert_equal,
          s(:str, "test"),
          s(:send,
            s(:lvar, :e), :message))))))

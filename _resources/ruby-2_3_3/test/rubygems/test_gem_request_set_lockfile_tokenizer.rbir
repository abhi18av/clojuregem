s(:begin,
  s(:send, nil, :require,
    s(:str, "rubygems/test_case")),
  s(:send, nil, :require,
    s(:str, "rubygems/request_set")),
  s(:send, nil, :require,
    s(:str, "rubygems/request_set/lockfile")),
  s(:send, nil, :require,
    s(:str, "rubygems/request_set/lockfile/tokenizer")),
  s(:send, nil, :require,
    s(:str, "rubygems/request_set/lockfile/parser")),
  s(:class,
    s(:const, nil, :TestGemRequestSetLockfileTokenizer),
    s(:const,
      s(:const, nil, :Gem), :TestCase),
    s(:begin,
      s(:def, :setup,
        s(:args),
        s(:begin,
          s(:zsuper),
          s(:ivasgn, :@gem_deps_file,
            s(:str, "gem.deps.rb")),
          s(:ivasgn, :@lock_file,
            s(:send,
              s(:const, nil, :File), :expand_path,
              s(:dstr,
                s(:begin,
                  s(:ivar, :@gem_deps_file)),
                s(:str, ".lock")))))),
      s(:def, :test_peek,
        s(:args),
        s(:begin,
          s(:lvasgn, :tokenizer,
            s(:send,
              s(:const,
                s(:const,
                  s(:const,
                    s(:const, nil, :Gem), :RequestSet), :Lockfile), :Tokenizer), :new,
              s(:str, "\n"))),
          s(:send, nil, :assert_equal,
            s(:sym, :newline),
            s(:send,
              s(:send,
                s(:lvar, :tokenizer), :peek), :first)),
          s(:send, nil, :assert_equal,
            s(:sym, :newline),
            s(:send,
              s(:send,
                s(:lvar, :tokenizer), :next_token), :first)),
          s(:send, nil, :assert_equal,
            s(:sym, :EOF),
            s(:send,
              s(:send,
                s(:lvar, :tokenizer), :peek), :first)))),
      s(:def, :test_skip,
        s(:args),
        s(:begin,
          s(:lvasgn, :tokenizer,
            s(:send,
              s(:const,
                s(:const,
                  s(:const,
                    s(:const, nil, :Gem), :RequestSet), :Lockfile), :Tokenizer), :new,
              s(:str, "\n"))),
          s(:send, nil, :refute_predicate,
            s(:lvar, :tokenizer),
            s(:sym, :empty?)),
          s(:send,
            s(:lvar, :tokenizer), :skip,
            s(:sym, :newline)),
          s(:send, nil, :assert_empty,
            s(:lvar, :tokenizer)))),
      s(:def, :test_token_pos,
        s(:args),
        s(:begin,
          s(:lvasgn, :tokenizer,
            s(:send,
              s(:const,
                s(:const,
                  s(:const,
                    s(:const, nil, :Gem), :RequestSet), :Lockfile), :Tokenizer), :new,
              s(:str, ""))),
          s(:send, nil, :assert_equal,
            s(:array,
              s(:int, 5),
              s(:int, 0)),
            s(:send,
              s(:lvar, :tokenizer), :token_pos,
              s(:int, 5))),
          s(:lvasgn, :tokenizer,
            s(:send,
              s(:const,
                s(:const,
                  s(:const,
                    s(:const, nil, :Gem), :RequestSet), :Lockfile), :Tokenizer), :new,
              s(:str, ""),
              s(:nil),
              s(:int, 1),
              s(:int, 2))),
          s(:send, nil, :assert_equal,
            s(:array,
              s(:int, 3),
              s(:int, 1)),
            s(:send,
              s(:lvar, :tokenizer), :token_pos,
              s(:int, 5))))),
      s(:def, :test_tokenize,
        s(:args),
        s(:begin,
          s(:send, nil, :write_lockfile,
            s(:dstr,
              s(:str, "GEM\n"),
              s(:str, "  remote: "),
              s(:begin,
                s(:ivar, :@gem_repo)),
              s(:str, "\n"),
              s(:str, "  specs:\n"),
              s(:str, "    a (2)\n"),
              s(:str, "      b (= 2)\n"),
              s(:str, "      c (!= 3)\n"),
              s(:str, "      d (> 4)\n"),
              s(:str, "      e (< 5)\n"),
              s(:str, "      f (>= 6)\n"),
              s(:str, "      g (<= 7)\n"),
              s(:str, "      h (~> 8)\n"),
              s(:str, "\n"),
              s(:str, "PLATFORMS\n"),
              s(:str, "  "),
              s(:begin,
                s(:const,
                  s(:const,
                    s(:const, nil, :Gem), :Platform), :RUBY)),
              s(:str, "\n"),
              s(:str, "\n"),
              s(:str, "DEPENDENCIES\n"),
              s(:str, "  a\n"))),
          s(:lvasgn, :expected,
            s(:array,
              s(:array,
                s(:sym, :section),
                s(:str, "GEM"),
                s(:int, 0),
                s(:int, 0)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 3),
                s(:int, 0)),
              s(:array,
                s(:sym, :entry),
                s(:str, "remote"),
                s(:int, 2),
                s(:int, 1)),
              s(:array,
                s(:sym, :text),
                s(:ivar, :@gem_repo),
                s(:int, 10),
                s(:int, 1)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 34),
                s(:int, 1)),
              s(:array,
                s(:sym, :entry),
                s(:str, "specs"),
                s(:int, 2),
                s(:int, 2)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 8),
                s(:int, 2)),
              s(:array,
                s(:sym, :text),
                s(:str, "a"),
                s(:int, 4),
                s(:int, 3)),
              s(:array,
                s(:sym, :l_paren),
                s(:nil),
                s(:int, 6),
                s(:int, 3)),
              s(:array,
                s(:sym, :text),
                s(:str, "2"),
                s(:int, 7),
                s(:int, 3)),
              s(:array,
                s(:sym, :r_paren),
                s(:nil),
                s(:int, 8),
                s(:int, 3)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 9),
                s(:int, 3)),
              s(:array,
                s(:sym, :text),
                s(:str, "b"),
                s(:int, 6),
                s(:int, 4)),
              s(:array,
                s(:sym, :l_paren),
                s(:nil),
                s(:int, 8),
                s(:int, 4)),
              s(:array,
                s(:sym, :requirement),
                s(:str, "="),
                s(:int, 9),
                s(:int, 4)),
              s(:array,
                s(:sym, :text),
                s(:str, "2"),
                s(:int, 11),
                s(:int, 4)),
              s(:array,
                s(:sym, :r_paren),
                s(:nil),
                s(:int, 12),
                s(:int, 4)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 13),
                s(:int, 4)),
              s(:array,
                s(:sym, :text),
                s(:str, "c"),
                s(:int, 6),
                s(:int, 5)),
              s(:array,
                s(:sym, :l_paren),
                s(:nil),
                s(:int, 8),
                s(:int, 5)),
              s(:array,
                s(:sym, :requirement),
                s(:str, "!="),
                s(:int, 9),
                s(:int, 5)),
              s(:array,
                s(:sym, :text),
                s(:str, "3"),
                s(:int, 12),
                s(:int, 5)),
              s(:array,
                s(:sym, :r_paren),
                s(:nil),
                s(:int, 13),
                s(:int, 5)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 14),
                s(:int, 5)),
              s(:array,
                s(:sym, :text),
                s(:str, "d"),
                s(:int, 6),
                s(:int, 6)),
              s(:array,
                s(:sym, :l_paren),
                s(:nil),
                s(:int, 8),
                s(:int, 6)),
              s(:array,
                s(:sym, :requirement),
                s(:str, ">"),
                s(:int, 9),
                s(:int, 6)),
              s(:array,
                s(:sym, :text),
                s(:str, "4"),
                s(:int, 11),
                s(:int, 6)),
              s(:array,
                s(:sym, :r_paren),
                s(:nil),
                s(:int, 12),
                s(:int, 6)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 13),
                s(:int, 6)),
              s(:array,
                s(:sym, :text),
                s(:str, "e"),
                s(:int, 6),
                s(:int, 7)),
              s(:array,
                s(:sym, :l_paren),
                s(:nil),
                s(:int, 8),
                s(:int, 7)),
              s(:array,
                s(:sym, :requirement),
                s(:str, "<"),
                s(:int, 9),
                s(:int, 7)),
              s(:array,
                s(:sym, :text),
                s(:str, "5"),
                s(:int, 11),
                s(:int, 7)),
              s(:array,
                s(:sym, :r_paren),
                s(:nil),
                s(:int, 12),
                s(:int, 7)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 13),
                s(:int, 7)),
              s(:array,
                s(:sym, :text),
                s(:str, "f"),
                s(:int, 6),
                s(:int, 8)),
              s(:array,
                s(:sym, :l_paren),
                s(:nil),
                s(:int, 8),
                s(:int, 8)),
              s(:array,
                s(:sym, :requirement),
                s(:str, ">="),
                s(:int, 9),
                s(:int, 8)),
              s(:array,
                s(:sym, :text),
                s(:str, "6"),
                s(:int, 12),
                s(:int, 8)),
              s(:array,
                s(:sym, :r_paren),
                s(:nil),
                s(:int, 13),
                s(:int, 8)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 14),
                s(:int, 8)),
              s(:array,
                s(:sym, :text),
                s(:str, "g"),
                s(:int, 6),
                s(:int, 9)),
              s(:array,
                s(:sym, :l_paren),
                s(:nil),
                s(:int, 8),
                s(:int, 9)),
              s(:array,
                s(:sym, :requirement),
                s(:str, "<="),
                s(:int, 9),
                s(:int, 9)),
              s(:array,
                s(:sym, :text),
                s(:str, "7"),
                s(:int, 12),
                s(:int, 9)),
              s(:array,
                s(:sym, :r_paren),
                s(:nil),
                s(:int, 13),
                s(:int, 9)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 14),
                s(:int, 9)),
              s(:array,
                s(:sym, :text),
                s(:str, "h"),
                s(:int, 6),
                s(:int, 10)),
              s(:array,
                s(:sym, :l_paren),
                s(:nil),
                s(:int, 8),
                s(:int, 10)),
              s(:array,
                s(:sym, :requirement),
                s(:str, "~>"),
                s(:int, 9),
                s(:int, 10)),
              s(:array,
                s(:sym, :text),
                s(:str, "8"),
                s(:int, 12),
                s(:int, 10)),
              s(:array,
                s(:sym, :r_paren),
                s(:nil),
                s(:int, 13),
                s(:int, 10)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 14),
                s(:int, 10)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 0),
                s(:int, 11)),
              s(:array,
                s(:sym, :section),
                s(:str, "PLATFORMS"),
                s(:int, 0),
                s(:int, 12)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 9),
                s(:int, 12)),
              s(:array,
                s(:sym, :text),
                s(:const,
                  s(:const,
                    s(:const, nil, :Gem), :Platform), :RUBY),
                s(:int, 2),
                s(:int, 13)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 6),
                s(:int, 13)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 0),
                s(:int, 14)),
              s(:array,
                s(:sym, :section),
                s(:str, "DEPENDENCIES"),
                s(:int, 0),
                s(:int, 15)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 12),
                s(:int, 15)),
              s(:array,
                s(:sym, :text),
                s(:str, "a"),
                s(:int, 2),
                s(:int, 16)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 3),
                s(:int, 16)))),
          s(:send, nil, :assert_equal,
            s(:lvar, :expected),
            s(:send, nil, :tokenize_lockfile)))),
      s(:def, :test_tokenize_capitals,
        s(:args),
        s(:begin,
          s(:send, nil, :write_lockfile,
            s(:dstr,
              s(:str, "GEM\n"),
              s(:str, "  remote: "),
              s(:begin,
                s(:ivar, :@gem_repo)),
              s(:str, "\n"),
              s(:str, "  specs:\n"),
              s(:str, "    Ab (2)\n"),
              s(:str, "\n"),
              s(:str, "PLATFORMS\n"),
              s(:str, "  "),
              s(:begin,
                s(:const,
                  s(:const,
                    s(:const, nil, :Gem), :Platform), :RUBY)),
              s(:str, "\n"),
              s(:str, "\n"),
              s(:str, "DEPENDENCIES\n"),
              s(:str, "  Ab\n"))),
          s(:lvasgn, :expected,
            s(:array,
              s(:array,
                s(:sym, :section),
                s(:str, "GEM"),
                s(:int, 0),
                s(:int, 0)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 3),
                s(:int, 0)),
              s(:array,
                s(:sym, :entry),
                s(:str, "remote"),
                s(:int, 2),
                s(:int, 1)),
              s(:array,
                s(:sym, :text),
                s(:ivar, :@gem_repo),
                s(:int, 10),
                s(:int, 1)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 34),
                s(:int, 1)),
              s(:array,
                s(:sym, :entry),
                s(:str, "specs"),
                s(:int, 2),
                s(:int, 2)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 8),
                s(:int, 2)),
              s(:array,
                s(:sym, :text),
                s(:str, "Ab"),
                s(:int, 4),
                s(:int, 3)),
              s(:array,
                s(:sym, :l_paren),
                s(:nil),
                s(:int, 7),
                s(:int, 3)),
              s(:array,
                s(:sym, :text),
                s(:str, "2"),
                s(:int, 8),
                s(:int, 3)),
              s(:array,
                s(:sym, :r_paren),
                s(:nil),
                s(:int, 9),
                s(:int, 3)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 10),
                s(:int, 3)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 0),
                s(:int, 4)),
              s(:array,
                s(:sym, :section),
                s(:str, "PLATFORMS"),
                s(:int, 0),
                s(:int, 5)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 9),
                s(:int, 5)),
              s(:array,
                s(:sym, :text),
                s(:const,
                  s(:const,
                    s(:const, nil, :Gem), :Platform), :RUBY),
                s(:int, 2),
                s(:int, 6)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 6),
                s(:int, 6)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 0),
                s(:int, 7)),
              s(:array,
                s(:sym, :section),
                s(:str, "DEPENDENCIES"),
                s(:int, 0),
                s(:int, 8)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 12),
                s(:int, 8)),
              s(:array,
                s(:sym, :text),
                s(:str, "Ab"),
                s(:int, 2),
                s(:int, 9)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 4),
                s(:int, 9)))),
          s(:send, nil, :assert_equal,
            s(:lvar, :expected),
            s(:send, nil, :tokenize_lockfile)))),
      s(:def, :test_tokenize_conflict_markers,
        s(:args),
        s(:begin,
          s(:send, nil, :write_lockfile,
            s(:str, "<<<<<<<")),
          s(:lvasgn, :e,
            s(:block,
              s(:send, nil, :assert_raises,
                s(:const,
                  s(:const,
                    s(:const,
                      s(:const, nil, :Gem), :RequestSet), :Lockfile), :ParseError)),
              s(:args),
              s(:send, nil, :tokenize_lockfile))),
          s(:send, nil, :assert_equal,
            s(:dstr,
              s(:str, "your "),
              s(:begin,
                s(:ivar, :@lock_file)),
              s(:str, " contains merge conflict markers (at line 0 column 0)")),
            s(:send,
              s(:lvar, :e), :message)),
          s(:send, nil, :write_lockfile,
            s(:str, "|||||||")),
          s(:lvasgn, :e,
            s(:block,
              s(:send, nil, :assert_raises,
                s(:const,
                  s(:const,
                    s(:const,
                      s(:const, nil, :Gem), :RequestSet), :Lockfile), :ParseError)),
              s(:args),
              s(:send, nil, :tokenize_lockfile))),
          s(:send, nil, :assert_equal,
            s(:dstr,
              s(:str, "your "),
              s(:begin,
                s(:ivar, :@lock_file)),
              s(:str, " contains merge conflict markers (at line 0 column 0)")),
            s(:send,
              s(:lvar, :e), :message)),
          s(:send, nil, :write_lockfile,
            s(:str, "=======")),
          s(:lvasgn, :e,
            s(:block,
              s(:send, nil, :assert_raises,
                s(:const,
                  s(:const,
                    s(:const,
                      s(:const, nil, :Gem), :RequestSet), :Lockfile), :ParseError)),
              s(:args),
              s(:send, nil, :tokenize_lockfile))),
          s(:send, nil, :assert_equal,
            s(:dstr,
              s(:str, "your "),
              s(:begin,
                s(:ivar, :@lock_file)),
              s(:str, " contains merge conflict markers (at line 0 column 0)")),
            s(:send,
              s(:lvar, :e), :message)),
          s(:send, nil, :write_lockfile,
            s(:str, ">>>>>>>")),
          s(:lvasgn, :e,
            s(:block,
              s(:send, nil, :assert_raises,
                s(:const,
                  s(:const,
                    s(:const,
                      s(:const, nil, :Gem), :RequestSet), :Lockfile), :ParseError)),
              s(:args),
              s(:send, nil, :tokenize_lockfile))),
          s(:send, nil, :assert_equal,
            s(:dstr,
              s(:str, "your "),
              s(:begin,
                s(:ivar, :@lock_file)),
              s(:str, " contains merge conflict markers (at line 0 column 0)")),
            s(:send,
              s(:lvar, :e), :message)))),
      s(:def, :test_tokenize_git,
        s(:args),
        s(:begin,
          s(:send, nil, :write_lockfile,
            s(:dstr,
              s(:str, "DEPENDENCIES\n"),
              s(:str, "  a!\n"))),
          s(:lvasgn, :expected,
            s(:array,
              s(:array,
                s(:sym, :section),
                s(:str, "DEPENDENCIES"),
                s(:int, 0),
                s(:int, 0)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 12),
                s(:int, 0)),
              s(:array,
                s(:sym, :text),
                s(:str, "a"),
                s(:int, 2),
                s(:int, 1)),
              s(:array,
                s(:sym, :bang),
                s(:nil),
                s(:int, 3),
                s(:int, 1)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 4),
                s(:int, 1)))),
          s(:send, nil, :assert_equal,
            s(:lvar, :expected),
            s(:send, nil, :tokenize_lockfile)))),
      s(:def, :test_tokenize_multiple,
        s(:args),
        s(:begin,
          s(:send, nil, :write_lockfile,
            s(:dstr,
              s(:str, "GEM\n"),
              s(:str, "  remote: "),
              s(:begin,
                s(:ivar, :@gem_repo)),
              s(:str, "\n"),
              s(:str, "  specs:\n"),
              s(:str, "    a (2)\n"),
              s(:str, "      b (~> 3.0, >= 3.0.1)\n"))),
          s(:lvasgn, :expected,
            s(:array,
              s(:array,
                s(:sym, :section),
                s(:str, "GEM"),
                s(:int, 0),
                s(:int, 0)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 3),
                s(:int, 0)),
              s(:array,
                s(:sym, :entry),
                s(:str, "remote"),
                s(:int, 2),
                s(:int, 1)),
              s(:array,
                s(:sym, :text),
                s(:ivar, :@gem_repo),
                s(:int, 10),
                s(:int, 1)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 34),
                s(:int, 1)),
              s(:array,
                s(:sym, :entry),
                s(:str, "specs"),
                s(:int, 2),
                s(:int, 2)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 8),
                s(:int, 2)),
              s(:array,
                s(:sym, :text),
                s(:str, "a"),
                s(:int, 4),
                s(:int, 3)),
              s(:array,
                s(:sym, :l_paren),
                s(:nil),
                s(:int, 6),
                s(:int, 3)),
              s(:array,
                s(:sym, :text),
                s(:str, "2"),
                s(:int, 7),
                s(:int, 3)),
              s(:array,
                s(:sym, :r_paren),
                s(:nil),
                s(:int, 8),
                s(:int, 3)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 9),
                s(:int, 3)),
              s(:array,
                s(:sym, :text),
                s(:str, "b"),
                s(:int, 6),
                s(:int, 4)),
              s(:array,
                s(:sym, :l_paren),
                s(:nil),
                s(:int, 8),
                s(:int, 4)),
              s(:array,
                s(:sym, :requirement),
                s(:str, "~>"),
                s(:int, 9),
                s(:int, 4)),
              s(:array,
                s(:sym, :text),
                s(:str, "3.0"),
                s(:int, 12),
                s(:int, 4)),
              s(:array,
                s(:sym, :comma),
                s(:nil),
                s(:int, 15),
                s(:int, 4)),
              s(:array,
                s(:sym, :requirement),
                s(:str, ">="),
                s(:int, 17),
                s(:int, 4)),
              s(:array,
                s(:sym, :text),
                s(:str, "3.0.1"),
                s(:int, 20),
                s(:int, 4)),
              s(:array,
                s(:sym, :r_paren),
                s(:nil),
                s(:int, 25),
                s(:int, 4)),
              s(:array,
                s(:sym, :newline),
                s(:nil),
                s(:int, 26),
                s(:int, 4)))),
          s(:send, nil, :assert_equal,
            s(:lvar, :expected),
            s(:send, nil, :tokenize_lockfile)))),
      s(:def, :test_unget,
        s(:args),
        s(:begin,
          s(:lvasgn, :tokenizer,
            s(:send,
              s(:const,
                s(:const,
                  s(:const,
                    s(:const, nil, :Gem), :RequestSet), :Lockfile), :Tokenizer), :new,
              s(:str, "\n"))),
          s(:send,
            s(:lvar, :tokenizer), :unshift,
            s(:sym, :token)),
          s(:lvasgn, :parser,
            s(:send,
              s(:lvar, :tokenizer), :make_parser,
              s(:nil),
              s(:nil))),
          s(:send, nil, :assert_equal,
            s(:sym, :token),
            s(:send,
              s(:lvar, :parser), :get)))),
      s(:def, :write_lockfile,
        s(:args,
          s(:arg, :lockfile)),
        s(:block,
          s(:send, nil, :open,
            s(:ivar, :@lock_file),
            s(:str, "w")),
          s(:args,
            s(:arg, :io)),
          s(:send,
            s(:lvar, :io), :write,
            s(:lvar, :lockfile)))),
      s(:def, :tokenize_lockfile,
        s(:args),
        s(:send,
          s(:send,
            s(:const,
              s(:const,
                s(:const,
                  s(:const, nil, :Gem), :RequestSet), :Lockfile), :Tokenizer), :from_file,
            s(:ivar, :@lock_file)), :to_a)))))

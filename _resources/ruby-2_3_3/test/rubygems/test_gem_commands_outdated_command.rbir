s(:begin,
  s(:send, nil, :require,
    s(:str, "rubygems/test_case")),
  s(:send, nil, :require,
    s(:str, "rubygems/commands/outdated_command")),
  s(:class,
    s(:const, nil, :TestGemCommandsOutdatedCommand),
    s(:const,
      s(:const, nil, :Gem), :TestCase),
    s(:begin,
      s(:def, :setup,
        s(:args),
        s(:begin,
          s(:zsuper),
          s(:ivasgn, :@cmd,
            s(:send,
              s(:const,
                s(:const,
                  s(:const, nil, :Gem), :Commands), :OutdatedCommand), :new)))),
      s(:def, :test_initialize,
        s(:args),
        s(:send, nil, :assert,
          s(:send,
            s(:ivar, :@cmd), :handles?,
            s(:array,
              s(:str, "--platform"),
              s(:dstr,
                s(:begin,
                  s(:send,
                    s(:const,
                      s(:const, nil, :Gem), :Platform), :local))))))),
      s(:def, :test_execute,
        s(:args),
        s(:begin,
          s(:block,
            s(:send, nil, :spec_fetcher),
            s(:args,
              s(:arg, :fetcher)),
            s(:begin,
              s(:send,
                s(:lvar, :fetcher), :download,
                s(:str, "foo"),
                s(:str, "1.0")),
              s(:send,
                s(:lvar, :fetcher), :download,
                s(:str, "foo"),
                s(:str, "2.0")),
              s(:send,
                s(:lvar, :fetcher), :gem,
                s(:str, "foo"),
                s(:str, "0.1")),
              s(:send,
                s(:lvar, :fetcher), :gem,
                s(:str, "foo"),
                s(:str, "0.2")))),
          s(:block,
            s(:send, nil, :use_ui,
              s(:ivar, :@ui)),
            s(:args),
            s(:send,
              s(:ivar, :@cmd), :execute)),
          s(:send, nil, :assert_equal,
            s(:str, "foo (0.2 < 2.0)\n"),
            s(:send,
              s(:ivar, :@ui), :output)),
          s(:send, nil, :assert_equal,
            s(:str, ""),
            s(:send,
              s(:ivar, :@ui), :error)))))))

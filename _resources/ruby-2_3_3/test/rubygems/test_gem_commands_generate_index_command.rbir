s(:begin,
  s(:send, nil, :require,
    s(:str, "rubygems/test_case")),
  s(:send, nil, :require,
    s(:str, "rubygems/indexer")),
  s(:send, nil, :require,
    s(:str, "rubygems/commands/generate_index_command")),
  s(:if,
    s(:send,
      s(:str, ""), :respond_to?,
      s(:sym, :to_xs)),
    s(:class,
      s(:const, nil, :TestGemCommandsGenerateIndexCommand),
      s(:const,
        s(:const, nil, :Gem), :TestCase),
      s(:begin,
        s(:def, :setup,
          s(:args),
          s(:begin,
            s(:zsuper),
            s(:ivasgn, :@cmd,
              s(:send,
                s(:const,
                  s(:const,
                    s(:const, nil, :Gem), :Commands), :GenerateIndexCommand), :new)),
            s(:send,
              s(:send,
                s(:ivar, :@cmd), :options), :[]=,
              s(:sym, :directory),
              s(:ivar, :@gemhome)))),
        s(:def, :test_execute,
          s(:args),
          s(:begin,
            s(:block,
              s(:send, nil, :use_ui,
                s(:ivar, :@ui)),
              s(:args),
              s(:send,
                s(:ivar, :@cmd), :execute)),
            s(:lvasgn, :specs,
              s(:send,
                s(:const, nil, :File), :join,
                s(:ivar, :@gemhome),
                s(:str, "specs.4.8.gz"))),
            s(:send, nil, :assert,
              s(:send,
                s(:const, nil, :File), :exist?,
                s(:lvar, :specs)),
              s(:lvar, :specs)))),
        s(:def, :test_handle_options_directory,
          s(:args),
          s(:begin,
            s(:if,
              s(:send, nil, :win_platform?),
              s(:return), nil),
            s(:send, nil, :refute_equal,
              s(:str, "/nonexistent"),
              s(:send,
                s(:send,
                  s(:ivar, :@cmd), :options), :[],
                s(:sym, :directory))),
            s(:send,
              s(:ivar, :@cmd), :handle_options,
              s(:array,
                s(:str, "--directory"),
                s(:str, "/nonexistent"))),
            s(:send, nil, :assert_equal,
              s(:str, "/nonexistent"),
              s(:send,
                s(:send,
                  s(:ivar, :@cmd), :options), :[],
                s(:sym, :directory))))),
        s(:def, :test_handle_options_directory_windows,
          s(:args),
          s(:begin,
            s(:if,
              s(:send, nil, :win_platform?), nil,
              s(:return)),
            s(:send, nil, :refute_equal,
              s(:str, "/nonexistent"),
              s(:send,
                s(:send,
                  s(:ivar, :@cmd), :options), :[],
                s(:sym, :directory))),
            s(:send,
              s(:ivar, :@cmd), :handle_options,
              s(:array,
                s(:str, "--directory"),
                s(:str, "C:/nonexistent"))),
            s(:send, nil, :assert_equal,
              s(:str, "C:/nonexistent"),
              s(:send,
                s(:send,
                  s(:ivar, :@cmd), :options), :[],
                s(:sym, :directory))))),
        s(:def, :test_handle_options_update,
          s(:args),
          s(:begin,
            s(:send,
              s(:ivar, :@cmd), :handle_options,
              s(:array,
                s(:str, "--update"))),
            s(:send, nil, :assert,
              s(:send,
                s(:send,
                  s(:ivar, :@cmd), :options), :[],
                s(:sym, :update))))))), nil))

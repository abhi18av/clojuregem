s(:begin,
  s(:send, nil, :require,
    s(:str, "rubygems/test_case")),
  s(:send, nil, :require,
    s(:str, "rubygems/command")),
  s(:send, nil, :require,
    s(:str, "rubygems/version_option")),
  s(:class,
    s(:const, nil, :TestGemVersionOption),
    s(:const,
      s(:const, nil, :Gem), :TestCase),
    s(:begin,
      s(:def, :setup,
        s(:args),
        s(:begin,
          s(:zsuper),
          s(:ivasgn, :@cmd,
            s(:send,
              s(:const,
                s(:const, nil, :Gem), :Command), :new,
              s(:str, "dummy"),
              s(:str, "dummy"))),
          s(:send,
            s(:ivar, :@cmd), :extend,
            s(:const,
              s(:const, nil, :Gem), :VersionOption)))),
      s(:def, :test_add_platform_option,
        s(:args),
        s(:begin,
          s(:send,
            s(:ivar, :@cmd), :add_platform_option),
          s(:send, nil, :assert,
            s(:send,
              s(:ivar, :@cmd), :handles?,
              s(:array,
                s(:str, "--platform"),
                s(:str, "x86-darwin")))))),
      s(:def, :test_add_version_option,
        s(:args),
        s(:begin,
          s(:send,
            s(:ivar, :@cmd), :add_version_option),
          s(:send, nil, :assert,
            s(:send,
              s(:ivar, :@cmd), :handles?,
              s(:array,
                s(:str, "--version"),
                s(:str, ">1")))))),
      s(:def, :test_enables_prerelease,
        s(:args),
        s(:begin,
          s(:send,
            s(:ivar, :@cmd), :add_version_option),
          s(:send,
            s(:ivar, :@cmd), :handle_options,
            s(:array,
              s(:str, "mygem"),
              s(:str, "-v"),
              s(:str, "0.2.0.a"))),
          s(:send, nil, :assert,
            s(:send,
              s(:send,
                s(:ivar, :@cmd), :options), :[],
              s(:sym, :prerelease))),
          s(:send,
            s(:ivar, :@cmd), :handle_options,
            s(:array,
              s(:str, "mygem"),
              s(:str, "-v"),
              s(:str, "0.2.0"))),
          s(:send, nil, :refute,
            s(:send,
              s(:send,
                s(:ivar, :@cmd), :options), :[],
              s(:sym, :prerelease))),
          s(:send,
            s(:ivar, :@cmd), :handle_options,
            s(:array,
              s(:str, "mygem"))),
          s(:send, nil, :refute,
            s(:send,
              s(:send,
                s(:ivar, :@cmd), :options), :[],
              s(:sym, :prerelease))))),
      s(:def, :test_platform_option,
        s(:args),
        s(:begin,
          s(:send,
            s(:ivar, :@cmd), :add_platform_option),
          s(:send,
            s(:ivar, :@cmd), :handle_options,
            s(:array,
              s(:str, "--platform"),
              s(:str, "x86-freebsd6"),
              s(:str, "--platform"),
              s(:str, "x86-freebsd7"))),
          s(:lvasgn, :expected,
            s(:array,
              s(:const,
                s(:const,
                  s(:const, nil, :Gem), :Platform), :RUBY),
              s(:send,
                s(:const,
                  s(:const, nil, :Gem), :Platform), :new,
                s(:str, "x86-freebsd6")),
              s(:send,
                s(:const,
                  s(:const, nil, :Gem), :Platform), :new,
                s(:str, "x86-freebsd7")))),
          s(:send, nil, :assert_equal,
            s(:lvar, :expected),
            s(:send,
              s(:const, nil, :Gem), :platforms)))),
      s(:def, :test_platform_option_ruby,
        s(:args),
        s(:begin,
          s(:send,
            s(:ivar, :@cmd), :add_platform_option),
          s(:send,
            s(:ivar, :@cmd), :handle_options,
            s(:array,
              s(:str, "--platform"),
              s(:str, "ruby"))),
          s(:lvasgn, :expected,
            s(:array,
              s(:const,
                s(:const,
                  s(:const, nil, :Gem), :Platform), :RUBY))),
          s(:send, nil, :assert_equal,
            s(:lvar, :expected),
            s(:send,
              s(:const, nil, :Gem), :platforms)))),
      s(:def, :test_platform_option_twice,
        s(:args),
        s(:begin,
          s(:send,
            s(:ivar, :@cmd), :add_platform_option),
          s(:send,
            s(:ivar, :@cmd), :handle_options,
            s(:array,
              s(:str, "--platform"),
              s(:str, "x86-freebsd6"),
              s(:str, "--platform"),
              s(:str, "x86-freebsd-6"))),
          s(:lvasgn, :expected,
            s(:array,
              s(:const,
                s(:const,
                  s(:const, nil, :Gem), :Platform), :RUBY),
              s(:send,
                s(:const,
                  s(:const, nil, :Gem), :Platform), :new,
                s(:str, "x86-freebsd6")))),
          s(:send, nil, :assert_equal,
            s(:lvar, :expected),
            s(:send,
              s(:const, nil, :Gem), :platforms)))),
      s(:def, :test_version_option,
        s(:args),
        s(:begin,
          s(:send,
            s(:ivar, :@cmd), :add_version_option),
          s(:send,
            s(:ivar, :@cmd), :handle_options,
            s(:array,
              s(:str, "--version"),
              s(:str, ">1"))),
          s(:lvasgn, :expected,
            s(:hash,
              s(:pair,
                s(:sym, :args),
                s(:array)),
              s(:pair,
                s(:sym, :explicit_prerelease),
                s(:false)),
              s(:pair,
                s(:sym, :prerelease),
                s(:false)),
              s(:pair,
                s(:sym, :version),
                s(:send,
                  s(:const,
                    s(:const, nil, :Gem), :Requirement), :new,
                  s(:str, "> 1"))))),
          s(:send, nil, :assert_equal,
            s(:lvar, :expected),
            s(:send,
              s(:ivar, :@cmd), :options)))),
      s(:def, :test_version_option_compound,
        s(:args),
        s(:begin,
          s(:send,
            s(:ivar, :@cmd), :add_version_option),
          s(:send,
            s(:ivar, :@cmd), :handle_options,
            s(:array,
              s(:str, "--version"),
              s(:str, "< 1, > 0.9"))),
          s(:lvasgn, :expected,
            s(:hash,
              s(:pair,
                s(:sym, :args),
                s(:array)),
              s(:pair,
                s(:sym, :explicit_prerelease),
                s(:false)),
              s(:pair,
                s(:sym, :prerelease),
                s(:false)),
              s(:pair,
                s(:sym, :version),
                s(:send,
                  s(:const,
                    s(:const, nil, :Gem), :Requirement), :new,
                  s(:str, "< 1"),
                  s(:str, "> 0.9"))))),
          s(:send, nil, :assert_equal,
            s(:lvar, :expected),
            s(:send,
              s(:ivar, :@cmd), :options)))),
      s(:def, :test_version_option_explicit_prerelease,
        s(:args),
        s(:begin,
          s(:send,
            s(:ivar, :@cmd), :add_prerelease_option),
          s(:send,
            s(:ivar, :@cmd), :add_version_option),
          s(:send,
            s(:ivar, :@cmd), :handle_options,
            s(:array,
              s(:str, "--pre"),
              s(:str, "--version"),
              s(:str, ">1"))),
          s(:lvasgn, :expected,
            s(:hash,
              s(:pair,
                s(:sym, :args),
                s(:array)),
              s(:pair,
                s(:sym, :explicit_prerelease),
                s(:true)),
              s(:pair,
                s(:sym, :prerelease),
                s(:true)),
              s(:pair,
                s(:sym, :version),
                s(:send,
                  s(:const,
                    s(:const, nil, :Gem), :Requirement), :new,
                  s(:str, "> 1"))))),
          s(:send, nil, :assert_equal,
            s(:lvar, :expected),
            s(:send,
              s(:ivar, :@cmd), :options)))),
      s(:def, :test_version_option_twice,
        s(:args),
        s(:begin,
          s(:send,
            s(:ivar, :@cmd), :add_version_option),
          s(:send,
            s(:ivar, :@cmd), :handle_options,
            s(:array,
              s(:str, "--version"),
              s(:str, ">1.a"))),
          s(:lvasgn, :expected,
            s(:hash,
              s(:pair,
                s(:sym, :args),
                s(:array)),
              s(:pair,
                s(:sym, :explicit_prerelease),
                s(:false)),
              s(:pair,
                s(:sym, :prerelease),
                s(:true)),
              s(:pair,
                s(:sym, :version),
                s(:send,
                  s(:const,
                    s(:const, nil, :Gem), :Requirement), :new,
                  s(:str, "> 1.a"))))),
          s(:send, nil, :assert_equal,
            s(:lvar, :expected),
            s(:send,
              s(:ivar, :@cmd), :options)),
          s(:send,
            s(:ivar, :@cmd), :handle_options,
            s(:array,
              s(:str, "--version"),
              s(:str, ">1"))),
          s(:lvasgn, :expected,
            s(:hash,
              s(:pair,
                s(:sym, :args),
                s(:array)),
              s(:pair,
                s(:sym, :explicit_prerelease),
                s(:false)),
              s(:pair,
                s(:sym, :prerelease),
                s(:false)),
              s(:pair,
                s(:sym, :version),
                s(:send,
                  s(:const,
                    s(:const, nil, :Gem), :Requirement), :new,
                  s(:str, "> 1"))))),
          s(:send, nil, :assert_equal,
            s(:lvar, :expected),
            s(:send,
              s(:ivar, :@cmd), :options)))))))

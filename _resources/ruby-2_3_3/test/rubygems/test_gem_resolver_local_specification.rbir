s(:begin,
  s(:send, nil, :require,
    s(:str, "rubygems/test_case")),
  s(:send, nil, :require,
    s(:str, "rubygems/available_set")),
  s(:class,
    s(:const, nil, :TestGemResolverLocalSpecification),
    s(:const,
      s(:const, nil, :Gem), :TestCase),
    s(:begin,
      s(:def, :setup,
        s(:args),
        s(:begin,
          s(:zsuper),
          s(:ivasgn, :@set,
            s(:send,
              s(:const,
                s(:const, nil, :Gem), :AvailableSet), :new)))),
      s(:def, :test_install,
        s(:args),
        s(:begin,
          s(:lvasgn, :specs,
            s(:block,
              s(:send, nil, :spec_fetcher),
              s(:args,
                s(:arg, :fetcher)),
              s(:send,
                s(:lvar, :fetcher), :gem,
                s(:str, "a"),
                s(:int, 2)))),
          s(:lvasgn, :source,
            s(:send,
              s(:const,
                s(:const,
                  s(:const, nil, :Gem), :Source), :SpecificFile), :new,
              s(:str, "gems/a-2.gem"))),
          s(:lvasgn, :spec,
            s(:send,
              s(:const,
                s(:const,
                  s(:const, nil, :Gem), :Resolver), :LocalSpecification), :new,
              s(:ivar, :@set),
              s(:send,
                s(:lvar, :specs), :[],
                s(:str, "a-2")),
              s(:lvar, :source))),
          s(:lvasgn, :called,
            s(:false)),
          s(:block,
            s(:send,
              s(:lvar, :spec), :install,
              s(:hash)),
            s(:args,
              s(:arg, :installer)),
            s(:lvasgn, :called,
              s(:lvar, :installer))),
          s(:send, nil, :assert_path_exists,
            s(:send,
              s(:const, nil, :File), :join,
              s(:ivar, :@gemhome),
              s(:str, "specifications"),
              s(:str, "a-2.gemspec"))),
          s(:send, nil, :assert_kind_of,
            s(:const,
              s(:const, nil, :Gem), :Installer),
            s(:lvar, :called)))),
      s(:def, :test_installable_platform_eh,
        s(:args),
        s(:begin,
          s(:masgn,
            s(:mlhs,
              s(:lvasgn, :b),
              s(:lvasgn, :b_gem)),
            s(:block,
              s(:send, nil, :util_gem,
                s(:str, "a"),
                s(:int, 1)),
              s(:args,
                s(:arg, :s)),
              s(:send,
                s(:lvar, :s), :platform=,
                s(:send,
                  s(:const,
                    s(:const, nil, :Gem), :Platform), :new,
                  s(:array,
                    s(:str, "cpu"),
                    s(:str, "other_platform"),
                    s(:str, "1")))))),
          s(:lvasgn, :source,
            s(:send,
              s(:const,
                s(:const,
                  s(:const, nil, :Gem), :Source), :SpecificFile), :new,
              s(:lvar, :b_gem))),
          s(:lvasgn, :b_spec,
            s(:send,
              s(:const,
                s(:const,
                  s(:const, nil, :Gem), :Resolver), :InstalledSpecification), :new,
              s(:ivar, :@set),
              s(:lvar, :b),
              s(:lvar, :source))),
          s(:send, nil, :assert,
            s(:send,
              s(:lvar, :b_spec), :installable_platform?)))))))

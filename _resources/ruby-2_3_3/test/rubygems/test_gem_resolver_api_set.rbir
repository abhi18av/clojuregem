s(:begin,
  s(:send, nil, :require,
    s(:str, "rubygems/test_case")),
  s(:class,
    s(:const, nil, :TestGemResolverAPISet),
    s(:const,
      s(:const, nil, :Gem), :TestCase),
    s(:begin,
      s(:def, :setup,
        s(:args),
        s(:begin,
          s(:zsuper),
          s(:ivasgn, :@DR,
            s(:const,
              s(:const, nil, :Gem), :Resolver)),
          s(:ivasgn, :@dep_uri,
            s(:send, nil, :URI,
              s(:dstr,
                s(:begin,
                  s(:ivar, :@gem_repo)),
                s(:str, "api/v1/dependencies")))))),
      s(:def, :test_initialize,
        s(:args),
        s(:begin,
          s(:lvasgn, :set,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :APISet), :new)),
          s(:send, nil, :assert_equal,
            s(:send, nil, :URI,
              s(:str, "https://rubygems.org/api/v1/dependencies")),
            s(:send,
              s(:lvar, :set), :dep_uri)),
          s(:send, nil, :assert_equal,
            s(:send, nil, :URI,
              s(:str, "https://rubygems.org")),
            s(:send,
              s(:lvar, :set), :uri)),
          s(:send, nil, :assert_equal,
            s(:send,
              s(:const,
                s(:const, nil, :Gem), :Source), :new,
              s(:send, nil, :URI,
                s(:str, "https://rubygems.org"))),
            s(:send,
              s(:lvar, :set), :source)))),
      s(:def, :test_initialize_deeper_uri,
        s(:args),
        s(:begin,
          s(:lvasgn, :set,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :APISet), :new,
              s(:str, "https://rubygemsserver.com/mygems/api/v1/dependencies"))),
          s(:send, nil, :assert_equal,
            s(:send, nil, :URI,
              s(:str, "https://rubygemsserver.com/mygems/api/v1/dependencies")),
            s(:send,
              s(:lvar, :set), :dep_uri)),
          s(:send, nil, :assert_equal,
            s(:send, nil, :URI,
              s(:str, "https://rubygemsserver.com/mygems/")),
            s(:send,
              s(:lvar, :set), :uri)),
          s(:send, nil, :assert_equal,
            s(:send,
              s(:const,
                s(:const, nil, :Gem), :Source), :new,
              s(:send, nil, :URI,
                s(:str, "https://rubygemsserver.com/mygems/"))),
            s(:send,
              s(:lvar, :set), :source)))),
      s(:def, :test_initialize_uri,
        s(:args),
        s(:begin,
          s(:lvasgn, :set,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :APISet), :new,
              s(:ivar, :@dep_uri))),
          s(:send, nil, :assert_equal,
            s(:send, nil, :URI,
              s(:dstr,
                s(:begin,
                  s(:ivar, :@gem_repo)),
                s(:str, "api/v1/dependencies"))),
            s(:send,
              s(:lvar, :set), :dep_uri)),
          s(:send, nil, :assert_equal,
            s(:send, nil, :URI,
              s(:dstr,
                s(:begin,
                  s(:ivar, :@gem_repo)))),
            s(:send,
              s(:lvar, :set), :uri)))),
      s(:def, :test_find_all,
        s(:args),
        s(:begin,
          s(:send, nil, :spec_fetcher),
          s(:lvasgn, :data,
            s(:array,
              s(:hash,
                s(:pair,
                  s(:sym, :name),
                  s(:str, "a")),
                s(:pair,
                  s(:sym, :number),
                  s(:str, "1")),
                s(:pair,
                  s(:sym, :platform),
                  s(:str, "ruby")),
                s(:pair,
                  s(:sym, :dependencies),
                  s(:array))))),
          s(:send,
            s(:send,
              s(:ivar, :@fetcher), :data), :[]=,
            s(:dstr,
              s(:begin,
                s(:ivar, :@dep_uri)),
              s(:str, "?gems=a")),
            s(:send,
              s(:const, nil, :Marshal), :dump,
              s(:lvar, :data))),
          s(:lvasgn, :set,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :APISet), :new,
              s(:ivar, :@dep_uri))),
          s(:lvasgn, :a_dep,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :DependencyRequest), :new,
              s(:send, nil, :dep,
                s(:str, "a")),
              s(:nil))),
          s(:lvasgn, :expected,
            s(:array,
              s(:send,
                s(:const,
                  s(:ivar, :@DR), :APISpecification), :new,
                s(:lvar, :set),
                s(:send,
                  s(:lvar, :data), :first)))),
          s(:send, nil, :assert_equal,
            s(:lvar, :expected),
            s(:send,
              s(:lvar, :set), :find_all,
              s(:lvar, :a_dep))))),
      s(:def, :test_find_all_cache,
        s(:args),
        s(:begin,
          s(:send, nil, :spec_fetcher),
          s(:lvasgn, :data,
            s(:array,
              s(:hash,
                s(:pair,
                  s(:sym, :name),
                  s(:str, "a")),
                s(:pair,
                  s(:sym, :number),
                  s(:str, "1")),
                s(:pair,
                  s(:sym, :platform),
                  s(:str, "ruby")),
                s(:pair,
                  s(:sym, :dependencies),
                  s(:array))))),
          s(:send,
            s(:send,
              s(:ivar, :@fetcher), :data), :[]=,
            s(:dstr,
              s(:begin,
                s(:ivar, :@dep_uri)),
              s(:str, "?gems=a")),
            s(:send,
              s(:const, nil, :Marshal), :dump,
              s(:lvar, :data))),
          s(:lvasgn, :set,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :APISet), :new,
              s(:ivar, :@dep_uri))),
          s(:lvasgn, :a_dep,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :DependencyRequest), :new,
              s(:send, nil, :dep,
                s(:str, "a")),
              s(:nil))),
          s(:send,
            s(:lvar, :set), :prefetch,
            s(:array,
              s(:lvar, :a_dep))),
          s(:lvasgn, :expected,
            s(:array,
              s(:send,
                s(:const,
                  s(:ivar, :@DR), :APISpecification), :new,
                s(:lvar, :set),
                s(:send,
                  s(:lvar, :data), :first)))),
          s(:send, nil, :assert_equal,
            s(:lvar, :expected),
            s(:send,
              s(:lvar, :set), :find_all,
              s(:lvar, :a_dep))),
          s(:send,
            s(:send,
              s(:ivar, :@fetcher), :data), :delete,
            s(:dstr,
              s(:begin,
                s(:ivar, :@dep_uri)),
              s(:str, "?gems=a"))))),
      s(:def, :test_find_all_local,
        s(:args),
        s(:begin,
          s(:lvasgn, :set,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :APISet), :new,
              s(:ivar, :@dep_uri))),
          s(:send,
            s(:lvar, :set), :remote=,
            s(:false)),
          s(:lvasgn, :a_dep,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :DependencyRequest), :new,
              s(:send, nil, :dep,
                s(:str, "a")),
              s(:nil))),
          s(:send, nil, :assert_empty,
            s(:send,
              s(:lvar, :set), :find_all,
              s(:lvar, :a_dep))))),
      s(:def, :test_find_all_missing,
        s(:args),
        s(:begin,
          s(:send, nil, :spec_fetcher),
          s(:send,
            s(:send,
              s(:ivar, :@fetcher), :data), :[]=,
            s(:dstr,
              s(:begin,
                s(:ivar, :@dep_uri)),
              s(:str, "?gems=a")),
            s(:send,
              s(:const, nil, :Marshal), :dump,
              s(:array))),
          s(:lvasgn, :set,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :APISet), :new,
              s(:ivar, :@dep_uri))),
          s(:lvasgn, :a_dep,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :DependencyRequest), :new,
              s(:send, nil, :dep,
                s(:str, "a")),
              s(:nil))),
          s(:send, nil, :assert_empty,
            s(:send,
              s(:lvar, :set), :find_all,
              s(:lvar, :a_dep))),
          s(:send,
            s(:send,
              s(:ivar, :@fetcher), :data), :delete,
            s(:dstr,
              s(:begin,
                s(:ivar, :@dep_uri)),
              s(:str, "?gems=a"))),
          s(:send, nil, :assert_empty,
            s(:send,
              s(:lvar, :set), :find_all,
              s(:lvar, :a_dep))))),
      s(:def, :test_prefetch,
        s(:args),
        s(:begin,
          s(:send, nil, :spec_fetcher),
          s(:lvasgn, :data,
            s(:array,
              s(:hash,
                s(:pair,
                  s(:sym, :name),
                  s(:str, "a")),
                s(:pair,
                  s(:sym, :number),
                  s(:str, "1")),
                s(:pair,
                  s(:sym, :platform),
                  s(:str, "ruby")),
                s(:pair,
                  s(:sym, :dependencies),
                  s(:array))))),
          s(:send,
            s(:send,
              s(:ivar, :@fetcher), :data), :[]=,
            s(:dstr,
              s(:begin,
                s(:ivar, :@dep_uri)),
              s(:str, "?gems=a,b")),
            s(:send,
              s(:const, nil, :Marshal), :dump,
              s(:lvar, :data))),
          s(:send,
            s(:send,
              s(:ivar, :@fetcher), :data), :[]=,
            s(:dstr,
              s(:begin,
                s(:ivar, :@dep_uri)),
              s(:str, "?gems=b")),
            s(:send,
              s(:const, nil, :Marshal), :dump,
              s(:array))),
          s(:lvasgn, :set,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :APISet), :new,
              s(:ivar, :@dep_uri))),
          s(:lvasgn, :a_dep,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :DependencyRequest), :new,
              s(:send, nil, :dep,
                s(:str, "a")),
              s(:nil))),
          s(:lvasgn, :b_dep,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :DependencyRequest), :new,
              s(:send, nil, :dep,
                s(:str, "b")),
              s(:nil))),
          s(:send,
            s(:lvar, :set), :prefetch,
            s(:array,
              s(:lvar, :a_dep),
              s(:lvar, :b_dep))),
          s(:send, nil, :assert_equal,
            s(:array,
              s(:str, "a-1")),
            s(:block,
              s(:send,
                s(:send,
                  s(:lvar, :set), :find_all,
                  s(:lvar, :a_dep)), :map),
              s(:args,
                s(:arg, :s)),
              s(:send,
                s(:lvar, :s), :full_name))),
          s(:send, nil, :assert_empty,
            s(:send,
              s(:lvar, :set), :find_all,
              s(:lvar, :b_dep))))),
      s(:def, :test_prefetch_cache,
        s(:args),
        s(:begin,
          s(:send, nil, :spec_fetcher),
          s(:lvasgn, :data,
            s(:array,
              s(:hash,
                s(:pair,
                  s(:sym, :name),
                  s(:str, "a")),
                s(:pair,
                  s(:sym, :number),
                  s(:str, "1")),
                s(:pair,
                  s(:sym, :platform),
                  s(:str, "ruby")),
                s(:pair,
                  s(:sym, :dependencies),
                  s(:array))))),
          s(:send,
            s(:send,
              s(:ivar, :@fetcher), :data), :[]=,
            s(:dstr,
              s(:begin,
                s(:ivar, :@dep_uri)),
              s(:str, "?gems=a")),
            s(:send,
              s(:const, nil, :Marshal), :dump,
              s(:lvar, :data))),
          s(:lvasgn, :set,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :APISet), :new,
              s(:ivar, :@dep_uri))),
          s(:lvasgn, :a_dep,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :DependencyRequest), :new,
              s(:send, nil, :dep,
                s(:str, "a")),
              s(:nil))),
          s(:lvasgn, :b_dep,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :DependencyRequest), :new,
              s(:send, nil, :dep,
                s(:str, "b")),
              s(:nil))),
          s(:send,
            s(:lvar, :set), :prefetch,
            s(:array,
              s(:lvar, :a_dep))),
          s(:send,
            s(:send,
              s(:ivar, :@fetcher), :data), :delete,
            s(:dstr,
              s(:begin,
                s(:ivar, :@dep_uri)),
              s(:str, "?gems=a"))),
          s(:send,
            s(:send,
              s(:ivar, :@fetcher), :data), :[]=,
            s(:dstr,
              s(:begin,
                s(:ivar, :@dep_uri)),
              s(:str, "?gems=b")),
            s(:send,
              s(:const, nil, :Marshal), :dump,
              s(:array))),
          s(:send,
            s(:lvar, :set), :prefetch,
            s(:array,
              s(:lvar, :a_dep),
              s(:lvar, :b_dep))))),
      s(:def, :test_prefetch_cache_missing,
        s(:args),
        s(:begin,
          s(:send, nil, :spec_fetcher),
          s(:lvasgn, :data,
            s(:array,
              s(:hash,
                s(:pair,
                  s(:sym, :name),
                  s(:str, "a")),
                s(:pair,
                  s(:sym, :number),
                  s(:str, "1")),
                s(:pair,
                  s(:sym, :platform),
                  s(:str, "ruby")),
                s(:pair,
                  s(:sym, :dependencies),
                  s(:array))))),
          s(:send,
            s(:send,
              s(:ivar, :@fetcher), :data), :[]=,
            s(:dstr,
              s(:begin,
                s(:ivar, :@dep_uri)),
              s(:str, "?gems=a,b")),
            s(:send,
              s(:const, nil, :Marshal), :dump,
              s(:lvar, :data))),
          s(:lvasgn, :set,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :APISet), :new,
              s(:ivar, :@dep_uri))),
          s(:lvasgn, :a_dep,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :DependencyRequest), :new,
              s(:send, nil, :dep,
                s(:str, "a")),
              s(:nil))),
          s(:lvasgn, :b_dep,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :DependencyRequest), :new,
              s(:send, nil, :dep,
                s(:str, "b")),
              s(:nil))),
          s(:send,
            s(:lvar, :set), :prefetch,
            s(:array,
              s(:lvar, :a_dep),
              s(:lvar, :b_dep))),
          s(:send,
            s(:send,
              s(:ivar, :@fetcher), :data), :delete,
            s(:dstr,
              s(:begin,
                s(:ivar, :@dep_uri)),
              s(:str, "?gems=a,b"))),
          s(:send,
            s(:lvar, :set), :prefetch,
            s(:array,
              s(:lvar, :a_dep),
              s(:lvar, :b_dep))))),
      s(:def, :test_prefetch_local,
        s(:args),
        s(:begin,
          s(:send, nil, :spec_fetcher),
          s(:lvasgn, :data,
            s(:array,
              s(:hash,
                s(:pair,
                  s(:sym, :name),
                  s(:str, "a")),
                s(:pair,
                  s(:sym, :number),
                  s(:str, "1")),
                s(:pair,
                  s(:sym, :platform),
                  s(:str, "ruby")),
                s(:pair,
                  s(:sym, :dependencies),
                  s(:array))))),
          s(:send,
            s(:send,
              s(:ivar, :@fetcher), :data), :[]=,
            s(:dstr,
              s(:begin,
                s(:ivar, :@dep_uri)),
              s(:str, "?gems=a,b")),
            s(:send,
              s(:const, nil, :Marshal), :dump,
              s(:lvar, :data))),
          s(:send,
            s(:send,
              s(:ivar, :@fetcher), :data), :[]=,
            s(:dstr,
              s(:begin,
                s(:ivar, :@dep_uri)),
              s(:str, "?gems=b")),
            s(:send,
              s(:const, nil, :Marshal), :dump,
              s(:array))),
          s(:lvasgn, :set,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :APISet), :new,
              s(:ivar, :@dep_uri))),
          s(:send,
            s(:lvar, :set), :remote=,
            s(:false)),
          s(:lvasgn, :a_dep,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :DependencyRequest), :new,
              s(:send, nil, :dep,
                s(:str, "a")),
              s(:nil))),
          s(:lvasgn, :b_dep,
            s(:send,
              s(:const,
                s(:ivar, :@DR), :DependencyRequest), :new,
              s(:send, nil, :dep,
                s(:str, "b")),
              s(:nil))),
          s(:send,
            s(:lvar, :set), :prefetch,
            s(:array,
              s(:lvar, :a_dep),
              s(:lvar, :b_dep))),
          s(:send, nil, :assert_empty,
            s(:send,
              s(:lvar, :set), :instance_variable_get,
              s(:sym, :@data))))))))

s(:begin,
  s(:send, nil, :require,
    s(:str, "test/unit")),
  s(:send, nil, :require,
    s(:str, "find")),
  s(:send, nil, :require,
    s(:str, "tmpdir")),
  s(:class,
    s(:const, nil, :TestFind),
    s(:const,
      s(:const,
        s(:const, nil, :Test), :Unit), :TestCase),
    s(:begin,
      s(:def, :test_empty,
        s(:args),
        s(:block,
          s(:send,
            s(:const, nil, :Dir), :mktmpdir),
          s(:args,
            s(:arg, :d)),
          s(:begin,
            s(:lvasgn, :a,
              s(:array)),
            s(:block,
              s(:send,
                s(:const, nil, :Find), :find,
                s(:lvar, :d)),
              s(:args,
                s(:arg, :f)),
              s(:send,
                s(:lvar, :a), :<<,
                s(:lvar, :f))),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:lvar, :d)),
              s(:lvar, :a))))),
      s(:def, :test_rec,
        s(:args),
        s(:block,
          s(:send,
            s(:const, nil, :Dir), :mktmpdir),
          s(:args,
            s(:arg, :d)),
          s(:begin,
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/a")),
                s(:str, "w")),
              s(:args), nil),
            s(:send,
              s(:const, nil, :Dir), :mkdir,
              s(:dstr,
                s(:begin,
                  s(:lvar, :d)),
                s(:str, "/b"))),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b/a")),
                s(:str, "w")),
              s(:args), nil),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b/b")),
                s(:str, "w")),
              s(:args), nil),
            s(:send,
              s(:const, nil, :Dir), :mkdir,
              s(:dstr,
                s(:begin,
                  s(:lvar, :d)),
                s(:str, "/c"))),
            s(:lvasgn, :a,
              s(:array)),
            s(:block,
              s(:send,
                s(:const, nil, :Find), :find,
                s(:lvar, :d)),
              s(:args,
                s(:arg, :f)),
              s(:send,
                s(:lvar, :a), :<<,
                s(:lvar, :f))),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:lvar, :d),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/a")),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b")),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b/a")),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b/b")),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/c"))),
              s(:lvar, :a))))),
      s(:def, :test_relative,
        s(:args),
        s(:block,
          s(:send,
            s(:const, nil, :Dir), :mktmpdir),
          s(:args,
            s(:arg, :d)),
          s(:begin,
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/a")),
                s(:str, "w")),
              s(:args), nil),
            s(:send,
              s(:const, nil, :Dir), :mkdir,
              s(:dstr,
                s(:begin,
                  s(:lvar, :d)),
                s(:str, "/b"))),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b/a")),
                s(:str, "w")),
              s(:args), nil),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b/b")),
                s(:str, "w")),
              s(:args), nil),
            s(:send,
              s(:const, nil, :Dir), :mkdir,
              s(:dstr,
                s(:begin,
                  s(:lvar, :d)),
                s(:str, "/c"))),
            s(:lvasgn, :a,
              s(:array)),
            s(:block,
              s(:send,
                s(:const, nil, :Dir), :chdir,
                s(:lvar, :d)),
              s(:args),
              s(:block,
                s(:send,
                  s(:const, nil, :Find), :find,
                  s(:str, ".")),
                s(:args,
                  s(:arg, :f)),
                s(:send,
                  s(:lvar, :a), :<<,
                  s(:lvar, :f)))),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:str, "."),
                s(:str, "./a"),
                s(:str, "./b"),
                s(:str, "./b/a"),
                s(:str, "./b/b"),
                s(:str, "./c")),
              s(:lvar, :a))))),
      s(:def, :test_dont_follow_symlink,
        s(:args),
        s(:block,
          s(:send,
            s(:const, nil, :Dir), :mktmpdir),
          s(:args,
            s(:arg, :d)),
          s(:begin,
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/a")),
                s(:str, "w")),
              s(:args), nil),
            s(:send,
              s(:const, nil, :Dir), :mkdir,
              s(:dstr,
                s(:begin,
                  s(:lvar, :d)),
                s(:str, "/b"))),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b/a")),
                s(:str, "w")),
              s(:args), nil),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b/b")),
                s(:str, "w")),
              s(:args), nil),
            s(:kwbegin,
              s(:rescue,
                s(:send,
                  s(:const, nil, :File), :symlink,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :d)),
                    s(:str, "/b")),
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :d)),
                    s(:str, "/c"))),
                s(:resbody,
                  s(:array,
                    s(:const, nil, :NotImplementedError),
                    s(:const,
                      s(:const, nil, :Errno), :EACCES)), nil,
                  s(:send, nil, :skip,
                    s(:str, "symlink is not supported."))), nil)),
            s(:lvasgn, :a,
              s(:array)),
            s(:block,
              s(:send,
                s(:const, nil, :Find), :find,
                s(:lvar, :d)),
              s(:args,
                s(:arg, :f)),
              s(:send,
                s(:lvar, :a), :<<,
                s(:lvar, :f))),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:lvar, :d),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/a")),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b")),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b/a")),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b/b")),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/c"))),
              s(:lvar, :a))))),
      s(:def, :test_prune,
        s(:args),
        s(:block,
          s(:send,
            s(:const, nil, :Dir), :mktmpdir),
          s(:args,
            s(:arg, :d)),
          s(:begin,
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/a")),
                s(:str, "w")),
              s(:args), nil),
            s(:send,
              s(:const, nil, :Dir), :mkdir,
              s(:dstr,
                s(:begin,
                  s(:lvar, :d)),
                s(:str, "/b"))),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b/a")),
                s(:str, "w")),
              s(:args), nil),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b/b")),
                s(:str, "w")),
              s(:args), nil),
            s(:send,
              s(:const, nil, :Dir), :mkdir,
              s(:dstr,
                s(:begin,
                  s(:lvar, :d)),
                s(:str, "/c"))),
            s(:lvasgn, :a,
              s(:array)),
            s(:block,
              s(:send,
                s(:const, nil, :Find), :find,
                s(:lvar, :d)),
              s(:args,
                s(:arg, :f)),
              s(:begin,
                s(:send,
                  s(:lvar, :a), :<<,
                  s(:lvar, :f)),
                s(:if,
                  s(:send,
                    s(:lvar, :f), :==,
                    s(:dstr,
                      s(:begin,
                        s(:lvar, :d)),
                      s(:str, "/b"))),
                  s(:send,
                    s(:const, nil, :Find), :prune), nil))),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:lvar, :d),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/a")),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b")),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/c"))),
              s(:lvar, :a))))),
      s(:def, :test_countup3,
        s(:args),
        s(:block,
          s(:send,
            s(:const, nil, :Dir), :mktmpdir),
          s(:args,
            s(:arg, :d)),
          s(:begin,
            s(:block,
              s(:send,
                s(:int, 1), :upto,
                s(:int, 3)),
              s(:args,
                s(:arg, :n)),
              s(:block,
                s(:send,
                  s(:const, nil, :File), :open,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :d)),
                    s(:str, "/"),
                    s(:begin,
                      s(:lvar, :n))),
                  s(:str, "w")),
                s(:args), nil)),
            s(:lvasgn, :a,
              s(:array)),
            s(:block,
              s(:send,
                s(:const, nil, :Find), :find,
                s(:lvar, :d)),
              s(:args,
                s(:arg, :f)),
              s(:send,
                s(:lvar, :a), :<<,
                s(:lvar, :f))),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:lvar, :d),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/1")),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/2")),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/3"))),
              s(:lvar, :a))))),
      s(:def, :test_countdown3,
        s(:args),
        s(:block,
          s(:send,
            s(:const, nil, :Dir), :mktmpdir),
          s(:args,
            s(:arg, :d)),
          s(:begin,
            s(:block,
              s(:send,
                s(:int, 3), :downto,
                s(:int, 1)),
              s(:args,
                s(:arg, :n)),
              s(:block,
                s(:send,
                  s(:const, nil, :File), :open,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :d)),
                    s(:str, "/"),
                    s(:begin,
                      s(:lvar, :n))),
                  s(:str, "w")),
                s(:args), nil)),
            s(:lvasgn, :a,
              s(:array)),
            s(:block,
              s(:send,
                s(:const, nil, :Find), :find,
                s(:lvar, :d)),
              s(:args,
                s(:arg, :f)),
              s(:send,
                s(:lvar, :a), :<<,
                s(:lvar, :f))),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:lvar, :d),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/1")),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/2")),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/3"))),
              s(:lvar, :a))))),
      s(:def, :test_unreadable_dir,
        s(:args),
        s(:begin,
          s(:if,
            s(:match_with_lvasgn,
              s(:regexp,
                s(:str, "mswin|mingw"),
                s(:regopt)),
              s(:const, nil, :RUBY_PLATFORM)),
            s(:send, nil, :skip,
              s(:str, "no meaning test on Windows")), nil),
          s(:block,
            s(:send,
              s(:const, nil, :Dir), :mktmpdir),
            s(:args,
              s(:arg, :d)),
            s(:begin,
              s(:send,
                s(:const, nil, :Dir), :mkdir,
                s(:lvasgn, :dir,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :d)),
                    s(:str, "/dir")))),
              s(:block,
                s(:send,
                  s(:const, nil, :File), :open,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :dir)),
                    s(:str, "/foo")),
                  s(:str, "w")),
                s(:args), nil),
              s(:kwbegin,
                s(:ensure,
                  s(:begin,
                    s(:send,
                      s(:const, nil, :File), :chmod,
                      s(:int, 192),
                      s(:lvar, :dir)),
                    s(:lvasgn, :a,
                      s(:array)),
                    s(:block,
                      s(:send,
                        s(:const, nil, :Find), :find,
                        s(:lvar, :d)),
                      s(:args,
                        s(:arg, :f)),
                      s(:send,
                        s(:lvar, :a), :<<,
                        s(:lvar, :f))),
                    s(:send, nil, :assert_equal,
                      s(:array,
                        s(:lvar, :d),
                        s(:lvar, :dir)),
                      s(:lvar, :a)),
                    s(:lvasgn, :a,
                      s(:array)),
                    s(:block,
                      s(:send,
                        s(:const, nil, :Find), :find,
                        s(:lvar, :d),
                        s(:hash,
                          s(:pair,
                            s(:sym, :ignore_error),
                            s(:true)))),
                      s(:args,
                        s(:arg, :f)),
                      s(:send,
                        s(:lvar, :a), :<<,
                        s(:lvar, :f))),
                    s(:send, nil, :assert_equal,
                      s(:array,
                        s(:lvar, :d),
                        s(:lvar, :dir)),
                      s(:lvar, :a)),
                    s(:lvasgn, :a,
                      s(:array)),
                    s(:block,
                      s(:send,
                        s(:send,
                          s(:const, nil, :Find), :find,
                          s(:lvar, :d),
                          s(:hash,
                            s(:pair,
                              s(:sym, :ignore_error),
                              s(:true)))), :each),
                      s(:args,
                        s(:arg, :f)),
                      s(:send,
                        s(:lvar, :a), :<<,
                        s(:lvar, :f))),
                    s(:send, nil, :assert_equal,
                      s(:array,
                        s(:lvar, :d),
                        s(:lvar, :dir)),
                      s(:lvar, :a)),
                    s(:lvasgn, :a,
                      s(:array)),
                    s(:block,
                      s(:send, nil, :assert_raise_with_message,
                        s(:const,
                          s(:const, nil, :Errno), :EACCES),
                        s(:regexp,
                          s(:begin,
                            s(:send,
                              s(:const, nil, :Regexp), :quote,
                              s(:lvar, :dir))),
                          s(:regopt))),
                      s(:args),
                      s(:block,
                        s(:send,
                          s(:const, nil, :Find), :find,
                          s(:lvar, :d),
                          s(:hash,
                            s(:pair,
                              s(:sym, :ignore_error),
                              s(:false)))),
                        s(:args,
                          s(:arg, :f)),
                        s(:send,
                          s(:lvar, :a), :<<,
                          s(:lvar, :f)))),
                    s(:send, nil, :assert_equal,
                      s(:array,
                        s(:lvar, :d),
                        s(:lvar, :dir)),
                      s(:lvar, :a)),
                    s(:lvasgn, :a,
                      s(:array)),
                    s(:block,
                      s(:send, nil, :assert_raise_with_message,
                        s(:const,
                          s(:const, nil, :Errno), :EACCES),
                        s(:regexp,
                          s(:begin,
                            s(:send,
                              s(:const, nil, :Regexp), :quote,
                              s(:lvar, :dir))),
                          s(:regopt))),
                      s(:args),
                      s(:block,
                        s(:send,
                          s(:send,
                            s(:const, nil, :Find), :find,
                            s(:lvar, :d),
                            s(:hash,
                              s(:pair,
                                s(:sym, :ignore_error),
                                s(:false)))), :each),
                        s(:args,
                          s(:arg, :f)),
                        s(:send,
                          s(:lvar, :a), :<<,
                          s(:lvar, :f)))),
                    s(:send, nil, :assert_equal,
                      s(:array,
                        s(:lvar, :d),
                        s(:lvar, :dir)),
                      s(:lvar, :a))),
                  s(:send,
                    s(:const, nil, :File), :chmod,
                    s(:int, 448),
                    s(:lvar, :dir)))))))),
      s(:def, :test_unsearchable_dir,
        s(:args),
        s(:block,
          s(:send,
            s(:const, nil, :Dir), :mktmpdir),
          s(:args,
            s(:arg, :d)),
          s(:begin,
            s(:send,
              s(:const, nil, :Dir), :mkdir,
              s(:lvasgn, :dir,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/dir")))),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:lvasgn, :file,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :dir)),
                    s(:str, "/foo"))),
                s(:str, "w")),
              s(:args), nil),
            s(:kwbegin,
              s(:ensure,
                s(:begin,
                  s(:send,
                    s(:const, nil, :File), :chmod,
                    s(:int, 384),
                    s(:lvar, :dir)),
                  s(:lvasgn, :a,
                    s(:array)),
                  s(:block,
                    s(:send,
                      s(:const, nil, :Find), :find,
                      s(:lvar, :d)),
                    s(:args,
                      s(:arg, :f)),
                    s(:send,
                      s(:lvar, :a), :<<,
                      s(:lvar, :f))),
                  s(:send, nil, :assert_equal,
                    s(:array,
                      s(:lvar, :d),
                      s(:lvar, :dir),
                      s(:lvar, :file)),
                    s(:lvar, :a)),
                  s(:lvasgn, :a,
                    s(:array)),
                  s(:block,
                    s(:send,
                      s(:const, nil, :Find), :find,
                      s(:lvar, :d),
                      s(:hash,
                        s(:pair,
                          s(:sym, :ignore_error),
                          s(:true)))),
                    s(:args,
                      s(:arg, :f)),
                    s(:send,
                      s(:lvar, :a), :<<,
                      s(:lvar, :f))),
                  s(:send, nil, :assert_equal,
                    s(:array,
                      s(:lvar, :d),
                      s(:lvar, :dir),
                      s(:lvar, :file)),
                    s(:lvar, :a)),
                  s(:lvasgn, :a,
                    s(:array)),
                  s(:block,
                    s(:send,
                      s(:send,
                        s(:const, nil, :Find), :find,
                        s(:lvar, :d),
                        s(:hash,
                          s(:pair,
                            s(:sym, :ignore_error),
                            s(:true)))), :each),
                    s(:args,
                      s(:arg, :f)),
                    s(:send,
                      s(:lvar, :a), :<<,
                      s(:lvar, :f))),
                  s(:send, nil, :assert_equal,
                    s(:array,
                      s(:lvar, :d),
                      s(:lvar, :dir),
                      s(:lvar, :file)),
                    s(:lvar, :a)),
                  s(:if,
                    s(:match_with_lvasgn,
                      s(:regexp,
                        s(:str, "mswin|mingw"),
                        s(:regopt)),
                      s(:const, nil, :RUBY_PLATFORM)),
                    s(:send, nil, :skip,
                      s(:str, "no meaning test on Windows")), nil),
                  s(:lvasgn, :a,
                    s(:array)),
                  s(:block,
                    s(:send, nil, :assert_raise_with_message,
                      s(:const,
                        s(:const, nil, :Errno), :EACCES),
                      s(:regexp,
                        s(:begin,
                          s(:send,
                            s(:const, nil, :Regexp), :quote,
                            s(:lvar, :file))),
                        s(:regopt))),
                    s(:args),
                    s(:block,
                      s(:send,
                        s(:const, nil, :Find), :find,
                        s(:lvar, :d),
                        s(:hash,
                          s(:pair,
                            s(:sym, :ignore_error),
                            s(:false)))),
                      s(:args,
                        s(:arg, :f)),
                      s(:send,
                        s(:lvar, :a), :<<,
                        s(:lvar, :f)))),
                  s(:send, nil, :assert_equal,
                    s(:array,
                      s(:lvar, :d),
                      s(:lvar, :dir),
                      s(:lvar, :file)),
                    s(:lvar, :a)),
                  s(:lvasgn, :a,
                    s(:array)),
                  s(:block,
                    s(:send, nil, :assert_raise_with_message,
                      s(:const,
                        s(:const, nil, :Errno), :EACCES),
                      s(:regexp,
                        s(:begin,
                          s(:send,
                            s(:const, nil, :Regexp), :quote,
                            s(:lvar, :file))),
                        s(:regopt))),
                    s(:args),
                    s(:block,
                      s(:send,
                        s(:send,
                          s(:const, nil, :Find), :find,
                          s(:lvar, :d),
                          s(:hash,
                            s(:pair,
                              s(:sym, :ignore_error),
                              s(:false)))), :each),
                      s(:args,
                        s(:arg, :f)),
                      s(:send,
                        s(:lvar, :a), :<<,
                        s(:lvar, :f)))),
                  s(:send, nil, :assert_equal,
                    s(:array,
                      s(:lvar, :d),
                      s(:lvar, :dir),
                      s(:lvar, :file)),
                    s(:lvar, :a)),
                  s(:block,
                    s(:send, nil, :assert_raise,
                      s(:const,
                        s(:const, nil, :Errno), :EACCES)),
                    s(:args),
                    s(:send,
                      s(:const, nil, :File), :lstat,
                      s(:lvar, :file)))),
                s(:send,
                  s(:const, nil, :File), :chmod,
                  s(:int, 448),
                  s(:lvar, :dir))))))),
      s(:def, :test_dangling_symlink,
        s(:args),
        s(:block,
          s(:send,
            s(:const, nil, :Dir), :mktmpdir),
          s(:args,
            s(:arg, :d)),
          s(:begin,
            s(:kwbegin,
              s(:rescue,
                s(:send,
                  s(:const, nil, :File), :symlink,
                  s(:str, "foo"),
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :d)),
                    s(:str, "/bar"))),
                s(:resbody,
                  s(:array,
                    s(:const, nil, :NotImplementedError),
                    s(:const,
                      s(:const, nil, :Errno), :EACCES)), nil,
                  s(:send, nil, :skip,
                    s(:str, "symlink is not supported."))), nil)),
            s(:lvasgn, :a,
              s(:array)),
            s(:block,
              s(:send,
                s(:const, nil, :Find), :find,
                s(:lvar, :d)),
              s(:args,
                s(:arg, :f)),
              s(:send,
                s(:lvar, :a), :<<,
                s(:lvar, :f))),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:lvar, :d),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/bar"))),
              s(:lvar, :a)),
            s(:block,
              s(:send, nil, :assert_raise,
                s(:const,
                  s(:const, nil, :Errno), :ENOENT)),
              s(:args),
              s(:send,
                s(:const, nil, :File), :stat,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/bar"))))))),
      s(:def, :test_dangling_symlink_stat_error,
        s(:args),
        s(:block,
          s(:send,
            s(:const, nil, :Dir), :mktmpdir),
          s(:args,
            s(:arg, :d)),
          s(:begin,
            s(:kwbegin,
              s(:rescue,
                s(:send,
                  s(:const, nil, :File), :symlink,
                  s(:str, "foo"),
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :d)),
                    s(:str, "/bar"))),
                s(:resbody,
                  s(:array,
                    s(:const, nil, :NotImplementedError),
                    s(:const,
                      s(:const, nil, :Errno), :EACCES)), nil,
                  s(:send, nil, :skip,
                    s(:str, "symlink is not supported."))), nil)),
            s(:block,
              s(:send, nil, :assert_raise,
                s(:const,
                  s(:const, nil, :Errno), :ENOENT)),
              s(:args),
              s(:block,
                s(:send,
                  s(:const, nil, :Find), :find,
                  s(:lvar, :d)),
                s(:args,
                  s(:arg, :f)),
                s(:send,
                  s(:const, nil, :File), :stat,
                  s(:lvar, :f))))))),
      s(:def, :test_change_dir_to_file,
        s(:args),
        s(:block,
          s(:send,
            s(:const, nil, :Dir), :mktmpdir),
          s(:args,
            s(:arg, :d)),
          s(:begin,
            s(:send,
              s(:const, nil, :Dir), :mkdir,
              s(:lvasgn, :dir_1,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/d1")))),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:lvasgn, :file_a,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :dir_1)),
                    s(:str, "/a"))),
                s(:str, "w")),
              s(:args), nil),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:lvasgn, :file_b,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :dir_1)),
                    s(:str, "/b"))),
                s(:str, "w")),
              s(:args), nil),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:lvasgn, :file_c,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :dir_1)),
                    s(:str, "/c"))),
                s(:str, "w")),
              s(:args), nil),
            s(:send,
              s(:const, nil, :Dir), :mkdir,
              s(:lvasgn, :dir_d,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :dir_1)),
                  s(:str, "/d")))),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :dir_d)),
                  s(:str, "/e")),
                s(:str, "w")),
              s(:args), nil),
            s(:lvasgn, :dir_2,
              s(:dstr,
                s(:begin,
                  s(:lvar, :d)),
                s(:str, "/d2"))),
            s(:lvasgn, :a,
              s(:array)),
            s(:block,
              s(:send,
                s(:const, nil, :Find), :find,
                s(:lvar, :d)),
              s(:args,
                s(:arg, :f)),
              s(:begin,
                s(:send,
                  s(:lvar, :a), :<<,
                  s(:lvar, :f)),
                s(:if,
                  s(:send,
                    s(:lvar, :f), :==,
                    s(:lvar, :file_b)),
                  s(:begin,
                    s(:send,
                      s(:const, nil, :File), :rename,
                      s(:lvar, :dir_1),
                      s(:lvar, :dir_2)),
                    s(:block,
                      s(:send,
                        s(:const, nil, :File), :open,
                        s(:lvar, :dir_1),
                        s(:str, "w")),
                      s(:args), nil)), nil))),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:lvar, :d),
                s(:lvar, :dir_1),
                s(:lvar, :file_a),
                s(:lvar, :file_b),
                s(:lvar, :file_c),
                s(:lvar, :dir_d)),
              s(:lvar, :a))))),
      s(:def, :test_change_dir_to_symlink_loop,
        s(:args),
        s(:block,
          s(:send,
            s(:const, nil, :Dir), :mktmpdir),
          s(:args,
            s(:arg, :d)),
          s(:begin,
            s(:send,
              s(:const, nil, :Dir), :mkdir,
              s(:lvasgn, :dir_1,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/d1")))),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:lvasgn, :file_a,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :dir_1)),
                    s(:str, "/a"))),
                s(:str, "w")),
              s(:args), nil),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:lvasgn, :file_b,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :dir_1)),
                    s(:str, "/b"))),
                s(:str, "w")),
              s(:args), nil),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:lvasgn, :file_c,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :dir_1)),
                    s(:str, "/c"))),
                s(:str, "w")),
              s(:args), nil),
            s(:send,
              s(:const, nil, :Dir), :mkdir,
              s(:lvasgn, :dir_d,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :dir_1)),
                  s(:str, "/d")))),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :dir_d)),
                  s(:str, "/e")),
                s(:str, "w")),
              s(:args), nil),
            s(:lvasgn, :dir_2,
              s(:dstr,
                s(:begin,
                  s(:lvar, :d)),
                s(:str, "/d2"))),
            s(:lvasgn, :a,
              s(:array)),
            s(:block,
              s(:send,
                s(:const, nil, :Find), :find,
                s(:lvar, :d)),
              s(:args,
                s(:arg, :f)),
              s(:begin,
                s(:send,
                  s(:lvar, :a), :<<,
                  s(:lvar, :f)),
                s(:if,
                  s(:send,
                    s(:lvar, :f), :==,
                    s(:lvar, :file_b)),
                  s(:begin,
                    s(:send,
                      s(:const, nil, :File), :rename,
                      s(:lvar, :dir_1),
                      s(:lvar, :dir_2)),
                    s(:kwbegin,
                      s(:rescue,
                        s(:send,
                          s(:const, nil, :File), :symlink,
                          s(:str, "d1"),
                          s(:lvar, :dir_1)),
                        s(:resbody,
                          s(:array,
                            s(:const, nil, :NotImplementedError),
                            s(:const,
                              s(:const, nil, :Errno), :EACCES)), nil,
                          s(:send, nil, :skip,
                            s(:str, "symlink is not supported."))), nil))), nil))),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:lvar, :d),
                s(:lvar, :dir_1),
                s(:lvar, :file_a),
                s(:lvar, :file_b),
                s(:lvar, :file_c),
                s(:lvar, :dir_d)),
              s(:lvar, :a))))),
      s(:def, :test_enumerator,
        s(:args),
        s(:block,
          s(:send,
            s(:const, nil, :Dir), :mktmpdir),
          s(:args,
            s(:arg, :d)),
          s(:begin,
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/a")),
                s(:str, "w")),
              s(:args), nil),
            s(:send,
              s(:const, nil, :Dir), :mkdir,
              s(:dstr,
                s(:begin,
                  s(:lvar, :d)),
                s(:str, "/b"))),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b/a")),
                s(:str, "w")),
              s(:args), nil),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b/b")),
                s(:str, "w")),
              s(:args), nil),
            s(:send,
              s(:const, nil, :Dir), :mkdir,
              s(:dstr,
                s(:begin,
                  s(:lvar, :d)),
                s(:str, "/c"))),
            s(:lvasgn, :e,
              s(:send,
                s(:const, nil, :Find), :find,
                s(:lvar, :d))),
            s(:lvasgn, :a,
              s(:array)),
            s(:block,
              s(:send,
                s(:lvar, :e), :each),
              s(:args,
                s(:arg, :f)),
              s(:send,
                s(:lvar, :a), :<<,
                s(:lvar, :f))),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:lvar, :d),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/a")),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b")),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b/a")),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/b/b")),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/c"))),
              s(:lvar, :a))))),
      s(:def, :test_encoding_ascii,
        s(:args),
        s(:block,
          s(:send,
            s(:const, nil, :Dir), :mktmpdir),
          s(:args,
            s(:arg, :d)),
          s(:begin,
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/a")),
                s(:str, "w")),
              s(:args), nil),
            s(:send,
              s(:const, nil, :Dir), :mkdir,
              s(:dstr,
                s(:begin,
                  s(:lvar, :d)),
                s(:str, "/b"))),
            s(:lvasgn, :a,
              s(:array)),
            s(:block,
              s(:send,
                s(:const, nil, :Find), :find,
                s(:send,
                  s(:lvar, :d), :encode,
                  s(:const,
                    s(:const, nil, :Encoding), :US_ASCII))),
              s(:args,
                s(:arg, :f)),
              s(:send,
                s(:lvar, :a), :<<,
                s(:lvar, :f))),
            s(:block,
              s(:send,
                s(:lvar, :a), :each),
              s(:args,
                s(:arg, :i)),
              s(:send, nil, :assert,
                s(:send,
                  s(:const, nil, :Encoding), :compatible?,
                  s(:send,
                    s(:lvar, :d), :encode,
                    s(:send,
                      s(:const, nil, :Encoding), :find,
                      s(:str, "filesystem"))),
                  s(:lvar, :i))))))),
      s(:def, :test_encoding_non_ascii,
        s(:args),
        s(:block,
          s(:send,
            s(:const, nil, :Dir), :mktmpdir),
          s(:args,
            s(:arg, :d)),
          s(:begin,
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:dstr,
                  s(:begin,
                    s(:lvar, :d)),
                  s(:str, "/a")),
                s(:str, "w")),
              s(:args), nil),
            s(:send,
              s(:const, nil, :Dir), :mkdir,
              s(:dstr,
                s(:begin,
                  s(:lvar, :d)),
                s(:str, "/b"))),
            s(:lvasgn, :euc_jp,
              s(:const,
                s(:const, nil, :Encoding), :EUC_JP)),
            s(:lvasgn, :win_31j,
              s(:const,
                s(:const, nil, :Encoding), :Windows_31J)),
            s(:lvasgn, :utf_8,
              s(:const,
                s(:const, nil, :Encoding), :UTF_8)),
            s(:lvasgn, :a,
              s(:array)),
            s(:block,
              s(:send,
                s(:const, nil, :Find), :find,
                s(:send,
                  s(:lvar, :d), :encode,
                  s(:lvar, :euc_jp)),
                s(:send,
                  s(:lvar, :d), :encode,
                  s(:lvar, :win_31j)),
                s(:send,
                  s(:lvar, :d), :encode,
                  s(:lvar, :utf_8))),
              s(:args,
                s(:arg, :f)),
              s(:send,
                s(:lvar, :a), :<<,
                s(:array,
                  s(:lvar, :f),
                  s(:send,
                    s(:lvar, :f), :encoding)))),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:array,
                  s(:lvar, :d),
                  s(:lvar, :euc_jp)),
                s(:array,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :d)),
                    s(:str, "/a")),
                  s(:lvar, :euc_jp)),
                s(:array,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :d)),
                    s(:str, "/b")),
                  s(:lvar, :euc_jp)),
                s(:array,
                  s(:lvar, :d),
                  s(:lvar, :win_31j)),
                s(:array,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :d)),
                    s(:str, "/a")),
                  s(:lvar, :win_31j)),
                s(:array,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :d)),
                    s(:str, "/b")),
                  s(:lvar, :win_31j)),
                s(:array,
                  s(:lvar, :d),
                  s(:lvar, :utf_8)),
                s(:array,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :d)),
                    s(:str, "/a")),
                  s(:lvar, :utf_8)),
                s(:array,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :d)),
                    s(:str, "/b")),
                  s(:lvar, :utf_8))),
              s(:lvar, :a)),
            s(:if,
              s(:match_with_lvasgn,
                s(:regexp,
                  s(:str, "mswin|mingw"),
                  s(:regopt)),
                s(:const, nil, :RUBY_PLATFORM)),
              s(:begin,
                s(:lvasgn, :a,
                  s(:array)),
                s(:send,
                  s(:const, nil, :Dir), :mkdir,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :d)),
                    s(:str, "/♠"))),
                s(:block,
                  s(:send,
                    s(:const, nil, :Find), :find,
                    s(:send,
                      s(:dstr,
                        s(:begin,
                          s(:lvar, :d))), :encode,
                      s(:lvar, :utf_8))),
                  s(:args,
                    s(:arg, :f)),
                  s(:send,
                    s(:lvar, :a), :<<,
                    s(:array,
                      s(:lvar, :f),
                      s(:send,
                        s(:lvar, :f), :encoding)))),
                s(:send, nil, :assert_equal,
                  s(:array,
                    s(:array,
                      s(:lvar, :d),
                      s(:lvar, :utf_8)),
                    s(:array,
                      s(:dstr,
                        s(:begin,
                          s(:lvar, :d)),
                        s(:str, "/a")),
                      s(:lvar, :utf_8)),
                    s(:array,
                      s(:dstr,
                        s(:begin,
                          s(:lvar, :d)),
                        s(:str, "/b")),
                      s(:lvar, :utf_8)),
                    s(:array,
                      s(:dstr,
                        s(:begin,
                          s(:lvar, :d)),
                        s(:str, "/♠")),
                      s(:lvar, :utf_8))),
                  s(:lvar, :a))), nil)))),
      s(:class,
        s(:const, nil, :TestInclude),
        s(:const,
          s(:const,
            s(:const, nil, :Test), :Unit), :TestCase),
        s(:begin,
          s(:send, nil, :include,
            s(:const, nil, :Find)),
          s(:def, :test_functional_call,
            s(:args),
            s(:block,
              s(:send,
                s(:const, nil, :Dir), :mktmpdir),
              s(:args,
                s(:arg, :d)),
              s(:begin,
                s(:block,
                  s(:send,
                    s(:const, nil, :File), :open,
                    s(:dstr,
                      s(:begin,
                        s(:lvar, :d)),
                      s(:str, "/a")),
                    s(:str, "w")),
                  s(:args), nil),
                s(:lvasgn, :a,
                  s(:array)),
                s(:block,
                  s(:send, nil, :find,
                    s(:lvar, :d)),
                  s(:args,
                    s(:arg, :f)),
                  s(:send,
                    s(:lvar, :a), :<<,
                    s(:lvar, :f))),
                s(:send, nil, :assert_equal,
                  s(:array,
                    s(:lvar, :d),
                    s(:dstr,
                      s(:begin,
                        s(:lvar, :d)),
                      s(:str, "/a"))),
                  s(:lvar, :a))))))))))

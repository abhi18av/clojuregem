s(:begin,
  s(:send, nil, :require_relative,
    s(:str, "drbtest")),
  s(:kwbegin,
    s(:rescue,
      s(:send, nil, :require,
        s(:str, "drb/ssl")),
      s(:resbody,
        s(:array,
          s(:const, nil, :LoadError)), nil, nil), nil)),
  s(:module,
    s(:const, nil, :DRbTests),
    s(:if,
      s(:send,
        s(:const, nil, :Object), :const_defined?,
        s(:str, "OpenSSL")),
      s(:begin,
        s(:class,
          s(:const, nil, :DRbSSLService),
          s(:const, nil, :DRbService),
          s(:begin,
            s(:block,
              s(:send,
                s(:array,
                  s(:str, "ut_drb_drbssl.rb"),
                  s(:str, "ut_array_drbssl.rb")), :each),
              s(:args,
                s(:arg, :nm)),
              s(:send, nil, :add_service_command,
                s(:lvar, :nm))),
            s(:lvasgn, :config,
              s(:send,
                s(:const, nil, :Hash), :new)),
            s(:send,
              s(:lvar, :config), :[]=,
              s(:sym, :SSLVerifyMode),
              s(:const,
                s(:const,
                  s(:const, nil, :OpenSSL), :SSL), :VERIFY_PEER)),
            s(:send,
              s(:lvar, :config), :[]=,
              s(:sym, :SSLVerifyCallback),
              s(:block,
                s(:send, nil, :lambda),
                s(:args,
                  s(:arg, :ok),
                  s(:arg, :x509_store)),
                s(:true))),
            s(:kwbegin,
              s(:rescue,
                s(:begin,
                  s(:lvasgn, :data,
                    s(:block,
                      s(:send, nil, :open,
                        s(:str, "sample.key")),
                      s(:args,
                        s(:arg, :io)),
                      s(:send,
                        s(:lvar, :io), :read))),
                  s(:send,
                    s(:lvar, :config), :[]=,
                    s(:sym, :SSLPrivateKey),
                    s(:send,
                      s(:const,
                        s(:const,
                          s(:const, nil, :OpenSSL), :PKey), :RSA), :new,
                      s(:lvar, :data))),
                  s(:lvasgn, :data,
                    s(:block,
                      s(:send, nil, :open,
                        s(:str, "sample.crt")),
                      s(:args,
                        s(:arg, :io)),
                      s(:send,
                        s(:lvar, :io), :read))),
                  s(:send,
                    s(:lvar, :config), :[]=,
                    s(:sym, :SSLCertificate),
                    s(:send,
                      s(:const,
                        s(:const,
                          s(:const, nil, :OpenSSL), :X509), :Certificate), :new,
                      s(:lvar, :data)))),
                s(:resbody, nil, nil,
                  s(:send,
                    s(:lvar, :config), :[]=,
                    s(:sym, :SSLCertName),
                    s(:array,
                      s(:array,
                        s(:str, "C"),
                        s(:str, "JP")),
                      s(:array,
                        s(:str, "O"),
                        s(:str, "Foo.DRuby.Org")),
                      s(:array,
                        s(:str, "CN"),
                        s(:str, "Sample"))))), nil)),
            s(:if,
              s(:send,
                s(:gvar, :$0), :==,
                s(:str, "(string)")),
              s(:lvasgn, :uri,
                s(:send,
                  s(:const, nil, :ARGV), :shift)), nil),
            s(:ivasgn, :@server,
              s(:send,
                s(:const,
                  s(:const, nil, :DRb), :DRbServer), :new,
                s(:or,
                  s(:lvar, :uri),
                  s(:str, "drbssl://:0")),
                s(:send,
                  s(:self), :manager),
                s(:lvar, :config))))),
        s(:class,
          s(:const, nil, :TestDRbSSLCore),
          s(:const,
            s(:const,
              s(:const, nil, :Test), :Unit), :TestCase),
          s(:begin,
            s(:send, nil, :include,
              s(:const, nil, :DRbCore)),
            s(:def, :setup,
              s(:args),
              s(:begin,
                s(:send, nil, :setup_service,
                  s(:str, "ut_drb_drbssl.rb")),
                s(:zsuper))),
            s(:def, :teardown,
              s(:args),
              s(:begin,
                s(:zsuper),
                s(:send,
                  s(:const, nil, :DRbService), :finish))),
            s(:def, :test_02_unknown,
              s(:args), nil),
            s(:def, :test_01_02_loop,
              s(:args), nil),
            s(:def, :test_05_eq,
              s(:args), nil))),
        s(:class,
          s(:const, nil, :TestDRbSSLAry),
          s(:const,
            s(:const,
              s(:const, nil, :Test), :Unit), :TestCase),
          s(:begin,
            s(:send, nil, :include,
              s(:const, nil, :DRbAry)),
            s(:def, :setup,
              s(:args),
              s(:begin,
                s(:send, nil, :setup_service,
                  s(:str, "ut_array_drbssl.rb")),
                s(:zsuper))),
            s(:def, :teardown,
              s(:args),
              s(:begin,
                s(:zsuper),
                s(:send,
                  s(:const, nil, :DRbService), :finish)))))), nil)))

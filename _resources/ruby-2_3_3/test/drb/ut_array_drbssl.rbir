s(:begin,
  s(:send, nil, :require,
    s(:str, "drb/drb")),
  s(:send, nil, :require,
    s(:str, "drb/extserv")),
  s(:send, nil, :require,
    s(:str, "drb/ssl")),
  s(:if,
    s(:send,
      s(:str, "(string)"), :==,
      s(:gvar, :$0)),
    s(:begin,
      s(:defs,
        s(:const, nil, :ARGV), :shift,
        s(:args),
        s(:begin,
          s(:lvasgn, :it,
            s(:super)),
          s(:if,
            s(:lvar, :it), nil,
            s(:send, nil, :raise,
              s(:dstr,
                s(:str, "usage: "),
                s(:begin,
                  s(:gvar, :$0)),
                s(:str, " <uri> <name>")))),
          s(:lvar, :it))),
      s(:module,
        s(:const, nil, :DRbTests),
        s(:begin,
          s(:casgn, nil, :TEST_KEY_DH1024,
            s(:send,
              s(:const,
                s(:const,
                  s(:const, nil, :OpenSSL), :PKey), :DH), :new,
              s(:dstr,
                s(:str, "-----BEGIN DH PARAMETERS-----\n"),
                s(:str, "MIGHAoGBAKnKQ8MNK6nYZzLrrcuTsLxuiJGXoOO5gT+tljOTbHBuiktdMTITzIY0\n"),
                s(:str, "pFxIvjG05D7HoBZQfrR0c92NGWPkAiCkhQKB8JCbPVzwNLDy6DZ0pmofDKrEsYHG\n"),
                s(:str, "AQjjxMXhwULlmuR/K+WwlaZPiLIBYalLAZQ7ZbOPeVkJ8ePao0eLAgEC\n"),
                s(:str, "-----END DH PARAMETERS-----\n")))),
          s(:send,
            s(:const, nil, :TEST_KEY_DH1024), :priv_key=,
            s(:send,
              s(:const,
                s(:const, nil, :OpenSSL), :BN), :new,
              s(:str, "48561834C67E65FFD2A9B47F41E5E78FDC95C387428FDB1E4B0188B64D1643C3A8D3455B945B7E8C4D166010C7C2CE23BFB9BEF43D0348FE7FA5284B0225E7FE1537546D114E3D8A4411B9B9351AB451E1A358F50ED61B1F00DA29336EEBBD649980AC86D76AF8BBB065298C2052672EEF3EF13AB47A15275FC2836F3AC74CEA"),
              s(:int, 16))))),
      s(:lvasgn, :config,
        s(:send,
          s(:const, nil, :Hash), :new)),
      s(:send,
        s(:lvar, :config), :[]=,
        s(:sym, :SSLTmpDhCallback),
        s(:block,
          s(:send, nil, :proc),
          s(:args),
          s(:const,
            s(:const, nil, :DRbTests), :TEST_KEY_DH1024))),
      s(:send,
        s(:lvar, :config), :[]=,
        s(:sym, :SSLVerifyMode),
        s(:const,
          s(:const,
            s(:const, nil, :OpenSSL), :SSL), :VERIFY_PEER)),
      s(:send,
        s(:lvar, :config), :[]=,
        s(:sym, :SSLVerifyCallback),
        s(:block,
          s(:send, nil, :lambda),
          s(:args,
            s(:arg, :ok),
            s(:arg, :x509_store)),
          s(:true))),
      s(:send,
        s(:lvar, :config), :[]=,
        s(:sym, :SSLCertName),
        s(:array,
          s(:array,
            s(:str, "C"),
            s(:str, "JP")),
          s(:array,
            s(:str, "O"),
            s(:str, "Foo.DRuby.Org")),
          s(:array,
            s(:str, "CN"),
            s(:str, "Sample")))),
      s(:send,
        s(:const, nil, :DRb), :start_service,
        s(:str, "drbssl://localhost:0"),
        s(:array,
          s(:int, 1),
          s(:int, 2),
          s(:str, "III"),
          s(:int, 4),
          s(:str, "five"),
          s(:int, 6)),
        s(:lvar, :config)),
      s(:lvasgn, :es,
        s(:send,
          s(:const,
            s(:const, nil, :DRb), :ExtServ), :new,
          s(:send,
            s(:const, nil, :ARGV), :shift),
          s(:send,
            s(:const, nil, :ARGV), :shift))),
      s(:send,
        s(:send,
          s(:const, nil, :DRb), :thread), :join),
      s(:if,
        s(:send,
          s(:lvar, :es), :alive?),
        s(:send,
          s(:lvar, :es), :stop_service), nil)), nil))

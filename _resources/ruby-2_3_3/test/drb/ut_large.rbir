s(:begin,
  s(:send, nil, :require,
    s(:str, "drb/drb")),
  s(:send, nil, :require,
    s(:str, "drb/extserv")),
  s(:send, nil, :require,
    s(:str, "timeout")),
  s(:module,
    s(:const, nil, :DRbTests),
    s(:class,
      s(:const, nil, :DRbLarge), nil,
      s(:begin,
        s(:send, nil, :include,
          s(:const, nil, :DRbUndumped)),
        s(:def, :size,
          s(:args,
            s(:arg, :ary)),
          s(:send,
            s(:lvar, :ary), :size)),
        s(:def, :sum,
          s(:args,
            s(:arg, :ary)),
          s(:begin,
            s(:lvasgn, :sum,
              s(:int, 0)),
            s(:block,
              s(:send,
                s(:lvar, :ary), :each),
              s(:args,
                s(:arg, :e)),
              s(:op_asgn,
                s(:lvasgn, :sum), :+,
                s(:send,
                  s(:lvar, :e), :to_i))),
            s(:lvar, :sum))),
        s(:def, :arg_test,
          s(:args,
            s(:restarg, :arg)), nil)))),
  s(:if,
    s(:send,
      s(:str, "(string)"), :==,
      s(:gvar, :$0)),
    s(:begin,
      s(:defs,
        s(:const, nil, :ARGV), :shift,
        s(:args),
        s(:begin,
          s(:lvasgn, :it,
            s(:super)),
          s(:if,
            s(:lvar, :it), nil,
            s(:send, nil, :raise,
              s(:dstr,
                s(:str, "usage: "),
                s(:begin,
                  s(:gvar, :$0)),
                s(:str, " <manager-uri> <name>")))),
          s(:lvar, :it))),
      s(:send,
        s(:const,
          s(:const, nil, :DRb), :DRbServer), :default_argc_limit,
        s(:int, 3)),
      s(:send,
        s(:const,
          s(:const, nil, :DRb), :DRbServer), :default_load_limit,
        s(:int, 100000)),
      s(:send,
        s(:const, nil, :DRb), :start_service,
        s(:str, "druby://localhost:0"),
        s(:send,
          s(:const,
            s(:const, nil, :DRbTests), :DRbLarge), :new)),
      s(:lvasgn, :es,
        s(:send,
          s(:const,
            s(:const, nil, :DRb), :ExtServ), :new,
          s(:send,
            s(:const, nil, :ARGV), :shift),
          s(:send,
            s(:const, nil, :ARGV), :shift))),
      s(:send,
        s(:send,
          s(:const, nil, :DRb), :thread), :join),
      s(:if,
        s(:send,
          s(:lvar, :es), :alive?),
        s(:send,
          s(:lvar, :es), :stop_service), nil)), nil))

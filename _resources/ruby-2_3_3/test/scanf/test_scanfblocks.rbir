s(:begin,
  s(:send, nil, :require,
    s(:str, "test/unit")),
  s(:send, nil, :require,
    s(:str, "scanf")),
  s(:send, nil, :require,
    s(:str, "tmpdir")),
  s(:class,
    s(:const, nil, :TestScanfBlock),
    s(:const,
      s(:const,
        s(:const, nil, :Test), :Unit), :TestCase),
    s(:begin,
      s(:def, :setup,
        s(:args),
        s(:ivasgn, :@str,
          s(:dstr,
            s(:str, "    Beethoven  1770\n"),
            s(:str, "    Bach       1685\n"),
            s(:str, "    Handel     1685\n"),
            s(:str, "    Scarlatti  1685\n"),
            s(:str, "    Brahms     1833\n")))),
      s(:alias,
        s(:sym, :set_up),
        s(:sym, :setup)),
      s(:def, :test_str1,
        s(:args),
        s(:begin,
          s(:lvasgn, :res,
            s(:block,
              s(:send,
                s(:ivar, :@str), :scanf,
                s(:str, "%s%d")),
              s(:args,
                s(:arg, :name),
                s(:arg, :year)),
              s(:dstr,
                s(:begin,
                  s(:lvar, :name)),
                s(:str, " was born in "),
                s(:begin,
                  s(:lvar, :year)),
                s(:str, ".")))),
          s(:send, nil, :assert_equal,
            s(:lvar, :res),
            s(:array,
              s(:str, "Beethoven was born in 1770."),
              s(:str, "Bach was born in 1685."),
              s(:str, "Handel was born in 1685."),
              s(:str, "Scarlatti was born in 1685."),
              s(:str, "Brahms was born in 1833."))))),
      s(:def, :test_str2,
        s(:args),
        s(:begin,
          s(:lvasgn, :names,
            s(:block,
              s(:send,
                s(:ivar, :@str), :scanf,
                s(:str, "%s%d")),
              s(:args,
                s(:arg, :name),
                s(:arg, :year)),
              s(:send,
                s(:lvar, :name), :upcase))),
          s(:send, nil, :assert_equal,
            s(:lvar, :names),
            s(:array,
              s(:str, "BEETHOVEN"),
              s(:str, "BACH"),
              s(:str, "HANDEL"),
              s(:str, "SCARLATTI"),
              s(:str, "BRAHMS"))))),
      s(:def, :test_str3,
        s(:args),
        s(:send, nil, :assert_equal,
          s(:block,
            s(:send,
              s(:str, ""), :scanf,
              s(:str, "%d%f%s")),
            s(:args), nil),
          s(:array))),
      s(:def, :test_str4,
        s(:args),
        s(:send, nil, :assert_equal,
          s(:block,
            s(:send,
              s(:str, "abc"), :scanf,
              s(:str, "%d%f%s")),
            s(:args), nil),
          s(:array))),
      s(:def, :test_str5,
        s(:args),
        s(:send, nil, :assert_equal,
          s(:block,
            s(:send,
              s(:str, "abc"), :scanf,
              s(:str, "")),
            s(:args), nil),
          s(:array))),
      s(:def, :test_io1,
        s(:args),
        s(:ensure,
          s(:begin,
            s(:lvasgn, :fn,
              s(:dstr,
                s(:begin,
                  s(:send,
                    s(:const, nil, :Dir), :tmpdir)),
                s(:str, "/iotest.dat."),
                s(:begin,
                  s(:gvar, :$$)))),
            s(:block,
              s(:send,
                s(:const, nil, :File), :open,
                s(:lvar, :fn),
                s(:str, "w")),
              s(:args,
                s(:arg, :fh)),
              s(:send,
                s(:lvar, :fh), :puts,
                s(:ivar, :@str))),
            s(:lvasgn, :fh,
              s(:send,
                s(:const, nil, :File), :open,
                s(:lvar, :fn),
                s(:str, "rb"))),
            s(:lvasgn, :res,
              s(:block,
                s(:send,
                  s(:lvar, :fh), :scanf,
                  s(:str, "%s%d")),
                s(:args,
                  s(:arg, :name),
                  s(:arg, :year)),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :name)),
                  s(:str, " was born in "),
                  s(:begin,
                    s(:lvar, :year)),
                  s(:str, ".")))),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:str, "Beethoven was born in 1770."),
                s(:str, "Bach was born in 1685."),
                s(:str, "Handel was born in 1685."),
                s(:str, "Scarlatti was born in 1685."),
                s(:str, "Brahms was born in 1833.")),
              s(:lvar, :res)),
            s(:send,
              s(:lvar, :fh), :close)),
          s(:send,
            s(:const, nil, :File), :delete,
            s(:lvar, :fn)))),
      s(:def, :test_io2,
        s(:args),
        s(:ensure,
          s(:begin,
            s(:lvasgn, :fn,
              s(:dstr,
                s(:begin,
                  s(:send,
                    s(:const, nil, :Dir), :tmpdir)),
                s(:str, "/iotest.dat."),
                s(:begin,
                  s(:gvar, :$$)))),
            s(:send,
              s(:send,
                s(:const, nil, :File), :open,
                s(:lvar, :fn),
                s(:str, "w")), :close),
            s(:lvasgn, :fh,
              s(:send,
                s(:const, nil, :File), :open,
                s(:lvar, :fn),
                s(:str, "rb"))),
            s(:send, nil, :assert_equal,
              s(:block,
                s(:send,
                  s(:lvar, :fh), :scanf,
                  s(:str, "")),
                s(:args), nil),
              s(:array)),
            s(:send,
              s(:lvar, :fh), :seek,
              s(:int, 0)),
            s(:send, nil, :assert_equal,
              s(:block,
                s(:send,
                  s(:lvar, :fh), :scanf,
                  s(:str, "%d%f%s")),
                s(:args), nil),
              s(:array)),
            s(:send,
              s(:lvar, :fh), :close)),
          s(:send,
            s(:const, nil, :File), :delete,
            s(:lvar, :fn)))))))

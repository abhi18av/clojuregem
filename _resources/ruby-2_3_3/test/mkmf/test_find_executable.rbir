s(:begin,
  s(:send, nil, :require_relative,
    s(:str, "base")),
  s(:class,
    s(:const, nil, :TestMkmf), nil,
    s(:class,
      s(:const, nil, :TestFindExecutable),
      s(:const, nil, :TestMkmf),
      s(:begin,
        s(:def, :setup,
          s(:args),
          s(:begin,
            s(:zsuper),
            s(:masgn,
              s(:mlhs,
                s(:ivasgn, :@path),
                s(:send,
                  s(:const, nil, :ENV), :[]=,
                  s(:str, "PATH"))),
              s(:array,
                s(:send,
                  s(:const, nil, :ENV), :[],
                  s(:str, "PATH")),
                s(:ivar, :@tmpdir))))),
        s(:def, :teardown,
          s(:args),
          s(:begin,
            s(:send,
              s(:const, nil, :ENV), :[]=,
              s(:str, "PATH"),
              s(:ivar, :@path)),
            s(:zsuper))),
        s(:def, :test_find_executable,
          s(:args),
          s(:begin,
            s(:lvasgn, :bug2669,
              s(:str, "[ruby-core:27912]")),
            s(:lvasgn, :name,
              s(:dstr,
                s(:str, "foobar"),
                s(:begin,
                  s(:gvar, :$$)),
                s(:begin,
                  s(:send, nil, :rand,
                    s(:int, 1000))))),
            s(:lvasgn, :exts,
              s(:send,
                s(:block,
                  s(:send, nil, :mkmf),
                  s(:args),
                  s(:send,
                    s(:const,
                      s(:send,
                        s(:self), :class), :CONFIG), :[],
                    s(:str, "EXECUTABLE_EXTS"))), :split)),
            s(:block,
              s(:send,
                s(:send, nil, :stdout), :filter),
              s(:args,
                s(:arg, :s)),
              s(:send,
                s(:lvar, :s), :sub,
                s(:lvar, :name),
                s(:str, "<executable>"))),
            s(:or_asgn,
              s(:send,
                s(:lvar, :exts), :[],
                s(:int, 0)),
              s(:str, "")),
            s(:block,
              s(:send,
                s(:lvar, :exts), :each),
              s(:args,
                s(:arg, :ext)),
              s(:begin,
                s(:lvasgn, :full,
                  s(:send,
                    s(:lvar, :name), :+,
                    s(:lvar, :ext))),
                s(:kwbegin,
                  s(:ensure,
                    s(:begin,
                      s(:block,
                        s(:send, nil, :open,
                          s(:lvar, :full),
                          s(:str, "w")),
                        s(:args,
                          s(:arg, :ff)),
                        s(:send,
                          s(:lvar, :ff), :chmod,
                          s(:int, 493))),
                      s(:lvasgn, :result,
                        s(:block,
                          s(:send, nil, :mkmf),
                          s(:args),
                          s(:send, nil, :find_executable,
                            s(:lvar, :name))))),
                    s(:send,
                      s(:const, nil, :File), :unlink,
                      s(:lvar, :full)))),
                s(:send, nil, :assert_equal,
                  s(:dstr,
                    s(:begin,
                      s(:ivar, :@tmpdir)),
                    s(:str, "/"),
                    s(:begin,
                      s(:lvar, :name)),
                    s(:begin,
                      s(:lvar, :ext))),
                  s(:lvar, :result),
                  s(:lvar, :bug2669)))))),
        s(:def, :test_find_executable_dir,
          s(:args),
          s(:begin,
            s(:lvasgn, :name,
              s(:dstr,
                s(:str, "foobar"),
                s(:begin,
                  s(:gvar, :$$)),
                s(:begin,
                  s(:send, nil, :rand,
                    s(:int, 1000))))),
            s(:lvasgn, :exts,
              s(:send,
                s(:block,
                  s(:send, nil, :mkmf),
                  s(:args),
                  s(:send,
                    s(:const,
                      s(:send,
                        s(:self), :class), :CONFIG), :[],
                    s(:str, "EXECUTABLE_EXTS"))), :split)),
            s(:block,
              s(:send,
                s(:send, nil, :stdout), :filter),
              s(:args,
                s(:arg, :s)),
              s(:send,
                s(:lvar, :s), :sub,
                s(:lvar, :name),
                s(:str, "<executable>"))),
            s(:or_asgn,
              s(:send,
                s(:lvar, :exts), :[],
                s(:int, 0)),
              s(:str, "")),
            s(:block,
              s(:send,
                s(:lvar, :exts), :each),
              s(:args,
                s(:arg, :ext)),
              s(:begin,
                s(:lvasgn, :full,
                  s(:send,
                    s(:lvar, :name), :+,
                    s(:lvar, :ext))),
                s(:kwbegin,
                  s(:ensure,
                    s(:begin,
                      s(:send,
                        s(:const, nil, :Dir), :mkdir,
                        s(:lvar, :full)),
                      s(:lvasgn, :result,
                        s(:block,
                          s(:send, nil, :mkmf),
                          s(:args),
                          s(:send, nil, :find_executable,
                            s(:lvar, :name))))),
                    s(:send,
                      s(:const, nil, :Dir), :rmdir,
                      s(:lvar, :full)))),
                s(:send, nil, :assert_nil,
                  s(:lvar, :result))))))))))

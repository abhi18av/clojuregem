s(:begin,
  s(:gvasgn, :$extmk,
    s(:true)),
  s(:send, nil, :require,
    s(:str, "test/unit")),
  s(:send, nil, :require,
    s(:str, "mkmf")),
  s(:class,
    s(:const, nil, :TestMkmf),
    s(:const,
      s(:const,
        s(:const, nil, :Test), :Unit), :TestCase),
    s(:class,
      s(:const, nil, :TestConfig),
      s(:const,
        s(:const,
          s(:const, nil, :Test), :Unit), :TestCase),
      s(:def, :test_dir_config,
        s(:args),
        s(:begin,
          s(:lvasgn, :bug8074,
            s(:str, "[Bug #8074]")),
          s(:lvasgn, :lib,
            s(:send,
              s(:const, nil, :RbConfig), :expand,
              s(:send,
                s(:const,
                  s(:const, nil, :RbConfig), :MAKEFILE_CONFIG), :[],
                s(:str, "libdir")),
              s(:hash,
                s(:pair,
                  s(:str, "exec_prefix"),
                  s(:str, ""))))),
          s(:send, nil, :assert_separately,
            s(:array,
              s(:str, "-rmkmf"),
              s(:str, "-"),
              s(:str, "--"),
              s(:str, "--with-foo-dir=/test/foo")),
            s(:dstr,
              s(:str, "\n"),
              s(:str, "        assert_equal(%w[/test/foo/include /test/foo"),
              s(:begin,
                s(:lvar, :lib)),
              s(:str, "], dir_config(\"foo\"), "),
              s(:begin,
                s(:send,
                  s(:lvar, :bug8074), :dump)),
              s(:str, ")\n"),
              s(:str, "      "))))))))

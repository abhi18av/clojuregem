s(:begin,
  s(:send, nil, :require_relative,
    s(:str, "base")),
  s(:class,
    s(:const, nil, :TestMkmf), nil,
    s(:class,
      s(:const, nil, :TestSignedness),
      s(:const, nil, :TestMkmf),
      s(:begin,
        s(:def, :test_typeof_builtin,
          s(:args),
          s(:begin,
            s(:lvasgn, :bug4144,
              s(:str, "[ruby-dev:42731]")),
            s(:block,
              s(:send,
                s(:array,
                  s(:array,
                    s(:str, ""),
                    s(:str, "-1")),
                  s(:array,
                    s(:str, "signed "),
                    s(:str, "-1")),
                  s(:array,
                    s(:str, "unsigned "),
                    s(:str, "+1"))), :each),
              s(:args,
                s(:arg, :signed),
                s(:arg, :expect)),
              s(:block,
                s(:send,
                  s(:array,
                    s(:str, "short"),
                    s(:str, "int"),
                    s(:str, "long")), :each),
                s(:args,
                  s(:arg, :type)),
                s(:send, nil, :assert_equal,
                  s(:send,
                    s(:lvar, :expect), :to_i),
                  s(:block,
                    s(:send, nil, :mkmf),
                    s(:args),
                    s(:send, nil, :check_signedness,
                      s(:send,
                        s(:lvar, :signed), :+,
                        s(:lvar, :type)))),
                  s(:send, nil, :mkmflog,
                    s(:lvar, :bug4144))))))),
        s(:def, :test_typeof_typedef,
          s(:args),
          s(:ensure,
            s(:block,
              s(:send,
                s(:array,
                  s(:array,
                    s(:str, ""),
                    s(:str, "-1")),
                  s(:array,
                    s(:str, "signed "),
                    s(:str, "-1")),
                  s(:array,
                    s(:str, "unsigned "),
                    s(:str, "+1"))), :each),
              s(:args,
                s(:arg, :signed),
                s(:arg, :expect)),
              s(:block,
                s(:send,
                  s(:array,
                    s(:str, "short"),
                    s(:str, "int"),
                    s(:str, "long")), :each),
                s(:args,
                  s(:arg, :type)),
                s(:begin,
                  s(:block,
                    s(:send, nil, :open,
                      s(:str, "confdefs.h"),
                      s(:str, "w")),
                    s(:args,
                      s(:arg, :f)),
                    s(:send,
                      s(:lvar, :f), :puts,
                      s(:dstr,
                        s(:str, "typedef "),
                        s(:begin,
                          s(:lvar, :signed)),
                        s(:begin,
                          s(:lvar, :type)),
                        s(:str, " test1_t;")))),
                  s(:send,
                    s(:gvar, :$defs), :clear),
                  s(:send, nil, :assert_equal,
                    s(:send,
                      s(:lvar, :expect), :to_i),
                    s(:block,
                      s(:send, nil, :mkmf),
                      s(:args),
                      s(:send, nil, :check_signedness,
                        s(:str, "test1_t"),
                        s(:str, "confdefs.h"))),
                    s(:const, nil, :MKMFLOG)),
                  s(:send, nil, :assert_include,
                    s(:gvar, :$defs),
                    s(:dstr,
                      s(:str, "-DSIGNEDNESS_OF_TEST1_T="),
                      s(:begin,
                        s(:lvar, :expect))))))),
            s(:send,
              s(:const, nil, :File), :unlink,
              s(:str, "confdefs.h"))))))))

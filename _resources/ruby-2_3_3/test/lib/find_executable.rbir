s(:begin,
  s(:send, nil, :require,
    s(:str, "rbconfig")),
  s(:module,
    s(:const, nil, :EnvUtil),
    s(:begin,
      s(:def, :find_executable,
        s(:args,
          s(:arg, :cmd),
          s(:restarg, :args)),
        s(:begin,
          s(:lvasgn, :exts,
            s(:send,
              s(:send,
                s(:send,
                  s(:const,
                    s(:const, nil, :RbConfig), :CONFIG), :[],
                  s(:str, "EXECUTABLE_EXTS")), :split), :|,
              s(:array,
                s(:send,
                  s(:const,
                    s(:const, nil, :RbConfig), :CONFIG), :[],
                  s(:str, "EXEEXT"))))),
          s(:block,
            s(:send,
              s(:send,
                s(:send,
                  s(:const, nil, :ENV), :[],
                  s(:str, "PATH")), :split,
                s(:const,
                  s(:const, nil, :File), :PATH_SEPARATOR)), :each),
            s(:args,
              s(:arg, :path)),
            s(:begin,
              s(:if,
                s(:send,
                  s(:lvar, :path), :empty?),
                s(:next), nil),
              s(:lvasgn, :path,
                s(:send,
                  s(:const, nil, :File), :join,
                  s(:lvar, :path),
                  s(:lvar, :cmd))),
              s(:block,
                s(:send,
                  s(:lvar, :exts), :each),
                s(:args,
                  s(:arg, :ext)),
                s(:begin,
                  s(:lvasgn, :cmdline,
                    s(:array,
                      s(:send,
                        s(:lvar, :path), :+,
                        s(:lvar, :ext)),
                      s(:splat,
                        s(:lvar, :args)))),
                  s(:kwbegin,
                    s(:rescue,
                      s(:if,
                        s(:yield,
                          s(:send,
                            s(:const, nil, :IO), :popen,
                            s(:lvar, :cmdline),
                            s(:str, "r"),
                            s(:hash,
                              s(:pair,
                                s(:sym, :err),
                                s(:array,
                                  s(:sym, :child),
                                  s(:sym, :out)))),
                            s(:block_pass,
                              s(:sym, :read)))),
                        s(:return,
                          s(:lvar, :cmdline)), nil),
                      s(:resbody, nil, nil,
                        s(:next)), nil)))))),
          s(:nil))),
      s(:send, nil, :module_function,
        s(:sym, :find_executable)))))

s(:begin,
  s(:kwbegin,
    s(:rescue,
      s(:send, nil, :require,
        s(:str, "win32ole")),
      s(:resbody,
        s(:array,
          s(:const, nil, :LoadError)), nil, nil), nil)),
  s(:send, nil, :require,
    s(:str, "test/unit")),
  s(:if,
    s(:defined?,
      s(:const, nil, :WIN32OLE)),
    s(:class,
      s(:const, nil, :TestNIL2VT_EMPTY),
      s(:const,
        s(:const,
          s(:const, nil, :Test), :Unit), :TestCase),
      s(:begin,
        s(:def, :setup,
          s(:args),
          s(:begin,
            s(:lvasgn, :fs,
              s(:send,
                s(:const, nil, :WIN32OLE), :new,
                s(:str, "Scripting.FileSystemObject"))),
            s(:ivasgn, :@path,
              s(:send,
                s(:send,
                  s(:lvar, :fs), :GetFolder,
                  s(:str, ".")), :path)))),
        s(:def, :test_openSchema,
          s(:args),
          s(:begin,
            s(:lvasgn, :con,
              s(:nil)),
            s(:kwbegin,
              s(:rescue,
                s(:begin,
                  s(:lvasgn, :con,
                    s(:send,
                      s(:const, nil, :WIN32OLE), :new,
                      s(:str, "ADODB.Connection"))),
                  s(:send,
                    s(:lvar, :con), :connectionString=,
                    s(:str, "Provider=MSDASQL;Extended Properties=")),
                  s(:op_asgn,
                    s(:send,
                      s(:lvar, :con), :connectionString), :+,
                    s(:dstr,
                      s(:str, "\"DRIVER={Microsoft Text Driver (*.txt; *.csv)};DBQ="),
                      s(:begin,
                        s(:ivar, :@path)),
                      s(:str, "\""))),
                  s(:send,
                    s(:lvar, :con), :open)),
                s(:resbody, nil, nil,
                  s(:lvasgn, :con,
                    s(:nil))), nil)),
            s(:if,
              s(:lvar, :con),
              s(:begin,
                s(:lvasgn, :rs,
                  s(:send,
                    s(:lvar, :con), :openSchema,
                    s(:int, 4),
                    s(:array,
                      s(:nil),
                      s(:nil),
                      s(:str, "DUMMY"),
                      s(:str, "TABLE")))),
                s(:send, nil, :assert,
                  s(:lvar, :rs)),
                s(:send, nil, :assert_equal,
                  s(:str, "_Recordset"),
                  s(:send,
                    s(:send,
                      s(:lvar, :rs), :ole_type), :name)),
                s(:lvasgn, :rs,
                  s(:send,
                    s(:lvar, :con), :openSchema,
                    s(:int, 4),
                    s(:array,
                      s(:const,
                        s(:const, nil, :WIN32OLE_VARIANT), :Empty),
                      s(:const,
                        s(:const, nil, :WIN32OLE_VARIANT), :Empty),
                      s(:str, "DUMMY"),
                      s(:str, "TABLE")))),
                s(:send, nil, :assert,
                  s(:lvar, :rs)),
                s(:send, nil, :assert_equal,
                  s(:str, "_Recordset"),
                  s(:send,
                    s(:send,
                      s(:lvar, :rs), :ole_type), :name))), nil))))), nil))

s(:begin,
  s(:send, nil, :require,
    s(:str, "test/unit")),
  s(:kwbegin,
    s(:rescue,
      s(:send, nil, :require,
        s(:str, "win32ole")),
      s(:resbody,
        s(:array,
          s(:const, nil, :LoadError)), nil, nil), nil)),
  s(:if,
    s(:defined?,
      s(:const, nil, :WIN32OLE)),
    s(:class,
      s(:const, nil, :TestWIN32OLE_PROPERTYPUTREF),
      s(:const,
        s(:const,
          s(:const, nil, :Test), :Unit), :TestCase),
      s(:begin,
        s(:def, :setup,
          s(:args),
          s(:kwbegin,
            s(:rescue,
              s(:begin,
                s(:ivasgn, :@sapi,
                  s(:send,
                    s(:const, nil, :WIN32OLE), :new,
                    s(:str, "SAPI.SpVoice"))),
                s(:ivasgn, :@sv,
                  s(:send,
                    s(:ivar, :@sapi), :voice))),
              s(:resbody,
                s(:array,
                  s(:const, nil, :WIN32OLERuntimeError)), nil,
                s(:ivasgn, :@sapi,
                  s(:nil))), nil))),
        s(:def, :test_sapi,
          s(:args),
          s(:if,
            s(:ivar, :@sapi),
            s(:begin,
              s(:lvasgn, :new_id,
                s(:send,
                  s(:send,
                    s(:send,
                      s(:ivar, :@sapi), :getvoices), :item,
                    s(:int, 0)), :Id)),
              s(:send,
                s(:ivar, :@sapi), :voice=,
                s(:send,
                  s(:send,
                    s(:ivar, :@sapi), :getvoices), :item,
                  s(:int, 0))),
              s(:send, nil, :assert_equal,
                s(:lvar, :new_id),
                s(:send,
                  s(:send,
                    s(:ivar, :@sapi), :voice), :Id))), nil)),
        s(:def, :teardown,
          s(:args),
          s(:if,
            s(:ivar, :@sapi),
            s(:send,
              s(:ivar, :@sapi), :voice=,
              s(:ivar, :@sv)), nil)))), nil))

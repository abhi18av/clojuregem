s(:module,
  s(:const, nil, :UpdateEnv),
  s(:def, :update_env,
    s(:args,
      s(:arg, :environ)),
    s(:block,
      s(:send,
        s(:lvar, :environ), :each),
      s(:args,
        s(:arg, :key),
        s(:arg, :val)),
      s(:begin,
        s(:if,
          s(:send,
            s(:ivar, :@environ), :key?,
            s(:lvar, :key)), nil,
          s(:send,
            s(:ivar, :@environ), :[]=,
            s(:lvar, :key),
            s(:send,
              s(:const, nil, :ENV), :[],
              s(:lvar, :key)))),
        s(:send,
          s(:const, nil, :ENV), :[]=,
          s(:lvar, :key),
          s(:lvar, :val))))))

s(:begin,
  s(:send, nil, :require,
    s(:str, "test/unit")),
  s(:send, nil, :require,
    s(:str, "uri/mailto")),
  s(:module,
    s(:const, nil, :URI),
    s(:class,
      s(:const, nil, :TestMailTo),
      s(:const,
        s(:const,
          s(:const, nil, :Test), :Unit), :TestCase),
      s(:begin,
        s(:def, :setup,
          s(:args),
          s(:ivasgn, :@u,
            s(:const,
              s(:const, nil, :URI), :MailTo))),
        s(:def, :teardown,
          s(:args), nil),
        s(:def, :uri_to_ary,
          s(:args,
            s(:arg, :uri)),
          s(:block,
            s(:send,
              s(:send,
                s(:send,
                  s(:lvar, :uri), :class), :component), :collect),
            s(:args,
              s(:arg, :c)),
            s(:send,
              s(:lvar, :uri), :send,
              s(:lvar, :c)))),
        s(:def, :test_build,
          s(:args),
          s(:begin,
            s(:lvasgn, :ok,
              s(:array)),
            s(:lvasgn, :bad,
              s(:array)),
            s(:send,
              s(:lvar, :ok), :<<,
              s(:array,
                s(:str, "mailto:chris@example.com"))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:array,
                s(:str, "chris@example.com"),
                s(:nil))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:hash,
                s(:pair,
                  s(:sym, :to),
                  s(:str, "chris@example.com")))),
            s(:send,
              s(:lvar, :ok), :<<,
              s(:array,
                s(:str, "mailto:foo+@example.com,bar@example.com"))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:array,
                s(:array,
                  s(:str, "foo+@example.com"),
                  s(:str, "bar@example.com")),
                s(:nil))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:hash,
                s(:pair,
                  s(:sym, :to),
                  s(:str, "foo+@example.com,bar@example.com")))),
            s(:send,
              s(:lvar, :ok), :<<,
              s(:array,
                s(:str, "mailto:infobot@example.com?subject=current-issue"))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:array,
                s(:str, "infobot@example.com"),
                s(:array,
                  s(:str, "subject=current-issue")))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:hash,
                s(:pair,
                  s(:sym, :to),
                  s(:str, "infobot@example.com")),
                s(:pair,
                  s(:sym, :headers),
                  s(:array,
                    s(:str, "subject=current-issue"))))),
            s(:send,
              s(:lvar, :ok), :<<,
              s(:array,
                s(:str, "mailto:infobot@example.com?body=send%20current-issue"))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:array,
                s(:str, "infobot@example.com"),
                s(:array,
                  s(:str, "body=send%20current-issue")))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:hash,
                s(:pair,
                  s(:sym, :to),
                  s(:str, "infobot@example.com")),
                s(:pair,
                  s(:sym, :headers),
                  s(:array,
                    s(:str, "body=send%20current-issue"))))),
            s(:send,
              s(:lvar, :ok), :<<,
              s(:array,
                s(:str, "mailto:infobot@example.com?body=send%20current-issue%0D%0Asend%20index"))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:array,
                s(:str, "infobot@example.com"),
                s(:array,
                  s(:str, "body=send%20current-issue%0D%0Asend%20index")))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:hash,
                s(:pair,
                  s(:sym, :to),
                  s(:str, "infobot@example.com")),
                s(:pair,
                  s(:sym, :headers),
                  s(:array,
                    s(:str, "body=send%20current-issue%0D%0Asend%20index"))))),
            s(:send,
              s(:lvar, :ok), :<<,
              s(:array,
                s(:str, "mailto:foobar@example.com?In-Reply-To=%3c3469A91.D10AF4C@example.com"))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:array,
                s(:str, "foobar@example.com"),
                s(:array,
                  s(:str, "In-Reply-To=%3c3469A91.D10AF4C@example.com")))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:hash,
                s(:pair,
                  s(:sym, :to),
                  s(:str, "foobar@example.com")),
                s(:pair,
                  s(:sym, :headers),
                  s(:array,
                    s(:str, "In-Reply-To=%3c3469A91.D10AF4C@example.com"))))),
            s(:send,
              s(:lvar, :ok), :<<,
              s(:array,
                s(:str, "mailto:majordomo@example.com?body=subscribe%20bamboo-l"))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:array,
                s(:str, "majordomo@example.com"),
                s(:array,
                  s(:str, "body=subscribe%20bamboo-l")))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:hash,
                s(:pair,
                  s(:sym, :to),
                  s(:str, "majordomo@example.com")),
                s(:pair,
                  s(:sym, :headers),
                  s(:array,
                    s(:str, "body=subscribe%20bamboo-l"))))),
            s(:send,
              s(:lvar, :ok), :<<,
              s(:array,
                s(:str, "mailto:joe@example.com?cc=bob@example.com&body=hello"))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:array,
                s(:str, "joe@example.com"),
                s(:array,
                  s(:str, "cc=bob@example.com"),
                  s(:str, "body=hello")))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:hash,
                s(:pair,
                  s(:sym, :to),
                  s(:str, "joe@example.com")),
                s(:pair,
                  s(:sym, :headers),
                  s(:array,
                    s(:str, "cc=bob@example.com"),
                    s(:str, "body=hello"))))),
            s(:send,
              s(:lvar, :ok), :<<,
              s(:array,
                s(:str, "mailto:?to=joe@example.com&cc=bob@example.com&body=hello"))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:array,
                s(:nil),
                s(:array,
                  s(:str, "to=joe@example.com"),
                  s(:str, "cc=bob@example.com"),
                  s(:str, "body=hello")))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:hash,
                s(:pair,
                  s(:sym, :headers),
                  s(:array,
                    s(:str, "to=joe@example.com"),
                    s(:str, "cc=bob@example.com"),
                    s(:str, "body=hello"))))),
            s(:send,
              s(:lvar, :ok), :<<,
              s(:array,
                s(:str, "mailto:gorby%25kremvax@example.com"))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:array,
                s(:str, "gorby%25kremvax@example.com"),
                s(:nil))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:hash,
                s(:pair,
                  s(:sym, :to),
                  s(:str, "gorby%25kremvax@example.com")))),
            s(:send,
              s(:lvar, :ok), :<<,
              s(:array,
                s(:str, "mailto:unlikely%3Faddress@example.com?blat=foop"))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:array,
                s(:str, "unlikely%3Faddress@example.com"),
                s(:array,
                  s(:str, "blat=foop")))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:hash,
                s(:pair,
                  s(:sym, :to),
                  s(:str, "unlikely%3Faddress@example.com")),
                s(:pair,
                  s(:sym, :headers),
                  s(:array,
                    s(:str, "blat=foop"))))),
            s(:send,
              s(:lvar, :ok), :<<,
              s(:array,
                s(:str, "mailto:john@example.com?Subject=Ruby&Cc=jack@example.com"))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:array,
                s(:str, "john@example.com"),
                s(:array,
                  s(:array,
                    s(:str, "Subject"),
                    s(:str, "Ruby")),
                  s(:array,
                    s(:str, "Cc"),
                    s(:str, "jack@example.com"))))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:hash,
                s(:pair,
                  s(:sym, :to),
                  s(:str, "john@example.com")),
                s(:pair,
                  s(:sym, :headers),
                  s(:array,
                    s(:array,
                      s(:str, "Subject"),
                      s(:str, "Ruby")),
                    s(:array,
                      s(:str, "Cc"),
                      s(:str, "jack@example.com")))))),
            s(:send,
              s(:lvar, :ok), :<<,
              s(:array,
                s(:str, "mailto:listman@example.com?subject=subscribe"))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:hash,
                s(:pair,
                  s(:sym, :to),
                  s(:str, "listman@example.com")),
                s(:pair,
                  s(:sym, :headers),
                  s(:array,
                    s(:array,
                      s(:str, "subject"),
                      s(:str, "subscribe")))))),
            s(:send,
              s(:send,
                s(:lvar, :ok), :[],
                s(:int, -1)), :<<,
              s(:hash,
                s(:pair,
                  s(:sym, :to),
                  s(:str, "listman@example.com")),
                s(:pair,
                  s(:sym, :headers),
                  s(:array,
                    s(:array,
                      s(:str, "subject"),
                      s(:str, "subscribe")))))),
            s(:lvasgn, :ok_all,
              s(:send,
                s(:send,
                  s(:lvar, :ok), :flatten), :join,
                s(:str, "\u0000"))),
            s(:send,
              s(:lvar, :bad), :<<,
              s(:array,
                s(:str, "joe@example.com"),
                s(:array,
                  s(:str, "cc=bob@example.com?body=hello")))),
            s(:send,
              s(:lvar, :bad), :<<,
              s(:array,
                s(:str, "javascript:alert()"),
                s(:array))),
            s(:send,
              s(:lvar, :bad), :<<,
              s(:array,
                s(:str, "/example.com/"),
                s(:array))),
            s(:send,
              s(:lvar, :bad), :<<,
              s(:array,
                s(:str, "foo@example.jp?subject=1+1=2"),
                s(:array))),
            s(:block,
              s(:send,
                s(:lvar, :ok), :each),
              s(:args,
                s(:arg, :x)),
              s(:begin,
                s(:send, nil, :assert_equal,
                  s(:send,
                    s(:lvar, :x), :[],
                    s(:int, 0)),
                  s(:send,
                    s(:send,
                      s(:const, nil, :URI), :parse,
                      s(:send,
                        s(:lvar, :x), :[],
                        s(:int, 0))), :to_s)),
                s(:send, nil, :assert_equal,
                  s(:send,
                    s(:lvar, :x), :[],
                    s(:int, 0)),
                  s(:send,
                    s(:send,
                      s(:ivar, :@u), :build,
                      s(:send,
                        s(:lvar, :x), :[],
                        s(:int, 1))), :to_s)),
                s(:send, nil, :assert_equal,
                  s(:send,
                    s(:lvar, :x), :[],
                    s(:int, 0)),
                  s(:send,
                    s(:send,
                      s(:ivar, :@u), :build,
                      s(:send,
                        s(:lvar, :x), :[],
                        s(:int, 2))), :to_s)))),
            s(:block,
              s(:send,
                s(:lvar, :bad), :each),
              s(:args,
                s(:arg, :x)),
              s(:begin,
                s(:block,
                  s(:send, nil, :assert_raise,
                    s(:const,
                      s(:const, nil, :URI), :InvalidURIError)),
                  s(:args),
                  s(:send,
                    s(:const, nil, :URI), :parse,
                    s(:lvar, :x))),
                s(:block,
                  s(:send, nil, :assert_raise,
                    s(:const,
                      s(:const, nil, :URI), :InvalidComponentError)),
                  s(:args),
                  s(:send,
                    s(:ivar, :@u), :build,
                    s(:lvar, :x))))),
            s(:send, nil, :assert_equal,
              s(:lvar, :ok_all),
              s(:send,
                s(:send,
                  s(:lvar, :ok), :flatten), :join,
                s(:str, "\u0000"))))),
        s(:def, :test_select,
          s(:args),
          s(:begin,
            s(:lvasgn, :u,
              s(:send,
                s(:const, nil, :URI), :parse,
                s(:str, "mailto:joe@example.com?cc=bob@example.com&body=hello"))),
            s(:send, nil, :assert_equal,
              s(:send, nil, :uri_to_ary,
                s(:lvar, :u)),
              s(:send,
                s(:lvar, :u), :select,
                s(:splat,
                  s(:send,
                    s(:lvar, :u), :component)))),
            s(:block,
              s(:send, nil, :assert_raise,
                s(:const, nil, :ArgumentError)),
              s(:args),
              s(:send,
                s(:lvar, :u), :select,
                s(:sym, :scheme),
                s(:sym, :host),
                s(:sym, :not_exist),
                s(:sym, :port)))))))))

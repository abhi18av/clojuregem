s(:begin,
  s(:send, nil, :require,
    s(:str, "test/unit")),
  s(:send, nil, :require,
    s(:str, "uri/ldap")),
  s(:module,
    s(:const, nil, :URI),
    s(:class,
      s(:const, nil, :TestLDAP),
      s(:const,
        s(:const,
          s(:const, nil, :Test), :Unit), :TestCase),
      s(:begin,
        s(:def, :setup,
          s(:args), nil),
        s(:def, :teardown,
          s(:args), nil),
        s(:def, :uri_to_ary,
          s(:args,
            s(:arg, :uri)),
          s(:block,
            s(:send,
              s(:send,
                s(:send,
                  s(:lvar, :uri), :class), :component), :collect),
            s(:args,
              s(:arg, :c)),
            s(:send,
              s(:lvar, :uri), :send,
              s(:lvar, :c)))),
        s(:def, :test_parse,
          s(:args),
          s(:begin,
            s(:lvasgn, :url,
              s(:str, "ldap://ldap.jaist.ac.jp/o=JAIST,c=JP?sn?base?(sn=ttate*)")),
            s(:lvasgn, :u,
              s(:send,
                s(:const, nil, :URI), :parse,
                s(:lvar, :url))),
            s(:send, nil, :assert_kind_of,
              s(:const,
                s(:const, nil, :URI), :LDAP),
              s(:lvar, :u)),
            s(:send, nil, :assert_equal,
              s(:lvar, :url),
              s(:send,
                s(:lvar, :u), :to_s)),
            s(:send, nil, :assert_equal,
              s(:str, "o=JAIST,c=JP"),
              s(:send,
                s(:lvar, :u), :dn)),
            s(:send, nil, :assert_equal,
              s(:str, "sn"),
              s(:send,
                s(:lvar, :u), :attributes)),
            s(:send, nil, :assert_equal,
              s(:str, "base"),
              s(:send,
                s(:lvar, :u), :scope)),
            s(:send, nil, :assert_equal,
              s(:str, "(sn=ttate*)"),
              s(:send,
                s(:lvar, :u), :filter)),
            s(:send, nil, :assert_equal,
              s(:nil),
              s(:send,
                s(:lvar, :u), :extensions)),
            s(:send,
              s(:lvar, :u), :scope=,
              s(:const,
                s(:const,
                  s(:const, nil, :URI), :LDAP), :SCOPE_SUB)),
            s(:send,
              s(:lvar, :u), :attributes=,
              s(:str, "sn,cn,mail")),
            s(:send, nil, :assert_equal,
              s(:str, "ldap://ldap.jaist.ac.jp/o=JAIST,c=JP?sn,cn,mail?sub?(sn=ttate*)"),
              s(:send,
                s(:lvar, :u), :to_s)),
            s(:send, nil, :assert_equal,
              s(:str, "o=JAIST,c=JP"),
              s(:send,
                s(:lvar, :u), :dn)),
            s(:send, nil, :assert_equal,
              s(:str, "sn,cn,mail"),
              s(:send,
                s(:lvar, :u), :attributes)),
            s(:send, nil, :assert_equal,
              s(:str, "sub"),
              s(:send,
                s(:lvar, :u), :scope)),
            s(:send, nil, :assert_equal,
              s(:str, "(sn=ttate*)"),
              s(:send,
                s(:lvar, :u), :filter)),
            s(:send, nil, :assert_equal,
              s(:nil),
              s(:send,
                s(:lvar, :u), :extensions)),
            s(:block,
              s(:send,
                s(:hash,
                  s(:pair,
                    s(:str, "ldap:///o=University%20of%20Michigan,c=US"),
                    s(:array,
                      s(:str, "ldap"),
                      s(:nil),
                      s(:const,
                        s(:const,
                          s(:const, nil, :URI), :LDAP), :DEFAULT_PORT),
                      s(:str, "o=University%20of%20Michigan,c=US"),
                      s(:nil),
                      s(:nil),
                      s(:nil),
                      s(:nil))),
                  s(:pair,
                    s(:str, "ldap://ldap.itd.umich.edu/o=University%20of%20Michigan,c=US"),
                    s(:array,
                      s(:str, "ldap"),
                      s(:str, "ldap.itd.umich.edu"),
                      s(:const,
                        s(:const,
                          s(:const, nil, :URI), :LDAP), :DEFAULT_PORT),
                      s(:str, "o=University%20of%20Michigan,c=US"),
                      s(:nil),
                      s(:nil),
                      s(:nil),
                      s(:nil))),
                  s(:pair,
                    s(:str, "ldap://ldap.itd.umich.edu/o=University%20of%20Michigan,c=US?postalAddress"),
                    s(:array,
                      s(:str, "ldap"),
                      s(:str, "ldap.itd.umich.edu"),
                      s(:const,
                        s(:const,
                          s(:const, nil, :URI), :LDAP), :DEFAULT_PORT),
                      s(:str, "o=University%20of%20Michigan,c=US"),
                      s(:str, "postalAddress"),
                      s(:nil),
                      s(:nil),
                      s(:nil))),
                  s(:pair,
                    s(:str, "ldap://host.com:6666/o=University%20of%20Michigan,c=US??sub?(cn=Babs%20Jensen)"),
                    s(:array,
                      s(:str, "ldap"),
                      s(:str, "host.com"),
                      s(:int, 6666),
                      s(:str, "o=University%20of%20Michigan,c=US"),
                      s(:nil),
                      s(:str, "sub"),
                      s(:str, "(cn=Babs%20Jensen)"),
                      s(:nil))),
                  s(:pair,
                    s(:str, "ldap://ldap.itd.umich.edu/c=GB?objectClass?one"),
                    s(:array,
                      s(:str, "ldap"),
                      s(:str, "ldap.itd.umich.edu"),
                      s(:const,
                        s(:const,
                          s(:const, nil, :URI), :LDAP), :DEFAULT_PORT),
                      s(:str, "c=GB"),
                      s(:str, "objectClass"),
                      s(:str, "one"),
                      s(:nil),
                      s(:nil))),
                  s(:pair,
                    s(:str, "ldap://ldap.question.com/o=Question%3f,c=US?mail"),
                    s(:array,
                      s(:str, "ldap"),
                      s(:str, "ldap.question.com"),
                      s(:const,
                        s(:const,
                          s(:const, nil, :URI), :LDAP), :DEFAULT_PORT),
                      s(:str, "o=Question%3f,c=US"),
                      s(:str, "mail"),
                      s(:nil),
                      s(:nil),
                      s(:nil))),
                  s(:pair,
                    s(:str, "ldap://ldap.netscape.com/o=Babsco,c=US??(int=%5c00%5c00%5c00%5c04)"),
                    s(:array,
                      s(:str, "ldap"),
                      s(:str, "ldap.netscape.com"),
                      s(:const,
                        s(:const,
                          s(:const, nil, :URI), :LDAP), :DEFAULT_PORT),
                      s(:str, "o=Babsco,c=US"),
                      s(:nil),
                      s(:str, "(int=%5c00%5c00%5c00%5c04)"),
                      s(:nil),
                      s(:nil))),
                  s(:pair,
                    s(:str, "ldap:///??sub??bindname=cn=Manager%2co=Foo"),
                    s(:array,
                      s(:str, "ldap"),
                      s(:nil),
                      s(:const,
                        s(:const,
                          s(:const, nil, :URI), :LDAP), :DEFAULT_PORT),
                      s(:str, ""),
                      s(:nil),
                      s(:str, "sub"),
                      s(:nil),
                      s(:str, "bindname=cn=Manager%2co=Foo"))),
                  s(:pair,
                    s(:str, "ldap:///??sub??!bindname=cn=Manager%2co=Foo"),
                    s(:array,
                      s(:str, "ldap"),
                      s(:nil),
                      s(:const,
                        s(:const,
                          s(:const, nil, :URI), :LDAP), :DEFAULT_PORT),
                      s(:str, ""),
                      s(:nil),
                      s(:str, "sub"),
                      s(:nil),
                      s(:str, "!bindname=cn=Manager%2co=Foo")))), :each),
              s(:args,
                s(:arg, :url2),
                s(:arg, :ary)),
              s(:begin,
                s(:lvasgn, :u,
                  s(:send,
                    s(:const, nil, :URI), :parse,
                    s(:lvar, :url2))),
                s(:send, nil, :assert_equal,
                  s(:lvar, :ary),
                  s(:send, nil, :uri_to_ary,
                    s(:lvar, :u))))))),
        s(:def, :test_select,
          s(:args),
          s(:begin,
            s(:lvasgn, :u,
              s(:send,
                s(:const, nil, :URI), :parse,
                s(:str, "ldap:///??sub??!bindname=cn=Manager%2co=Foo"))),
            s(:send, nil, :assert_equal,
              s(:send, nil, :uri_to_ary,
                s(:lvar, :u)),
              s(:send,
                s(:lvar, :u), :select,
                s(:splat,
                  s(:send,
                    s(:lvar, :u), :component)))),
            s(:block,
              s(:send, nil, :assert_raise,
                s(:const, nil, :ArgumentError)),
              s(:args),
              s(:send,
                s(:lvar, :u), :select,
                s(:sym, :scheme),
                s(:sym, :host),
                s(:sym, :not_exist),
                s(:sym, :port)))))))))

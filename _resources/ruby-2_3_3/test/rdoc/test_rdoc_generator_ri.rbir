s(:begin,
  s(:send, nil, :require,
    s(:str, "rdoc/test_case")),
  s(:class,
    s(:const, nil, :TestRDocGeneratorRI),
    s(:const,
      s(:const, nil, :RDoc), :TestCase),
    s(:begin,
      s(:def, :setup,
        s(:args),
        s(:begin,
          s(:zsuper),
          s(:ivasgn, :@options,
            s(:send,
              s(:const,
                s(:const, nil, :RDoc), :Options), :new)),
          s(:if,
            s(:send,
              s(:const, nil, :Object), :const_defined?,
              s(:sym, :Encoding)),
            s(:begin,
              s(:send,
                s(:ivar, :@options), :encoding=,
                s(:const,
                  s(:const, nil, :Encoding), :UTF_8)),
              s(:send,
                s(:ivar, :@store), :encoding=,
                s(:const,
                  s(:const, nil, :Encoding), :UTF_8))), nil),
          s(:ivasgn, :@tmpdir,
            s(:send,
              s(:const, nil, :File), :join,
              s(:send,
                s(:const, nil, :Dir), :tmpdir),
              s(:dstr,
                s(:str, "test_rdoc_generator_ri_"),
                s(:begin,
                  s(:gvar, :$$))))),
          s(:send,
            s(:const, nil, :FileUtils), :mkdir_p,
            s(:ivar, :@tmpdir)),
          s(:ivasgn, :@g,
            s(:send,
              s(:const,
                s(:const,
                  s(:const, nil, :RDoc), :Generator), :RI), :new,
              s(:ivar, :@store),
              s(:ivar, :@options))),
          s(:ivasgn, :@top_level,
            s(:send,
              s(:ivar, :@store), :add_file,
              s(:str, "file.rb"))),
          s(:ivasgn, :@klass,
            s(:send,
              s(:ivar, :@top_level), :add_class,
              s(:const,
                s(:const, nil, :RDoc), :NormalClass),
              s(:str, "Object"))),
          s(:ivasgn, :@meth,
            s(:send,
              s(:const,
                s(:const, nil, :RDoc), :AnyMethod), :new,
              s(:nil),
              s(:str, "method"))),
          s(:send,
            s(:ivar, :@meth), :record_location,
            s(:ivar, :@top_level)),
          s(:ivasgn, :@meth_bang,
            s(:send,
              s(:const,
                s(:const, nil, :RDoc), :AnyMethod), :new,
              s(:nil),
              s(:str, "method!"))),
          s(:send,
            s(:ivar, :@meth_bang), :record_location,
            s(:ivar, :@top_level)),
          s(:ivasgn, :@attr,
            s(:send,
              s(:const,
                s(:const, nil, :RDoc), :Attr), :new,
              s(:nil),
              s(:str, "attr"),
              s(:str, "RW"),
              s(:str, ""))),
          s(:send,
            s(:ivar, :@attr), :record_location,
            s(:ivar, :@top_level)),
          s(:send,
            s(:ivar, :@klass), :add_method,
            s(:ivar, :@meth)),
          s(:send,
            s(:ivar, :@klass), :add_method,
            s(:ivar, :@meth_bang)),
          s(:send,
            s(:ivar, :@klass), :add_attribute,
            s(:ivar, :@attr)),
          s(:send,
            s(:const, nil, :Dir), :chdir,
            s(:ivar, :@tmpdir)))),
      s(:def, :teardown,
        s(:args),
        s(:begin,
          s(:zsuper),
          s(:send,
            s(:const, nil, :Dir), :chdir,
            s(:ivar, :@pwd)),
          s(:send,
            s(:const, nil, :FileUtils), :rm_rf,
            s(:ivar, :@tmpdir)))),
      s(:def, :test_generate,
        s(:args),
        s(:begin,
          s(:send,
            s(:ivar, :@g), :generate),
          s(:send, nil, :assert_file,
            s(:send,
              s(:const, nil, :File), :join,
              s(:ivar, :@tmpdir),
              s(:str, "cache.ri"))),
          s(:send, nil, :assert_file,
            s(:send,
              s(:const, nil, :File), :join,
              s(:ivar, :@tmpdir),
              s(:str, "Object"),
              s(:str, "cdesc-Object.ri"))),
          s(:send, nil, :assert_file,
            s(:send,
              s(:const, nil, :File), :join,
              s(:ivar, :@tmpdir),
              s(:str, "Object"),
              s(:str, "attr-i.ri"))),
          s(:send, nil, :assert_file,
            s(:send,
              s(:const, nil, :File), :join,
              s(:ivar, :@tmpdir),
              s(:str, "Object"),
              s(:str, "method-i.ri"))),
          s(:send, nil, :assert_file,
            s(:send,
              s(:const, nil, :File), :join,
              s(:ivar, :@tmpdir),
              s(:str, "Object"),
              s(:str, "method%21-i.ri"))),
          s(:lvasgn, :store,
            s(:send,
              s(:const,
                s(:const,
                  s(:const, nil, :RDoc), :RI), :Store), :new,
              s(:ivar, :@tmpdir))),
          s(:send,
            s(:lvar, :store), :load_cache),
          s(:lvasgn, :encoding,
            s(:if,
              s(:send,
                s(:const, nil, :Object), :const_defined?,
                s(:sym, :Encoding)),
              s(:const,
                s(:const, nil, :Encoding), :UTF_8),
              s(:nil))),
          s(:send, nil, :assert_equal,
            s(:lvar, :encoding),
            s(:send,
              s(:lvar, :store), :encoding)))),
      s(:def, :test_generate_dry_run,
        s(:args),
        s(:begin,
          s(:send,
            s(:ivar, :@store), :dry_run=,
            s(:true)),
          s(:ivasgn, :@g,
            s(:send,
              s(:const,
                s(:const,
                  s(:const, nil, :RDoc), :Generator), :RI), :new,
              s(:ivar, :@store),
              s(:ivar, :@options))),
          s(:lvasgn, :top_level,
            s(:send,
              s(:ivar, :@store), :add_file,
              s(:str, "file.rb"))),
          s(:send,
            s(:lvar, :top_level), :add_class,
            s(:send,
              s(:ivar, :@klass), :class),
            s(:send,
              s(:ivar, :@klass), :name)),
          s(:send,
            s(:ivar, :@g), :generate),
          s(:send, nil, :refute_file,
            s(:send,
              s(:const, nil, :File), :join,
              s(:ivar, :@tmpdir),
              s(:str, "cache.ri"))),
          s(:send, nil, :refute_file,
            s(:send,
              s(:const, nil, :File), :join,
              s(:ivar, :@tmpdir),
              s(:str, "Object"))))))))

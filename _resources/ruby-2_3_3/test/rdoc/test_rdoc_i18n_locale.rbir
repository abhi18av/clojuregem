s(:begin,
  s(:send, nil, :require,
    s(:str, "rdoc/test_case")),
  s(:class,
    s(:const, nil, :TestRDocI18nLocale),
    s(:const,
      s(:const, nil, :RDoc), :TestCase),
    s(:begin,
      s(:def, :setup,
        s(:args),
        s(:begin,
          s(:zsuper),
          s(:ivasgn, :@locale,
            s(:send, nil, :locale,
              s(:str, "fr"))),
          s(:ivasgn, :@tmpdir,
            s(:send,
              s(:const, nil, :File), :join,
              s(:send,
                s(:const, nil, :Dir), :tmpdir),
              s(:dstr,
                s(:str, "test_rdoc_i18n_locale_"),
                s(:begin,
                  s(:gvar, :$$))))),
          s(:send,
            s(:const, nil, :FileUtils), :mkdir_p,
            s(:ivar, :@tmpdir)),
          s(:ivasgn, :@locale_dir,
            s(:ivar, :@tmpdir)))),
      s(:def, :teardown,
        s(:args),
        s(:begin,
          s(:send,
            s(:const, nil, :FileUtils), :rm_rf,
            s(:ivar, :@tmpdir)),
          s(:zsuper))),
      s(:def, :test_name,
        s(:args),
        s(:send, nil, :assert_equal,
          s(:str, "fr"),
          s(:send,
            s(:send, nil, :locale,
              s(:str, "fr")), :name))),
      s(:def, :test_load_nonexistent_po,
        s(:args),
        s(:block,
          s(:send,
            s(:const, nil, :File), :stub,
            s(:sym, :exist?),
            s(:false)),
          s(:args),
          s(:send, nil, :refute,
            s(:send,
              s(:ivar, :@locale), :load,
              s(:str, "nonexsitent-locale"))))),
      s(:def, :test_load_existent_po,
        s(:args),
        s(:begin,
          s(:kwbegin,
            s(:rescue,
              s(:send, nil, :require,
                s(:str, "gettext/po_parser")),
              s(:resbody,
                s(:array,
                  s(:const, nil, :LoadError)), nil,
                s(:send, nil, :skip,
                  s(:str, "gettext gem is not found"))), nil)),
          s(:lvasgn, :fr_locale_dir,
            s(:send,
              s(:const, nil, :File), :join,
              s(:ivar, :@locale_dir),
              s(:str, "fr"))),
          s(:send,
            s(:const, nil, :FileUtils), :mkdir_p,
            s(:lvar, :fr_locale_dir)),
          s(:block,
            s(:send,
              s(:const, nil, :File), :open,
              s(:send,
                s(:const, nil, :File), :join,
                s(:lvar, :fr_locale_dir),
                s(:str, "rdoc.po")),
              s(:str, "w")),
            s(:args,
              s(:arg, :po)),
            s(:send,
              s(:lvar, :po), :puts,
              s(:dstr,
                s(:str, "msgid \"\"\n"),
                s(:str, "msgstr \"\"\n"),
                s(:str, "\"Language: fr\n\"\n"),
                s(:str, "\"MIME-Version: 1.0\n\"\n"),
                s(:str, "\"Content-Type: text/plain; charset=UTF-8\n\"\n"),
                s(:str, "\"Content-Transfer-Encoding: 8bit\n\"\n"),
                s(:str, "\n"),
                s(:str, "msgid \"Hello\"\n"),
                s(:str, "msgstr \"Bonjour\"\n")))),
          s(:send, nil, :assert,
            s(:send,
              s(:ivar, :@locale), :load,
              s(:ivar, :@locale_dir))),
          s(:send, nil, :assert_equal,
            s(:str, "Bonjour"),
            s(:send,
              s(:ivar, :@locale), :translate,
              s(:str, "Hello"))))),
      s(:def, :test_translate_existent_message,
        s(:args),
        s(:begin,
          s(:lvasgn, :messages,
            s(:send,
              s(:ivar, :@locale), :instance_variable_get,
              s(:sym, :@messages))),
          s(:send,
            s(:lvar, :messages), :[]=,
            s(:str, "Hello"),
            s(:str, "Bonjour")),
          s(:send, nil, :assert_equal,
            s(:str, "Bonjour"),
            s(:send,
              s(:ivar, :@locale), :translate,
              s(:str, "Hello"))))),
      s(:def, :test_translate_nonexistent_message,
        s(:args),
        s(:send, nil, :assert_equal,
          s(:str, "Hello"),
          s(:send,
            s(:ivar, :@locale), :translate,
            s(:str, "Hello")))),
      s(:send, nil, :private),
      s(:def, :locale,
        s(:args,
          s(:arg, :name)),
        s(:send,
          s(:const,
            s(:const,
              s(:const, nil, :RDoc), :I18n), :Locale), :new,
          s(:lvar, :name))))))

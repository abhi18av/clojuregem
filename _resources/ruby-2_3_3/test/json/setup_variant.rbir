s(:case,
  s(:send,
    s(:const, nil, :ENV), :[],
    s(:str, "JSON")),
  s(:when,
    s(:str, "pure"),
    s(:begin,
      s(:send,
        s(:gvar, :$:), :unshift,
        s(:str, "lib")),
      s(:send, nil, :require,
        s(:str, "json/pure")))),
  s(:when,
    s(:str, "ext"),
    s(:begin,
      s(:send,
        s(:gvar, :$:), :unshift,
        s(:str, "ext"),
        s(:str, "lib")),
      s(:send, nil, :require,
        s(:str, "json/ext")))),
  s(:begin,
    s(:send,
      s(:gvar, :$:), :unshift,
      s(:str, "ext"),
      s(:str, "lib")),
    s(:send, nil, :require,
      s(:str, "json"))))

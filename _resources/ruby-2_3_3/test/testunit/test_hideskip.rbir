s(:begin,
  s(:send, nil, :require,
    s(:str, "test/unit")),
  s(:class,
    s(:const, nil, :TestHideSkip),
    s(:const,
      s(:const,
        s(:const, nil, :Test), :Unit), :TestCase),
    s(:begin,
      s(:def, :test_hideskip,
        s(:args),
        s(:begin,
          s(:send, nil, :assert_not_match,
            s(:regexp,
              s(:str, "assertions/s.\\n\\n  1\\) Skipped"),
              s(:regopt)),
            s(:send, nil, :hideskip)),
          s(:send, nil, :assert_match,
            s(:regexp,
              s(:str, "assertions/s.\\n\\n  1\\) Skipped"),
              s(:regopt)),
            s(:send, nil, :hideskip,
              s(:str, "--show-skip"))),
          s(:send, nil, :assert_match,
            s(:regexp,
              s(:str, "assertions/s.\\n\\n1 tests, 0 assertions, 0 failures, 0 errors, 1 skips"),
              s(:regopt)),
            s(:send, nil, :hideskip,
              s(:str, "--hide-skip"))))),
      s(:def, :hideskip,
        s(:args,
          s(:restarg, :args)),
        s(:block,
          s(:send,
            s(:const, nil, :IO), :popen,
            s(:array,
              s(:splat,
                s(:send,
                  s(:ivar, :@options), :[],
                  s(:sym, :ruby))),
              s(:dstr,
                s(:begin,
                  s(:send,
                    s(:const, nil, :File), :dirname,
                    s(:str, "(string)"))),
                s(:str, "/test4test_hideskip.rb")),
              s(:str, "--verbose"),
              s(:splat,
                s(:lvar, :args))),
            s(:hash,
              s(:pair,
                s(:sym, :err),
                s(:array,
                  s(:sym, :child),
                  s(:sym, :out))))),
          s(:args,
            s(:arg, :f)),
          s(:send,
            s(:lvar, :f), :read))))))

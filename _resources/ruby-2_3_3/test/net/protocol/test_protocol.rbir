s(:begin,
  s(:send, nil, :require,
    s(:str, "test/unit")),
  s(:send, nil, :require,
    s(:str, "net/protocol")),
  s(:send, nil, :require,
    s(:str, "stringio")),
  s(:class,
    s(:const, nil, :TestProtocol),
    s(:const,
      s(:const,
        s(:const, nil, :Test), :Unit), :TestCase),
    s(:begin,
      s(:def, :test_should_properly_dot_stuff_period_with_no_endline,
        s(:args),
        s(:begin,
          s(:lvasgn, :bug9627,
            s(:str, "[ruby-core:61441] [Bug #9627]")),
          s(:lvasgn, :sio,
            s(:send,
              s(:const, nil, :StringIO), :new,
              s(:str, ""))),
          s(:lvasgn, :imio,
            s(:send,
              s(:const,
                s(:const, nil, :Net), :InternetMessageIO), :new,
              s(:lvar, :sio))),
          s(:lvasgn, :email,
            s(:str, "To: bob@aol.com\nlook, a period with no endline\n.")),
          s(:send,
            s(:lvar, :imio), :write_message,
            s(:lvar, :email)),
          s(:send, nil, :assert_equal,
            s(:str, "To: bob@aol.com\r\nlook, a period with no endline\r\n..\r\n.\r\n"),
            s(:send,
              s(:lvar, :sio), :string),
            s(:lvar, :bug9627)))),
      s(:def, :test_each_crlf_line,
        s(:args),
        s(:block,
          s(:send, nil, :assert_output,
            s(:str, ""),
            s(:str, "")),
          s(:args),
          s(:begin,
            s(:lvasgn, :sio,
              s(:send,
                s(:const, nil, :StringIO), :new,
                s(:str, ""))),
            s(:lvasgn, :imio,
              s(:send,
                s(:const,
                  s(:const, nil, :Net), :InternetMessageIO), :new,
                s(:lvar, :sio))),
            s(:send, nil, :assert_equal,
              s(:int, 23),
              s(:send,
                s(:lvar, :imio), :write_message,
                s(:str, "あ\rい\nう\r\nえ"))),
            s(:send, nil, :assert_equal,
              s(:str, "あ\r\nい\r\nう\r\nえ\r\n.\r\n"),
              s(:send,
                s(:lvar, :sio), :string)),
            s(:lvasgn, :sio,
              s(:send,
                s(:const, nil, :StringIO), :new,
                s(:str, ""))),
            s(:lvasgn, :imio,
              s(:send,
                s(:const,
                  s(:const, nil, :Net), :InternetMessageIO), :new,
                s(:lvar, :sio))),
            s(:send, nil, :assert_equal,
              s(:int, 8),
              s(:send,
                s(:lvar, :imio), :write_message,
                s(:str, "あ\r"))),
            s(:send, nil, :assert_equal,
              s(:str, "あ\r\n.\r\n"),
              s(:send,
                s(:lvar, :sio), :string))))))))

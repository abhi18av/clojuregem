s(:begin,
  s(:send, nil, :require_relative,
    s(:str, "helper")),
  s(:if,
    s(:defined?,
      s(:const,
        s(:const, nil, :DTrace), :TestCase)),
    s(:module,
      s(:const, nil, :DTrace),
      s(:class,
        s(:const, nil, :TestHashCreate),
        s(:const, nil, :TestCase),
        s(:begin,
          s(:def, :test_hash_new,
            s(:args),
            s(:block,
              s(:send, nil, :trap_probe,
                s(:send, nil, :probe),
                s(:str, "Hash.new")),
              s(:args,
                s(:arg, :_),
                s(:arg, :rbfile),
                s(:arg, :saw)),
              s(:begin,
                s(:lvasgn, :saw,
                  s(:block,
                    s(:send,
                      s(:send,
                        s(:lvar, :saw), :map,
                        s(:block_pass,
                          s(:sym, :split))), :find_all),
                    s(:args,
                      s(:arg, :num),
                      s(:arg, :file),
                      s(:arg, :line)),
                    s(:and,
                      s(:send,
                        s(:lvar, :file), :==,
                        s(:lvar, :rbfile)),
                      s(:send,
                        s(:lvar, :num), :==,
                        s(:str, "0"))))),
                s(:send, nil, :assert_operator,
                  s(:send,
                    s(:lvar, :saw), :length),
                  s(:sym, :>),
                  s(:int, 0))))),
          s(:def, :test_hash_lit,
            s(:args),
            s(:block,
              s(:send, nil, :trap_probe,
                s(:send, nil, :probe),
                s(:str, "{}")),
              s(:args,
                s(:arg, :_),
                s(:arg, :rbfile),
                s(:arg, :saw)),
              s(:begin,
                s(:lvasgn, :saw,
                  s(:block,
                    s(:send,
                      s(:send,
                        s(:lvar, :saw), :map,
                        s(:block_pass,
                          s(:sym, :split))), :find_all),
                    s(:args,
                      s(:arg, :num),
                      s(:arg, :file),
                      s(:arg, :line)),
                    s(:and,
                      s(:send,
                        s(:lvar, :file), :==,
                        s(:lvar, :rbfile)),
                      s(:send,
                        s(:lvar, :num), :==,
                        s(:str, "0"))))),
                s(:send, nil, :assert_operator,
                  s(:send,
                    s(:lvar, :saw), :length),
                  s(:sym, :>),
                  s(:int, 0))))),
          s(:def, :test_hash_lit_elements,
            s(:args),
            s(:block,
              s(:send, nil, :trap_probe,
                s(:send, nil, :probe),
                s(:str, "{ :foo => :bar }")),
              s(:args,
                s(:arg, :_),
                s(:arg, :rbfile),
                s(:arg, :saw)),
              s(:begin,
                s(:lvasgn, :saw,
                  s(:block,
                    s(:send,
                      s(:send,
                        s(:lvar, :saw), :map,
                        s(:block_pass,
                          s(:sym, :split))), :find_all),
                    s(:args,
                      s(:arg, :num),
                      s(:arg, :file),
                      s(:arg, :line)),
                    s(:and,
                      s(:send,
                        s(:lvar, :file), :==,
                        s(:lvar, :rbfile)),
                      s(:send,
                        s(:lvar, :num), :==,
                        s(:str, "2"))))),
                s(:send, nil, :assert_operator,
                  s(:send,
                    s(:lvar, :saw), :length),
                  s(:sym, :>),
                  s(:int, 0))))),
          s(:def, :test_hash_lit_elements_string,
            s(:args),
            s(:block,
              s(:send, nil, :trap_probe,
                s(:send, nil, :probe),
                s(:str, "{ :foo => :bar, :bar => \"baz\" }")),
              s(:args,
                s(:arg, :_),
                s(:arg, :rbfile),
                s(:arg, :saw)),
              s(:begin,
                s(:lvasgn, :saw,
                  s(:block,
                    s(:send,
                      s(:send,
                        s(:lvar, :saw), :map,
                        s(:block_pass,
                          s(:sym, :split))), :find_all),
                    s(:args,
                      s(:arg, :num),
                      s(:arg, :file),
                      s(:arg, :line)),
                    s(:and,
                      s(:send,
                        s(:lvar, :file), :==,
                        s(:lvar, :rbfile)),
                      s(:send,
                        s(:lvar, :num), :==,
                        s(:str, "4"))))),
                s(:send, nil, :assert_operator,
                  s(:send,
                    s(:lvar, :saw), :length),
                  s(:sym, :>),
                  s(:int, 0))))),
          s(:send, nil, :private),
          s(:def, :probe,
            s(:args),
            s(:dstr,
              s(:str, "ruby$target:::hash-create\n"),
              s(:str, "/arg1/\n"),
              s(:str, "{\n"),
              s(:str, "  printf(\"%d %s %d\\n\", arg0, copyinstr(arg1), arg2);\n"),
              s(:str, "}\n")))))), nil))

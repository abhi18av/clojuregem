s(:begin,
  s(:send, nil, :require,
    s(:str, "test/unit")),
  s(:send, nil, :require,
    s(:str, "timeout")),
  s(:send, nil, :require,
    s(:str, "thread")),
  s(:class,
    s(:const, nil, :TestTimeout),
    s(:const,
      s(:const,
        s(:const, nil, :Test), :Unit), :TestCase),
    s(:begin,
      s(:def, :test_queue,
        s(:args),
        s(:begin,
          s(:lvasgn, :q,
            s(:send,
              s(:const, nil, :Queue), :new)),
          s(:block,
            s(:send, nil, :assert_raise,
              s(:const,
                s(:const, nil, :Timeout), :Error),
              s(:str, "[ruby-dev:32935]")),
            s(:args),
            s(:block,
              s(:send,
                s(:const, nil, :Timeout), :timeout,
                s(:float, 0.01)),
              s(:args),
              s(:send,
                s(:lvar, :q), :pop))))),
      s(:def, :test_timeout,
        s(:args),
        s(:block,
          s(:send, nil, :assert_raise,
            s(:const,
              s(:const, nil, :Timeout), :Error)),
          s(:args),
          s(:block,
            s(:send,
              s(:const, nil, :Timeout), :timeout,
              s(:float, 0.1)),
            s(:args),
            s(:while,
              s(:true),
              s(:nil))))),
      s(:def, :test_cannot_convert_into_time_interval,
        s(:args),
        s(:begin,
          s(:lvasgn, :bug3168,
            s(:str, "[ruby-dev:41010]")),
          s(:defs,
            s(:lvasgn, :n,
              s(:send,
                s(:const, nil, :Object), :new)), :zero?,
            s(:args),
            s(:false)),
          s(:block,
            s(:send, nil, :assert_raise,
              s(:const, nil, :TypeError),
              s(:lvar, :bug3168)),
            s(:args),
            s(:block,
              s(:send,
                s(:const, nil, :Timeout), :timeout,
                s(:lvar, :n)),
              s(:args),
              s(:send, nil, :sleep,
                s(:float, 0.1)))))),
      s(:def, :test_skip_rescue,
        s(:args),
        s(:begin,
          s(:lvasgn, :bug8730,
            s(:str, "[Bug #8730]")),
          s(:lvasgn, :e,
            s(:nil)),
          s(:block,
            s(:send, nil, :assert_raise_with_message,
              s(:const,
                s(:const, nil, :Timeout), :Error),
              s(:regexp,
                s(:str, "execution expired"),
                s(:regopt)),
              s(:lvar, :bug8730)),
            s(:args),
            s(:block,
              s(:send,
                s(:const, nil, :Timeout), :timeout,
                s(:float, 0.01)),
              s(:args),
              s(:kwbegin,
                s(:rescue,
                  s(:send, nil, :sleep,
                    s(:int, 3)),
                  s(:resbody,
                    s(:array,
                      s(:const, nil, :Exception)),
                    s(:lvasgn, :e), nil), nil)))),
          s(:send, nil, :assert_nil,
            s(:lvar, :e),
            s(:lvar, :bug8730)))),
      s(:def, :test_rescue_exit,
        s(:args),
        s(:begin,
          s(:lvasgn, :exc,
            s(:send,
              s(:const, nil, :Class), :new,
              s(:const, nil, :RuntimeError))),
          s(:lvasgn, :e,
            s(:nil)),
          s(:block,
            s(:send, nil, :assert_nothing_raised,
              s(:lvar, :exc)),
            s(:args),
            s(:block,
              s(:send,
                s(:const, nil, :Timeout), :timeout,
                s(:float, 0.01),
                s(:lvar, :exc)),
              s(:args),
              s(:kwbegin,
                s(:rescue,
                  s(:send, nil, :sleep,
                    s(:int, 3)),
                  s(:resbody,
                    s(:array,
                      s(:lvar, :exc)),
                    s(:lvasgn, :e), nil), nil)))),
          s(:block,
            s(:send, nil, :assert_raise_with_message,
              s(:lvar, :exc),
              s(:str, "execution expired")),
            s(:args),
            s(:if,
              s(:lvar, :e),
              s(:send, nil, :raise,
                s(:lvar, :e)), nil)))),
      s(:def, :test_custom_exception,
        s(:args),
        s(:begin,
          s(:lvasgn, :bug9354,
            s(:str, "[ruby-core:59511] [Bug #9354]")),
          s(:lvasgn, :err,
            s(:block,
              s(:send,
                s(:const, nil, :Class), :new,
                s(:const, nil, :StandardError)),
              s(:args),
              s(:def, :initialize,
                s(:args,
                  s(:arg, :msg)),
                s(:zsuper)))),
          s(:block,
            s(:send, nil, :assert_nothing_raised,
              s(:const, nil, :ArgumentError),
              s(:lvar, :bug9354)),
            s(:args),
            s(:send, nil, :assert_equal,
              s(:sym, :ok),
              s(:block,
                s(:send,
                  s(:const, nil, :Timeout), :timeout,
                  s(:int, 100),
                  s(:lvar, :err)),
                s(:args),
                s(:sym, :ok)))),
          s(:block,
            s(:send, nil, :assert_raise_with_message,
              s(:lvar, :err),
              s(:str, "execution expired")),
            s(:args),
            s(:block,
              s(:send,
                s(:const, nil, :Timeout), :timeout,
                s(:float, 0.01),
                s(:lvar, :err)),
              s(:args),
              s(:send, nil, :sleep,
                s(:int, 3)))))),
      s(:def, :test_exit_exception,
        s(:args),
        s(:block,
          s(:send, nil, :assert_raise_with_message,
            s(:const,
              s(:const, nil, :Timeout), :Error),
            s(:str, "boon")),
          s(:args),
          s(:block,
            s(:send,
              s(:const, nil, :Timeout), :timeout,
              s(:int, 10),
              s(:const,
                s(:const, nil, :Timeout), :Error)),
            s(:args),
            s(:send, nil, :raise,
              s(:const,
                s(:const, nil, :Timeout), :Error),
              s(:str, "boon"))))),
      s(:def, :test_enumerator_next,
        s(:args),
        s(:begin,
          s(:lvasgn, :bug9380,
            s(:str, "[ruby-dev:47872] [Bug #9380]: timeout in Enumerator#next")),
          s(:lvasgn, :e,
            s(:send,
              s(:begin,
                s(:lvasgn, :o,
                  s(:send,
                    s(:const, nil, :Object), :new))), :to_enum)),
          s(:defs,
            s(:lvar, :o), :each,
            s(:args),
            s(:send, nil, :sleep)),
          s(:block,
            s(:send, nil, :assert_raise_with_message,
              s(:const,
                s(:const, nil, :Timeout), :Error),
              s(:str, "execution expired"),
              s(:lvar, :bug9380)),
            s(:args),
            s(:block,
              s(:send,
                s(:const, nil, :Timeout), :timeout,
                s(:float, 0.01)),
              s(:args),
              s(:send,
                s(:lvar, :e), :next))))),
      s(:def, :test_handle_interrupt,
        s(:args),
        s(:begin,
          s(:lvasgn, :bug11344,
            s(:str, "[ruby-dev:49179] [Bug #11344]")),
          s(:lvasgn, :ok,
            s(:false)),
          s(:block,
            s(:send, nil, :assert_raise,
              s(:const,
                s(:const, nil, :Timeout), :Error)),
            s(:args),
            s(:block,
              s(:send,
                s(:const, nil, :Thread), :handle_interrupt,
                s(:hash,
                  s(:pair,
                    s(:const,
                      s(:const, nil, :Timeout), :Error),
                    s(:sym, :never)))),
              s(:args),
              s(:block,
                s(:send,
                  s(:const, nil, :Timeout), :timeout,
                  s(:float, 0.01)),
                s(:args),
                s(:begin,
                  s(:send, nil, :sleep,
                    s(:float, 0.2)),
                  s(:lvasgn, :ok,
                    s(:true)),
                  s(:block,
                    s(:send,
                      s(:const, nil, :Thread), :handle_interrupt,
                      s(:hash,
                        s(:pair,
                          s(:const,
                            s(:const, nil, :Timeout), :Error),
                          s(:sym, :on_blocking)))),
                    s(:args),
                    s(:send, nil, :sleep,
                      s(:float, 0.2))))))),
          s(:send, nil, :assert,
            s(:lvar, :ok),
            s(:lvar, :bug11344)))))))

s(:begin,
  s(:send, nil, :require_relative,
    s(:str, "helper")),
  s(:class,
    s(:const, nil, :PsychStructWithIvar),
    s(:send,
      s(:const, nil, :Struct), :new,
      s(:sym, :foo)),
    s(:begin,
      s(:send, nil, :attr_reader,
        s(:sym, :bar)),
      s(:def, :initialize,
        s(:args,
          s(:restarg, :args)),
        s(:begin,
          s(:zsuper),
          s(:ivasgn, :@bar,
            s(:str, "hello")))))),
  s(:module,
    s(:const, nil, :Psych),
    s(:class,
      s(:const, nil, :TestStruct),
      s(:const, nil, :TestCase),
      s(:begin,
        s(:class,
          s(:const, nil, :StructSubclass),
          s(:send,
            s(:const, nil, :Struct), :new,
            s(:sym, :foo)),
          s(:def, :initialize,
            s(:args,
              s(:arg, :foo),
              s(:arg, :bar)),
            s(:begin,
              s(:super,
                s(:lvar, :foo)),
              s(:ivasgn, :@bar,
                s(:lvar, :bar))))),
        s(:def, :test_self_referential_struct,
          s(:args),
          s(:begin,
            s(:lvasgn, :ss,
              s(:send,
                s(:const, nil, :StructSubclass), :new,
                s(:nil),
                s(:str, "foo"))),
            s(:send,
              s(:lvar, :ss), :foo=,
              s(:lvar, :ss)),
            s(:lvasgn, :loaded,
              s(:send,
                s(:const, nil, :Psych), :load,
                s(:send,
                  s(:const, nil, :Psych), :dump,
                  s(:lvar, :ss)))),
            s(:send, nil, :assert_instance_of,
              s(:const, nil, :StructSubclass),
              s(:send,
                s(:lvar, :loaded), :foo)),
            s(:send, nil, :assert_equal,
              s(:lvar, :ss),
              s(:lvar, :loaded)))),
        s(:def, :test_roundtrip,
          s(:args),
          s(:begin,
            s(:lvasgn, :thing,
              s(:send,
                s(:const, nil, :PsychStructWithIvar), :new,
                s(:str, "bar"))),
            s(:lvasgn, :struct,
              s(:send,
                s(:const, nil, :Psych), :load,
                s(:send,
                  s(:const, nil, :Psych), :dump,
                  s(:lvar, :thing)))),
            s(:send, nil, :assert_equal,
              s(:str, "hello"),
              s(:send,
                s(:lvar, :struct), :bar)),
            s(:send, nil, :assert_equal,
              s(:str, "bar"),
              s(:send,
                s(:lvar, :struct), :foo)))),
        s(:def, :test_load,
          s(:args),
          s(:begin,
            s(:lvasgn, :obj,
              s(:send,
                s(:const, nil, :Psych), :load,
                s(:dstr,
                  s(:str, "--- !ruby/struct:PsychStructWithIvar\n"),
                  s(:str, ":foo: bar\n"),
                  s(:str, ":@bar: hello\n")))),
            s(:send, nil, :assert_equal,
              s(:str, "hello"),
              s(:send,
                s(:lvar, :obj), :bar)),
            s(:send, nil, :assert_equal,
              s(:str, "bar"),
              s(:send,
                s(:lvar, :obj), :foo))))))))

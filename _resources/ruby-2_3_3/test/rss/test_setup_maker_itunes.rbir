s(:begin,
  s(:send, nil, :require_relative,
    s(:str, "rss-testcase")),
  s(:send, nil, :require,
    s(:str, "rss/maker")),
  s(:module,
    s(:const, nil, :RSS),
    s(:class,
      s(:const, nil, :TestSetupMakerITunes),
      s(:const, nil, :TestCase),
      s(:begin,
        s(:def, :test_setup_maker_simple,
          s(:args),
          s(:begin,
            s(:lvasgn, :author,
              s(:str, "John Doe")),
            s(:lvasgn, :block,
              s(:true)),
            s(:lvasgn, :categories,
              s(:array,
                s(:str, "Audio Blogs"))),
            s(:lvasgn, :image,
              s(:str, "http://example.com/podcasts/everything/AllAboutEverything.jpg")),
            s(:lvasgn, :duration,
              s(:str, "4:05")),
            s(:lvasgn, :duration_components,
              s(:array,
                s(:int, 0),
                s(:int, 4),
                s(:int, 5))),
            s(:lvasgn, :explicit,
              s(:true)),
            s(:lvasgn, :keywords,
              s(:array,
                s(:str, "salt"),
                s(:str, "pepper"),
                s(:str, "shaker"),
                s(:str, "exciting"))),
            s(:lvasgn, :owner,
              s(:hash,
                s(:pair,
                  s(:sym, :name),
                  s(:str, "John Doe")),
                s(:pair,
                  s(:sym, :email),
                  s(:str, "john.doe@example.com")))),
            s(:lvasgn, :subtitle,
              s(:str, "A show about everything")),
            s(:lvasgn, :summary,
              s(:send,
                s(:send,
                  s(:send,
                    s(:send,
                      s(:str, "All About Everything is a show about "), :+,
                      s(:str, "everything. Each week we dive into any ")), :+,
                    s(:str, "subject known to man and talk about it ")), :+,
                  s(:str, "as much as we can. Look for our Podcast ")), :+,
                s(:str, "in the iTunes Music Store"))),
            s(:lvasgn, :feed,
              s(:block,
                s(:send,
                  s(:const,
                    s(:const, nil, :RSS), :Maker), :make,
                  s(:str, "rss2.0")),
                s(:args,
                  s(:arg, :maker)),
                s(:begin,
                  s(:send, nil, :setup_dummy_channel,
                    s(:lvar, :maker)),
                  s(:send, nil, :setup_dummy_item,
                    s(:lvar, :maker)),
                  s(:lvasgn, :channel,
                    s(:send,
                      s(:lvar, :maker), :channel)),
                  s(:send,
                    s(:lvar, :channel), :itunes_author=,
                    s(:lvar, :author)),
                  s(:send,
                    s(:lvar, :channel), :itunes_block=,
                    s(:lvar, :block)),
                  s(:block,
                    s(:send,
                      s(:lvar, :categories), :each),
                    s(:args,
                      s(:arg, :category)),
                    s(:send,
                      s(:send,
                        s(:send,
                          s(:lvar, :channel), :itunes_categories), :new_category), :text=,
                      s(:lvar, :category))),
                  s(:send,
                    s(:lvar, :channel), :itunes_image=,
                    s(:lvar, :image)),
                  s(:send,
                    s(:lvar, :channel), :itunes_explicit=,
                    s(:lvar, :explicit)),
                  s(:send,
                    s(:lvar, :channel), :itunes_keywords=,
                    s(:lvar, :keywords)),
                  s(:send,
                    s(:send,
                      s(:lvar, :channel), :itunes_owner), :itunes_name=,
                    s(:send,
                      s(:lvar, :owner), :[],
                      s(:sym, :name))),
                  s(:send,
                    s(:send,
                      s(:lvar, :channel), :itunes_owner), :itunes_email=,
                    s(:send,
                      s(:lvar, :owner), :[],
                      s(:sym, :email))),
                  s(:send,
                    s(:lvar, :channel), :itunes_subtitle=,
                    s(:lvar, :subtitle)),
                  s(:send,
                    s(:lvar, :channel), :itunes_summary=,
                    s(:lvar, :summary)),
                  s(:lvasgn, :item,
                    s(:send,
                      s(:send,
                        s(:lvar, :maker), :items), :last)),
                  s(:send,
                    s(:lvar, :item), :itunes_author=,
                    s(:lvar, :author)),
                  s(:send,
                    s(:lvar, :item), :itunes_block=,
                    s(:lvar, :block)),
                  s(:send,
                    s(:lvar, :item), :itunes_duration=,
                    s(:lvar, :duration)),
                  s(:send,
                    s(:lvar, :item), :itunes_explicit=,
                    s(:lvar, :explicit)),
                  s(:send,
                    s(:lvar, :item), :itunes_keywords=,
                    s(:lvar, :keywords)),
                  s(:send,
                    s(:lvar, :item), :itunes_subtitle=,
                    s(:lvar, :subtitle)),
                  s(:send,
                    s(:lvar, :item), :itunes_summary=,
                    s(:lvar, :summary))))),
            s(:send, nil, :assert_not_nil,
              s(:lvar, :feed)),
            s(:lvasgn, :new_feed,
              s(:block,
                s(:send,
                  s(:const,
                    s(:const, nil, :RSS), :Maker), :make,
                  s(:str, "rss2.0")),
                s(:args,
                  s(:arg, :maker)),
                s(:send,
                  s(:lvar, :feed), :setup_maker,
                  s(:lvar, :maker)))),
            s(:send, nil, :assert_not_nil,
              s(:lvar, :new_feed)),
            s(:lvasgn, :channel,
              s(:send,
                s(:lvar, :new_feed), :channel)),
            s(:lvasgn, :item,
              s(:send,
                s(:send,
                  s(:lvar, :new_feed), :items), :last)),
            s(:send, nil, :assert_equal,
              s(:lvar, :author),
              s(:send,
                s(:lvar, :channel), :itunes_author)),
            s(:send, nil, :assert_equal,
              s(:lvar, :author),
              s(:send,
                s(:lvar, :item), :itunes_author)),
            s(:send, nil, :assert_equal,
              s(:lvar, :block),
              s(:send,
                s(:lvar, :channel), :itunes_block?)),
            s(:send, nil, :assert_equal,
              s(:lvar, :block),
              s(:send,
                s(:lvar, :item), :itunes_block?)),
            s(:send, nil, :assert_equal,
              s(:lvar, :categories),
              s(:send, nil, :collect_itunes_categories,
                s(:send,
                  s(:lvar, :channel), :itunes_categories))),
            s(:send, nil, :assert_equal,
              s(:lvar, :image),
              s(:send,
                s(:send,
                  s(:lvar, :channel), :itunes_image), :href)),
            s(:send, nil, :assert_equal,
              s(:lvar, :duration_components),
              s(:array,
                s(:send,
                  s(:send,
                    s(:lvar, :item), :itunes_duration), :hour),
                s(:send,
                  s(:send,
                    s(:lvar, :item), :itunes_duration), :minute),
                s(:send,
                  s(:send,
                    s(:lvar, :item), :itunes_duration), :second))),
            s(:send, nil, :assert_equal,
              s(:lvar, :explicit),
              s(:send,
                s(:lvar, :channel), :itunes_explicit?)),
            s(:send, nil, :assert_equal,
              s(:lvar, :explicit),
              s(:send,
                s(:lvar, :item), :itunes_explicit?)),
            s(:send, nil, :assert_equal,
              s(:lvar, :keywords),
              s(:send,
                s(:lvar, :channel), :itunes_keywords)),
            s(:send, nil, :assert_equal,
              s(:lvar, :keywords),
              s(:send,
                s(:lvar, :item), :itunes_keywords)),
            s(:send, nil, :assert_equal,
              s(:lvar, :owner),
              s(:hash,
                s(:pair,
                  s(:sym, :name),
                  s(:send,
                    s(:send,
                      s(:lvar, :channel), :itunes_owner), :itunes_name)),
                s(:pair,
                  s(:sym, :email),
                  s(:send,
                    s(:send,
                      s(:lvar, :channel), :itunes_owner), :itunes_email)))),
            s(:send, nil, :assert_equal,
              s(:lvar, :subtitle),
              s(:send,
                s(:lvar, :channel), :itunes_subtitle)),
            s(:send, nil, :assert_equal,
              s(:lvar, :subtitle),
              s(:send,
                s(:lvar, :item), :itunes_subtitle)),
            s(:send, nil, :assert_equal,
              s(:lvar, :summary),
              s(:send,
                s(:lvar, :channel), :itunes_summary)),
            s(:send, nil, :assert_equal,
              s(:lvar, :summary),
              s(:send,
                s(:lvar, :item), :itunes_summary)))),
        s(:def, :test_setup_maker_with_nested_categories,
          s(:args),
          s(:begin,
            s(:lvasgn, :categories,
              s(:array,
                s(:array,
                  s(:str, "Arts & Entertainment"),
                  s(:str, "Games")),
                s(:array,
                  s(:str, "Technology"),
                  s(:str, "Computers")),
                s(:str, "Audio Blogs"))),
            s(:lvasgn, :feed,
              s(:block,
                s(:send,
                  s(:const,
                    s(:const, nil, :RSS), :Maker), :make,
                  s(:str, "rss2.0")),
                s(:args,
                  s(:arg, :maker)),
                s(:begin,
                  s(:send, nil, :setup_dummy_channel,
                    s(:lvar, :maker)),
                  s(:send, nil, :setup_dummy_item,
                    s(:lvar, :maker)),
                  s(:lvasgn, :channel,
                    s(:send,
                      s(:lvar, :maker), :channel)),
                  s(:block,
                    s(:send,
                      s(:lvar, :categories), :each),
                    s(:args,
                      s(:arg, :category)),
                    s(:begin,
                      s(:lvasgn, :target,
                        s(:send,
                          s(:lvar, :channel), :itunes_categories)),
                      s(:if,
                        s(:send,
                          s(:lvar, :category), :is_a?,
                          s(:const, nil, :Array)),
                        s(:block,
                          s(:send,
                            s(:lvar, :category), :each),
                          s(:args,
                            s(:arg, :sub_category)),
                          s(:begin,
                            s(:lvasgn, :target,
                              s(:send,
                                s(:lvar, :target), :new_category)),
                            s(:send,
                              s(:lvar, :target), :text=,
                              s(:lvar, :sub_category)))),
                        s(:send,
                          s(:send,
                            s(:lvar, :target), :new_category), :text=,
                          s(:lvar, :category)))))))),
            s(:send, nil, :assert_not_nil,
              s(:lvar, :feed)),
            s(:lvasgn, :new_feed,
              s(:block,
                s(:send,
                  s(:const,
                    s(:const, nil, :RSS), :Maker), :make,
                  s(:str, "rss2.0")),
                s(:args,
                  s(:arg, :maker)),
                s(:send,
                  s(:lvar, :feed), :setup_maker,
                  s(:lvar, :maker)))),
            s(:send, nil, :assert_not_nil,
              s(:lvar, :new_feed)),
            s(:lvasgn, :channel,
              s(:send,
                s(:lvar, :new_feed), :channel)),
            s(:send, nil, :assert_equal,
              s(:lvar, :categories),
              s(:send, nil, :collect_itunes_categories,
                s(:send,
                  s(:lvar, :channel), :itunes_categories))))),
        s(:send, nil, :private),
        s(:def, :collect_itunes_categories,
          s(:args,
            s(:arg, :categories)),
          s(:block,
            s(:send,
              s(:lvar, :categories), :collect),
            s(:args,
              s(:arg, :c)),
            s(:begin,
              s(:lvasgn, :rest,
                s(:send, nil, :collect_itunes_categories,
                  s(:send,
                    s(:lvar, :c), :itunes_categories))),
              s(:if,
                s(:send,
                  s(:lvar, :rest), :empty?),
                s(:send,
                  s(:lvar, :c), :text),
                s(:array,
                  s(:send,
                    s(:lvar, :c), :text),
                  s(:splat,
                    s(:lvar, :rest)))))))))))

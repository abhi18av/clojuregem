s(:begin,
  s(:send, nil, :require_relative,
    s(:str, "rss-testcase")),
  s(:send, nil, :require,
    s(:str, "rss/maker")),
  s(:module,
    s(:const, nil, :RSS),
    s(:class,
      s(:const, nil, :TestMakerTaxonomy),
      s(:const, nil, :TestCase),
      s(:begin,
        s(:def, :setup,
          s(:args),
          s(:begin,
            s(:ivasgn, :@uri,
              s(:str, "http://purl.org/rss/1.0/modules/taxonomy/")),
            s(:ivasgn, :@resources,
              s(:array,
                s(:str, "http://meerkat.oreillynet.com/?c=cat23"),
                s(:str, "http://meerkat.oreillynet.com/?c=47"),
                s(:str, "http://dmoz.org/Computers/Data_Formats/Markup_Languages/XML/"))),
            s(:ivasgn, :@topics,
              s(:array,
                s(:hash,
                  s(:pair,
                    s(:sym, :link),
                    s(:str, "http://meerkat.oreillynet.com/?c=cat23")),
                  s(:pair,
                    s(:sym, :title),
                    s(:str, "Data: XML")),
                  s(:pair,
                    s(:sym, :description),
                    s(:str, "A Meerkat channel"))),
                s(:hash,
                  s(:pair,
                    s(:sym, :link),
                    s(:str, "http://dmoz.org/Computers/Data_Formats/Markup_Languages/XML/")),
                  s(:pair,
                    s(:sym, :title),
                    s(:str, "XML")),
                  s(:pair,
                    s(:sym, :subject),
                    s(:str, "XML")),
                  s(:pair,
                    s(:sym, :description),
                    s(:str, "DMOZ category")),
                  s(:pair,
                    s(:sym, :topics),
                    s(:array,
                      s(:str, "http://meerkat.oreillynet.com/?c=cat23"),
                      s(:str, "http://dmoz.org/Computers/Data_Formats/Markup_Languages/SGML/"),
                      s(:str, "http://dmoz.org/Computers/Programming/Internet/")))))))),
        s(:def, :test_rss10,
          s(:args),
          s(:begin,
            s(:lvasgn, :rss,
              s(:block,
                s(:send,
                  s(:const,
                    s(:const, nil, :RSS), :Maker), :make,
                  s(:str, "1.0")),
                s(:args,
                  s(:arg, :maker)),
                s(:begin,
                  s(:send, nil, :setup_dummy_channel,
                    s(:lvar, :maker)),
                  s(:send, nil, :set_topics,
                    s(:send,
                      s(:lvar, :maker), :channel)),
                  s(:send, nil, :setup_dummy_item,
                    s(:lvar, :maker)),
                  s(:send, nil, :set_topics,
                    s(:send,
                      s(:send,
                        s(:lvar, :maker), :items), :last)),
                  s(:send, nil, :setup_taxo_topic,
                    s(:lvar, :maker),
                    s(:ivar, :@topics))))),
            s(:send, nil, :assert_equal,
              s(:ivar, :@resources),
              s(:send,
                s(:send,
                  s(:send,
                    s(:lvar, :rss), :channel), :taxo_topics), :resources)),
            s(:send, nil, :assert_equal,
              s(:ivar, :@resources),
              s(:send,
                s(:send,
                  s(:send,
                    s(:send,
                      s(:lvar, :rss), :items), :last), :taxo_topics), :resources)),
            s(:send, nil, :assert_taxo_topic,
              s(:ivar, :@topics),
              s(:lvar, :rss)))),
        s(:def, :_test_date,
          s(:args),
          s(:begin,
            s(:lvasgn, :t1,
              s(:send,
                s(:const, nil, :Time), :iso8601,
                s(:str, "2000-01-01T12:00:05+00:00"))),
            s(:lvasgn, :t2,
              s(:send,
                s(:const, nil, :Time), :iso8601,
                s(:str, "2005-01-01T12:00:05+00:00"))),
            s(:lvasgn, :rss,
              s(:block,
                s(:send,
                  s(:const,
                    s(:const, nil, :RSS), :Maker), :make,
                  s(:str, "1.0")),
                s(:args,
                  s(:arg, :maker)),
                s(:begin,
                  s(:send, nil, :setup_dummy_channel,
                    s(:lvar, :maker)),
                  s(:send,
                    s(:send,
                      s(:lvar, :maker), :channel), :date=,
                    s(:lvar, :t1)),
                  s(:block,
                    s(:send,
                      s(:send,
                        s(:send,
                          s(:lvar, :maker), :channel), :dc_dates), :new_date),
                    s(:args,
                      s(:arg, :date)),
                    s(:send,
                      s(:lvar, :date), :value=,
                      s(:lvar, :t2))),
                  s(:send, nil, :setup_dummy_item,
                    s(:lvar, :maker)),
                  s(:lvasgn, :item,
                    s(:send,
                      s(:send,
                        s(:lvar, :maker), :items), :last)),
                  s(:send,
                    s(:lvar, :item), :date=,
                    s(:lvar, :t2)),
                  s(:block,
                    s(:send,
                      s(:send,
                        s(:lvar, :item), :dc_dates), :new_date),
                    s(:args,
                      s(:arg, :date)),
                    s(:send,
                      s(:lvar, :date), :value=,
                      s(:lvar, :t1)))))),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:lvar, :t1),
                s(:lvar, :t2)),
              s(:block,
                s(:send,
                  s(:send,
                    s(:send,
                      s(:lvar, :rss), :channel), :dc_dates), :collect),
                s(:args,
                  s(:arg, :x)),
                s(:send,
                  s(:lvar, :x), :value))),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:lvar, :t2),
                s(:lvar, :t1)),
              s(:block,
                s(:send,
                  s(:send,
                    s(:send,
                      s(:send,
                        s(:lvar, :rss), :items), :last), :dc_dates), :collect),
                s(:args,
                  s(:arg, :x)),
                s(:send,
                  s(:lvar, :x), :value))))),
        s(:send, nil, :private),
        s(:def, :set_topics,
          s(:args,
            s(:arg, :target),
            s(:optarg, :resources,
              s(:ivar, :@resources))),
          s(:block,
            s(:send,
              s(:lvar, :resources), :each),
            s(:args,
              s(:arg, :value)),
            s(:send,
              s(:send,
                s(:lvar, :target), :taxo_topics), :<<,
              s(:lvar, :value))))))))

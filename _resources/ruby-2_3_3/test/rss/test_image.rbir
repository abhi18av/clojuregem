s(:begin,
  s(:send, nil, :require,
    s(:str, "cgi")),
  s(:send, nil, :require,
    s(:str, "rexml/document")),
  s(:send, nil, :require_relative,
    s(:str, "rss-testcase")),
  s(:send, nil, :require,
    s(:str, "rss/1.0")),
  s(:send, nil, :require,
    s(:str, "rss/image")),
  s(:module,
    s(:const, nil, :RSS),
    s(:class,
      s(:const, nil, :TestImage),
      s(:const, nil, :TestCase),
      s(:begin,
        s(:def, :setup,
          s(:args),
          s(:begin,
            s(:ivasgn, :@prefix,
              s(:str, "image")),
            s(:ivasgn, :@uri,
              s(:str, "http://purl.org/rss/1.0/modules/image/")),
            s(:ivasgn, :@favicon_attrs,
              s(:hash,
                s(:pair,
                  s(:str, "rdf:about"),
                  s(:str, "http://www.kuro5hin.org/favicon.ico")),
                s(:pair,
                  s(:dstr,
                    s(:begin,
                      s(:ivar, :@prefix)),
                    s(:str, ":size")),
                  s(:str, "small")))),
            s(:ivasgn, :@favicon_contents,
              s(:hash,
                s(:pair,
                  s(:str, "dc:title"),
                  s(:str, "Kuro5hin")))),
            s(:ivasgn, :@items,
              s(:array,
                s(:array,
                  s(:hash,
                    s(:pair,
                      s(:str, "rdf:about"),
                      s(:str, "http://www.example.org/item.png")),
                    s(:pair,
                      s(:str, "rdf:resource"),
                      s(:str, "http://www.example.org/item"))),
                  s(:hash,
                    s(:pair,
                      s(:str, "dc:title"),
                      s(:str, "Example Image")),
                    s(:pair,
                      s(:dstr,
                        s(:begin,
                          s(:ivar, :@prefix)),
                        s(:str, ":width")),
                      s(:str, "100")),
                    s(:pair,
                      s(:dstr,
                        s(:begin,
                          s(:ivar, :@prefix)),
                        s(:str, ":height")),
                      s(:str, "65")))),
                s(:array,
                  s(:hash,
                    s(:pair,
                      s(:str, "rdf:about"),
                      s(:str, "http://www.kuro5hin.org/images/topics/culture.jpg"))),
                  s(:hash,
                    s(:pair,
                      s(:str, "dc:title"),
                      s(:str, "Culture")),
                    s(:pair,
                      s(:dstr,
                        s(:begin,
                          s(:ivar, :@prefix)),
                        s(:str, ":width")),
                      s(:str, "80")),
                    s(:pair,
                      s(:dstr,
                        s(:begin,
                          s(:ivar, :@prefix)),
                        s(:str, ":height")),
                      s(:str, "50")))))),
            s(:ivasgn, :@channel_nodes,
              s(:send, nil, :make_element,
                s(:dstr,
                  s(:begin,
                    s(:ivar, :@prefix)),
                  s(:str, ":favicon")),
                s(:ivar, :@favicon_attrs),
                s(:ivar, :@favicon_contents))),
            s(:lvasgn, :items,
              s(:str, "")),
            s(:block,
              s(:send,
                s(:ivar, :@items), :each),
              s(:args,
                s(:arg, :attrs),
                s(:arg, :contents)),
              s(:begin,
                s(:lvasgn, :image_item,
                  s(:send, nil, :make_element,
                    s(:dstr,
                      s(:begin,
                        s(:ivar, :@prefix)),
                      s(:str, ":item")),
                    s(:lvar, :attrs),
                    s(:lvar, :contents))),
                s(:send,
                  s(:lvar, :items), :<<,
                  s(:send, nil, :make_item,
                    s(:lvar, :image_item))))),
            s(:ivasgn, :@ns,
              s(:hash,
                s(:pair,
                  s(:ivar, :@prefix),
                  s(:ivar, :@uri)),
                s(:pair,
                  s(:const, nil, :DC_PREFIX),
                  s(:const, nil, :DC_URI)))),
            s(:ivasgn, :@rss_source,
              s(:send, nil, :make_RDF,
                s(:dstr,
                  s(:begin,
                    s(:send, nil, :make_channel,
                      s(:ivar, :@channel_nodes))),
                  s(:str, "\n"),
                  s(:begin,
                    s(:send, nil, :make_image)),
                  s(:str, "\n"),
                  s(:begin,
                    s(:lvar, :items)),
                  s(:str, "\n"),
                  s(:begin,
                    s(:send, nil, :make_textinput)),
                  s(:str, "\n")),
                s(:ivar, :@ns))),
            s(:ivasgn, :@rss,
              s(:send,
                s(:const, nil, :Parser), :parse,
                s(:ivar, :@rss_source))))),
        s(:def, :test_parser,
          s(:args),
          s(:begin,
            s(:block,
              s(:send, nil, :assert_nothing_raised),
              s(:args),
              s(:send,
                s(:const, nil, :Parser), :parse,
                s(:ivar, :@rss_source))),
            s(:block,
              s(:send, nil, :assert_too_much_tag,
                s(:str, "favicon"),
                s(:str, "channel")),
              s(:args),
              s(:send,
                s(:const, nil, :Parser), :parse,
                s(:send, nil, :make_RDF,
                  s(:dstr,
                    s(:begin,
                      s(:send, nil, :make_channel,
                        s(:send,
                          s(:ivar, :@channel_nodes), :*,
                          s(:int, 2)))),
                    s(:str, "\n"),
                    s(:begin,
                      s(:send, nil, :make_item)),
                    s(:str, "\n")),
                  s(:ivar, :@ns)))),
            s(:lvasgn, :attrs,
              s(:hash,
                s(:pair,
                  s(:str, "rdf:about"),
                  s(:str, "http://www.example.org/item.png")))),
            s(:lvasgn, :contents,
              s(:send,
                s(:array,
                  s(:array,
                    s(:dstr,
                      s(:begin,
                        s(:ivar, :@prefix)),
                      s(:str, ":width")),
                    s(:str, "80"))), :*,
                s(:int, 5))),
            s(:lvasgn, :image_item,
              s(:send, nil, :make_element,
                s(:dstr,
                  s(:begin,
                    s(:ivar, :@prefix)),
                  s(:str, ":item")),
                s(:lvar, :attrs),
                s(:lvar, :contents))),
            s(:block,
              s(:send, nil, :assert_too_much_tag,
                s(:str, "width"),
                s(:str, "item")),
              s(:args),
              s(:send,
                s(:const, nil, :Parser), :parse,
                s(:send, nil, :make_RDF,
                  s(:dstr,
                    s(:begin,
                      s(:send, nil, :make_channel)),
                    s(:str, "\n"),
                    s(:begin,
                      s(:send, nil, :make_item,
                        s(:lvar, :image_item))),
                    s(:str, "\n")),
                  s(:ivar, :@ns)))))),
        s(:def, :test_favicon_accessor,
          s(:args),
          s(:begin,
            s(:lvasgn, :favicon,
              s(:send,
                s(:send,
                  s(:ivar, :@rss), :channel), :image_favicon)),
            s(:block,
              s(:send,
                s(:array,
                  s(:array,
                    s(:str, "about"),
                    s(:str, "rdf:about"),
                    s(:str, "http://example.com/favicon.ico")),
                  s(:array,
                    s(:str, "size"),
                    s(:str, "image:size"),
                    s(:str, "large")),
                  s(:array,
                    s(:str, "image_size"),
                    s(:str, "image:size"),
                    s(:str, "medium"))), :each),
              s(:args,
                s(:arg, :name),
                s(:arg, :full_name),
                s(:arg, :new_value)),
              s(:begin,
                s(:send, nil, :assert_equal,
                  s(:send,
                    s(:ivar, :@favicon_attrs), :[],
                    s(:lvar, :full_name)),
                  s(:send,
                    s(:lvar, :favicon), :__send__,
                    s(:lvar, :name))),
                s(:send,
                  s(:lvar, :favicon), :__send__,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :name)),
                    s(:str, "=")),
                  s(:lvar, :new_value)),
                s(:send, nil, :assert_equal,
                  s(:lvar, :new_value),
                  s(:send,
                    s(:lvar, :favicon), :__send__,
                    s(:lvar, :name))),
                s(:send,
                  s(:lvar, :favicon), :__send__,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :name)),
                    s(:str, "=")),
                  s(:send,
                    s(:ivar, :@favicon_attrs), :[],
                    s(:lvar, :full_name))),
                s(:send, nil, :assert_equal,
                  s(:send,
                    s(:ivar, :@favicon_attrs), :[],
                    s(:lvar, :full_name)),
                  s(:send,
                    s(:lvar, :favicon), :__send__,
                    s(:lvar, :name))))),
            s(:block,
              s(:send,
                s(:array,
                  s(:str, "small"),
                  s(:str, "medium"),
                  s(:str, "large")), :each),
              s(:args,
                s(:arg, :value)),
              s(:block,
                s(:send, nil, :assert_nothing_raised),
                s(:args),
                s(:begin,
                  s(:send,
                    s(:lvar, :favicon), :size=,
                    s(:lvar, :value)),
                  s(:send,
                    s(:lvar, :favicon), :image_size=,
                    s(:lvar, :value))))),
            s(:block,
              s(:send,
                s(:array,
                  s(:str, "aaa"),
                  s(:str, "AAA"),
                  s(:str, "SMALL"),
                  s(:str, "MEDIUM"),
                  s(:str, "LARGE")), :each),
              s(:args,
                s(:arg, :value)),
              s(:begin,
                s(:lvasgn, :args,
                  s(:array,
                    s(:dstr,
                      s(:begin,
                        s(:ivar, :@prefix)),
                      s(:str, ":favicon")),
                    s(:lvar, :value),
                    s(:dstr,
                      s(:begin,
                        s(:ivar, :@prefix)),
                      s(:str, ":size")))),
                s(:block,
                  s(:send, nil, :assert_not_available_value,
                    s(:splat,
                      s(:lvar, :args))),
                  s(:args),
                  s(:send,
                    s(:lvar, :favicon), :size=,
                    s(:lvar, :value))),
                s(:block,
                  s(:send, nil, :assert_not_available_value,
                    s(:splat,
                      s(:lvar, :args))),
                  s(:args),
                  s(:send,
                    s(:lvar, :favicon), :image_size=,
                    s(:lvar, :value))))),
            s(:block,
              s(:send,
                s(:array,
                  s(:array,
                    s(:str, "dc_title"),
                    s(:str, "dc:title"),
                    s(:str, "sample-favicon"))), :each),
              s(:args,
                s(:arg, :name),
                s(:arg, :full_name),
                s(:arg, :new_value)),
              s(:begin,
                s(:send, nil, :assert_equal,
                  s(:send,
                    s(:ivar, :@favicon_contents), :[],
                    s(:lvar, :full_name)),
                  s(:send,
                    s(:lvar, :favicon), :__send__,
                    s(:lvar, :name))),
                s(:send,
                  s(:lvar, :favicon), :__send__,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :name)),
                    s(:str, "=")),
                  s(:lvar, :new_value)),
                s(:send, nil, :assert_equal,
                  s(:lvar, :new_value),
                  s(:send,
                    s(:lvar, :favicon), :__send__,
                    s(:lvar, :name))),
                s(:send,
                  s(:lvar, :favicon), :__send__,
                  s(:dstr,
                    s(:begin,
                      s(:lvar, :name)),
                    s(:str, "=")),
                  s(:send,
                    s(:ivar, :@favicon_contents), :[],
                    s(:lvar, :full_name))),
                s(:send, nil, :assert_equal,
                  s(:send,
                    s(:ivar, :@favicon_contents), :[],
                    s(:lvar, :full_name)),
                  s(:send,
                    s(:lvar, :favicon), :__send__,
                    s(:lvar, :name))))))),
        s(:def, :test_item_accessor,
          s(:args),
          s(:block,
            s(:send,
              s(:send,
                s(:ivar, :@rss), :items), :each_with_index),
            s(:args,
              s(:arg, :item),
              s(:arg, :i)),
            s(:begin,
              s(:lvasgn, :image_item,
                s(:send,
                  s(:lvar, :item), :image_item)),
              s(:masgn,
                s(:mlhs,
                  s(:lvasgn, :attrs),
                  s(:lvasgn, :contents)),
                s(:send,
                  s(:ivar, :@items), :[],
                  s(:lvar, :i))),
              s(:block,
                s(:send,
                  s(:array,
                    s(:array,
                      s(:str, "about"),
                      s(:str, "rdf:about"),
                      s(:str, "http://example.com/image.png")),
                    s(:array,
                      s(:str, "resource"),
                      s(:str, "rdf:resource"),
                      s(:str, "http://example.com/"))), :each),
                s(:args,
                  s(:arg, :name),
                  s(:arg, :full_name),
                  s(:arg, :new_value)),
                s(:begin,
                  s(:send, nil, :assert_equal,
                    s(:send,
                      s(:lvar, :attrs), :[],
                      s(:lvar, :full_name)),
                    s(:send,
                      s(:lvar, :image_item), :__send__,
                      s(:lvar, :name))),
                  s(:send,
                    s(:lvar, :image_item), :__send__,
                    s(:dstr,
                      s(:begin,
                        s(:lvar, :name)),
                      s(:str, "=")),
                    s(:lvar, :new_value)),
                  s(:send, nil, :assert_equal,
                    s(:lvar, :new_value),
                    s(:send,
                      s(:lvar, :image_item), :__send__,
                      s(:lvar, :name))),
                  s(:send,
                    s(:lvar, :image_item), :__send__,
                    s(:dstr,
                      s(:begin,
                        s(:lvar, :name)),
                      s(:str, "=")),
                    s(:send,
                      s(:lvar, :attrs), :[],
                      s(:lvar, :full_name))),
                  s(:send, nil, :assert_equal,
                    s(:send,
                      s(:lvar, :attrs), :[],
                      s(:lvar, :full_name)),
                    s(:send,
                      s(:lvar, :image_item), :__send__,
                      s(:lvar, :name))))),
              s(:block,
                s(:send,
                  s(:array,
                    s(:array,
                      s(:str, "width"),
                      s(:str, "image:width"),
                      s(:str, "111")),
                    s(:array,
                      s(:str, "image_width"),
                      s(:str, "image:width"),
                      s(:str, "44")),
                    s(:array,
                      s(:str, "height"),
                      s(:str, "image:height"),
                      s(:str, "222")),
                    s(:array,
                      s(:str, "image_height"),
                      s(:str, "image:height"),
                      s(:str, "88"))), :each),
                s(:args,
                  s(:arg, :name),
                  s(:arg, :full_name),
                  s(:arg, :new_value)),
                s(:begin,
                  s(:send, nil, :assert_equal,
                    s(:send,
                      s(:send,
                        s(:lvar, :contents), :[],
                        s(:lvar, :full_name)), :to_i),
                    s(:send,
                      s(:lvar, :image_item), :__send__,
                      s(:lvar, :name))),
                  s(:send,
                    s(:lvar, :image_item), :__send__,
                    s(:dstr,
                      s(:begin,
                        s(:lvar, :name)),
                      s(:str, "=")),
                    s(:lvar, :new_value)),
                  s(:send, nil, :assert_equal,
                    s(:send,
                      s(:lvar, :new_value), :to_i),
                    s(:send,
                      s(:lvar, :image_item), :__send__,
                      s(:lvar, :name))),
                  s(:send,
                    s(:lvar, :image_item), :__send__,
                    s(:dstr,
                      s(:begin,
                        s(:lvar, :name)),
                      s(:str, "=")),
                    s(:send,
                      s(:lvar, :contents), :[],
                      s(:lvar, :full_name))),
                  s(:send, nil, :assert_equal,
                    s(:send,
                      s(:send,
                        s(:lvar, :contents), :[],
                        s(:lvar, :full_name)), :to_i),
                    s(:send,
                      s(:lvar, :image_item), :__send__,
                      s(:lvar, :name))))),
              s(:block,
                s(:send,
                  s(:array,
                    s(:array,
                      s(:str, "dc_title"),
                      s(:str, "dc:title"),
                      s(:str, "sample-image"))), :each),
                s(:args,
                  s(:arg, :name),
                  s(:arg, :full_name),
                  s(:arg, :new_value)),
                s(:begin,
                  s(:send, nil, :assert_equal,
                    s(:send,
                      s(:lvar, :contents), :[],
                      s(:lvar, :full_name)),
                    s(:send,
                      s(:lvar, :image_item), :__send__,
                      s(:lvar, :name))),
                  s(:send,
                    s(:lvar, :image_item), :__send__,
                    s(:dstr,
                      s(:begin,
                        s(:lvar, :name)),
                      s(:str, "=")),
                    s(:lvar, :new_value)),
                  s(:send, nil, :assert_equal,
                    s(:lvar, :new_value),
                    s(:send,
                      s(:lvar, :image_item), :__send__,
                      s(:lvar, :name))),
                  s(:send,
                    s(:lvar, :image_item), :__send__,
                    s(:dstr,
                      s(:begin,
                        s(:lvar, :name)),
                      s(:str, "=")),
                    s(:send,
                      s(:lvar, :contents), :[],
                      s(:lvar, :full_name))),
                  s(:send, nil, :assert_equal,
                    s(:send,
                      s(:lvar, :contents), :[],
                      s(:lvar, :full_name)),
                    s(:send,
                      s(:lvar, :image_item), :__send__,
                      s(:lvar, :name)))))))),
        s(:def, :test_favicon_to_s,
          s(:args),
          s(:begin,
            s(:lvasgn, :favicon,
              s(:send,
                s(:send,
                  s(:ivar, :@rss), :channel), :image_favicon)),
            s(:lvasgn, :expected_xml,
              s(:send, nil, :image_xmlns_container,
                s(:send, nil, :make_element,
                  s(:dstr,
                    s(:begin,
                      s(:ivar, :@prefix)),
                    s(:str, ":favicon")),
                  s(:ivar, :@favicon_attrs),
                  s(:ivar, :@favicon_contents)))),
            s(:lvasgn, :expected,
              s(:send,
                s(:const,
                  s(:const, nil, :REXML), :Document), :new,
                s(:lvar, :expected_xml))),
            s(:lvasgn, :actual_xml,
              s(:send, nil, :image_xmlns_container,
                s(:send,
                  s(:lvar, :favicon), :to_s,
                  s(:false),
                  s(:str, "")))),
            s(:lvasgn, :actual,
              s(:send,
                s(:const,
                  s(:const, nil, :REXML), :Document), :new,
                s(:lvar, :actual_xml))),
            s(:send, nil, :assert_equal,
              s(:send,
                s(:lvar, :expected), :to_s),
              s(:send,
                s(:lvar, :actual), :to_s)))),
        s(:def, :test_item_to_s,
          s(:args),
          s(:block,
            s(:send,
              s(:send,
                s(:ivar, :@rss), :items), :each_with_index),
            s(:args,
              s(:arg, :item),
              s(:arg, :i)),
            s(:begin,
              s(:masgn,
                s(:mlhs,
                  s(:lvasgn, :attrs),
                  s(:lvasgn, :contents)),
                s(:send,
                  s(:ivar, :@items), :[],
                  s(:lvar, :i))),
              s(:lvasgn, :expected_xml,
                s(:send, nil, :make_element,
                  s(:dstr,
                    s(:begin,
                      s(:ivar, :@prefix)),
                    s(:str, ":item")),
                  s(:lvar, :attrs),
                  s(:lvar, :contents))),
              s(:lvasgn, :expected_xml,
                s(:send, nil, :image_xmlns_container,
                  s(:lvar, :expected_xml))),
              s(:lvasgn, :expected,
                s(:send,
                  s(:const,
                    s(:const, nil, :REXML), :Document), :new,
                  s(:lvar, :expected_xml))),
              s(:lvasgn, :actual_xml,
                s(:send, nil, :image_xmlns_container,
                  s(:send,
                    s(:send,
                      s(:lvar, :item), :image_item), :to_s,
                    s(:false),
                    s(:str, "")))),
              s(:lvasgn, :actual,
                s(:send,
                  s(:const,
                    s(:const, nil, :REXML), :Document), :new,
                  s(:lvar, :actual_xml))),
              s(:send, nil, :assert_equal,
                s(:send,
                  s(:send,
                    s(:lvar, :expected), :[],
                    s(:int, 0)), :attributes),
                s(:send,
                  s(:send,
                    s(:lvar, :actual), :[],
                    s(:int, 0)), :attributes)),
              s(:block,
                s(:send,
                  s(:array,
                    s(:str, "image:height"),
                    s(:str, "image:width"),
                    s(:str, "dc:title")), :each),
                s(:args,
                  s(:arg, :name)),
                s(:begin,
                  s(:lvasgn, :actual_target,
                    s(:send,
                      s(:send,
                        s(:lvar, :actual), :elements), :[],
                      s(:dstr,
                        s(:str, "//"),
                        s(:begin,
                          s(:lvar, :name))))),
                  s(:lvasgn, :expected_target,
                    s(:send,
                      s(:send,
                        s(:lvar, :expected), :elements), :[],
                      s(:dstr,
                        s(:str, "//"),
                        s(:begin,
                          s(:lvar, :name))))),
                  s(:send, nil, :assert_equal,
                    s(:send,
                      s(:lvar, :expected_target), :to_s),
                    s(:send,
                      s(:lvar, :actual_target), :to_s))))))),
        s(:send, nil, :private),
        s(:def, :image_xmlns_container,
          s(:args,
            s(:arg, :content)),
          s(:send, nil, :xmlns_container,
            s(:hash,
              s(:pair,
                s(:ivar, :@prefix),
                s(:ivar, :@uri)),
              s(:pair,
                s(:str, "dc"),
                s(:str, "http://purl.org/dc/elements/1.1/")),
              s(:pair,
                s(:str, "rdf"),
                s(:str, "http://www.w3.org/1999/02/22-rdf-syntax-ns#"))),
            s(:lvar, :content)))))))

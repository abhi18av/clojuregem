s(:begin,
  s(:send, nil, :require,
    s(:str, "test/unit")),
  s(:send, nil, :require,
    s(:str, "webrick")),
  s(:send, nil, :require_relative,
    s(:str, "utils")),
  s(:class,
    s(:const, nil, :TestDoNotReverseLookup),
    s(:const,
      s(:const,
        s(:const, nil, :Test), :Unit), :TestCase),
    s(:begin,
      s(:class,
        s(:const, nil, :DNRL),
        s(:const,
          s(:const, nil, :WEBrick), :GenericServer),
        s(:def, :run,
          s(:args,
            s(:arg, :sock)),
          s(:send,
            s(:lvar, :sock), :<<,
            s(:send,
              s(:send,
                s(:lvar, :sock), :do_not_reverse_lookup), :to_s)))),
      s(:cvasgn, :@@original_do_not_reverse_lookup_value,
        s(:send,
          s(:const, nil, :Socket), :do_not_reverse_lookup)),
      s(:def, :teardown,
        s(:args),
        s(:send,
          s(:const, nil, :Socket), :do_not_reverse_lookup=,
          s(:cvar, :@@original_do_not_reverse_lookup_value))),
      s(:def, :do_not_reverse_lookup?,
        s(:args,
          s(:arg, :config)),
        s(:begin,
          s(:lvasgn, :result,
            s(:nil)),
          s(:block,
            s(:send,
              s(:const, nil, :TestWEBrick), :start_server,
              s(:const, nil, :DNRL),
              s(:lvar, :config)),
            s(:args,
              s(:arg, :server),
              s(:arg, :addr),
              s(:arg, :port),
              s(:arg, :log)),
            s(:block,
              s(:send,
                s(:const, nil, :TCPSocket), :open,
                s(:lvar, :addr),
                s(:lvar, :port)),
              s(:args,
                s(:arg, :sock)),
              s(:lvasgn, :result,
                s(:send,
                  s(:hash,
                    s(:pair,
                      s(:str, "true"),
                      s(:true)),
                    s(:pair,
                      s(:str, "false"),
                      s(:false))), :[],
                  s(:send,
                    s(:lvar, :sock), :gets))))),
          s(:lvar, :result))),
      s(:def, :test_socket_dnrl_true_server_dnrl_true,
        s(:args),
        s(:begin,
          s(:send,
            s(:const, nil, :Socket), :do_not_reverse_lookup=,
            s(:true)),
          s(:send, nil, :assert_equal,
            s(:true),
            s(:send, nil, :do_not_reverse_lookup?,
              s(:hash,
                s(:pair,
                  s(:sym, :DoNotReverseLookup),
                  s(:true))))))),
      s(:def, :test_socket_dnrl_true_server_dnrl_false,
        s(:args),
        s(:begin,
          s(:send,
            s(:const, nil, :Socket), :do_not_reverse_lookup=,
            s(:true)),
          s(:send, nil, :assert_equal,
            s(:false),
            s(:send, nil, :do_not_reverse_lookup?,
              s(:hash,
                s(:pair,
                  s(:sym, :DoNotReverseLookup),
                  s(:false))))))),
      s(:def, :test_socket_dnrl_true_server_dnrl_nil,
        s(:args),
        s(:begin,
          s(:send,
            s(:const, nil, :Socket), :do_not_reverse_lookup=,
            s(:true)),
          s(:send, nil, :assert_equal,
            s(:true),
            s(:send, nil, :do_not_reverse_lookup?,
              s(:hash,
                s(:pair,
                  s(:sym, :DoNotReverseLookup),
                  s(:nil))))))),
      s(:def, :test_socket_dnrl_false_server_dnrl_true,
        s(:args),
        s(:begin,
          s(:send,
            s(:const, nil, :Socket), :do_not_reverse_lookup=,
            s(:false)),
          s(:send, nil, :assert_equal,
            s(:true),
            s(:send, nil, :do_not_reverse_lookup?,
              s(:hash,
                s(:pair,
                  s(:sym, :DoNotReverseLookup),
                  s(:true))))))),
      s(:def, :test_socket_dnrl_false_server_dnrl_false,
        s(:args),
        s(:begin,
          s(:send,
            s(:const, nil, :Socket), :do_not_reverse_lookup=,
            s(:false)),
          s(:send, nil, :assert_equal,
            s(:false),
            s(:send, nil, :do_not_reverse_lookup?,
              s(:hash,
                s(:pair,
                  s(:sym, :DoNotReverseLookup),
                  s(:false))))))),
      s(:def, :test_socket_dnrl_false_server_dnrl_nil,
        s(:args),
        s(:begin,
          s(:send,
            s(:const, nil, :Socket), :do_not_reverse_lookup=,
            s(:false)),
          s(:send, nil, :assert_equal,
            s(:false),
            s(:send, nil, :do_not_reverse_lookup?,
              s(:hash,
                s(:pair,
                  s(:sym, :DoNotReverseLookup),
                  s(:nil))))))))))

s(:begin,
  s(:send, nil, :require,
    s(:str, "test/unit")),
  s(:send, nil, :require,
    s(:str, "-test-/string")),
  s(:class,
    s(:const, nil, :Test_StrSetLen),
    s(:const,
      s(:const,
        s(:const, nil, :Test), :Unit), :TestCase),
    s(:begin,
      s(:def, :setup,
        s(:args),
        s(:begin,
          s(:ivasgn, :@s0,
            s(:send,
              s(:send,
                s(:array,
                  s(:splat,
                    s(:irange,
                      s(:str, "a"),
                      s(:str, "z")))), :join,
                s(:str, "")), :freeze)),
          s(:ivasgn, :@s1,
            s(:send,
              s(:const,
                s(:const, nil, :Bug), :String), :new,
              s(:ivar, :@s0))))),
      s(:def, :teardown,
        s(:args),
        s(:begin,
          s(:lvasgn, :orig,
            s(:send,
              s(:array,
                s(:splat,
                  s(:irange,
                    s(:str, "a"),
                    s(:str, "z")))), :join,
              s(:str, ""))),
          s(:send, nil, :assert_equal,
            s(:lvar, :orig),
            s(:ivar, :@s0)))),
      s(:def, :test_non_shared,
        s(:args),
        s(:begin,
          s(:send,
            s(:ivar, :@s1), :modify!),
          s(:send, nil, :assert_equal,
            s(:str, "abc"),
            s(:send,
              s(:ivar, :@s1), :set_len,
              s(:int, 3))))),
      s(:def, :test_shared,
        s(:args),
        s(:block,
          s(:send, nil, :assert_raise,
            s(:const, nil, :RuntimeError)),
          s(:args),
          s(:send, nil, :assert_equal,
            s(:str, "abc"),
            s(:send,
              s(:ivar, :@s1), :set_len,
              s(:int, 3))))))))

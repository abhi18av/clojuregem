s(:begin,
  s(:send, nil, :require,
    s(:str, "test/unit")),
  s(:send, nil, :require,
    s(:str, "thread")),
  s(:send, nil, :require,
    s(:str, "-test-/postponed_job")),
  s(:module,
    s(:const, nil, :Bug),
    s(:begin,
      s(:defs,
        s(:self), :postponed_job_call_direct_wrapper,
        s(:args,
          s(:restarg, :args)),
        s(:send, nil, :postponed_job_call_direct,
          s(:splat,
            s(:lvar, :args)))),
      s(:defs,
        s(:self), :postponed_job_register_wrapper,
        s(:args,
          s(:restarg, :args)),
        s(:send, nil, :postponed_job_register,
          s(:splat,
            s(:lvar, :args)))))),
  s(:class,
    s(:const, nil, :TestPostponed_job),
    s(:const,
      s(:const,
        s(:const, nil, :Test), :Unit), :TestCase),
    s(:def, :test_register,
      s(:args),
      s(:begin,
        s(:masgn,
          s(:mlhs,
            s(:lvasgn, :direct),
            s(:lvasgn, :registered)),
          s(:array,
            s(:array),
            s(:array))),
        s(:send,
          s(:const, nil, :Bug), :postponed_job_call_direct_wrapper,
          s(:lvar, :direct)),
        s(:send,
          s(:const, nil, :Bug), :postponed_job_register_wrapper,
          s(:lvar, :registered)),
        s(:send, nil, :assert_match,
          s(:regexp,
            s(:str, "postponed_job_call_direct_wrapper"),
            s(:regopt)),
          s(:send,
            s(:lvar, :direct), :join)),
        s(:send, nil, :assert_not_match,
          s(:regexp,
            s(:str, "postponed_job_register_wrapper"),
            s(:regopt)),
          s(:send,
            s(:lvar, :registered), :join)),
        s(:send,
          s(:const, nil, :Bug), :postponed_job_register_one,
          s(:lvasgn, :ary,
            s(:array))),
        s(:send, nil, :assert_equal,
          s(:array,
            s(:int, 1)),
          s(:lvar, :ary))))))

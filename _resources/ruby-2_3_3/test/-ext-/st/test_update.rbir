s(:begin,
  s(:send, nil, :require,
    s(:str, "test/unit")),
  s(:send, nil, :require,
    s(:str, "-test-/st/update")),
  s(:class,
    s(:const,
      s(:const, nil, :Bug), :StTable), nil,
    s(:class,
      s(:const, nil, :Test_Update),
      s(:const,
        s(:const,
          s(:const, nil, :Test), :Unit), :TestCase),
      s(:begin,
        s(:def, :setup,
          s(:args),
          s(:begin,
            s(:ivasgn, :@tbl,
              s(:send,
                s(:const,
                  s(:const, nil, :Bug), :StTable), :new)),
            s(:send,
              s(:ivar, :@tbl), :[]=,
              s(:sym, :a),
              s(:int, 1)),
            s(:send,
              s(:ivar, :@tbl), :[]=,
              s(:sym, :b),
              s(:int, 2)))),
        s(:def, :test_notfound,
          s(:args),
          s(:begin,
            s(:send, nil, :assert_equal,
              s(:false),
              s(:block,
                s(:send,
                  s(:ivar, :@tbl), :st_update,
                  s(:sym, :c)),
                s(:args),
                s(:int, 42))),
            s(:send, nil, :assert_equal,
              s(:hash,
                s(:pair,
                  s(:sym, :a),
                  s(:int, 1)),
                s(:pair,
                  s(:sym, :b),
                  s(:int, 2)),
                s(:pair,
                  s(:sym, :c),
                  s(:int, 42))),
              s(:ivar, :@tbl)))),
        s(:def, :test_continue,
          s(:args),
          s(:begin,
            s(:lvasgn, :args,
              s(:nil)),
            s(:send, nil, :assert_equal,
              s(:true),
              s(:block,
                s(:send,
                  s(:ivar, :@tbl), :st_update,
                  s(:sym, :a)),
                s(:args,
                  s(:restarg, :x)),
                s(:begin,
                  s(:lvasgn, :args,
                    s(:lvar, :x)),
                  s(:false)))),
            s(:send, nil, :assert_equal,
              s(:hash,
                s(:pair,
                  s(:sym, :a),
                  s(:int, 1)),
                s(:pair,
                  s(:sym, :b),
                  s(:int, 2))),
              s(:ivar, :@tbl),
              s(:sym, :a)),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:sym, :a),
                s(:int, 1)),
              s(:lvar, :args)))),
        s(:def, :test_delete,
          s(:args),
          s(:begin,
            s(:lvasgn, :args,
              s(:nil)),
            s(:send, nil, :assert_equal,
              s(:true),
              s(:block,
                s(:send,
                  s(:ivar, :@tbl), :st_update,
                  s(:sym, :a)),
                s(:args,
                  s(:restarg, :x)),
                s(:begin,
                  s(:lvasgn, :args,
                    s(:lvar, :x)),
                  s(:nil)))),
            s(:send, nil, :assert_equal,
              s(:hash,
                s(:pair,
                  s(:sym, :b),
                  s(:int, 2))),
              s(:ivar, :@tbl),
              s(:sym, :a)),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:sym, :a),
                s(:int, 1)),
              s(:lvar, :args)))),
        s(:def, :test_update,
          s(:args),
          s(:begin,
            s(:lvasgn, :args,
              s(:nil)),
            s(:send, nil, :assert_equal,
              s(:true),
              s(:block,
                s(:send,
                  s(:ivar, :@tbl), :st_update,
                  s(:sym, :a)),
                s(:args,
                  s(:restarg, :x)),
                s(:begin,
                  s(:lvasgn, :args,
                    s(:lvar, :x)),
                  s(:int, 3)))),
            s(:send, nil, :assert_equal,
              s(:hash,
                s(:pair,
                  s(:sym, :a),
                  s(:int, 3)),
                s(:pair,
                  s(:sym, :b),
                  s(:int, 2))),
              s(:ivar, :@tbl),
              s(:sym, :a)),
            s(:send, nil, :assert_equal,
              s(:array,
                s(:sym, :a),
                s(:int, 1)),
              s(:lvar, :args)))),
        s(:def, :test_pass_objects_in_st_table,
          s(:args),
          s(:begin,
            s(:lvasgn, :bug7330,
              s(:str, "[ruby-core:49220]")),
            s(:lvasgn, :key,
              s(:send,
                s(:str, "abc"), :freeze)),
            s(:lvasgn, :value,
              s(:str, "def")),
            s(:send,
              s(:ivar, :@tbl), :[]=,
              s(:lvar, :key),
              s(:lvar, :value)),
            s(:block,
              s(:send,
                s(:ivar, :@tbl), :st_update,
                s(:str, "abc")),
              s(:args,
                s(:restarg, :args)),
              s(:begin,
                s(:send, nil, :assert_same,
                  s(:lvar, :key),
                  s(:send,
                    s(:lvar, :args), :[],
                    s(:int, 0)),
                  s(:lvar, :bug7330)),
                s(:send, nil, :assert_same,
                  s(:lvar, :value),
                  s(:send,
                    s(:lvar, :args), :[],
                    s(:int, 1)),
                  s(:lvar, :bug7330)),
                s(:nil)))))))))

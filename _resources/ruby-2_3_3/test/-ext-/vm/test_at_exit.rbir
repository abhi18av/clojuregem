s(:class,
  s(:const, nil, :TestVM),
  s(:const,
    s(:const,
      s(:const, nil, :Test), :Unit), :TestCase),
  s(:def, :test_at_exit,
    s(:args),
    s(:send, nil, :assert_in_out_err,
      s(:array),
      s(:dstr,
        s(:str, "      require '-test-/vm/at_exit'\n"),
        s(:str, "      Bug::VM.register_at_exit(false)\n"),
        s(:str, "      1000.times do\n"),
        s(:str, "        Bug::VM.register_at_exit(nil)\n"),
        s(:str, "        [\"x\"]*1000\n"),
        s(:str, "      end\n"),
        s(:str, "      GC.start\n"),
        s(:str, "      Bug::VM.register_at_exit(true)\n")),
      s(:array,
        s(:str, "begin"),
        s(:str, "end")))))

s(:begin,
  s(:send, nil, :require,
    s(:str, "test/unit")),
  s(:class,
    s(:const, nil, :TestMetaclass),
    s(:const,
      s(:const,
        s(:const, nil, :Test), :Unit), :TestCase),
    s(:begin,
      s(:class,
        s(:const, nil, :Foo), nil, nil),
      s(:class,
        s(:const, nil, :Bar),
        s(:const, nil, :Foo), nil),
      s(:class,
        s(:const, nil, :Baz), nil, nil),
      s(:def, :setup,
        s(:args),
        s(:begin,
          s(:block,
            s(:send,
              s(:const, nil, :Object), :class_eval),
            s(:args),
            s(:def, :method_o,
              s(:args), nil)),
          s(:block,
            s(:send,
              s(:const, nil, :Module), :class_eval),
            s(:args),
            s(:def, :method_m,
              s(:args), nil)),
          s(:block,
            s(:send,
              s(:const, nil, :Class), :class_eval),
            s(:args),
            s(:def, :method_c,
              s(:args), nil)))),
      s(:def, :teardown,
        s(:args),
        s(:begin,
          s(:block,
            s(:send,
              s(:const, nil, :Object), :class_eval),
            s(:args),
            s(:rescue,
              s(:send, nil, :remove_method,
                s(:sym, :method_o)),
              s(:resbody, nil, nil,
                s(:nil)), nil)),
          s(:block,
            s(:send,
              s(:const, nil, :Module), :class_eval),
            s(:args),
            s(:rescue,
              s(:send, nil, :remove_method,
                s(:sym, :method_m)),
              s(:resbody, nil, nil,
                s(:nil)), nil)),
          s(:block,
            s(:send,
              s(:const, nil, :Class), :class_eval),
            s(:args),
            s(:rescue,
              s(:send, nil, :remove_method,
                s(:sym, :method_c)),
              s(:resbody, nil, nil,
                s(:nil)), nil)),
          s(:block,
            s(:send,
              s(:const, nil, :Object), :class_eval),
            s(:args),
            s(:sclass,
              s(:self),
              s(:rescue,
                s(:send, nil, :remove_method,
                  s(:sym, :class_method_o)),
                s(:resbody, nil, nil,
                  s(:nil)), nil))),
          s(:block,
            s(:send,
              s(:const, nil, :Module), :class_eval),
            s(:args),
            s(:sclass,
              s(:self),
              s(:rescue,
                s(:send, nil, :remove_method,
                  s(:sym, :class_method_m)),
                s(:resbody, nil, nil,
                  s(:nil)), nil))),
          s(:block,
            s(:send,
              s(:const, nil, :Class), :class_eval),
            s(:args),
            s(:sclass,
              s(:self),
              s(:rescue,
                s(:send, nil, :remove_method,
                  s(:sym, :class_method_c)),
                s(:resbody, nil, nil,
                  s(:nil)), nil))),
          s(:block,
            s(:send,
              s(:const, nil, :Object), :class_eval),
            s(:args),
            s(:sclass,
              s(:self),
              s(:sclass,
                s(:self),
                s(:rescue,
                  s(:send, nil, :remove_method,
                    s(:sym, :metaclass_method_o)),
                  s(:resbody, nil, nil,
                    s(:nil)), nil)))),
          s(:block,
            s(:send,
              s(:const, nil, :Module), :class_eval),
            s(:args),
            s(:sclass,
              s(:self),
              s(:sclass,
                s(:self),
                s(:rescue,
                  s(:send, nil, :remove_method,
                    s(:sym, :metaclass_method_m)),
                  s(:resbody, nil, nil,
                    s(:nil)), nil)))),
          s(:block,
            s(:send,
              s(:const, nil, :Class), :class_eval),
            s(:args),
            s(:sclass,
              s(:self),
              s(:sclass,
                s(:self),
                s(:rescue,
                  s(:send, nil, :remove_method,
                    s(:sym, :metaclass_method_c)),
                  s(:resbody, nil, nil,
                    s(:nil)), nil)))))),
      s(:def, :test_metaclass,
        s(:args),
        s(:begin,
          s(:sclass,
            s(:const, nil, :Object),
            s(:def, :class_method_o,
              s(:args), nil)),
          s(:sclass,
            s(:const, nil, :Foo),
            s(:def, :class_method_f,
              s(:args), nil)),
          s(:sclass,
            s(:const, nil, :Baz),
            s(:def, :class_method_b,
              s(:args), nil)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:const, nil, :Bar), :method_o)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:const, nil, :Bar), :method_m)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:const, nil, :Bar), :method_c)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:const, nil, :Bar), :class_method_o)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:const, nil, :Bar), :class_method_f)),
          s(:block,
            s(:send, nil, :assert_raise,
              s(:const, nil, :NoMethodError)),
            s(:args),
            s(:send,
              s(:const, nil, :Bar), :class_method_b)),
          s(:sclass,
            s(:const, nil, :Module),
            s(:def, :class_method_m,
              s(:args), nil)),
          s(:sclass,
            s(:const, nil, :Class),
            s(:def, :class_method_c,
              s(:args), nil)),
          s(:sclass,
            s(:const, nil, :Object),
            s(:sclass,
              s(:self),
              s(:def, :metaclass_method_o,
                s(:args), nil))),
          s(:sclass,
            s(:const, nil, :Foo),
            s(:sclass,
              s(:self),
              s(:def, :metaclass_method_f,
                s(:args), nil))),
          s(:sclass,
            s(:const, nil, :Baz),
            s(:sclass,
              s(:self),
              s(:def, :metaclass_method_b,
                s(:args), nil))),
          s(:lvasgn, :metaclass_of_bar,
            s(:sclass,
              s(:const, nil, :Bar),
              s(:self))),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metaclass_of_bar), :method_o)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metaclass_of_bar), :method_m)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metaclass_of_bar), :method_c)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metaclass_of_bar), :class_method_o)),
          s(:block,
            s(:send, nil, :assert_raise,
              s(:const, nil, :NoMethodError)),
            s(:args),
            s(:send,
              s(:lvar, :metaclass_of_bar), :class_method_f)),
          s(:block,
            s(:send, nil, :assert_raise,
              s(:const, nil, :NoMethodError)),
            s(:args),
            s(:send,
              s(:lvar, :metaclass_of_bar), :class_method_b)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metaclass_of_bar), :class_method_m)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metaclass_of_bar), :class_method_c)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metaclass_of_bar), :metaclass_method_o)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metaclass_of_bar), :metaclass_method_f)),
          s(:block,
            s(:send, nil, :assert_raise,
              s(:const, nil, :NoMethodError)),
            s(:args),
            s(:send,
              s(:lvar, :metaclass_of_bar), :metaclass_method_b)),
          s(:sclass,
            s(:const, nil, :Module),
            s(:sclass,
              s(:self),
              s(:def, :metaclass_method_m,
                s(:args), nil))),
          s(:sclass,
            s(:const, nil, :Class),
            s(:sclass,
              s(:self),
              s(:def, :metaclass_method_c,
                s(:args), nil))),
          s(:sclass,
            s(:const, nil, :Object),
            s(:sclass,
              s(:self),
              s(:sclass,
                s(:self),
                s(:def, :metametaclass_method_o,
                  s(:args), nil)))),
          s(:sclass,
            s(:const, nil, :Foo),
            s(:sclass,
              s(:self),
              s(:sclass,
                s(:self),
                s(:def, :metametaclass_method_f,
                  s(:args), nil)))),
          s(:sclass,
            s(:const, nil, :Baz),
            s(:sclass,
              s(:self),
              s(:sclass,
                s(:self),
                s(:def, :metametaclass_method_b,
                  s(:args), nil)))),
          s(:lvasgn, :metametaclass_of_bar,
            s(:sclass,
              s(:lvar, :metaclass_of_bar),
              s(:self))),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metametaclass_of_bar), :method_o)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metametaclass_of_bar), :method_m)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metametaclass_of_bar), :method_c)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metametaclass_of_bar), :class_method_o)),
          s(:block,
            s(:send, nil, :assert_raise,
              s(:const, nil, :NoMethodError)),
            s(:args),
            s(:send,
              s(:lvar, :metametaclass_of_bar), :class_method_f)),
          s(:block,
            s(:send, nil, :assert_raise,
              s(:const, nil, :NoMethodError)),
            s(:args),
            s(:send,
              s(:lvar, :metametaclass_of_bar), :class_method_b)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metametaclass_of_bar), :class_method_m)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metametaclass_of_bar), :class_method_c)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metametaclass_of_bar), :metaclass_method_o)),
          s(:block,
            s(:send, nil, :assert_raise,
              s(:const, nil, :NoMethodError)),
            s(:args),
            s(:send,
              s(:lvar, :metametaclass_of_bar), :metaclass_method_f)),
          s(:block,
            s(:send, nil, :assert_raise,
              s(:const, nil, :NoMethodError)),
            s(:args),
            s(:send,
              s(:lvar, :metametaclass_of_bar), :metaclass_method_b)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metametaclass_of_bar), :metaclass_method_m)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metametaclass_of_bar), :metaclass_method_c)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metametaclass_of_bar), :metametaclass_method_o)),
          s(:block,
            s(:send, nil, :assert_nothing_raised),
            s(:args),
            s(:send,
              s(:lvar, :metametaclass_of_bar), :metametaclass_method_f)),
          s(:block,
            s(:send, nil, :assert_raise,
              s(:const, nil, :NoMethodError)),
            s(:args),
            s(:send,
              s(:lvar, :metametaclass_of_bar), :metaclass_method_b)))))))

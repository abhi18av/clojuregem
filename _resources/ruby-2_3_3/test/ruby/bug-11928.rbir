s(:class,
  s(:const, nil, :Segfault), nil,
  s(:begin,
    s(:block,
      s(:send, nil, :at_exit),
      s(:args),
      s(:send,
        s(:send,
          s(:const, nil, :Segfault), :new), :segfault)),
    s(:block,
      s(:send, nil, :define_method,
        s(:str, "segfault")),
      s(:args),
      s(:begin,
        s(:lvasgn, :n,
          s(:int, 11928)),
        s(:lvasgn, :v,
          s(:nil)),
        s(:lvasgn, :i,
          s(:int, 0)),
        s(:while,
          s(:send,
            s(:lvar, :i), :<,
            s(:lvar, :n)),
          s(:begin,
            s(:op_asgn,
              s(:lvasgn, :i), :+,
              s(:int, 1)),
            s(:lvasgn, :v,
              s(:send,
                s(:begin,
                  s(:rescue,
                    s(:send, nil, :foo),
                    s(:resbody, nil, nil,
                      s(:gvar, :$!)), nil)), :local_variables)))),
        s(:send, nil, :assert_equal,
          s(:array,
            s(:sym, :i),
            s(:sym, :n),
            s(:sym, :v)),
          s(:send,
            s(:lvar, :v), :sort))))))

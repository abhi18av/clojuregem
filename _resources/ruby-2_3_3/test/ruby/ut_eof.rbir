s(:begin,
  s(:send, nil, :require,
    s(:str, "test/unit")),
  s(:module,
    s(:const, nil, :TestEOF),
    s(:begin,
      s(:def, :test_eof_0,
        s(:args),
        s(:begin,
          s(:block,
            s(:send, nil, :open_file,
              s(:str, "")),
            s(:args,
              s(:arg, :f)),
            s(:begin,
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 0))),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 0))),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read)),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 0))),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 0))))),
          s(:block,
            s(:send, nil, :open_file,
              s(:str, "")),
            s(:args,
              s(:arg, :f)),
            s(:begin,
              s(:send, nil, :assert_nil,
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 1))),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read)),
              s(:send, nil, :assert_nil,
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 1))))),
          s(:block,
            s(:send, nil, :open_file,
              s(:str, "")),
            s(:args,
              s(:arg, :f)),
            s(:begin,
              s(:lvasgn, :s,
                s(:str, "x")),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read,
                  s(:nil),
                  s(:lvar, :s))),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:lvar, :s)))),
          s(:block,
            s(:send, nil, :open_file,
              s(:str, "")),
            s(:args,
              s(:arg, :f)),
            s(:begin,
              s(:lvasgn, :s,
                s(:str, "x")),
              s(:send, nil, :assert_nil,
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 10),
                  s(:lvar, :s))),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:lvar, :s)))))),
      s(:def, :test_eof_0_rw,
        s(:args),
        s(:begin,
          s(:if,
            s(:send, nil, :respond_to?,
              s(:sym, :open_file_rw)), nil,
            s(:return)),
          s(:block,
            s(:send, nil, :open_file_rw,
              s(:str, "")),
            s(:args,
              s(:arg, :f)),
            s(:begin,
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read)),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read)),
              s(:send, nil, :assert_equal,
                s(:int, 0),
                s(:send,
                  s(:lvar, :f), :syswrite,
                  s(:str, ""))),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read)))))),
      s(:def, :test_eof_1,
        s(:args),
        s(:begin,
          s(:block,
            s(:send, nil, :open_file,
              s(:str, "a")),
            s(:args,
              s(:arg, :f)),
            s(:begin,
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 0))),
              s(:send, nil, :assert_equal,
                s(:str, "a"),
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 1))),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 0))),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 0))),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read)),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 0))),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 0))))),
          s(:block,
            s(:send, nil, :open_file,
              s(:str, "a")),
            s(:args,
              s(:arg, :f)),
            s(:begin,
              s(:send, nil, :assert_equal,
                s(:str, "a"),
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 1))),
              s(:send, nil, :assert_nil,
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 1))))),
          s(:block,
            s(:send, nil, :open_file,
              s(:str, "a")),
            s(:args,
              s(:arg, :f)),
            s(:begin,
              s(:send, nil, :assert_equal,
                s(:str, "a"),
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 2))),
              s(:send, nil, :assert_nil,
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 1))),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read)),
              s(:send, nil, :assert_nil,
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 1))))),
          s(:block,
            s(:send, nil, :open_file,
              s(:str, "a")),
            s(:args,
              s(:arg, :f)),
            s(:begin,
              s(:send, nil, :assert_equal,
                s(:str, "a"),
                s(:send,
                  s(:lvar, :f), :read)),
              s(:send, nil, :assert_nil,
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 1))),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read)),
              s(:send, nil, :assert_nil,
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 1))))),
          s(:block,
            s(:send, nil, :open_file,
              s(:str, "a")),
            s(:args,
              s(:arg, :f)),
            s(:begin,
              s(:send, nil, :assert_equal,
                s(:str, "a"),
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 2))),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read)),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read)))),
          s(:block,
            s(:send, nil, :open_file,
              s(:str, "a")),
            s(:args,
              s(:arg, :f)),
            s(:begin,
              s(:send, nil, :assert_equal,
                s(:str, "a"),
                s(:send,
                  s(:lvar, :f), :read)),
              s(:send, nil, :assert_equal,
                s(:str, ""),
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 0))))),
          s(:block,
            s(:send, nil, :open_file,
              s(:str, "a")),
            s(:args,
              s(:arg, :f)),
            s(:begin,
              s(:lvasgn, :s,
                s(:str, "x")),
              s(:send, nil, :assert_equal,
                s(:str, "a"),
                s(:send,
                  s(:lvar, :f), :read,
                  s(:nil),
                  s(:lvar, :s))),
              s(:send, nil, :assert_equal,
                s(:str, "a"),
                s(:lvar, :s)))),
          s(:block,
            s(:send, nil, :open_file,
              s(:str, "a")),
            s(:args,
              s(:arg, :f)),
            s(:begin,
              s(:lvasgn, :s,
                s(:str, "x")),
              s(:send, nil, :assert_equal,
                s(:str, "a"),
                s(:send,
                  s(:lvar, :f), :read,
                  s(:int, 10),
                  s(:lvar, :s))),
              s(:send, nil, :assert_equal,
                s(:str, "a"),
                s(:lvar, :s)))))),
      s(:def, :test_eof_2,
        s(:args),
        s(:block,
          s(:send, nil, :open_file,
            s(:str, "")),
          s(:args,
            s(:arg, :f)),
          s(:begin,
            s(:send, nil, :assert_equal,
              s(:str, ""),
              s(:send,
                s(:lvar, :f), :read)),
            s(:send, nil, :assert_predicate,
              s(:lvar, :f),
              s(:sym, :eof?))))),
      s(:def, :test_eof_3,
        s(:args),
        s(:block,
          s(:send, nil, :open_file,
            s(:str, "")),
          s(:args,
            s(:arg, :f)),
          s(:send, nil, :assert_predicate,
            s(:lvar, :f),
            s(:sym, :eof?)))),
      s(:module,
        s(:const, nil, :Seek),
        s(:begin,
          s(:def, :open_file_seek,
            s(:args,
              s(:arg, :content),
              s(:arg, :pos)),
            s(:block,
              s(:send, nil, :open_file,
                s(:lvar, :content)),
              s(:args,
                s(:arg, :f)),
              s(:begin,
                s(:send,
                  s(:lvar, :f), :seek,
                  s(:lvar, :pos)),
                s(:yield,
                  s(:lvar, :f))))),
          s(:def, :test_eof_0_seek,
            s(:args),
            s(:block,
              s(:send, nil, :open_file_seek,
                s(:str, ""),
                s(:int, 10)),
              s(:args,
                s(:arg, :f)),
              s(:begin,
                s(:send, nil, :assert_equal,
                  s(:int, 10),
                  s(:send,
                    s(:lvar, :f), :pos)),
                s(:send, nil, :assert_equal,
                  s(:str, ""),
                  s(:send,
                    s(:lvar, :f), :read,
                    s(:int, 0))),
                s(:send, nil, :assert_equal,
                  s(:str, ""),
                  s(:send,
                    s(:lvar, :f), :read)),
                s(:send, nil, :assert_equal,
                  s(:str, ""),
                  s(:send,
                    s(:lvar, :f), :read,
                    s(:int, 0))),
                s(:send, nil, :assert_equal,
                  s(:str, ""),
                  s(:send,
                    s(:lvar, :f), :read))))),
          s(:def, :test_eof_1_seek,
            s(:args),
            s(:begin,
              s(:block,
                s(:send, nil, :open_file_seek,
                  s(:str, "a"),
                  s(:int, 10)),
                s(:args,
                  s(:arg, :f)),
                s(:begin,
                  s(:send, nil, :assert_equal,
                    s(:str, ""),
                    s(:send,
                      s(:lvar, :f), :read)),
                  s(:send, nil, :assert_equal,
                    s(:str, ""),
                    s(:send,
                      s(:lvar, :f), :read)))),
              s(:block,
                s(:send, nil, :open_file_seek,
                  s(:str, "a"),
                  s(:int, 1)),
                s(:args,
                  s(:arg, :f)),
                s(:begin,
                  s(:send, nil, :assert_equal,
                    s(:str, ""),
                    s(:send,
                      s(:lvar, :f), :read)),
                  s(:send, nil, :assert_equal,
                    s(:str, ""),
                    s(:send,
                      s(:lvar, :f), :read)))))))))))

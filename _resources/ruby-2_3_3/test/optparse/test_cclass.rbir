s(:begin,
  s(:send, nil, :require_relative,
    s(:str, "test_optparse")),
  s(:class,
    s(:const,
      s(:const, nil, :TestOptionParser), :CClass),
    s(:const, nil, :TestOptionParser),
    s(:begin,
      s(:def, :test_no_argument,
        s(:args),
        s(:begin,
          s(:lvasgn, :flags,
            s(:array)),
          s(:block,
            s(:send,
              s(:ivar, :@opt), :def_option,
              s(:str, "-[a-z]")),
            s(:args,
              s(:arg, :x)),
            s(:send,
              s(:lvar, :flags), :<<,
              s(:lvar, :x))),
          s(:block,
            s(:send, nil, :no_error),
            s(:args),
            s(:send,
              s(:ivar, :@opt), :parse!,
              s(:array,
                s(:str, "-a")))),
          s(:send, nil, :assert_equal,
            s(:array,
              s(:str, "a")),
            s(:lvar, :flags)))),
      s(:def, :test_required_argument,
        s(:args),
        s(:begin,
          s(:lvasgn, :flags,
            s(:array)),
          s(:block,
            s(:send,
              s(:ivar, :@opt), :def_option,
              s(:str, "-[a-z]X")),
            s(:args,
              s(:arg, :x)),
            s(:send,
              s(:lvar, :flags), :<<,
              s(:lvar, :x))),
          s(:block,
            s(:send, nil, :no_error),
            s(:args),
            s(:send,
              s(:ivar, :@opt), :parse!,
              s(:array,
                s(:str, "-a")))),
          s(:send, nil, :assert_equal,
            s(:array,
              s(:str, "a")),
            s(:lvar, :flags)))))))

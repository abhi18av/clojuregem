s(:begin,
  s(:send, nil, :require_relative,
    s(:str, "test_optparse")),
  s(:class,
    s(:const,
      s(:const, nil, :TestOptionParser), :PlaceArg),
    s(:const, nil, :TestOptionParser),
    s(:begin,
      s(:def, :setup,
        s(:args),
        s(:begin,
          s(:zsuper),
          s(:block,
            s(:send,
              s(:ivar, :@opt), :def_option,
              s(:str, "-x [VAL]")),
            s(:args,
              s(:arg, :x)),
            s(:ivasgn, :@flag,
              s(:lvar, :x))),
          s(:block,
            s(:send,
              s(:ivar, :@opt), :def_option,
              s(:str, "--option [VAL]")),
            s(:args,
              s(:arg, :x)),
            s(:ivasgn, :@flag,
              s(:lvar, :x))),
          s(:block,
            s(:send,
              s(:ivar, :@opt), :def_option,
              s(:str, "-T [level]"),
              s(:regexp,
                s(:str, "^[0-4]$"),
                s(:regopt)),
              s(:const, nil, :Integer)),
            s(:args,
              s(:arg, :x)),
            s(:ivasgn, :@topt,
              s(:lvar, :x))),
          s(:ivasgn, :@topt,
            s(:nil)),
          s(:block,
            s(:send,
              s(:ivar, :@opt), :def_option,
              s(:str, "-n")),
            s(:args), nil),
          s(:block,
            s(:send,
              s(:ivar, :@opt), :def_option,
              s(:str, "--regexp [REGEXP]"),
              s(:const, nil, :Regexp)),
            s(:args,
              s(:arg, :x)),
            s(:ivasgn, :@reopt,
              s(:lvar, :x))),
          s(:ivasgn, :@reopt,
            s(:nil)))),
      s(:def, :test_short,
        s(:args),
        s(:begin,
          s(:send, nil, :assert_equal,
            s(:array),
            s(:block,
              s(:send, nil, :no_error),
              s(:args),
              s(:send,
                s(:ivar, :@opt), :parse!,
                s(:array,
                  s(:str, "-x"),
                  s(:str, "-n"))))),
          s(:send, nil, :assert_equal,
            s(:nil),
            s(:ivar, :@flag)),
          s(:ivasgn, :@flag,
            s(:false)),
          s(:send, nil, :assert_equal,
            s(:array),
            s(:block,
              s(:send, nil, :no_error),
              s(:args),
              s(:send,
                s(:ivar, :@opt), :parse!,
                s(:array,
                  s(:str, "-x"),
                  s(:str, "foo"))))),
          s(:send, nil, :assert_equal,
            s(:str, "foo"),
            s(:ivar, :@flag)),
          s(:send, nil, :assert_equal,
            s(:array),
            s(:block,
              s(:send, nil, :no_error),
              s(:args),
              s(:send,
                s(:ivar, :@opt), :parse!,
                s(:array,
                  s(:str, "-xbar"))))),
          s(:send, nil, :assert_equal,
            s(:str, "bar"),
            s(:ivar, :@flag)),
          s(:send, nil, :assert_equal,
            s(:array),
            s(:block,
              s(:send, nil, :no_error),
              s(:args),
              s(:send,
                s(:ivar, :@opt), :parse!,
                s(:array,
                  s(:str, "-x="))))),
          s(:send, nil, :assert_equal,
            s(:str, "="),
            s(:ivar, :@flag)))),
      s(:def, :test_abbrev,
        s(:args),
        s(:begin,
          s(:send, nil, :assert_equal,
            s(:array),
            s(:block,
              s(:send, nil, :no_error),
              s(:args),
              s(:send,
                s(:ivar, :@opt), :parse!,
                s(:array,
                  s(:str, "-o"),
                  s(:str, "-n"))))),
          s(:send, nil, :assert_equal,
            s(:nil),
            s(:ivar, :@flag)),
          s(:ivasgn, :@flag,
            s(:false)),
          s(:send, nil, :assert_equal,
            s(:array),
            s(:block,
              s(:send, nil, :no_error),
              s(:args),
              s(:send,
                s(:ivar, :@opt), :parse!,
                s(:array,
                  s(:str, "-o"),
                  s(:str, "foo"))))),
          s(:send, nil, :assert_equal,
            s(:str, "foo"),
            s(:ivar, :@flag)),
          s(:send, nil, :assert_equal,
            s(:array),
            s(:block,
              s(:send, nil, :no_error),
              s(:args),
              s(:send,
                s(:ivar, :@opt), :parse!,
                s(:array,
                  s(:str, "-obar"))))),
          s(:send, nil, :assert_equal,
            s(:str, "bar"),
            s(:ivar, :@flag)),
          s(:send, nil, :assert_equal,
            s(:array),
            s(:block,
              s(:send, nil, :no_error),
              s(:args),
              s(:send,
                s(:ivar, :@opt), :parse!,
                s(:array,
                  s(:str, "-o="))))),
          s(:send, nil, :assert_equal,
            s(:str, "="),
            s(:ivar, :@flag)))),
      s(:def, :test_long,
        s(:args),
        s(:begin,
          s(:send, nil, :assert_equal,
            s(:array),
            s(:block,
              s(:send, nil, :no_error),
              s(:args),
              s(:send,
                s(:ivar, :@opt), :parse!,
                s(:array,
                  s(:str, "--opt"),
                  s(:str, "-n"))))),
          s(:send, nil, :assert_equal,
            s(:nil),
            s(:ivar, :@flag)),
          s(:send, nil, :assert_equal,
            s(:array,
              s(:str, "foo")),
            s(:block,
              s(:send, nil, :no_error),
              s(:args),
              s(:send,
                s(:ivar, :@opt), :parse!,
                s(:array,
                  s(:str, "--opt="),
                  s(:str, "foo"))))),
          s(:send, nil, :assert_equal,
            s(:str, ""),
            s(:ivar, :@flag)),
          s(:send, nil, :assert_equal,
            s(:array),
            s(:block,
              s(:send, nil, :no_error),
              s(:args),
              s(:send,
                s(:ivar, :@opt), :parse!,
                s(:array,
                  s(:str, "--opt=foo"))))),
          s(:send, nil, :assert_equal,
            s(:str, "foo"),
            s(:ivar, :@flag)),
          s(:send, nil, :assert_equal,
            s(:array),
            s(:block,
              s(:send, nil, :no_error),
              s(:args),
              s(:send,
                s(:ivar, :@opt), :parse!,
                s(:array,
                  s(:str, "--opt"),
                  s(:str, "bar"))))),
          s(:send, nil, :assert_equal,
            s(:str, "bar"),
            s(:ivar, :@flag)))),
      s(:def, :test_conv,
        s(:args),
        s(:begin,
          s(:send, nil, :assert_equal,
            s(:array,
              s(:str, "te.rb")),
            s(:block,
              s(:send, nil, :no_error,
                s(:str, "[ruby-dev:38333]")),
              s(:args),
              s(:send,
                s(:ivar, :@opt), :parse!,
                s(:array,
                  s(:str, "-T"),
                  s(:str, "te.rb"))))),
          s(:send, nil, :assert_nil,
            s(:ivar, :@topt)),
          s(:send, nil, :assert_equal,
            s(:array,
              s(:str, "te.rb")),
            s(:block,
              s(:send, nil, :no_error,
                s(:str, "[ruby-dev:38333]")),
              s(:args),
              s(:send,
                s(:ivar, :@opt), :parse!,
                s(:array,
                  s(:str, "-T1"),
                  s(:str, "te.rb"))))),
          s(:send, nil, :assert_equal,
            s(:int, 1),
            s(:ivar, :@topt)))))))

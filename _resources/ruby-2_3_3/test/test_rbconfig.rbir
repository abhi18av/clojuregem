s(:begin,
  s(:send, nil, :require,
    s(:str, "test/unit")),
  s(:send, nil, :require,
    s(:str, "rbconfig")),
  s(:send, nil, :require,
    s(:str, "shellwords")),
  s(:class,
    s(:const, nil, :TestRbConfig),
    s(:const,
      s(:const,
        s(:const, nil, :Test), :Unit), :TestCase),
    s(:begin,
      s(:cvasgn, :@@with_config,
        s(:hash)),
      s(:block,
        s(:send,
          s(:send,
            s(:const, nil, :Shellwords), :shellwords,
            s(:send,
              s(:const,
                s(:const, nil, :RbConfig), :CONFIG), :[],
              s(:str, "configure_args"))), :grep,
          s(:regexp,
            s(:str, "\\A--with-([^=]*)=(.*)"),
            s(:regopt))),
        s(:args),
        s(:send,
          s(:cvar, :@@with_config), :[]=,
          s(:send,
            s(:nth_ref, 1), :tr,
            s(:str, "_"),
            s(:str, "-")),
          s(:nth_ref, 2))),
      s(:def, :test_sitedirs,
        s(:args),
        s(:block,
          s(:send,
            s(:const,
              s(:const, nil, :RbConfig), :MAKEFILE_CONFIG), :each),
          s(:args,
            s(:arg, :key),
            s(:arg, :val)),
          s(:begin,
            s(:if,
              s(:match_with_lvasgn,
                s(:regexp,
                  s(:str, "\\Asite(?!arch)"),
                  s(:regopt)),
                s(:lvar, :key)), nil,
              s(:next)),
            s(:if,
              s(:send,
                s(:cvar, :@@with_config), :[],
                s(:lvar, :key)),
              s(:next), nil),
            s(:send, nil, :assert_match,
              s(:regexp,
                s(:str, "(?:\\$\\(|/)site"),
                s(:regopt)),
              s(:lvar, :val),
              s(:lvar, :key))))),
      s(:def, :test_vendordirs,
        s(:args),
        s(:block,
          s(:send,
            s(:const,
              s(:const, nil, :RbConfig), :MAKEFILE_CONFIG), :each),
          s(:args,
            s(:arg, :key),
            s(:arg, :val)),
          s(:begin,
            s(:if,
              s(:match_with_lvasgn,
                s(:regexp,
                  s(:str, "\\Avendor(?!arch)"),
                  s(:regopt)),
                s(:lvar, :key)), nil,
              s(:next)),
            s(:if,
              s(:send,
                s(:cvar, :@@with_config), :[],
                s(:lvar, :key)),
              s(:next), nil),
            s(:send, nil, :assert_match,
              s(:regexp,
                s(:str, "(?:\\$\\(|/)vendor"),
                s(:regopt)),
              s(:lvar, :val),
              s(:lvar, :key))))),
      s(:def, :test_archdirs,
        s(:args),
        s(:block,
          s(:send,
            s(:const,
              s(:const, nil, :RbConfig), :MAKEFILE_CONFIG), :each),
          s(:args,
            s(:arg, :key),
            s(:arg, :val)),
          s(:begin,
            s(:if,
              s(:match_with_lvasgn,
                s(:regexp,
                  s(:str, "\\A(?!site|vendor|archdir\\z).*arch.*dir\\z"),
                  s(:regopt)),
                s(:lvar, :key)), nil,
              s(:next)),
            s(:if,
              s(:send,
                s(:cvar, :@@with_config), :[],
                s(:lvar, :key)),
              s(:next), nil),
            s(:send, nil, :assert_match,
              s(:regexp,
                s(:str, "\\$\\(arch|\\$\\(rubyarchprefix\\)"),
                s(:regopt)),
              s(:lvar, :val),
              s(:lvar, :key))))),
      s(:def, :test_sitearchdirs,
        s(:args),
        s(:begin,
          s(:lvasgn, :bug7823,
            s(:str, "[ruby-dev:46964] [Bug #7823]")),
          s(:block,
            s(:send,
              s(:const,
                s(:const, nil, :RbConfig), :MAKEFILE_CONFIG), :each),
            s(:args,
              s(:arg, :key),
              s(:arg, :val)),
            s(:begin,
              s(:if,
                s(:match_with_lvasgn,
                  s(:regexp,
                    s(:str, "\\Asite.*arch.*dir\\z"),
                    s(:regopt)),
                  s(:lvar, :key)), nil,
                s(:next)),
              s(:if,
                s(:send,
                  s(:cvar, :@@with_config), :[],
                  s(:lvar, :key)),
                s(:next), nil),
              s(:send, nil, :assert_match,
                s(:regexp,
                  s(:str, "\\$\\(sitearch|\\$\\(rubysitearchprefix\\)"),
                  s(:regopt)),
                s(:lvar, :val),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :key)),
                  s(:str, " "),
                  s(:begin,
                    s(:lvar, :bug7823)))))))),
      s(:def, :test_vendorarchdirs,
        s(:args),
        s(:begin,
          s(:lvasgn, :bug7823,
            s(:str, "[ruby-dev:46964] [Bug #7823]")),
          s(:block,
            s(:send,
              s(:const,
                s(:const, nil, :RbConfig), :MAKEFILE_CONFIG), :each),
            s(:args,
              s(:arg, :key),
              s(:arg, :val)),
            s(:begin,
              s(:if,
                s(:match_with_lvasgn,
                  s(:regexp,
                    s(:str, "\\Avendor.*arch.*dir\\z"),
                    s(:regopt)),
                  s(:lvar, :key)), nil,
                s(:next)),
              s(:if,
                s(:send,
                  s(:cvar, :@@with_config), :[],
                  s(:lvar, :key)),
                s(:next), nil),
              s(:send, nil, :assert_match,
                s(:regexp,
                  s(:str, "\\$\\(sitearch|\\$\\(rubysitearchprefix\\)"),
                  s(:regopt)),
                s(:lvar, :val),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :key)),
                  s(:str, " "),
                  s(:begin,
                    s(:lvar, :bug7823)))))))))))

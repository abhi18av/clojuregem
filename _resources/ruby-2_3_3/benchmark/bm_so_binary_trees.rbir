s(:begin,
  s(:alias,
    s(:sym, :puts_orig),
    s(:sym, :puts)),
  s(:def, :puts,
    s(:args,
      s(:arg, :str)), nil),
  s(:def, :item_check,
    s(:args,
      s(:arg, :tree)),
    s(:if,
      s(:send,
        s(:send,
          s(:lvar, :tree), :[],
          s(:int, 0)), :==,
        s(:nil)),
      s(:send,
        s(:lvar, :tree), :[],
        s(:int, 1)),
      s(:send,
        s(:send,
          s(:send,
            s(:lvar, :tree), :[],
            s(:int, 1)), :+,
          s(:send, nil, :item_check,
            s(:send,
              s(:lvar, :tree), :[],
              s(:int, 0)))), :-,
        s(:send, nil, :item_check,
          s(:send,
            s(:lvar, :tree), :[],
            s(:int, 2)))))),
  s(:def, :bottom_up_tree,
    s(:args,
      s(:arg, :item),
      s(:arg, :depth)),
    s(:if,
      s(:send,
        s(:lvar, :depth), :>,
        s(:int, 0)),
      s(:begin,
        s(:lvasgn, :item_item,
          s(:send,
            s(:int, 2), :*,
            s(:lvar, :item))),
        s(:op_asgn,
          s(:lvasgn, :depth), :-,
          s(:int, 1)),
        s(:array,
          s(:send, nil, :bottom_up_tree,
            s(:send,
              s(:lvar, :item_item), :-,
              s(:int, 1)),
            s(:lvar, :depth)),
          s(:lvar, :item),
          s(:send, nil, :bottom_up_tree,
            s(:lvar, :item_item),
            s(:lvar, :depth)))),
      s(:array,
        s(:nil),
        s(:lvar, :item),
        s(:nil)))),
  s(:lvasgn, :max_depth,
    s(:int, 16)),
  s(:lvasgn, :min_depth,
    s(:int, 4)),
  s(:if,
    s(:send,
      s(:send,
        s(:lvar, :min_depth), :+,
        s(:int, 2)), :>,
      s(:lvar, :max_depth)),
    s(:lvasgn, :max_depth,
      s(:send,
        s(:lvar, :min_depth), :+,
        s(:int, 2))), nil),
  s(:lvasgn, :stretch_depth,
    s(:send,
      s(:lvar, :max_depth), :+,
      s(:int, 1))),
  s(:lvasgn, :stretch_tree,
    s(:send, nil, :bottom_up_tree,
      s(:int, 0),
      s(:lvar, :stretch_depth))),
  s(:send, nil, :puts,
    s(:dstr,
      s(:str, "stretch tree of depth "),
      s(:begin,
        s(:lvar, :stretch_depth)),
      s(:str, "\t check: "),
      s(:begin,
        s(:send, nil, :item_check,
          s(:lvar, :stretch_tree))))),
  s(:lvasgn, :stretch_tree,
    s(:nil)),
  s(:lvasgn, :long_lived_tree,
    s(:send, nil, :bottom_up_tree,
      s(:int, 0),
      s(:lvar, :max_depth))),
  s(:block,
    s(:send,
      s(:lvar, :min_depth), :step,
      s(:send,
        s(:lvar, :max_depth), :+,
        s(:int, 1)),
      s(:int, 2)),
    s(:args,
      s(:arg, :depth)),
    s(:begin,
      s(:lvasgn, :iterations,
        s(:send,
          s(:int, 2), :**,
          s(:begin,
            s(:send,
              s(:send,
                s(:lvar, :max_depth), :-,
                s(:lvar, :depth)), :+,
              s(:lvar, :min_depth))))),
      s(:lvasgn, :check,
        s(:int, 0)),
      s(:for,
        s(:lvasgn, :i),
        s(:irange,
          s(:int, 1),
          s(:lvar, :iterations)),
        s(:begin,
          s(:lvasgn, :temp_tree,
            s(:send, nil, :bottom_up_tree,
              s(:lvar, :i),
              s(:lvar, :depth))),
          s(:op_asgn,
            s(:lvasgn, :check), :+,
            s(:send, nil, :item_check,
              s(:lvar, :temp_tree))),
          s(:lvasgn, :temp_tree,
            s(:send, nil, :bottom_up_tree,
              s(:send,
                s(:lvar, :i), :-@),
              s(:lvar, :depth))),
          s(:op_asgn,
            s(:lvasgn, :check), :+,
            s(:send, nil, :item_check,
              s(:lvar, :temp_tree))))),
      s(:send, nil, :puts,
        s(:dstr,
          s(:begin,
            s(:send,
              s(:lvar, :iterations), :*,
              s(:int, 2))),
          s(:str, "\t trees of depth "),
          s(:begin,
            s(:lvar, :depth)),
          s(:str, "\t check: "),
          s(:begin,
            s(:lvar, :check)))))),
  s(:send, nil, :puts,
    s(:dstr,
      s(:str, "long lived tree of depth "),
      s(:begin,
        s(:lvar, :max_depth)),
      s(:str, "\t check: "),
      s(:begin,
        s(:send, nil, :item_check,
          s(:lvar, :long_lived_tree))))),
  s(:undef,
    s(:sym, :puts)),
  s(:alias,
    s(:sym, :puts),
    s(:sym, :puts_orig)))

s(:begin,
  s(:casgn, nil, :SOLAR_MASS,
    s(:send,
      s(:int, 4), :*,
      s(:send,
        s(:const,
          s(:const, nil, :Math), :PI), :**,
        s(:int, 2)))),
  s(:casgn, nil, :DAYS_PER_YEAR,
    s(:float, 365.24)),
  s(:def, :_puts,
    s(:args,
      s(:restarg, :args)), nil),
  s(:class,
    s(:const, nil, :Planet), nil,
    s(:begin,
      s(:send, nil, :attr_accessor,
        s(:sym, :x),
        s(:sym, :y),
        s(:sym, :z),
        s(:sym, :vx),
        s(:sym, :vy),
        s(:sym, :vz),
        s(:sym, :mass)),
      s(:def, :initialize,
        s(:args,
          s(:arg, :x),
          s(:arg, :y),
          s(:arg, :z),
          s(:arg, :vx),
          s(:arg, :vy),
          s(:arg, :vz),
          s(:arg, :mass)),
        s(:begin,
          s(:masgn,
            s(:mlhs,
              s(:ivasgn, :@x),
              s(:ivasgn, :@y),
              s(:ivasgn, :@z)),
            s(:array,
              s(:lvar, :x),
              s(:lvar, :y),
              s(:lvar, :z))),
          s(:masgn,
            s(:mlhs,
              s(:ivasgn, :@vx),
              s(:ivasgn, :@vy),
              s(:ivasgn, :@vz)),
            s(:array,
              s(:send,
                s(:lvar, :vx), :*,
                s(:const, nil, :DAYS_PER_YEAR)),
              s(:send,
                s(:lvar, :vy), :*,
                s(:const, nil, :DAYS_PER_YEAR)),
              s(:send,
                s(:lvar, :vz), :*,
                s(:const, nil, :DAYS_PER_YEAR)))),
          s(:ivasgn, :@mass,
            s(:send,
              s(:lvar, :mass), :*,
              s(:const, nil, :SOLAR_MASS))))),
      s(:def, :move_from_i,
        s(:args,
          s(:arg, :bodies),
          s(:arg, :nbodies),
          s(:arg, :dt),
          s(:arg, :i)),
        s(:begin,
          s(:while,
            s(:send,
              s(:lvar, :i), :<,
              s(:lvar, :nbodies)),
            s(:begin,
              s(:lvasgn, :b2,
                s(:send,
                  s(:lvar, :bodies), :[],
                  s(:lvar, :i))),
              s(:lvasgn, :dx,
                s(:send,
                  s(:ivar, :@x), :-,
                  s(:send,
                    s(:lvar, :b2), :x))),
              s(:lvasgn, :dy,
                s(:send,
                  s(:ivar, :@y), :-,
                  s(:send,
                    s(:lvar, :b2), :y))),
              s(:lvasgn, :dz,
                s(:send,
                  s(:ivar, :@z), :-,
                  s(:send,
                    s(:lvar, :b2), :z))),
              s(:lvasgn, :distance,
                s(:send,
                  s(:const, nil, :Math), :sqrt,
                  s(:send,
                    s(:send,
                      s(:send,
                        s(:lvar, :dx), :*,
                        s(:lvar, :dx)), :+,
                      s(:send,
                        s(:lvar, :dy), :*,
                        s(:lvar, :dy))), :+,
                    s(:send,
                      s(:lvar, :dz), :*,
                      s(:lvar, :dz))))),
              s(:lvasgn, :mag,
                s(:send,
                  s(:lvar, :dt), :/,
                  s(:begin,
                    s(:send,
                      s(:send,
                        s(:lvar, :distance), :*,
                        s(:lvar, :distance)), :*,
                      s(:lvar, :distance))))),
              s(:masgn,
                s(:mlhs,
                  s(:lvasgn, :b_mass_mag),
                  s(:lvasgn, :b2_mass_mag)),
                s(:array,
                  s(:send,
                    s(:ivar, :@mass), :*,
                    s(:lvar, :mag)),
                  s(:send,
                    s(:send,
                      s(:lvar, :b2), :mass), :*,
                    s(:lvar, :mag)))),
              s(:op_asgn,
                s(:ivasgn, :@vx), :-,
                s(:send,
                  s(:lvar, :dx), :*,
                  s(:lvar, :b2_mass_mag))),
              s(:op_asgn,
                s(:ivasgn, :@vy), :-,
                s(:send,
                  s(:lvar, :dy), :*,
                  s(:lvar, :b2_mass_mag))),
              s(:op_asgn,
                s(:ivasgn, :@vz), :-,
                s(:send,
                  s(:lvar, :dz), :*,
                  s(:lvar, :b2_mass_mag))),
              s(:op_asgn,
                s(:send,
                  s(:lvar, :b2), :vx), :+,
                s(:send,
                  s(:lvar, :dx), :*,
                  s(:lvar, :b_mass_mag))),
              s(:op_asgn,
                s(:send,
                  s(:lvar, :b2), :vy), :+,
                s(:send,
                  s(:lvar, :dy), :*,
                  s(:lvar, :b_mass_mag))),
              s(:op_asgn,
                s(:send,
                  s(:lvar, :b2), :vz), :+,
                s(:send,
                  s(:lvar, :dz), :*,
                  s(:lvar, :b_mass_mag))),
              s(:op_asgn,
                s(:lvasgn, :i), :+,
                s(:int, 1)))),
          s(:op_asgn,
            s(:ivasgn, :@x), :+,
            s(:send,
              s(:lvar, :dt), :*,
              s(:ivar, :@vx))),
          s(:op_asgn,
            s(:ivasgn, :@y), :+,
            s(:send,
              s(:lvar, :dt), :*,
              s(:ivar, :@vy))),
          s(:op_asgn,
            s(:ivasgn, :@z), :+,
            s(:send,
              s(:lvar, :dt), :*,
              s(:ivar, :@vz))))))),
  s(:def, :energy,
    s(:args,
      s(:arg, :bodies)),
    s(:begin,
      s(:lvasgn, :e,
        s(:float, 0.0)),
      s(:lvasgn, :nbodies,
        s(:send,
          s(:lvar, :bodies), :size)),
      s(:for,
        s(:lvasgn, :i),
        s(:erange,
          s(:int, 0),
          s(:lvar, :nbodies)),
        s(:begin,
          s(:lvasgn, :b,
            s(:send,
              s(:lvar, :bodies), :[],
              s(:lvar, :i))),
          s(:op_asgn,
            s(:lvasgn, :e), :+,
            s(:send,
              s(:send,
                s(:float, 0.5), :*,
                s(:send,
                  s(:lvar, :b), :mass)), :*,
              s(:begin,
                s(:send,
                  s(:send,
                    s(:send,
                      s(:send,
                        s(:lvar, :b), :vx), :*,
                      s(:send,
                        s(:lvar, :b), :vx)), :+,
                    s(:send,
                      s(:send,
                        s(:lvar, :b), :vy), :*,
                      s(:send,
                        s(:lvar, :b), :vy))), :+,
                  s(:send,
                    s(:send,
                      s(:lvar, :b), :vz), :*,
                    s(:send,
                      s(:lvar, :b), :vz)))))),
          s(:for,
            s(:lvasgn, :j),
            s(:erange,
              s(:begin,
                s(:send,
                  s(:lvar, :i), :+,
                  s(:int, 1))),
              s(:lvar, :nbodies)),
            s(:begin,
              s(:lvasgn, :b2,
                s(:send,
                  s(:lvar, :bodies), :[],
                  s(:lvar, :j))),
              s(:lvasgn, :dx,
                s(:send,
                  s(:send,
                    s(:lvar, :b), :x), :-,
                  s(:send,
                    s(:lvar, :b2), :x))),
              s(:lvasgn, :dy,
                s(:send,
                  s(:send,
                    s(:lvar, :b), :y), :-,
                  s(:send,
                    s(:lvar, :b2), :y))),
              s(:lvasgn, :dz,
                s(:send,
                  s(:send,
                    s(:lvar, :b), :z), :-,
                  s(:send,
                    s(:lvar, :b2), :z))),
              s(:lvasgn, :distance,
                s(:send,
                  s(:const, nil, :Math), :sqrt,
                  s(:send,
                    s(:send,
                      s(:send,
                        s(:lvar, :dx), :*,
                        s(:lvar, :dx)), :+,
                      s(:send,
                        s(:lvar, :dy), :*,
                        s(:lvar, :dy))), :+,
                    s(:send,
                      s(:lvar, :dz), :*,
                      s(:lvar, :dz))))),
              s(:op_asgn,
                s(:lvasgn, :e), :-,
                s(:send,
                  s(:begin,
                    s(:send,
                      s(:send,
                        s(:lvar, :b), :mass), :*,
                      s(:send,
                        s(:lvar, :b2), :mass))), :/,
                  s(:lvar, :distance))))))),
      s(:lvar, :e))),
  s(:def, :offset_momentum,
    s(:args,
      s(:arg, :bodies)),
    s(:begin,
      s(:masgn,
        s(:mlhs,
          s(:lvasgn, :px),
          s(:lvasgn, :py),
          s(:lvasgn, :pz)),
        s(:array,
          s(:float, 0.0),
          s(:float, 0.0),
          s(:float, 0.0))),
      s(:for,
        s(:lvasgn, :b),
        s(:lvar, :bodies),
        s(:begin,
          s(:lvasgn, :m,
            s(:send,
              s(:lvar, :b), :mass)),
          s(:op_asgn,
            s(:lvasgn, :px), :+,
            s(:send,
              s(:send,
                s(:lvar, :b), :vx), :*,
              s(:lvar, :m))),
          s(:op_asgn,
            s(:lvasgn, :py), :+,
            s(:send,
              s(:send,
                s(:lvar, :b), :vy), :*,
              s(:lvar, :m))),
          s(:op_asgn,
            s(:lvasgn, :pz), :+,
            s(:send,
              s(:send,
                s(:lvar, :b), :vz), :*,
              s(:lvar, :m))))),
      s(:lvasgn, :b,
        s(:send,
          s(:lvar, :bodies), :[],
          s(:int, 0))),
      s(:send,
        s(:lvar, :b), :vx=,
        s(:send,
          s(:send,
            s(:lvar, :px), :-@), :/,
          s(:const, nil, :SOLAR_MASS))),
      s(:send,
        s(:lvar, :b), :vy=,
        s(:send,
          s(:send,
            s(:lvar, :py), :-@), :/,
          s(:const, nil, :SOLAR_MASS))),
      s(:send,
        s(:lvar, :b), :vz=,
        s(:send,
          s(:send,
            s(:lvar, :pz), :-@), :/,
          s(:const, nil, :SOLAR_MASS))))),
  s(:casgn, nil, :BODIES,
    s(:array,
      s(:send,
        s(:const, nil, :Planet), :new,
        s(:float, 0.0),
        s(:float, 0.0),
        s(:float, 0.0),
        s(:float, 0.0),
        s(:float, 0.0),
        s(:float, 0.0),
        s(:float, 1.0)),
      s(:send,
        s(:const, nil, :Planet), :new,
        s(:float, 4.841431442464721),
        s(:float, -1.1603200440274282),
        s(:float, -0.10362204447112311),
        s(:float, 0.001660076642744036),
        s(:float, 0.007699011184197404),
        s(:float, -6.90460016972063e-05),
        s(:float, 0.0009547919384243266)),
      s(:send,
        s(:const, nil, :Planet), :new,
        s(:float, 8.34336671824458),
        s(:float, 4.124798564124305),
        s(:float, -0.4035234171143213),
        s(:float, -0.002767425107268624),
        s(:float, 0.004998528012349172),
        s(:float, 2.3041729757376393e-05),
        s(:float, 0.0002858859806661308)),
      s(:send,
        s(:const, nil, :Planet), :new,
        s(:float, 12.894369562139131),
        s(:float, -15.111151401698631),
        s(:float, -0.22330757889265573),
        s(:float, 0.002964601375647616),
        s(:float, 0.0023784717395948095),
        s(:float, -2.9658956854023752e-05),
        s(:float, 4.366244043351562e-05)),
      s(:send,
        s(:const, nil, :Planet), :new,
        s(:float, 15.379697114850911),
        s(:float, -25.919314609987964),
        s(:float, 0.17925877295037113),
        s(:float, 0.0026806777249038932),
        s(:float, 0.0016282417003824223),
        s(:float, -9.515922545197159e-05),
        s(:float, 5.1513890204661145e-05)))),
  s(:lvasgn, :init,
    s(:int, 200000)),
  s(:lvasgn, :n,
    s(:send, nil, :Integer,
      s(:lvar, :init))),
  s(:send, nil, :offset_momentum,
    s(:const, nil, :BODIES)),
  s(:send, nil, :puts,
    s(:send,
      s(:str, "%.9f"), :%,
      s(:send, nil, :energy,
        s(:const, nil, :BODIES)))),
  s(:lvasgn, :nbodies,
    s(:send,
      s(:const, nil, :BODIES), :size)),
  s(:lvasgn, :dt,
    s(:float, 0.01)),
  s(:block,
    s(:send,
      s(:lvar, :n), :times),
    s(:args),
    s(:begin,
      s(:lvasgn, :i,
        s(:int, 0)),
      s(:while,
        s(:send,
          s(:lvar, :i), :<,
          s(:lvar, :nbodies)),
        s(:begin,
          s(:lvasgn, :b,
            s(:send,
              s(:const, nil, :BODIES), :[],
              s(:lvar, :i))),
          s(:send,
            s(:lvar, :b), :move_from_i,
            s(:const, nil, :BODIES),
            s(:lvar, :nbodies),
            s(:lvar, :dt),
            s(:send,
              s(:lvar, :i), :+,
              s(:int, 1))),
          s(:op_asgn,
            s(:lvasgn, :i), :+,
            s(:int, 1)))))),
  s(:send, nil, :puts,
    s(:send,
      s(:str, "%.9f"), :%,
      s(:send, nil, :energy,
        s(:const, nil, :BODIES)))))

s(:begin,
  s(:if,
    s(:and,
      s(:defined?,
        s(:const,
          s(:const,
            s(:cbase), :JSON), :JSON_LOADED)),
      s(:const,
        s(:const,
          s(:cbase), :JSON), :JSON_LOADED)), nil,
    s(:send, nil, :require,
      s(:str, "json"))),
  s(:send, nil, :require,
    s(:str, "date")),
  s(:class,
    s(:const, nil, :DateTime), nil,
    s(:begin,
      s(:defs,
        s(:self), :json_create,
        s(:args,
          s(:arg, :object)),
        s(:begin,
          s(:lvasgn, :args,
            s(:send,
              s(:lvar, :object), :values_at,
              s(:str, "y"),
              s(:str, "m"),
              s(:str, "d"),
              s(:str, "H"),
              s(:str, "M"),
              s(:str, "S"))),
          s(:masgn,
            s(:mlhs,
              s(:lvasgn, :of_a),
              s(:lvasgn, :of_b)),
            s(:send,
              s(:send,
                s(:lvar, :object), :[],
                s(:str, "of")), :split,
              s(:str, "/"))),
          s(:if,
            s(:and,
              s(:lvar, :of_b),
              s(:send,
                s(:lvar, :of_b), :!=,
                s(:str, "0"))),
            s(:send,
              s(:lvar, :args), :<<,
              s(:send, nil, :Rational,
                s(:send,
                  s(:lvar, :of_a), :to_i),
                s(:send,
                  s(:lvar, :of_b), :to_i))),
            s(:send,
              s(:lvar, :args), :<<,
              s(:lvar, :of_a))),
          s(:send,
            s(:lvar, :args), :<<,
            s(:send,
              s(:lvar, :object), :[],
              s(:str, "sg"))),
          s(:send, nil, :civil,
            s(:splat,
              s(:lvar, :args))))),
      s(:if,
        s(:send, nil, :method_defined?,
          s(:sym, :start)), nil,
        s(:alias,
          s(:sym, :start),
          s(:sym, :sg))),
      s(:def, :as_json,
        s(:args,
          s(:restarg)),
        s(:hash,
          s(:pair,
            s(:send,
              s(:const, nil, :JSON), :create_id),
            s(:send,
              s(:send,
                s(:self), :class), :name)),
          s(:pair,
            s(:str, "y"),
            s(:send, nil, :year)),
          s(:pair,
            s(:str, "m"),
            s(:send, nil, :month)),
          s(:pair,
            s(:str, "d"),
            s(:send, nil, :day)),
          s(:pair,
            s(:str, "H"),
            s(:send, nil, :hour)),
          s(:pair,
            s(:str, "M"),
            s(:send, nil, :min)),
          s(:pair,
            s(:str, "S"),
            s(:send, nil, :sec)),
          s(:pair,
            s(:str, "of"),
            s(:send,
              s(:send, nil, :offset), :to_s)),
          s(:pair,
            s(:str, "sg"),
            s(:send, nil, :start)))),
      s(:def, :to_json,
        s(:args,
          s(:restarg, :args)),
        s(:send,
          s(:send, nil, :as_json), :to_json,
          s(:splat,
            s(:lvar, :args)))))))

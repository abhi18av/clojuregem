s(:begin,
  s(:if,
    s(:and,
      s(:defined?,
        s(:const,
          s(:const,
            s(:cbase), :JSON), :JSON_LOADED)),
      s(:const,
        s(:const,
          s(:cbase), :JSON), :JSON_LOADED)), nil,
    s(:send, nil, :require,
      s(:str, "json"))),
  s(:class,
    s(:const, nil, :Time), nil,
    s(:begin,
      s(:defs,
        s(:self), :json_create,
        s(:args,
          s(:arg, :object)),
        s(:begin,
          s(:if,
            s(:lvasgn, :usec,
              s(:send,
                s(:lvar, :object), :delete,
                s(:str, "u"))),
            s(:send,
              s(:lvar, :object), :[]=,
              s(:str, "n"),
              s(:send,
                s(:lvar, :usec), :*,
                s(:int, 1000))), nil),
          s(:if,
            s(:send, nil, :method_defined?,
              s(:sym, :tv_nsec)),
            s(:send, nil, :at,
              s(:send,
                s(:lvar, :object), :[],
                s(:str, "s")),
              s(:send, nil, :Rational,
                s(:send,
                  s(:lvar, :object), :[],
                  s(:str, "n")),
                s(:int, 1000))),
            s(:send, nil, :at,
              s(:send,
                s(:lvar, :object), :[],
                s(:str, "s")),
              s(:send,
                s(:send,
                  s(:lvar, :object), :[],
                  s(:str, "n")), :/,
                s(:int, 1000)))))),
      s(:def, :as_json,
        s(:args,
          s(:restarg)),
        s(:begin,
          s(:lvasgn, :nanoseconds,
            s(:array,
              s(:send,
                s(:send, nil, :tv_usec), :*,
                s(:int, 1000)))),
          s(:and,
            s(:send, nil, :respond_to?,
              s(:sym, :tv_nsec)),
            s(:send,
              s(:lvar, :nanoseconds), :<<,
              s(:send, nil, :tv_nsec))),
          s(:lvasgn, :nanoseconds,
            s(:send,
              s(:lvar, :nanoseconds), :max)),
          s(:hash,
            s(:pair,
              s(:send,
                s(:const, nil, :JSON), :create_id),
              s(:send,
                s(:send,
                  s(:self), :class), :name)),
            s(:pair,
              s(:str, "s"),
              s(:send, nil, :tv_sec)),
            s(:pair,
              s(:str, "n"),
              s(:lvar, :nanoseconds))))),
      s(:def, :to_json,
        s(:args,
          s(:restarg, :args)),
        s(:send,
          s(:send, nil, :as_json), :to_json,
          s(:splat,
            s(:lvar, :args)))))))

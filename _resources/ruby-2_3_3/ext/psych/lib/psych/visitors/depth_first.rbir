s(:module,
  s(:const, nil, :Psych),
  s(:module,
    s(:const, nil, :Visitors),
    s(:class,
      s(:const, nil, :DepthFirst),
      s(:const,
        s(:const,
          s(:const, nil, :Psych), :Visitors), :Visitor),
      s(:begin,
        s(:def, :initialize,
          s(:args,
            s(:arg, :block)),
          s(:ivasgn, :@block,
            s(:lvar, :block))),
        s(:send, nil, :private),
        s(:def, :nary,
          s(:args,
            s(:arg, :o)),
          s(:begin,
            s(:block,
              s(:send,
                s(:send,
                  s(:lvar, :o), :children), :each),
              s(:args,
                s(:arg, :x)),
              s(:send, nil, :visit,
                s(:lvar, :x))),
            s(:send,
              s(:ivar, :@block), :call,
              s(:lvar, :o)))),
        s(:alias,
          s(:sym, :visit_Psych_Nodes_Stream),
          s(:sym, :nary)),
        s(:alias,
          s(:sym, :visit_Psych_Nodes_Document),
          s(:sym, :nary)),
        s(:alias,
          s(:sym, :visit_Psych_Nodes_Sequence),
          s(:sym, :nary)),
        s(:alias,
          s(:sym, :visit_Psych_Nodes_Mapping),
          s(:sym, :nary)),
        s(:def, :terminal,
          s(:args,
            s(:arg, :o)),
          s(:send,
            s(:ivar, :@block), :call,
            s(:lvar, :o))),
        s(:alias,
          s(:sym, :visit_Psych_Nodes_Scalar),
          s(:sym, :terminal)),
        s(:alias,
          s(:sym, :visit_Psych_Nodes_Alias),
          s(:sym, :terminal))))))

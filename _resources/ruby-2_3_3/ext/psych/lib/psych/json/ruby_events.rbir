s(:module,
  s(:const, nil, :Psych),
  s(:module,
    s(:const, nil, :JSON),
    s(:module,
      s(:const, nil, :RubyEvents),
      s(:begin,
        s(:def, :visit_Time,
          s(:args,
            s(:arg, :o)),
          s(:begin,
            s(:lvasgn, :formatted,
              s(:send, nil, :format_time,
                s(:lvar, :o))),
            s(:send,
              s(:ivar, :@emitter), :scalar,
              s(:lvar, :formatted),
              s(:nil),
              s(:nil),
              s(:false),
              s(:true),
              s(:const,
                s(:const,
                  s(:const, nil, :Nodes), :Scalar), :DOUBLE_QUOTED)))),
        s(:def, :visit_DateTime,
          s(:args,
            s(:arg, :o)),
          s(:send, nil, :visit_Time,
            s(:send,
              s(:lvar, :o), :to_time))),
        s(:def, :visit_String,
          s(:args,
            s(:arg, :o)),
          s(:send,
            s(:ivar, :@emitter), :scalar,
            s(:send,
              s(:lvar, :o), :to_s),
            s(:nil),
            s(:nil),
            s(:false),
            s(:true),
            s(:const,
              s(:const,
                s(:const, nil, :Nodes), :Scalar), :DOUBLE_QUOTED))),
        s(:alias,
          s(:sym, :visit_Symbol),
          s(:sym, :visit_String))))))

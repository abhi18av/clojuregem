s(:begin,
  s(:send, nil, :require,
    s(:str, "stringio")),
  s(:send, nil, :require,
    s(:str, "psych/class_loader")),
  s(:send, nil, :require,
    s(:str, "psych/scalar_scanner")),
  s(:module,
    s(:const, nil, :Psych),
    s(:module,
      s(:const, nil, :Nodes),
      s(:class,
        s(:const, nil, :Node), nil,
        s(:begin,
          s(:send, nil, :include,
            s(:const, nil, :Enumerable)),
          s(:send, nil, :attr_reader,
            s(:sym, :children)),
          s(:send, nil, :attr_reader,
            s(:sym, :tag)),
          s(:def, :initialize,
            s(:args),
            s(:ivasgn, :@children,
              s(:array))),
          s(:def, :each,
            s(:args,
              s(:blockarg, :block)),
            s(:begin,
              s(:if,
                s(:send, nil, :block_given?), nil,
                s(:return,
                  s(:send, nil, :enum_for,
                    s(:sym, :each)))),
              s(:send,
                s(:send,
                  s(:const,
                    s(:const, nil, :Visitors), :DepthFirst), :new,
                  s(:lvar, :block)), :accept,
                s(:self)))),
          s(:def, :to_ruby,
            s(:args),
            s(:send,
              s(:send,
                s(:const,
                  s(:const, nil, :Visitors), :ToRuby), :create), :accept,
              s(:self))),
          s(:alias,
            s(:sym, :transform),
            s(:sym, :to_ruby)),
          s(:def, :yaml,
            s(:args,
              s(:optarg, :io,
                s(:nil)),
              s(:optarg, :options,
                s(:hash))),
            s(:begin,
              s(:lvasgn, :real_io,
                s(:or,
                  s(:lvar, :io),
                  s(:send,
                    s(:const, nil, :StringIO), :new,
                    s(:send,
                      s(:str, ""), :encode,
                      s(:str, "utf-8"))))),
              s(:send,
                s(:send,
                  s(:const,
                    s(:const, nil, :Visitors), :Emitter), :new,
                  s(:lvar, :real_io),
                  s(:lvar, :options)), :accept,
                s(:self)),
              s(:if,
                s(:lvar, :io), nil,
                s(:return,
                  s(:send,
                    s(:lvar, :real_io), :string))),
              s(:lvar, :io))),
          s(:alias,
            s(:sym, :to_yaml),
            s(:sym, :yaml)))))))

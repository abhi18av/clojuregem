s(:begin,
  s(:send, nil, :require,
    s(:str, "mkmf")),
  s(:lvasgn, :target,
    s(:str, "io/nonblock")),
  s(:lvasgn, :hdr,
    s(:array,
      s(:str, "fcntl.h"))),
  s(:if,
    s(:and,
      s(:send, nil, :have_macro,
        s(:str, "O_NONBLOCK"),
        s(:lvar, :hdr)),
      s(:begin,
        s(:or,
          s(:send, nil, :have_macro,
            s(:str, "F_GETFL"),
            s(:lvar, :hdr)),
          s(:send, nil, :have_macro,
            s(:str, "F_SETFL"),
            s(:lvar, :hdr))))),
    s(:send, nil, :create_makefile,
      s(:lvar, :target)), nil))

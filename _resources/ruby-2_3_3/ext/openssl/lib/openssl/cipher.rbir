s(:module,
  s(:const, nil, :OpenSSL),
  s(:class,
    s(:const, nil, :Cipher), nil,
    s(:begin,
      s(:block,
        s(:send,
          s(:array,
            s(:str, "AES"),
            s(:str, "CAST5"),
            s(:str, "BF"),
            s(:str, "DES"),
            s(:str, "IDEA"),
            s(:str, "RC2"),
            s(:str, "RC4"),
            s(:str, "RC5")), :each),
        s(:args,
          s(:arg, :name)),
        s(:begin,
          s(:lvasgn, :klass,
            s(:block,
              s(:send,
                s(:const, nil, :Class), :new,
                s(:const, nil, :Cipher)),
              s(:args),
              s(:block,
                s(:send, nil, :define_method,
                  s(:sym, :initialize)),
                s(:args,
                  s(:restarg, :args)),
                s(:begin,
                  s(:lvasgn, :cipher_name,
                    s(:block,
                      s(:send,
                        s(:lvar, :args), :inject,
                        s(:lvar, :name)),
                      s(:args,
                        s(:arg, :n),
                        s(:arg, :arg)),
                      s(:dstr,
                        s(:begin,
                          s(:lvar, :n)),
                        s(:str, "-"),
                        s(:begin,
                          s(:lvar, :arg))))),
                  s(:super,
                    s(:lvar, :cipher_name)))))),
          s(:send, nil, :const_set,
            s(:lvar, :name),
            s(:lvar, :klass)))),
      s(:block,
        s(:send,
          s(:array,
            s(:str, "128"),
            s(:str, "192"),
            s(:str, "256")), :each),
        s(:args,
          s(:arg, :keylen)),
        s(:begin,
          s(:lvasgn, :klass,
            s(:block,
              s(:send,
                s(:const, nil, :Class), :new,
                s(:const, nil, :Cipher)),
              s(:args),
              s(:block,
                s(:send, nil, :define_method,
                  s(:sym, :initialize)),
                s(:args,
                  s(:arg, :mode)),
                s(:begin,
                  s(:or_asgn,
                    s(:lvasgn, :mode),
                    s(:str, "CBC")),
                  s(:lvasgn, :cipher_name,
                    s(:dstr,
                      s(:str, "AES-"),
                      s(:begin,
                        s(:lvar, :keylen)),
                      s(:str, "-"),
                      s(:begin,
                        s(:lvar, :mode)))),
                  s(:super,
                    s(:lvar, :cipher_name)))))),
          s(:send, nil, :const_set,
            s(:dstr,
              s(:str, "AES"),
              s(:begin,
                s(:lvar, :keylen))),
            s(:lvar, :klass)))),
      s(:def, :random_key,
        s(:args),
        s(:begin,
          s(:lvasgn, :str,
            s(:send,
              s(:const,
                s(:const, nil, :OpenSSL), :Random), :random_bytes,
              s(:send,
                s(:self), :key_len))),
          s(:send,
            s(:self), :key=,
            s(:lvar, :str)),
          s(:return,
            s(:lvar, :str)))),
      s(:def, :random_iv,
        s(:args),
        s(:begin,
          s(:lvasgn, :str,
            s(:send,
              s(:const,
                s(:const, nil, :OpenSSL), :Random), :random_bytes,
              s(:send,
                s(:self), :iv_len))),
          s(:send,
            s(:self), :iv=,
            s(:lvar, :str)),
          s(:return,
            s(:lvar, :str)))),
      s(:class,
        s(:const, nil, :Cipher),
        s(:const, nil, :Cipher), nil))))

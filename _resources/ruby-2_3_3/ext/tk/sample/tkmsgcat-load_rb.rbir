s(:begin,
  s(:send, nil, :require,
    s(:str, "tk")),
  s(:lvasgn, :demo_dir,
    s(:send,
      s(:const, nil, :File), :dirname,
      s(:gvar, :$0))),
  s(:lvasgn, :msgcat_dir,
    s(:send,
      s(:array,
        s(:lvar, :demo_dir),
        s(:str, "msgs_rb")), :join,
      s(:const,
        s(:const, nil, :File), :Separator))),
  s(:lvasgn, :top_win,
    s(:nil)),
  s(:lvasgn, :msgcat,
    s(:send,
      s(:const, nil, :TkMsgCatalog), :new,
      s(:str, "::tkmsgcat_demo"))),
  s(:lvasgn, :default_locale,
    s(:send,
      s(:lvar, :msgcat), :locale)),
  s(:send,
    s(:lvar, :msgcat), :load,
    s(:lvar, :msgcat_dir)),
  s(:lvasgn, :col_proc,
    s(:send,
      s(:const, nil, :TkComm), :install_bind,
      s(:block,
        s(:send, nil, :proc),
        s(:args,
          s(:arg, :w),
          s(:arg, :color),
          s(:arg, :frame),
          s(:arg, :label)),
        s(:begin,
          s(:send,
            s(:send,
              s(:const, nil, :TkComm), :window,
              s(:lvar, :frame)), :background,
            s(:lvar, :color)),
          s(:send,
            s(:const, nil, :Tk), :update),
          s(:send,
            s(:send,
              s(:const, nil, :TkComm), :window,
              s(:lvar, :label)), :text,
            s(:send,
              s(:lvar, :msgcat), :[],
              s(:str, "%1$s:: %2$s"),
              s(:str, "Color"),
              s(:send,
                s(:lvar, :color), :capitalize))),
          s(:send,
            s(:lvar, :w), :flash),
          s(:send,
            s(:lvar, :w), :flash),
          s(:send,
            s(:const, nil, :Tk), :callback_break))),
      s(:str, "%W"))),
  s(:lvasgn, :del_proc,
    s(:send,
      s(:const, nil, :TkComm), :install_cmd,
      s(:block,
        s(:send, nil, :proc),
        s(:args),
        s(:begin,
          s(:send,
            s(:lvar, :top_win), :destroy),
          s(:lvasgn, :top_win,
            s(:nil)))))),
  s(:lvasgn, :err_proc,
    s(:send,
      s(:const, nil, :TkComm), :install_cmd,
      s(:block,
        s(:send, nil, :proc),
        s(:args),
        s(:send, nil, :fail,
          s(:const, nil, :RuntimeError),
          s(:send,
            s(:lvar, :msgcat), :[],
            s(:str, "Application Error")))))),
  s(:lvasgn, :show_sample,
    s(:block,
      s(:send, nil, :proc),
      s(:args,
        s(:arg, :loc)),
      s(:begin,
        s(:lvasgn, :top_win,
          s(:send,
            s(:const, nil, :TkToplevel), :new,
            s(:hash,
              s(:pair,
                s(:sym, :title),
                s(:lvar, :loc))))),
        s(:send,
          s(:lvar, :msgcat), :locale=,
          s(:lvar, :loc)),
        s(:send,
          s(:lvar, :msgcat), :load,
          s(:lvar, :msgcat_dir)),
        s(:block,
          s(:send,
            s(:const, nil, :TkLabel), :new,
            s(:lvar, :top_win)),
          s(:args),
          s(:begin,
            s(:send, nil, :text,
              s(:dstr,
                s(:str, "preferences:: "),
                s(:begin,
                  s(:send,
                    s(:send,
                      s(:lvar, :msgcat), :preferences), :join,
                    s(:str, " "))))),
            s(:send, nil, :pack,
              s(:hash,
                s(:pair,
                  s(:sym, :pady),
                  s(:int, 10)),
                s(:pair,
                  s(:sym, :padx),
                  s(:int, 10)))))),
        s(:lvasgn, :lbl,
          s(:send,
            s(:send,
              s(:const, nil, :TkLabel), :new,
              s(:lvar, :top_win),
              s(:hash,
                s(:pair,
                  s(:sym, :text),
                  s(:send,
                    s(:lvar, :msgcat), :[],
                    s(:str, "%1$s:: %2$s"),
                    s(:str, "Color"),
                    s(:str, ""))))), :pack,
            s(:hash,
              s(:pair,
                s(:sym, :anchor),
                s(:str, "w"))))),
        s(:lvasgn, :bg,
          s(:send,
            s(:send,
              s(:const, nil, :TkFrame), :new,
              s(:lvar, :top_win)), :pack,
            s(:hash,
              s(:pair,
                s(:sym, :ipadx),
                s(:int, 20)),
              s(:pair,
                s(:sym, :ipady),
                s(:int, 10)),
              s(:pair,
                s(:sym, :expand),
                s(:true)),
              s(:pair,
                s(:sym, :fill),
                s(:sym, :both))))),
        s(:send,
          s(:block,
            s(:send,
              s(:const, nil, :TkFrame), :new,
              s(:lvar, :bg)),
            s(:args,
              s(:arg, :f)),
            s(:block,
              s(:send,
                s(:array,
                  s(:str, "blue"),
                  s(:str, "green"),
                  s(:str, "red")), :each),
              s(:args,
                s(:arg, :col)),
              s(:send,
                s(:block,
                  s(:send,
                    s(:const, nil, :TkButton), :new,
                    s(:lvar, :f),
                    s(:hash,
                      s(:pair,
                        s(:sym, :text),
                        s(:send,
                          s(:lvar, :msgcat), :[],
                          s(:lvar, :col))))),
                  s(:args),
                  s(:send, nil, :bind,
                    s(:str, "ButtonRelease-1"),
                    s(:lvar, :col_proc),
                    s(:dstr,
                      s(:begin,
                        s(:lvar, :col)),
                      s(:str, " "),
                      s(:begin,
                        s(:send,
                          s(:lvar, :bg), :path)),
                      s(:str, " "),
                      s(:begin,
                        s(:send,
                          s(:lvar, :lbl), :path))))), :pack,
                s(:hash,
                  s(:pair,
                    s(:sym, :fill),
                    s(:sym, :x)))))), :pack,
          s(:hash,
            s(:pair,
              s(:sym, :anchor),
              s(:str, "center")),
            s(:pair,
              s(:sym, :pady),
              s(:int, 15)))),
        s(:send,
          s(:block,
            s(:send,
              s(:const, nil, :TkFrame), :new,
              s(:lvar, :top_win)),
            s(:args,
              s(:arg, :f)),
            s(:begin,
              s(:send,
                s(:send,
                  s(:const, nil, :TkButton), :new,
                  s(:lvar, :f),
                  s(:hash,
                    s(:pair,
                      s(:sym, :text),
                      s(:send,
                        s(:lvar, :msgcat), :[],
                        s(:str, "Delete"))),
                    s(:pair,
                      s(:sym, :command),
                      s(:lvar, :del_proc)))), :pack,
                s(:hash,
                  s(:pair,
                    s(:sym, :side),
                    s(:sym, :right)),
                  s(:pair,
                    s(:sym, :padx),
                    s(:int, 5)))),
              s(:send,
                s(:send,
                  s(:const, nil, :TkButton), :new,
                  s(:lvar, :f),
                  s(:hash,
                    s(:pair,
                      s(:sym, :text),
                      s(:send,
                        s(:lvar, :msgcat), :[],
                        s(:str, "Error"))),
                    s(:pair,
                      s(:sym, :command),
                      s(:lvar, :err_proc)))), :pack,
                s(:hash,
                  s(:pair,
                    s(:sym, :side),
                    s(:sym, :left)),
                  s(:pair,
                    s(:sym, :padx),
                    s(:int, 5)))))), :pack,
          s(:hash,
            s(:pair,
              s(:sym, :side),
              s(:sym, :bottom)),
            s(:pair,
              s(:sym, :fill),
              s(:sym, :x)))),
        s(:lvar, :top_win)))),
  s(:send,
    s(:send,
      s(:const, nil, :TkLabel), :new,
      s(:hash,
        s(:pair,
          s(:sym, :text),
          s(:str, "Please click a locale.")))), :pack,
    s(:hash,
      s(:pair,
        s(:sym, :padx),
        s(:int, 5)),
      s(:pair,
        s(:sym, :pady),
        s(:int, 3)))),
  s(:send,
    s(:block,
      s(:send,
        s(:const, nil, :TkFrame), :new),
      s(:args,
        s(:arg, :f)),
      s(:send,
        s(:send,
          s(:const, nil, :TkButton), :new,
          s(:lvar, :f),
          s(:hash,
            s(:pair,
              s(:sym, :text),
              s(:send,
                s(:lvar, :msgcat), :[],
                s(:str, "Exit"))),
            s(:pair,
              s(:sym, :command),
              s(:block,
                s(:send, nil, :proc),
                s(:args),
                s(:send, nil, :exit))))), :pack,
        s(:hash,
          s(:pair,
            s(:sym, :side),
            s(:sym, :right)),
          s(:pair,
            s(:sym, :padx),
            s(:int, 5))))), :pack,
    s(:hash,
      s(:pair,
        s(:sym, :side),
        s(:sym, :bottom)),
      s(:pair,
        s(:sym, :fill),
        s(:sym, :x)))),
  s(:lvasgn, :f,
    s(:send,
      s(:send,
        s(:const, nil, :TkFrame), :new), :pack,
      s(:hash,
        s(:pair,
          s(:sym, :side),
          s(:sym, :top)),
        s(:pair,
          s(:sym, :fill),
          s(:sym, :both)),
        s(:pair,
          s(:sym, :expand),
          s(:true))))),
  s(:lvasgn, :lbox,
    s(:send,
      s(:send,
        s(:const, nil, :TkListbox), :new,
        s(:lvar, :f)), :pack,
      s(:hash,
        s(:pair,
          s(:sym, :side),
          s(:sym, :left)),
        s(:pair,
          s(:sym, :fill),
          s(:sym, :both)),
        s(:pair,
          s(:sym, :expand),
          s(:true))))),
  s(:send,
    s(:lvar, :lbox), :yscrollbar,
    s(:send,
      s(:send,
        s(:const, nil, :TkScrollbar), :new,
        s(:lvar, :f),
        s(:hash,
          s(:pair,
            s(:sym, :width),
            s(:int, 12)))), :pack,
      s(:hash,
        s(:pair,
          s(:sym, :side),
          s(:sym, :right)),
        s(:pair,
          s(:sym, :fill),
          s(:sym, :y))))),
  s(:block,
    s(:send,
      s(:lvar, :lbox), :bind,
      s(:str, "ButtonRelease-1")),
    s(:args,
      s(:arg, :ev)),
    s(:begin,
      s(:lvasgn, :idx,
        s(:send,
          s(:lvar, :lbox), :index,
          s(:dstr,
            s(:str, "@"),
            s(:begin,
              s(:send,
                s(:lvar, :ev), :x)),
            s(:str, ","),
            s(:begin,
              s(:send,
                s(:lvar, :ev), :y))))),
      s(:if,
        s(:send,
          s(:lvar, :idx), :==,
          s(:int, 0)),
        s(:lvasgn, :loc,
          s(:lvar, :default_locale)),
        s(:lvasgn, :loc,
          s(:send,
            s(:lvar, :lbox), :get,
            s(:lvar, :idx)))),
      s(:if,
        s(:and,
          s(:send,
            s(:lvar, :top_win), :!=,
            s(:nil)),
          s(:send,
            s(:lvar, :top_win), :exist?)),
        s(:send,
          s(:lvar, :top_win), :destroy), nil),
      s(:lvasgn, :top_win,
        s(:send,
          s(:lvar, :show_sample), :call,
          s(:lvar, :loc))))),
  s(:send,
    s(:lvar, :lbox), :insert,
    s(:str, "end"),
    s(:str, "default")),
  s(:block,
    s(:send,
      s(:send,
        s(:send,
          s(:const, nil, :Dir), :entries,
          s(:lvar, :msgcat_dir)), :sort), :each),
    s(:args,
      s(:arg, :f)),
    s(:if,
      s(:send,
        s(:lvar, :f), :=~,
        s(:regexp,
          s(:str, "^(.*).msg$"),
          s(:regopt))),
      s(:send,
        s(:lvar, :lbox), :insert,
        s(:str, "end"),
        s(:nth_ref, 1)), nil)),
  s(:lvasgn, :top_win,
    s(:send,
      s(:lvar, :show_sample), :call,
      s(:lvar, :default_locale))),
  s(:send,
    s(:const, nil, :Tk), :mainloop))

s(:begin,
  s(:if,
    s(:and,
      s(:defined?,
        s(:gvar, :$check2_demo)),
      s(:gvar, :$check2_demo)),
    s(:begin,
      s(:send,
        s(:gvar, :$check2_demo), :destroy),
      s(:gvasgn, :$check2_demo,
        s(:nil))), nil),
  s(:gvasgn, :$check2_demo,
    s(:block,
      s(:send,
        s(:const, nil, :TkToplevel), :new),
      s(:args,
        s(:arg, :w)),
      s(:begin,
        s(:send, nil, :title,
          s(:str, "Checkbutton Demonstration 2")),
        s(:send, nil, :iconname,
          s(:str, "check2")),
        s(:send, nil, :positionWindow,
          s(:lvar, :w))))),
  s(:lvasgn, :base_frame,
    s(:send,
      s(:send,
        s(:const, nil, :TkFrame), :new,
        s(:gvar, :$check2_demo)), :pack,
      s(:hash,
        s(:pair,
          s(:sym, :fill),
          s(:sym, :both)),
        s(:pair,
          s(:sym, :expand),
          s(:true))))),
  s(:lvasgn, :msg,
    s(:block,
      s(:send,
        s(:const, nil, :TkLabel), :new,
        s(:lvar, :base_frame)),
      s(:args),
      s(:begin,
        s(:send, nil, :font,
          s(:gvar, :$font)),
        s(:send, nil, :wraplength,
          s(:str, "4i")),
        s(:send, nil, :justify,
          s(:str, "left")),
        s(:send, nil, :text,
          s(:str, "Four checkbuttons are displayed below.  If you click on a button, it will toggle the button's selection state and set a Tcl variable to a value indicating the state of the checkbutton.  The first button also follows the state of the other three.  If only some of the three are checked, the first button will display the tri-state mode. Click the \"See Variables\" button to see the current values of the variables."))))),
  s(:send,
    s(:lvar, :msg), :pack,
    s(:hash,
      s(:pair,
        s(:str, "side"),
        s(:str, "top")))),
  s(:lvasgn, :safety,
    s(:send,
      s(:const, nil, :TkVariable), :new,
      s(:int, 0))),
  s(:lvasgn, :wipers,
    s(:send,
      s(:const, nil, :TkVariable), :new,
      s(:int, 0))),
  s(:lvasgn, :brakes,
    s(:send,
      s(:const, nil, :TkVariable), :new,
      s(:int, 0))),
  s(:lvasgn, :sober,
    s(:send,
      s(:const, nil, :TkVariable), :new,
      s(:int, 0))),
  s(:send,
    s(:block,
      s(:send,
        s(:const, nil, :TkFrame), :new,
        s(:lvar, :base_frame)),
      s(:args,
        s(:arg, :frame)),
      s(:begin,
        s(:send, nil, :TkGrid,
          s(:send,
            s(:const, nil, :TkFrame), :new,
            s(:lvar, :frame),
            s(:hash,
              s(:pair,
                s(:sym, :height),
                s(:int, 2)),
              s(:pair,
                s(:sym, :relief),
                s(:sym, :sunken)),
              s(:pair,
                s(:sym, :bd),
                s(:int, 2)))),
          s(:hash,
            s(:pair,
              s(:sym, :columnspan),
              s(:int, 4)),
            s(:pair,
              s(:sym, :row),
              s(:int, 0)),
            s(:pair,
              s(:sym, :sticky),
              s(:str, "ew")),
            s(:pair,
              s(:sym, :pady),
              s(:int, 2)))),
        s(:send, nil, :TkGrid,
          s(:str, "x"),
          s(:send,
            s(:const, nil, :TkButton), :new,
            s(:lvar, :frame),
            s(:hash,
              s(:pair,
                s(:sym, :text),
                s(:str, "See Variables")),
              s(:pair,
                s(:sym, :image),
                s(:send,
                  s(:gvar, :$image), :[],
                  s(:str, "view"))),
              s(:pair,
                s(:sym, :compound),
                s(:sym, :left)),
              s(:pair,
                s(:sym, :command),
                s(:block,
                  s(:send, nil, :proc),
                  s(:args),
                  s(:send, nil, :showVars,
                    s(:gvar, :$check2_demo),
                    s(:array,
                      s(:str, "safety"),
                      s(:lvar, :safety)),
                    s(:array,
                      s(:str, "wipers"),
                      s(:lvar, :wipers)),
                    s(:array,
                      s(:str, "brakes"),
                      s(:lvar, :brakes)),
                    s(:array,
                      s(:str, "sober"),
                      s(:lvar, :sober))))))),
          s(:send,
            s(:const, nil, :TkButton), :new,
            s(:lvar, :frame),
            s(:hash,
              s(:pair,
                s(:sym, :text),
                s(:str, "See Code")),
              s(:pair,
                s(:sym, :image),
                s(:send,
                  s(:gvar, :$image), :[],
                  s(:str, "view"))),
              s(:pair,
                s(:sym, :compound),
                s(:sym, :left)),
              s(:pair,
                s(:sym, :command),
                s(:block,
                  s(:send, nil, :proc),
                  s(:args),
                  s(:send, nil, :showCode,
                    s(:str, "check2")))))),
          s(:send,
            s(:const, nil, :TkButton), :new,
            s(:lvar, :frame),
            s(:hash,
              s(:pair,
                s(:sym, :text),
                s(:str, "Dismiss")),
              s(:pair,
                s(:sym, :image),
                s(:send,
                  s(:gvar, :$image), :[],
                  s(:str, "delete"))),
              s(:pair,
                s(:sym, :compound),
                s(:sym, :left)),
              s(:pair,
                s(:sym, :command),
                s(:block,
                  s(:send, nil, :proc),
                  s(:args),
                  s(:begin,
                    s(:lvasgn, :tmppath,
                      s(:gvar, :$check2_demo)),
                    s(:gvasgn, :$check2_demo,
                      s(:nil)),
                    s(:send,
                      s(:gvar, :$showVarsWin), :[]=,
                      s(:send,
                        s(:lvar, :tmppath), :path),
                      s(:nil)),
                    s(:send,
                      s(:lvar, :tmppath), :destroy)))))),
          s(:hash,
            s(:pair,
              s(:sym, :padx),
              s(:int, 4)),
            s(:pair,
              s(:sym, :pady),
              s(:int, 4)))),
        s(:send,
          s(:lvar, :frame), :grid_columnconfigure,
          s(:int, 0),
          s(:hash,
            s(:pair,
              s(:sym, :weight),
              s(:int, 1)))))), :pack,
    s(:hash,
      s(:pair,
        s(:str, "side"),
        s(:str, "bottom")),
      s(:pair,
        s(:str, "fill"),
        s(:str, "x")))),
  s(:block,
    s(:send,
      s(:const, nil, :TkCheckButton), :new,
      s(:lvar, :base_frame),
      s(:hash,
        s(:pair,
          s(:sym, :text),
          s(:str, "Safety Check")),
        s(:pair,
          s(:sym, :variable),
          s(:lvar, :safety)),
        s(:pair,
          s(:sym, :relief),
          s(:sym, :flat)),
        s(:pair,
          s(:sym, :onvalue),
          s(:str, "all")),
        s(:pair,
          s(:sym, :offvalue),
          s(:str, "none")),
        s(:pair,
          s(:sym, :tristatevalue),
          s(:str, "partial")))),
    s(:args),
    s(:send, nil, :pack,
      s(:hash,
        s(:pair,
          s(:str, "side"),
          s(:str, "top")),
        s(:pair,
          s(:str, "pady"),
          s(:int, 2)),
        s(:pair,
          s(:str, "anchor"),
          s(:str, "w"))))),
  s(:block,
    s(:send,
      s(:array,
        s(:send,
          s(:const, nil, :TkCheckButton), :new,
          s(:lvar, :base_frame),
          s(:hash,
            s(:pair,
              s(:str, "text"),
              s(:str, "Wipers OK")),
            s(:pair,
              s(:str, "variable"),
              s(:lvar, :wipers)))),
        s(:send,
          s(:const, nil, :TkCheckButton), :new,
          s(:lvar, :base_frame),
          s(:hash,
            s(:pair,
              s(:str, "text"),
              s(:str, "Brakes OK")),
            s(:pair,
              s(:str, "variable"),
              s(:lvar, :brakes)))),
        s(:send,
          s(:const, nil, :TkCheckButton), :new,
          s(:lvar, :base_frame),
          s(:hash,
            s(:pair,
              s(:str, "text"),
              s(:str, "Driver Sober")),
            s(:pair,
              s(:str, "variable"),
              s(:lvar, :sober))))), :each),
    s(:args,
      s(:arg, :w)),
    s(:begin,
      s(:send,
        s(:lvar, :w), :relief,
        s(:str, "flat")),
      s(:send,
        s(:lvar, :w), :pack,
        s(:hash,
          s(:pair,
            s(:str, "side"),
            s(:str, "top")),
          s(:pair,
            s(:str, "padx"),
            s(:int, 15)),
          s(:pair,
            s(:str, "pady"),
            s(:int, 2)),
          s(:pair,
            s(:str, "anchor"),
            s(:str, "w")))))),
  s(:lvasgn, :in_check,
    s(:false)),
  s(:lvasgn, :tristate_check,
    s(:block,
      s(:send, nil, :proc),
      s(:args,
        s(:arg, :n1),
        s(:arg, :n2),
        s(:arg, :op)),
      s(:if,
        s(:lvar, :in_check), nil,
        s(:begin,
          s(:lvasgn, :in_check,
            s(:true)),
          s(:kwbegin,
            s(:ensure,
              s(:if,
                s(:send,
                  s(:lvar, :n1), :==,
                  s(:lvar, :safety)),
                s(:if,
                  s(:send,
                    s(:lvar, :safety), :==,
                    s(:str, "none")),
                  s(:begin,
                    s(:send,
                      s(:lvar, :wipers), :value=,
                      s(:int, 0)),
                    s(:send,
                      s(:lvar, :brakes), :value=,
                      s(:int, 0)),
                    s(:send,
                      s(:lvar, :sober), :value=,
                      s(:int, 0))),
                  s(:if,
                    s(:send,
                      s(:lvar, :safety), :==,
                      s(:str, "all")),
                    s(:begin,
                      s(:send,
                        s(:lvar, :wipers), :value=,
                        s(:int, 1)),
                      s(:send,
                        s(:lvar, :brakes), :value=,
                        s(:int, 1)),
                      s(:send,
                        s(:lvar, :sober), :value=,
                        s(:int, 1))), nil)),
                s(:if,
                  s(:and,
                    s(:and,
                      s(:send,
                        s(:lvar, :wipers), :==,
                        s(:int, 1)),
                      s(:send,
                        s(:lvar, :brakes), :==,
                        s(:int, 1))),
                    s(:send,
                      s(:lvar, :sober), :==,
                      s(:int, 1))),
                  s(:send,
                    s(:lvar, :safety), :value=,
                    s(:str, "all")),
                  s(:if,
                    s(:or,
                      s(:or,
                        s(:send,
                          s(:lvar, :wipers), :==,
                          s(:int, 1)),
                        s(:send,
                          s(:lvar, :brakes), :==,
                          s(:int, 1))),
                      s(:send,
                        s(:lvar, :sober), :==,
                        s(:int, 1))),
                    s(:send,
                      s(:lvar, :safety), :value=,
                      s(:str, "partial")),
                    s(:send,
                      s(:lvar, :safety), :value=,
                      s(:str, "none"))))),
              s(:lvasgn, :in_check,
                s(:false)))))))),
  s(:block,
    s(:send,
      s(:array,
        s(:lvar, :wipers),
        s(:lvar, :brakes),
        s(:lvar, :sober),
        s(:lvar, :safety)), :each),
    s(:args,
      s(:arg, :v)),
    s(:send,
      s(:lvar, :v), :trace,
      s(:str, "w"),
      s(:lvar, :tristate_check))))

s(:begin,
  s(:if,
    s(:and,
      s(:defined?,
        s(:gvar, :$image3_demo)),
      s(:gvar, :$image3_demo)),
    s(:begin,
      s(:send,
        s(:gvar, :$image3_demo), :destroy),
      s(:gvasgn, :$image3_demo,
        s(:nil))), nil),
  s(:gvasgn, :$image3_demo,
    s(:block,
      s(:send,
        s(:const, nil, :TkToplevel), :new),
      s(:args,
        s(:arg, :w)),
      s(:begin,
        s(:send, nil, :title,
          s(:str, "Image Demonstration #3")),
        s(:send, nil, :iconname,
          s(:str, "Image3")),
        s(:send, nil, :positionWindow,
          s(:lvar, :w))))),
  s(:lvasgn, :base_frame,
    s(:send,
      s(:send,
        s(:const, nil, :TkFrame), :new,
        s(:gvar, :$image3_demo)), :pack,
      s(:hash,
        s(:pair,
          s(:sym, :fill),
          s(:sym, :both)),
        s(:pair,
          s(:sym, :expand),
          s(:true))))),
  s(:def, :loadDir3,
    s(:args,
      s(:arg, :w)),
    s(:begin,
      s(:send,
        s(:lvar, :w), :delete,
        s(:int, 0),
        s(:str, "end")),
      s(:block,
        s(:send,
          s(:send,
            s(:send,
              s(:const, nil, :Dir), :glob,
              s(:send,
                s(:array,
                  s(:gvar, :$dirName),
                  s(:str, "*")), :join,
                s(:const,
                  s(:const, nil, :File), :Separator))), :sort), :each),
        s(:args,
          s(:arg, :f)),
        s(:send,
          s(:lvar, :w), :insert,
          s(:str, "end"),
          s(:send,
            s(:const, nil, :File), :basename,
            s(:lvar, :f)))))),
  s(:def, :selectAndLoadDir3,
    s(:args,
      s(:arg, :w),
      s(:arg, :lbox)),
    s(:begin,
      s(:lvasgn, :dir,
        s(:send,
          s(:const, nil, :Tk), :chooseDirectory,
          s(:hash,
            s(:pair,
              s(:sym, :initialdir),
              s(:send,
                s(:gvar, :$dirName), :value)),
            s(:pair,
              s(:sym, :parent),
              s(:lvar, :w)),
            s(:pair,
              s(:sym, :mustexist),
              s(:true))))),
      s(:if,
        s(:send,
          s(:send,
            s(:lvar, :dir), :length), :>,
          s(:int, 0)),
        s(:begin,
          s(:send,
            s(:gvar, :$dirName), :value=,
            s(:lvar, :dir)),
          s(:send, nil, :loadDir3,
            s(:lvar, :lbox))), nil))),
  s(:def, :loadImage,
    s(:args,
      s(:arg, :w),
      s(:arg, :x),
      s(:arg, :y)),
    s(:send,
      s(:gvar, :$image3a), :file,
      s(:send,
        s(:array,
          s(:gvar, :$dirName),
          s(:send,
            s(:lvar, :w), :get,
            s(:dstr,
              s(:str, "@"),
              s(:begin,
                s(:lvar, :x)),
              s(:str, ","),
              s(:begin,
                s(:lvar, :y))))), :join,
        s(:const,
          s(:const, nil, :File), :Separator)))),
  s(:lvasgn, :msg,
    s(:block,
      s(:send,
        s(:const, nil, :TkLabel), :new,
        s(:lvar, :base_frame)),
      s(:args),
      s(:begin,
        s(:send, nil, :font,
          s(:gvar, :$font)),
        s(:send, nil, :wraplength,
          s(:str, "4i")),
        s(:send, nil, :justify,
          s(:str, "left")),
        s(:send, nil, :text,
          s(:str, "This demonstration allows you to view images using a Tk \"photo\" image.  First type a directory name in the listbox, then type Return to load the directory into the listbox.  Then double-click on a file name in the listbox to see that image."))))),
  s(:send,
    s(:lvar, :msg), :pack,
    s(:hash,
      s(:pair,
        s(:str, "side"),
        s(:str, "top")))),
  s(:send,
    s(:block,
      s(:send,
        s(:const, nil, :TkFrame), :new,
        s(:lvar, :base_frame)),
      s(:args,
        s(:arg, :frame)),
      s(:begin,
        s(:send,
          s(:block,
            s(:send,
              s(:const, nil, :TkButton), :new,
              s(:lvar, :frame)),
            s(:args),
            s(:begin,
              s(:send, nil, :text,
                s(:str, "Dismiss")),
              s(:send, nil, :command,
                s(:block,
                  s(:send, nil, :proc),
                  s(:args),
                  s(:begin,
                    s(:lvasgn, :tmppath,
                      s(:gvar, :$image3_demo)),
                    s(:gvasgn, :$image3_demo,
                      s(:nil)),
                    s(:send,
                      s(:lvar, :tmppath), :destroy)))))), :pack,
          s(:hash,
            s(:pair,
              s(:str, "side"),
              s(:str, "left")),
            s(:pair,
              s(:str, "expand"),
              s(:str, "yes")))),
        s(:send,
          s(:block,
            s(:send,
              s(:const, nil, :TkButton), :new,
              s(:lvar, :frame)),
            s(:args),
            s(:begin,
              s(:send, nil, :text,
                s(:str, "Show Code")),
              s(:send, nil, :command,
                s(:block,
                  s(:send, nil, :proc),
                  s(:args),
                  s(:send, nil, :showCode,
                    s(:str, "image3")))))), :pack,
          s(:hash,
            s(:pair,
              s(:str, "side"),
              s(:str, "left")),
            s(:pair,
              s(:str, "expand"),
              s(:str, "yes")))))), :pack,
    s(:hash,
      s(:pair,
        s(:str, "side"),
        s(:str, "bottom")),
      s(:pair,
        s(:str, "fill"),
        s(:str, "x")),
      s(:pair,
        s(:str, "pady"),
        s(:str, "2m")))),
  s(:gvasgn, :$dirName,
    s(:send,
      s(:const, nil, :TkVariable), :new,
      s(:send,
        s(:array,
          s(:gvar, :$demo_dir),
          s(:str, ".."),
          s(:str, "images")), :join,
        s(:const,
          s(:const, nil, :File), :Separator)))),
  s(:kwbegin,
    s(:rescue,
      s(:send,
        s(:gvar, :$image3a), :delete),
      s(:resbody, nil, nil, nil), nil)),
  s(:gvasgn, :$image3a,
    s(:send,
      s(:const, nil, :TkPhotoImage), :new)),
  s(:lvasgn, :image3_f,
    s(:send,
      s(:send,
        s(:const, nil, :TkFrame), :new,
        s(:lvar, :base_frame)), :pack,
      s(:hash,
        s(:pair,
          s(:sym, :fill),
          s(:sym, :both)),
        s(:pair,
          s(:sym, :expand),
          s(:true))))),
  s(:lvasgn, :image3_df,
    s(:send,
      s(:const, nil, :TkLabelFrame), :new,
      s(:lvar, :base_frame),
      s(:hash,
        s(:pair,
          s(:sym, :text),
          s(:str, "Directory:"))))),
  s(:lvasgn, :image3_ff,
    s(:send,
      s(:const, nil, :TkLabelFrame), :new,
      s(:lvar, :base_frame),
      s(:hash,
        s(:pair,
          s(:sym, :text),
          s(:str, "File:")),
        s(:pair,
          s(:sym, :padx),
          s(:str, "2m")),
        s(:pair,
          s(:sym, :pady),
          s(:str, "2m"))))),
  s(:lvasgn, :image3_lbx,
    s(:block,
      s(:send,
        s(:const, nil, :TkListbox), :new,
        s(:lvar, :image3_ff),
        s(:hash,
          s(:pair,
            s(:sym, :width),
            s(:int, 20)),
          s(:pair,
            s(:sym, :height),
            s(:int, 10)))),
      s(:args),
      s(:begin,
        s(:send, nil, :pack,
          s(:hash,
            s(:pair,
              s(:sym, :side),
              s(:sym, :left)),
            s(:pair,
              s(:sym, :fill),
              s(:sym, :y)),
            s(:pair,
              s(:sym, :expand),
              s(:true)))),
        s(:send, nil, :yscrollbar,
          s(:send,
            s(:send,
              s(:const, nil, :TkScrollbar), :new,
              s(:lvar, :image3_ff)), :pack,
            s(:hash,
              s(:pair,
                s(:sym, :side),
                s(:sym, :left)),
              s(:pair,
                s(:sym, :fill),
                s(:sym, :y)),
              s(:pair,
                s(:sym, :expand),
                s(:true))))),
        s(:send, nil, :insert,
          s(:int, 0),
          s(:splat,
            s(:begin,
              s(:array,
                s(:str, "earth.gif"),
                s(:str, "earthris.gif"),
                s(:str, "teapot.ppm"))))),
        s(:send, nil, :bind,
          s(:str, "Double-1"),
          s(:block,
            s(:send, nil, :proc),
            s(:args,
              s(:arg, :x),
              s(:arg, :y)),
            s(:send, nil, :loadImage,
              s(:self),
              s(:lvar, :x),
              s(:lvar, :y))),
          s(:str, "%x %y"))))),
  s(:lvasgn, :image3_ent,
    s(:block,
      s(:send,
        s(:const, nil, :TkEntry), :new,
        s(:lvar, :image3_df),
        s(:hash,
          s(:pair,
            s(:sym, :width),
            s(:int, 30)),
          s(:pair,
            s(:sym, :textvariable),
            s(:gvar, :$dirName)))),
      s(:args),
      s(:begin,
        s(:send, nil, :pack,
          s(:hash,
            s(:pair,
              s(:sym, :side),
              s(:sym, :left)),
            s(:pair,
              s(:sym, :fill),
              s(:sym, :both)),
            s(:pair,
              s(:sym, :padx),
              s(:str, "2m")),
            s(:pair,
              s(:sym, :pady),
              s(:str, "2m")),
            s(:pair,
              s(:sym, :expand),
              s(:true)))),
        s(:send, nil, :bind,
          s(:str, "Return"),
          s(:block,
            s(:send, nil, :proc),
            s(:args),
            s(:send, nil, :loadDir3,
              s(:lvar, :image3_lbx))))))),
  s(:block,
    s(:send,
      s(:const, nil, :TkButton), :new,
      s(:lvar, :image3_df),
      s(:hash,
        s(:pair,
          s(:sym, :pady),
          s(:int, 0)),
        s(:pair,
          s(:sym, :padx),
          s(:str, "2m")),
        s(:pair,
          s(:sym, :text),
          s(:str, "Select Dir.")),
        s(:pair,
          s(:sym, :command),
          s(:block,
            s(:send, nil, :proc),
            s(:args),
            s(:send, nil, :selectAndLoadDir3,
              s(:lvar, :image3_ent),
              s(:lvar, :image3_lbx)))))),
    s(:args),
    s(:send, nil, :pack,
      s(:hash,
        s(:pair,
          s(:sym, :side),
          s(:sym, :left)),
        s(:pair,
          s(:sym, :fill),
          s(:sym, :y)),
        s(:pair,
          s(:sym, :padx),
          s(:array,
            s(:int, 0),
            s(:str, "2m"))),
        s(:pair,
          s(:sym, :pady),
          s(:str, "2m"))))),
  s(:lvasgn, :image3_if,
    s(:block,
      s(:send,
        s(:const, nil, :TkLabelFrame), :new,
        s(:lvar, :base_frame),
        s(:hash,
          s(:pair,
            s(:sym, :text),
            s(:str, "Image:")))),
      s(:args,
        s(:arg, :f)),
      s(:send,
        s(:send,
          s(:const,
            s(:const, nil, :Tk), :Label), :new,
          s(:lvar, :f),
          s(:hash,
            s(:pair,
              s(:sym, :image),
              s(:gvar, :$image3a)))), :pack,
        s(:hash,
          s(:pair,
            s(:sym, :padx),
            s(:str, "2m")),
          s(:pair,
            s(:sym, :pady),
            s(:str, "2m")))))),
  s(:send,
    s(:const, nil, :Tk), :grid,
    s(:lvar, :image3_df),
    s(:str, "-"),
    s(:hash,
      s(:pair,
        s(:sym, :sticky),
        s(:sym, :ew)),
      s(:pair,
        s(:sym, :padx),
        s(:str, "1m")),
      s(:pair,
        s(:sym, :pady),
        s(:str, "1m")),
      s(:pair,
        s(:sym, :in),
        s(:lvar, :image3_f)))),
  s(:send,
    s(:const, nil, :Tk), :grid,
    s(:lvar, :image3_ff),
    s(:lvar, :image3_if),
    s(:hash,
      s(:pair,
        s(:sym, :sticky),
        s(:sym, :nw)),
      s(:pair,
        s(:sym, :padx),
        s(:str, "1m")),
      s(:pair,
        s(:sym, :pady),
        s(:str, "1m")),
      s(:pair,
        s(:sym, :in),
        s(:lvar, :image3_f)))),
  s(:send,
    s(:const, nil, :TkGrid), :columnconfigure,
    s(:lvar, :image3_f),
    s(:int, 1),
    s(:hash,
      s(:pair,
        s(:sym, :weight),
        s(:int, 1)))))

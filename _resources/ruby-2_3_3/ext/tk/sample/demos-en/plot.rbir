s(:begin,
  s(:if,
    s(:and,
      s(:defined?,
        s(:gvar, :$plot_demo)),
      s(:gvar, :$plot_demo)),
    s(:begin,
      s(:send,
        s(:gvar, :$plot_demo), :destroy),
      s(:gvasgn, :$plot_demo,
        s(:nil))), nil),
  s(:gvasgn, :$plot_demo,
    s(:block,
      s(:send,
        s(:const, nil, :TkToplevel), :new),
      s(:args,
        s(:arg, :w)),
      s(:begin,
        s(:send, nil, :title,
          s(:str, "Plot Demonstration")),
        s(:send, nil, :iconname,
          s(:str, "Plot")),
        s(:send, nil, :positionWindow,
          s(:lvar, :w))))),
  s(:lvasgn, :base_frame,
    s(:send,
      s(:send,
        s(:const, nil, :TkFrame), :new,
        s(:gvar, :$plot_demo)), :pack,
      s(:hash,
        s(:pair,
          s(:sym, :fill),
          s(:sym, :both)),
        s(:pair,
          s(:sym, :expand),
          s(:true))))),
  s(:block,
    s(:send,
      s(:const, nil, :TkLabel), :new,
      s(:lvar, :base_frame),
      s(:hash,
        s(:pair,
          s(:str, "font"),
          s(:gvar, :$font)),
        s(:pair,
          s(:str, "wraplength"),
          s(:str, "4i")),
        s(:pair,
          s(:str, "justify"),
          s(:str, "left")),
        s(:pair,
          s(:str, "text"),
          s(:str, "This window displays a canvas widget containing a simple 2-dimensional plot.  You can doctor the data by dragging any of the points with mouse button 1.")))),
    s(:args),
    s(:send, nil, :pack,
      s(:hash,
        s(:pair,
          s(:str, "side"),
          s(:str, "top"))))),
  s(:gvasgn, :$plot_buttons,
    s(:block,
      s(:send,
        s(:const, nil, :TkFrame), :new,
        s(:lvar, :base_frame)),
      s(:args,
        s(:arg, :frame)),
      s(:begin,
        s(:send,
          s(:block,
            s(:send,
              s(:const, nil, :TkButton), :new,
              s(:lvar, :frame)),
            s(:args),
            s(:begin,
              s(:send, nil, :text,
                s(:str, "Dismiss")),
              s(:send, nil, :command,
                s(:block,
                  s(:send, nil, :proc),
                  s(:args),
                  s(:begin,
                    s(:lvasgn, :tmppath,
                      s(:gvar, :$plot_demo)),
                    s(:gvasgn, :$plot_demo,
                      s(:nil)),
                    s(:send,
                      s(:lvar, :tmppath), :destroy)))))), :pack,
          s(:hash,
            s(:pair,
              s(:str, "side"),
              s(:str, "left")),
            s(:pair,
              s(:str, "expand"),
              s(:str, "yes")))),
        s(:send,
          s(:block,
            s(:send,
              s(:const, nil, :TkButton), :new,
              s(:lvar, :frame)),
            s(:args),
            s(:begin,
              s(:send, nil, :text,
                s(:str, "Show Code")),
              s(:send, nil, :command,
                s(:block,
                  s(:send, nil, :proc),
                  s(:args),
                  s(:send, nil, :showCode,
                    s(:str, "plot")))))), :pack,
          s(:hash,
            s(:pair,
              s(:str, "side"),
              s(:str, "left")),
            s(:pair,
              s(:str, "expand"),
              s(:str, "yes"))))))),
  s(:send,
    s(:gvar, :$plot_buttons), :pack,
    s(:hash,
      s(:pair,
        s(:str, "side"),
        s(:str, "bottom")),
      s(:pair,
        s(:str, "fill"),
        s(:str, "x")),
      s(:pair,
        s(:str, "pady"),
        s(:str, "2m")))),
  s(:lvasgn, :plotFont,
    s(:str, "-*-Helvetica-Medium-R-Normal--*-180-*-*-*-*-*-*")),
  s(:gvasgn, :$plot_canvas,
    s(:send,
      s(:const, nil, :TkCanvas), :new,
      s(:lvar, :base_frame),
      s(:hash,
        s(:pair,
          s(:str, "relief"),
          s(:str, "raised")),
        s(:pair,
          s(:str, "width"),
          s(:int, 450)),
        s(:pair,
          s(:str, "height"),
          s(:int, 300))))),
  s(:send,
    s(:gvar, :$plot_canvas), :pack,
    s(:hash,
      s(:pair,
        s(:str, "side"),
        s(:str, "top")),
      s(:pair,
        s(:str, "fill"),
        s(:str, "x")))),
  s(:send,
    s(:const, nil, :TkcLine), :new,
    s(:gvar, :$plot_canvas),
    s(:int, 100),
    s(:int, 250),
    s(:int, 400),
    s(:int, 250),
    s(:hash,
      s(:pair,
        s(:str, "width"),
        s(:int, 2)))),
  s(:send,
    s(:const, nil, :TkcLine), :new,
    s(:gvar, :$plot_canvas),
    s(:int, 100),
    s(:int, 250),
    s(:int, 100),
    s(:int, 50),
    s(:hash,
      s(:pair,
        s(:str, "width"),
        s(:int, 2)))),
  s(:send,
    s(:const, nil, :TkcText), :new,
    s(:gvar, :$plot_canvas),
    s(:int, 225),
    s(:int, 20),
    s(:hash,
      s(:pair,
        s(:str, "text"),
        s(:str, "A Simple Plot")),
      s(:pair,
        s(:str, "font"),
        s(:lvar, :plotFont)),
      s(:pair,
        s(:str, "fill"),
        s(:str, "brown")))),
  s(:block,
    s(:send,
      s(:begin,
        s(:irange,
          s(:int, 0),
          s(:int, 10))), :each),
    s(:args,
      s(:arg, :i)),
    s(:begin,
      s(:lvasgn, :x,
        s(:send,
          s(:int, 100), :+,
          s(:begin,
            s(:send,
              s(:lvar, :i), :*,
              s(:int, 30))))),
      s(:send,
        s(:const, nil, :TkcLine), :new,
        s(:gvar, :$plot_canvas),
        s(:lvar, :x),
        s(:int, 250),
        s(:lvar, :x),
        s(:int, 245),
        s(:hash,
          s(:pair,
            s(:str, "width"),
            s(:int, 2)))),
      s(:send,
        s(:const, nil, :TkcText), :new,
        s(:gvar, :$plot_canvas),
        s(:lvar, :x),
        s(:int, 254),
        s(:hash,
          s(:pair,
            s(:str, "text"),
            s(:send,
              s(:int, 10), :*,
              s(:lvar, :i))),
          s(:pair,
            s(:str, "font"),
            s(:lvar, :plotFont)),
          s(:pair,
            s(:str, "anchor"),
            s(:str, "n")))))),
  s(:block,
    s(:send,
      s(:begin,
        s(:irange,
          s(:int, 0),
          s(:int, 5))), :each),
    s(:args,
      s(:arg, :i)),
    s(:begin,
      s(:lvasgn, :y,
        s(:send,
          s(:int, 250), :-,
          s(:begin,
            s(:send,
              s(:lvar, :i), :*,
              s(:int, 40))))),
      s(:send,
        s(:const, nil, :TkcLine), :new,
        s(:gvar, :$plot_canvas),
        s(:int, 100),
        s(:lvar, :y),
        s(:int, 105),
        s(:lvar, :y),
        s(:hash,
          s(:pair,
            s(:str, "width"),
            s(:int, 2)))),
      s(:send,
        s(:const, nil, :TkcText), :new,
        s(:gvar, :$plot_canvas),
        s(:int, 96),
        s(:lvar, :y),
        s(:hash,
          s(:pair,
            s(:str, "text"),
            s(:dstr,
              s(:begin,
                s(:send,
                  s(:lvar, :i), :*,
                  s(:int, 50))),
              s(:str, ".0"))),
          s(:pair,
            s(:str, "font"),
            s(:lvar, :plotFont)),
          s(:pair,
            s(:str, "anchor"),
            s(:str, "e")))))),
  s(:for,
    s(:mlhs,
      s(:lvasgn, :xx),
      s(:lvasgn, :yy)),
    s(:array,
      s(:array,
        s(:int, 12),
        s(:int, 56)),
      s(:array,
        s(:int, 20),
        s(:int, 94)),
      s(:array,
        s(:int, 33),
        s(:int, 98)),
      s(:array,
        s(:int, 32),
        s(:int, 120)),
      s(:array,
        s(:int, 61),
        s(:int, 180)),
      s(:array,
        s(:int, 75),
        s(:int, 160)),
      s(:array,
        s(:int, 98),
        s(:int, 223))),
    s(:begin,
      s(:lvasgn, :x,
        s(:send,
          s(:int, 100), :+,
          s(:begin,
            s(:send,
              s(:int, 3), :*,
              s(:lvar, :xx))))),
      s(:lvasgn, :y,
        s(:send,
          s(:int, 250), :-,
          s(:send,
            s(:begin,
              s(:send,
                s(:int, 4), :*,
                s(:lvar, :yy))), :/,
            s(:int, 5)))),
      s(:lvasgn, :item,
        s(:send,
          s(:const, nil, :TkcOval), :new,
          s(:gvar, :$plot_canvas),
          s(:send,
            s(:lvar, :x), :-,
            s(:int, 6)),
          s(:send,
            s(:lvar, :y), :-,
            s(:int, 6)),
          s(:send,
            s(:lvar, :x), :+,
            s(:int, 6)),
          s(:send,
            s(:lvar, :y), :+,
            s(:int, 6)),
          s(:hash,
            s(:pair,
              s(:str, "width"),
              s(:int, 1)),
            s(:pair,
              s(:str, "outline"),
              s(:str, "black")),
            s(:pair,
              s(:str, "fill"),
              s(:str, "SkyBlue2"))))),
      s(:send,
        s(:lvar, :item), :addtag,
        s(:str, "point")))),
  s(:send,
    s(:gvar, :$plot_canvas), :itembind,
    s(:str, "point"),
    s(:str, "Any-Enter"),
    s(:block,
      s(:send, nil, :proc),
      s(:args),
      s(:send,
        s(:gvar, :$plot_canvas), :itemconfigure,
        s(:str, "current"),
        s(:str, "fill"),
        s(:str, "red")))),
  s(:send,
    s(:gvar, :$plot_canvas), :itembind,
    s(:str, "point"),
    s(:str, "Any-Leave"),
    s(:block,
      s(:send, nil, :proc),
      s(:args),
      s(:send,
        s(:gvar, :$plot_canvas), :itemconfigure,
        s(:str, "current"),
        s(:str, "fill"),
        s(:str, "SkyBlue2")))),
  s(:send,
    s(:gvar, :$plot_canvas), :itembind,
    s(:str, "point"),
    s(:str, "1"),
    s(:block,
      s(:send, nil, :proc),
      s(:args,
        s(:arg, :x),
        s(:arg, :y)),
      s(:send, nil, :plotDown,
        s(:gvar, :$plot_canvas),
        s(:lvar, :x),
        s(:lvar, :y))),
    s(:str, "%x %y")),
  s(:send,
    s(:gvar, :$plot_canvas), :itembind,
    s(:str, "point"),
    s(:str, "ButtonRelease-1"),
    s(:block,
      s(:send, nil, :proc),
      s(:args),
      s(:send,
        s(:gvar, :$plot_canvas), :dtag,
        s(:str, "selected")))),
  s(:send,
    s(:gvar, :$plot_canvas), :bind,
    s(:str, "B1-Motion"),
    s(:block,
      s(:send, nil, :proc),
      s(:args,
        s(:arg, :x),
        s(:arg, :y)),
      s(:send, nil, :plotMove,
        s(:gvar, :$plot_canvas),
        s(:lvar, :x),
        s(:lvar, :y))),
    s(:str, "%x %y")),
  s(:gvasgn, :$plot,
    s(:hash,
      s(:pair,
        s(:str, "lastX"),
        s(:int, 0)),
      s(:pair,
        s(:str, "lastY"),
        s(:int, 0)))),
  s(:def, :plotDown,
    s(:args,
      s(:arg, :w),
      s(:arg, :x),
      s(:arg, :y)),
    s(:begin,
      s(:send,
        s(:lvar, :w), :dtag,
        s(:str, "selected")),
      s(:send,
        s(:lvar, :w), :addtag_withtag,
        s(:str, "selected"),
        s(:str, "current")),
      s(:send,
        s(:lvar, :w), :raise,
        s(:str, "current")),
      s(:send,
        s(:gvar, :$plot), :[]=,
        s(:str, "lastX"),
        s(:lvar, :x)),
      s(:send,
        s(:gvar, :$plot), :[]=,
        s(:str, "lastY"),
        s(:lvar, :y)))),
  s(:def, :plotMove,
    s(:args,
      s(:arg, :w),
      s(:arg, :x),
      s(:arg, :y)),
    s(:begin,
      s(:send,
        s(:lvar, :w), :move,
        s(:str, "selected"),
        s(:send,
          s(:lvar, :x), :-,
          s(:send,
            s(:gvar, :$plot), :[],
            s(:str, "lastX"))),
        s(:send,
          s(:lvar, :y), :-,
          s(:send,
            s(:gvar, :$plot), :[],
            s(:str, "lastY")))),
      s(:send,
        s(:gvar, :$plot), :[]=,
        s(:str, "lastX"),
        s(:lvar, :x)),
      s(:send,
        s(:gvar, :$plot), :[]=,
        s(:str, "lastY"),
        s(:lvar, :y)))))

s(:begin,
  s(:send, nil, :require,
    s(:str, "tk")),
  s(:module,
    s(:const, nil, :Tk),
    s(:module,
      s(:const, nil, :RbWidget),
      s(:class,
        s(:const, nil, :Editable_Listbox),
        s(:const, nil, :TkListbox), nil))),
  s(:class,
    s(:const,
      s(:const,
        s(:const, nil, :Tk), :RbWidget), :Editable_Listbox),
    s(:const, nil, :TkListbox),
    s(:begin,
      s(:casgn, nil, :BindTag,
        s(:send,
          s(:const, nil, :TkBindTag), :new_by_name,
          s(:send,
            s(:send,
              s(:self), :to_s), :gsub,
            s(:regexp,
              s(:str, "::"),
              s(:regopt)),
            s(:str, "#")))),
      s(:block,
        s(:send,
          s(:const, nil, :BindTag), :bind,
          s(:str, "FocusIn"),
          s(:sym, :widget)),
        s(:args,
          s(:arg, :w)),
        s(:block,
          s(:send,
            s(:lvar, :w), :instance_eval),
          s(:args),
          s(:if,
            s(:lvasgn, :idx,
              s(:send,
                s(:ivar, :@ebox), :pos)),
            s(:begin,
              s(:if,
                s(:send,
                  s(:send, nil, :bbox,
                    s(:lvar, :idx)), :empty?),
                s(:send, nil, :see,
                  s(:lvar, :idx)), nil),
              s(:send,
                s(:ivar, :@ebox), :focus,
                s(:true))), nil))),
      s(:block,
        s(:send,
          s(:const, nil, :BindTag), :bind,
          s(:str, "Double-1"),
          s(:sym, :widget),
          s(:sym, :y)),
        s(:args,
          s(:arg, :w),
          s(:arg, :y)),
        s(:block,
          s(:send,
            s(:lvar, :w), :instance_eval),
          s(:args),
          s(:send, nil, :_ebox_placer,
            s(:send, nil, :nearest,
              s(:lvar, :y))))),
      s(:block,
        s(:send,
          s(:const, nil, :BindTag), :bind,
          s(:str, "Return"),
          s(:sym, :widget)),
        s(:args,
          s(:arg, :w)),
        s(:block,
          s(:send,
            s(:lvar, :w), :instance_eval),
          s(:args),
          s(:if,
            s(:lvasgn, :idx,
              s(:send, nil, :index,
                s(:sym, :active))),
            s(:send, nil, :_ebox_placer,
              s(:lvar, :idx)), nil))),
      s(:def, :configure,
        s(:args,
          s(:restarg, :args)),
        s(:begin,
          s(:lvasgn, :ret,
            s(:zsuper)),
          s(:case,
            s(:send, nil, :cget,
              s(:sym, :state)),
            s(:when,
              s(:str, "normal"), nil),
            s(:when,
              s(:str, "disabled"),
              s(:send, nil, :_ebox_erase)), nil),
          s(:lvar, :ret))),
      s(:def, :_ebox_move,
        s(:args,
          s(:arg, :idx)),
        s(:begin,
          s(:if,
            s(:send,
              s(:send, nil, :cget,
                s(:sym, :state)), :==,
              s(:str, "disabled")),
            s(:return,
              s(:nil)), nil),
          s(:masgn,
            s(:mlhs,
              s(:lvasgn, :x),
              s(:lvasgn, :y),
              s(:lvasgn, :w),
              s(:lvasgn, :h)),
            s(:send, nil, :bbox,
              s(:lvar, :idx))),
          s(:if,
            s(:and,
              s(:lvar, :y),
              s(:lvar, :h)), nil,
            s(:return,
              s(:nil))),
          s(:send,
            s(:ivar, :@ebox), :place,
            s(:hash,
              s(:pair,
                s(:sym, :x),
                s(:int, 0)),
              s(:pair,
                s(:sym, :relwidth),
                s(:float, 1.0)),
              s(:pair,
                s(:sym, :y),
                s(:send,
                  s(:lvar, :y), :-,
                  s(:send, nil, :selectborderwidth))),
              s(:pair,
                s(:sym, :height),
                s(:send,
                  s(:lvar, :h), :+,
                  s(:send,
                    s(:int, 2), :*,
                    s(:send, nil, :selectborderwidth)))))),
          s(:send,
            s(:ivar, :@ebox), :pos=,
            s(:lvar, :idx)),
          s(:send,
            s(:ivar, :@ebox), :focus))),
      s(:def, :_ebox_placer,
        s(:args,
          s(:arg, :idx)),
        s(:begin,
          s(:if,
            s(:send, nil, :_ebox_move,
              s(:lvar, :idx)), nil,
            s(:return,
              s(:nil))),
          s(:send,
            s(:ivar, :@ebox), :value=,
            s(:send,
              s(:send,
                s(:send, nil, :listvariable), :list), :[],
              s(:lvar, :idx))),
          s(:send,
            s(:ivar, :@ebox), :xview_moveto,
            s(:send,
              s(:send,
                s(:self), :xview), :[],
              s(:int, 0))))),
      s(:def, :_ebox_erase,
        s(:args),
        s(:begin,
          s(:send,
            s(:ivar, :@ebox), :place_forget),
          s(:send,
            s(:ivar, :@ebox), :pos=,
            s(:nil)))),
      s(:send, nil, :private,
        s(:sym, :_ebox_move),
        s(:sym, :_ebox_placer),
        s(:sym, :_ebox_erase)),
      s(:def, :_setup_ebox_bindings,
        s(:args),
        s(:begin,
          s(:block,
            s(:send,
              s(:ivar, :@ebox), :bind,
              s(:str, "Return")),
            s(:args),
            s(:begin,
              s(:lvasgn, :list,
                s(:send,
                  s(:send, nil, :listvariable), :list)),
              s(:if,
                s(:send,
                  s(:ivar, :@ebox), :pos),
                s(:send,
                  s(:lvar, :list), :[]=,
                  s(:send,
                    s(:ivar, :@ebox), :pos),
                  s(:send,
                    s(:ivar, :@ebox), :value)), nil),
              s(:send,
                s(:send, nil, :listvariable), :value=,
                s(:lvar, :list)),
              s(:send, nil, :_ebox_erase),
              s(:send, nil, :focus))),
          s(:block,
            s(:send,
              s(:ivar, :@ebox), :bind,
              s(:str, "Escape")),
            s(:args),
            s(:send, nil, :_ebox_erase)))),
      s(:def, :_setup_listbox_bindings,
        s(:args),
        s(:begin,
          s(:lvasgn, :tags,
            s(:send, nil, :bindtags)),
          s(:send, nil, :bindtags,
            s(:send,
              s(:lvar, :tags), :insert,
              s(:send,
                s(:send,
                  s(:lvar, :tags), :index,
                  s(:self)), :+,
                s(:int, 1)),
              s(:const,
                s(:send,
                  s(:self), :class), :BindTag))))),
      s(:send, nil, :private,
        s(:sym, :_setup_ebox_bindings),
        s(:sym, :_setup_listbox_bindings)),
      s(:def, :yview,
        s(:args,
          s(:restarg, :args)),
        s(:begin,
          s(:if,
            s(:or,
              s(:send,
                s(:send,
                  s(:ivar, :@ebox), :pos), :!),
              s(:send,
                s(:send, nil, :bbox,
                  s(:send,
                    s(:ivar, :@ebox), :pos)), :empty?)),
            s(:send,
              s(:ivar, :@ebox), :place_forget),
            s(:send, nil, :_ebox_move,
              s(:send,
                s(:ivar, :@ebox), :pos))),
          s(:zsuper))),
      s(:def, :create_self,
        s(:args,
          s(:arg, :keys)),
        s(:begin,
          s(:super,
            s(:lvar, :keys)),
          s(:if,
            s(:send,
              s(:self), :listvariable), nil,
            s(:send,
              s(:self), :listvariable=,
              s(:send,
                s(:const, nil, :TkVariable), :new,
                s(:send,
                  s(:self), :get,
                  s(:int, 0),
                  s(:sym, :end))))),
          s(:ivasgn, :@ebox,
            s(:block,
              s(:send,
                s(:const, nil, :TkEntry), :new,
                s(:self)),
              s(:args),
              s(:begin,
                s(:ivasgn, :@pos,
                  s(:nil)),
                s(:defs,
                  s(:self), :pos,
                  s(:args),
                  s(:ivar, :@pos)),
                s(:defs,
                  s(:self), :pos=,
                  s(:args,
                    s(:arg, :idx)),
                  s(:ivasgn, :@pos,
                    s(:lvar, :idx)))))),
          s(:send, nil, :_setup_ebox_bindings),
          s(:send, nil, :_setup_listbox_bindings))))),
  s(:if,
    s(:send,
      s(:gvar, :$0), :==,
      s(:str, "(string)")),
    s(:begin,
      s(:lvasgn, :scr,
        s(:send,
          s(:send,
            s(:const, nil, :TkScrollbar), :new), :pack,
          s(:hash,
            s(:pair,
              s(:sym, :side),
              s(:sym, :right)),
            s(:pair,
              s(:sym, :fill),
              s(:sym, :y))))),
      s(:lvasgn, :lbox1,
        s(:send,
          s(:send,
            s(:const,
              s(:const,
                s(:const, nil, :Tk), :RbWidget), :Editable_Listbox), :new), :pack,
          s(:hash,
            s(:pair,
              s(:sym, :side),
              s(:sym, :left))))),
      s(:lvasgn, :lbox2,
        s(:send,
          s(:send,
            s(:const,
              s(:const,
                s(:const, nil, :Tk), :RbWidget), :Editable_Listbox), :new), :pack,
          s(:hash,
            s(:pair,
              s(:sym, :side),
              s(:sym, :left))))),
      s(:send,
        s(:lvar, :scr), :assign,
        s(:lvar, :lbox1),
        s(:lvar, :lbox2)),
      s(:send,
        s(:lvar, :lbox1), :insert,
        s(:sym, :end),
        s(:splat,
          s(:array,
            s(:str, "a"),
            s(:str, "b"),
            s(:str, "c"),
            s(:str, "d"),
            s(:str, "e"),
            s(:str, "f"),
            s(:str, "g"),
            s(:str, "h"),
            s(:str, "i"),
            s(:str, "j"),
            s(:str, "k"),
            s(:str, "l"),
            s(:str, "m"),
            s(:str, "n")))),
      s(:send,
        s(:lvar, :lbox2), :insert,
        s(:sym, :end),
        s(:int, 0),
        s(:int, 1),
        s(:int, 2),
        s(:int, 3),
        s(:int, 4),
        s(:int, 5),
        s(:int, 6),
        s(:int, 7),
        s(:int, 8),
        s(:int, 9),
        s(:int, 0),
        s(:int, 1),
        s(:int, 2),
        s(:int, 3)),
      s(:send,
        s(:const, nil, :Tk), :mainloop)), nil))

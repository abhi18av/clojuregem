s(:begin,
  s(:send, nil, :require,
    s(:str, "tk")),
  s(:send, nil, :require,
    s(:str, "tkextlib/blt")),
  s(:lvasgn, :file,
    s(:send,
      s(:const, nil, :File), :join,
      s(:send,
        s(:const, nil, :File), :dirname,
        s(:send,
          s(:const, nil, :File), :expand_path,
          s(:str, "(string)"))),
      s(:str, "images"),
      s(:str, "sample.gif"))),
  s(:if,
    s(:send,
      s(:const, nil, :File), :exist?,
      s(:lvar, :file)),
    s(:lvasgn, :src,
      s(:send,
        s(:const, nil, :TkPhotoImage), :new,
        s(:hash,
          s(:pair,
            s(:sym, :file),
            s(:lvar, :file))))),
    s(:send, nil, :fail,
      s(:const, nil, :RuntimeError),
      s(:str, "no image file"))),
  s(:lvasgn, :width,
    s(:send,
      s(:lvar, :src), :width)),
  s(:lvasgn, :height,
    s(:send,
      s(:lvar, :src), :height)),
  s(:send,
    s(:const, nil, :TkOption), :add,
    s(:str, "*Label.font"),
    s(:str, "*helvetica*10*")),
  s(:send,
    s(:const, nil, :TkOption), :add,
    s(:str, "*Label.background"),
    s(:str, "white")),
  s(:lvasgn, :l_img0,
    s(:send,
      s(:const, nil, :TkLabel), :new,
      s(:hash,
        s(:pair,
          s(:sym, :image),
          s(:lvar, :src))))),
  s(:lvasgn, :l_hdr0,
    s(:send,
      s(:const, nil, :TkLabel), :new,
      s(:hash,
        s(:pair,
          s(:sym, :text),
          s(:dstr,
            s(:begin,
              s(:lvar, :width)),
            s(:str, " x "),
            s(:begin,
              s(:lvar, :height))))))),
  s(:lvasgn, :l_ftr0,
    s(:send,
      s(:const, nil, :TkLabel), :new,
      s(:hash,
        s(:pair,
          s(:sym, :text),
          s(:str, "100%"))))),
  s(:send,
    s(:send,
      s(:const, nil, :Tk), :root), :background,
    s(:str, "white")),
  s(:block,
    s(:send,
      s(:begin,
        s(:irange,
          s(:int, 2),
          s(:int, 10))), :each),
    s(:args,
      s(:arg, :i)),
    s(:begin,
      s(:lvasgn, :iw,
        s(:send,
          s(:lvar, :width), :/,
          s(:lvar, :i))),
      s(:lvasgn, :ih,
        s(:send,
          s(:lvar, :height), :/,
          s(:lvar, :i))),
      s(:lvasgn, :r,
        s(:send,
          s(:str, "%6g"), :%,
          s(:begin,
            s(:send,
              s(:float, 100.0), :/,
              s(:lvar, :i))))),
      s(:lvasgn, :dst,
        s(:send,
          s(:const, nil, :TkPhotoImage), :new,
          s(:hash,
            s(:pair,
              s(:sym, :width),
              s(:lvar, :iw)),
            s(:pair,
              s(:sym, :height),
              s(:lvar, :ih))))),
      s(:send,
        s(:const,
          s(:const,
            s(:const, nil, :Tk), :BLT), :Winop), :image_resample,
        s(:lvar, :src),
        s(:lvar, :dst),
        s(:sym, :sinc)),
      s(:lvasgn, :l_hdr,
        s(:send,
          s(:const, nil, :TkLabel), :new,
          s(:hash,
            s(:pair,
              s(:sym, :text),
              s(:dstr,
                s(:begin,
                  s(:lvar, :iw)),
                s(:str, " x "),
                s(:begin,
                  s(:lvar, :ih))))))),
      s(:lvasgn, :l_ftr,
        s(:send,
          s(:const, nil, :TkLabel), :new,
          s(:hash,
            s(:pair,
              s(:sym, :text),
              s(:dstr,
                s(:begin,
                  s(:lvar, :r)),
                s(:str, "%")))))),
      s(:lvasgn, :l_img,
        s(:send,
          s(:const, nil, :TkLabel), :new,
          s(:hash,
            s(:pair,
              s(:sym, :image),
              s(:lvar, :dst))))),
      s(:send,
        s(:const,
          s(:const,
            s(:const, nil, :Tk), :BLT), :Table), :add,
        s(:send,
          s(:const, nil, :Tk), :root),
        s(:array,
          s(:int, 0),
          s(:lvar, :i)),
        s(:lvar, :l_hdr),
        s(:array,
          s(:int, 1),
          s(:lvar, :i)),
        s(:lvar, :l_img),
        s(:array,
          s(:int, 2),
          s(:lvar, :i)),
        s(:lvar, :l_ftr)),
      s(:send,
        s(:const, nil, :Tk), :update))),
  s(:send,
    s(:const, nil, :Tk), :mainloop))

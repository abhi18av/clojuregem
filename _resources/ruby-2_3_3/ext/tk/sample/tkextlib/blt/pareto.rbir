s(:begin,
  s(:send, nil, :require,
    s(:str, "tk")),
  s(:send, nil, :require,
    s(:str, "tkextlib/blt")),
  s(:lvasgn, :b,
    s(:send,
      s(:const,
        s(:const,
          s(:const, nil, :Tk), :BLT), :Barchart), :new,
      s(:hash,
        s(:pair,
          s(:sym, :title),
          s(:str, "Defects Found During Inspection")),
        s(:pair,
          s(:sym, :font),
          s(:str, "Helvetica 12")),
        s(:pair,
          s(:sym, :plotpady),
          s(:array,
            s(:int, 12),
            s(:int, 4))),
        s(:pair,
          s(:sym, :width),
          s(:str, "6i")),
        s(:pair,
          s(:sym, :height),
          s(:str, "5i"))))),
  s(:send,
    s(:const,
      s(:const,
        s(:const, nil, :Tk), :BLT), :Table), :add,
    s(:send,
      s(:const, nil, :Tk), :root),
    s(:lvar, :b),
    s(:hash,
      s(:pair,
        s(:sym, :fill),
        s(:sym, :both)))),
  s(:lvasgn, :data,
    s(:array,
      s(:array,
        s(:str, "Spot Weld"),
        s(:int, 82),
        s(:str, "yellow")),
      s(:array,
        s(:str, "Lathe"),
        s(:int, 49),
        s(:str, "orange")),
      s(:array,
        s(:str, "Gear Cut"),
        s(:int, 38),
        s(:str, "green")),
      s(:array,
        s(:str, "Drill"),
        s(:int, 24),
        s(:str, "blue")),
      s(:array,
        s(:str, "Grind"),
        s(:int, 17),
        s(:str, "red")),
      s(:array,
        s(:str, "Lapping"),
        s(:int, 12),
        s(:str, "brown")),
      s(:array,
        s(:str, "Press"),
        s(:int, 8),
        s(:str, "purple")),
      s(:array,
        s(:str, "De-burr"),
        s(:int, 4),
        s(:str, "pink")),
      s(:array,
        s(:str, "Packaging"),
        s(:int, 3),
        s(:str, "cyan")),
      s(:array,
        s(:str, "Other"),
        s(:int, 12),
        s(:str, "magenta")))),
  s(:send,
    s(:lvar, :b), :line_create,
    s(:str, "accum"),
    s(:hash,
      s(:pair,
        s(:sym, :label),
        s(:str, "")),
      s(:pair,
        s(:sym, :symbol),
        s(:sym, :none)),
      s(:pair,
        s(:sym, :color),
        s(:str, "red")))),
  s(:lvasgn, :pattern1,
    s(:send,
      s(:const,
        s(:const,
          s(:const, nil, :Tk), :BLT), :Bitmap), :define,
      s(:array,
        s(:array,
          s(:int, 4),
          s(:int, 4)),
        s(:array,
          s(:int, 1),
          s(:int, 2),
          s(:int, 4),
          s(:int, 8))))),
  s(:lvasgn, :count,
    s(:int, 0)),
  s(:lvasgn, :sum,
    s(:int, 0)),
  s(:lvasgn, :ydata,
    s(:array,
      s(:int, 0))),
  s(:lvasgn, :xdata,
    s(:array,
      s(:int, 0))),
  s(:lvasgn, :labels,
    s(:array)),
  s(:block,
    s(:send,
      s(:lvar, :data), :each),
    s(:args,
      s(:arg, :label),
      s(:arg, :value),
      s(:arg, :color)),
    s(:begin,
      s(:op_asgn,
        s(:lvasgn, :count), :+,
        s(:int, 1)),
      s(:send,
        s(:lvar, :b), :element_create,
        s(:lvar, :label),
        s(:hash,
          s(:pair,
            s(:sym, :xdata),
            s(:lvar, :count)),
          s(:pair,
            s(:sym, :ydata),
            s(:lvar, :value)),
          s(:pair,
            s(:sym, :foreground),
            s(:lvar, :color)),
          s(:pair,
            s(:sym, :relief),
            s(:sym, :solid)),
          s(:pair,
            s(:sym, :borderwidth),
            s(:int, 1)),
          s(:pair,
            s(:sym, :stipple),
            s(:lvar, :pattern1)),
          s(:pair,
            s(:sym, :background),
            s(:str, "lightblue")))),
      s(:send,
        s(:lvar, :labels), :[]=,
        s(:lvar, :count),
        s(:lvar, :label)),
      s(:op_asgn,
        s(:lvasgn, :sum), :+,
        s(:lvar, :value)),
      s(:send,
        s(:lvar, :ydata), :<<,
        s(:lvar, :sum)),
      s(:send,
        s(:lvar, :xdata), :<<,
        s(:lvar, :count)))),
  s(:send,
    s(:lvar, :b), :element_configure,
    s(:str, "accum"),
    s(:hash,
      s(:pair,
        s(:sym, :xdata),
        s(:lvar, :xdata)),
      s(:pair,
        s(:sym, :ydata),
        s(:lvar, :ydata)))),
  s(:block,
    s(:send,
      s(:lvar, :xdata), :zip,
      s(:lvar, :ydata)),
    s(:args,
      s(:arg, :x),
      s(:arg, :y)),
    s(:begin,
      s(:lvasgn, :percent,
        s(:send,
          s(:begin,
            s(:send,
              s(:lvar, :y), :*,
              s(:float, 100.0))), :/,
          s(:lvar, :sum))),
      s(:if,
        s(:send,
          s(:lvar, :x), :==,
          s(:int, 0)),
        s(:lvasgn, :text,
          s(:str, " 0%")),
        s(:lvasgn, :text,
          s(:send,
            s(:str, "%.1f"), :%,
            s(:lvar, :percent)))),
      s(:send,
        s(:lvar, :b), :marker_create,
        s(:sym, :text),
        s(:hash,
          s(:pair,
            s(:sym, :coords),
            s(:array,
              s(:lvar, :x),
              s(:lvar, :y))),
          s(:pair,
            s(:sym, :text),
            s(:lvar, :text)),
          s(:pair,
            s(:sym, :font),
            s(:str, "Helvetica 10")),
          s(:pair,
            s(:sym, :foreground),
            s(:str, "red4")),
          s(:pair,
            s(:sym, :anchor),
            s(:sym, :center)),
          s(:pair,
            s(:sym, :yoffset),
            s(:int, -5)))))),
  s(:send,
    s(:lvar, :b), :axis_configure,
    s(:str, "y2"),
    s(:hash,
      s(:pair,
        s(:sym, :hide),
        s(:false)),
      s(:pair,
        s(:sym, :min),
        s(:float, 0.0)),
      s(:pair,
        s(:sym, :max),
        s(:float, 100.0)),
      s(:pair,
        s(:sym, :title),
        s(:str, "Percentage")))),
  s(:send,
    s(:lvar, :b), :axis_configure,
    s(:str, "y"),
    s(:hash,
      s(:pair,
        s(:sym, :title),
        s(:str, "Defects")))),
  s(:send,
    s(:lvar, :b), :axis_configure,
    s(:str, "x"),
    s(:hash,
      s(:pair,
        s(:sym, :title),
        s(:str, "Process")),
      s(:pair,
        s(:sym, :rotate),
        s(:int, 90)),
      s(:pair,
        s(:sym, :subdivisions),
        s(:int, 0)),
      s(:pair,
        s(:sym, :command),
        s(:block,
          s(:send, nil, :proc),
          s(:args,
            s(:arg, :w),
            s(:arg, :val)),
          s(:begin,
            s(:lvasgn, :val,
              s(:send,
                s(:lvar, :val), :round)),
            s(:if,
              s(:send,
                s(:lvar, :labels), :[],
                s(:lvar, :val)),
              s(:send,
                s(:lvar, :labels), :[],
                s(:lvar, :val)),
              s(:lvar, :val))))))),
  s(:send,
    s(:lvar, :b), :legend_configure,
    s(:hash,
      s(:pair,
        s(:sym, :hide),
        s(:true)))),
  s(:send,
    s(:lvar, :b), :gridline_configure,
    s(:hash,
      s(:pair,
        s(:sym, :mapx),
        s(:sym, :x)),
      s(:pair,
        s(:sym, :color),
        s(:str, "lightblue")))),
  s(:send,
    s(:const, nil, :Tk), :mainloop))

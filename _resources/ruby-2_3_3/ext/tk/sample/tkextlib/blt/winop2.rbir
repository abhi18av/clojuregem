s(:begin,
  s(:send, nil, :require,
    s(:str, "tk")),
  s(:send, nil, :require,
    s(:str, "tkextlib/blt")),
  s(:lvasgn, :file,
    s(:send,
      s(:const, nil, :File), :join,
      s(:send,
        s(:const, nil, :File), :dirname,
        s(:send,
          s(:const, nil, :File), :expand_path,
          s(:str, "(string)"))),
      s(:str, "images"),
      s(:str, "qv100.t.gif"))),
  s(:if,
    s(:send,
      s(:const, nil, :File), :exist?,
      s(:lvar, :file)),
    s(:lvasgn, :src,
      s(:send,
        s(:const, nil, :TkPhotoImage), :new,
        s(:hash,
          s(:pair,
            s(:sym, :file),
            s(:lvar, :file))))),
    s(:send, nil, :fail,
      s(:const, nil, :RuntimeError),
      s(:str, "no image file"))),
  s(:lvasgn, :width,
    s(:send,
      s(:lvar, :src), :width)),
  s(:lvasgn, :height,
    s(:send,
      s(:lvar, :src), :height)),
  s(:send,
    s(:const, nil, :TkOption), :add,
    s(:str, "*Label.font"),
    s(:str, "*helvetica*10*")),
  s(:send,
    s(:const, nil, :TkOption), :add,
    s(:str, "*Label.background"),
    s(:str, "white")),
  s(:block,
    s(:send,
      s(:array,
        s(:int, 0),
        s(:int, 90),
        s(:int, 180),
        s(:int, 270),
        s(:int, 360),
        s(:int, 45)), :each_with_index),
    s(:args,
      s(:arg, :r),
      s(:arg, :i)),
    s(:begin,
      s(:lvasgn, :dest,
        s(:send,
          s(:const, nil, :TkPhotoImage), :new)),
      s(:send,
        s(:const,
          s(:const,
            s(:const, nil, :Tk), :BLT), :Winop), :image_rotate,
        s(:lvar, :src),
        s(:lvar, :dest),
        s(:lvar, :r)),
      s(:lvasgn, :l_txt,
        s(:send,
          s(:const, nil, :TkLabel), :new,
          s(:hash,
            s(:pair,
              s(:sym, :text),
              s(:dstr,
                s(:begin,
                  s(:lvar, :r)),
                s(:str, " degrees")))))),
      s(:lvasgn, :l_img,
        s(:send,
          s(:const, nil, :TkLabel), :new,
          s(:hash,
            s(:pair,
              s(:sym, :image),
              s(:lvar, :dest))))),
      s(:send,
        s(:const,
          s(:const,
            s(:const, nil, :Tk), :BLT), :Table), :add,
        s(:send,
          s(:const, nil, :Tk), :root),
        s(:array,
          s(:int, 0),
          s(:lvar, :i)),
        s(:lvar, :l_img),
        s(:array,
          s(:int, 1),
          s(:lvar, :i)),
        s(:lvar, :l_txt)),
      s(:send,
        s(:const, nil, :Tk), :update))),
  s(:send,
    s(:const, nil, :Tk), :mainloop))

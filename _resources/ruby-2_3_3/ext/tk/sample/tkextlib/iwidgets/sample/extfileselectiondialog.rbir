s(:begin,
  s(:send, nil, :require,
    s(:str, "tk")),
  s(:send, nil, :require,
    s(:str, "tkextlib/iwidgets")),
  s(:lvasgn, :mainloop,
    s(:block,
      s(:send,
        s(:const, nil, :Thread), :new),
      s(:args),
      s(:send,
        s(:const, nil, :Tk), :mainloop))),
  s(:lvasgn, :nmfsd,
    s(:send,
      s(:const,
        s(:const,
          s(:const, nil, :Tk), :Iwidgets), :Extfileselectiondialog), :new,
      s(:hash,
        s(:pair,
          s(:sym, :title),
          s(:str, "Non-Modal"))))),
  s(:send,
    s(:lvar, :nmfsd), :buttonconfigure,
    s(:str, "OK"),
    s(:hash,
      s(:pair,
        s(:sym, :command),
        s(:block,
          s(:send, nil, :proc),
          s(:args),
          s(:begin,
            s(:send, nil, :puts,
              s(:dstr,
                s(:str, "You selected "),
                s(:begin,
                  s(:send,
                    s(:lvar, :nmfsd), :get)))),
            s(:send,
              s(:lvar, :nmfsd), :deactivate)))))),
  s(:send,
    s(:lvar, :nmfsd), :activate),
  s(:lvasgn, :mfsd,
    s(:send,
      s(:const,
        s(:const,
          s(:const, nil, :Tk), :Iwidgets), :Extfileselectiondialog), :new,
      s(:hash,
        s(:pair,
          s(:sym, :modality),
          s(:sym, :application))))),
  s(:send,
    s(:lvar, :mfsd), :center),
  s(:if,
    s(:send,
      s(:const, nil, :TkComm), :bool,
      s(:send,
        s(:lvar, :mfsd), :activate)),
    s(:send, nil, :puts,
      s(:dstr,
        s(:str, "You selected "),
        s(:begin,
          s(:send,
            s(:lvar, :mfsd), :get)))),
    s(:send, nil, :puts,
      s(:str, "You cancelled the dialog"))),
  s(:send,
    s(:lvar, :mainloop), :join))

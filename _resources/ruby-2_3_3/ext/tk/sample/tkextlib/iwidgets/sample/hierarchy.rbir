s(:begin,
  s(:send, nil, :require,
    s(:str, "tk")),
  s(:send, nil, :require,
    s(:str, "tkextlib/iwidgets")),
  s(:def, :get_files,
    s(:args,
      s(:arg, :file)),
    s(:begin,
      s(:lvasgn, :dir,
        s(:if,
          s(:begin,
            s(:send,
              s(:lvar, :file), :empty?)),
          s(:send,
            s(:const, nil, :ENV), :[],
            s(:str, "HOME")),
          s(:send,
            s(:const, nil, :TkComm), :_fromUTF8,
            s(:lvar, :file)))),
      s(:rescue,
        s(:send,
          s(:const, nil, :Dir), :chdir,
          s(:lvar, :dir)),
        s(:resbody, nil, nil,
          s(:return,
            s(:str, ""))), nil),
      s(:block,
        s(:send,
          s(:send,
            s(:send,
              s(:const, nil, :Dir), :[],
              s(:str, "*")), :sort), :collect),
        s(:args,
          s(:arg, :f)),
        s(:array,
          s(:send,
            s(:const, nil, :TkComm), :_toUTF8,
            s(:send,
              s(:const, nil, :File), :join,
              s(:lvar, :dir),
              s(:lvar, :f))),
          s(:send,
            s(:const, nil, :TkComm), :_toUTF8,
            s(:lvar, :f)))))),
  s(:send,
    s(:send,
      s(:const,
        s(:const,
          s(:const, nil, :Tk), :Iwidgets), :Hierarchy), :new,
      s(:hash,
        s(:pair,
          s(:sym, :querycommand),
          s(:block,
            s(:send, nil, :proc),
            s(:args,
              s(:arg, :arg)),
            s(:send, nil, :get_files,
              s(:send,
                s(:lvar, :arg), :node)))),
        s(:pair,
          s(:sym, :visibleitems),
          s(:str, "30x15")),
        s(:pair,
          s(:sym, :labeltext),
          s(:send,
            s(:const, nil, :ENV), :[],
            s(:str, "HOME"))))), :pack,
    s(:hash,
      s(:pair,
        s(:sym, :side),
        s(:sym, :left)),
      s(:pair,
        s(:sym, :expand),
        s(:true)),
      s(:pair,
        s(:sym, :fill),
        s(:sym, :both)))),
  s(:send,
    s(:const, nil, :Tk), :mainloop))

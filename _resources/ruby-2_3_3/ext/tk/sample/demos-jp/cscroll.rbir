s(:begin,
  s(:if,
    s(:and,
      s(:defined?,
        s(:gvar, :$cscroll_demo)),
      s(:gvar, :$cscroll_demo)),
    s(:begin,
      s(:send,
        s(:gvar, :$cscroll_demo), :destroy),
      s(:gvasgn, :$cscroll_demo,
        s(:nil))), nil),
  s(:gvasgn, :$cscroll_demo,
    s(:block,
      s(:send,
        s(:const, nil, :TkToplevel), :new),
      s(:args,
        s(:arg, :w)),
      s(:begin,
        s(:send, nil, :title,
          s(:str, "Scrollable Canvas Demonstration")),
        s(:send, nil, :iconname,
          s(:str, "cscroll")),
        s(:send, nil, :positionWindow,
          s(:lvar, :w))))),
  s(:lvasgn, :base_frame,
    s(:send,
      s(:send,
        s(:const, nil, :TkFrame), :new,
        s(:gvar, :$cscroll_demo)), :pack,
      s(:hash,
        s(:pair,
          s(:sym, :fill),
          s(:sym, :both)),
        s(:pair,
          s(:sym, :expand),
          s(:true))))),
  s(:block,
    s(:send,
      s(:const, nil, :TkLabel), :new,
      s(:lvar, :base_frame),
      s(:hash,
        s(:pair,
          s(:str, "font"),
          s(:gvar, :$font)),
        s(:pair,
          s(:str, "wraplength"),
          s(:str, "4i")),
        s(:pair,
          s(:str, "justify"),
          s(:str, "left")),
        s(:pair,
          s(:str, "text"),
          s(:str, "このウィンドウにはスクロールバーやマウスのボタン2 でスクロールできるキャンバス widget が表示されています。四角の上でボタン1 をクリックすると、そのインデックスが標準出力に出力されます。")))),
    s(:args),
    s(:send, nil, :pack,
      s(:hash,
        s(:pair,
          s(:str, "side"),
          s(:str, "top"))))),
  s(:gvasgn, :$cscroll_buttons,
    s(:block,
      s(:send,
        s(:const, nil, :TkFrame), :new,
        s(:lvar, :base_frame)),
      s(:args,
        s(:arg, :frame)),
      s(:begin,
        s(:send,
          s(:block,
            s(:send,
              s(:const, nil, :TkButton), :new,
              s(:lvar, :frame)),
            s(:args),
            s(:begin,
              s(:send, nil, :text,
                s(:str, "閉じる")),
              s(:send, nil, :command,
                s(:block,
                  s(:send, nil, :proc),
                  s(:args),
                  s(:begin,
                    s(:lvasgn, :tmppath,
                      s(:gvar, :$cscroll_demo)),
                    s(:gvasgn, :$cscroll_demo,
                      s(:nil)),
                    s(:send,
                      s(:lvar, :tmppath), :destroy)))))), :pack,
          s(:hash,
            s(:pair,
              s(:str, "side"),
              s(:str, "left")),
            s(:pair,
              s(:str, "expand"),
              s(:str, "yes")))),
        s(:send,
          s(:block,
            s(:send,
              s(:const, nil, :TkButton), :new,
              s(:lvar, :frame)),
            s(:args),
            s(:begin,
              s(:send, nil, :text,
                s(:str, "コード参照")),
              s(:send, nil, :command,
                s(:block,
                  s(:send, nil, :proc),
                  s(:args),
                  s(:send, nil, :showCode,
                    s(:str, "cscroll")))))), :pack,
          s(:hash,
            s(:pair,
              s(:str, "side"),
              s(:str, "left")),
            s(:pair,
              s(:str, "expand"),
              s(:str, "yes"))))))),
  s(:send,
    s(:gvar, :$cscroll_buttons), :pack,
    s(:hash,
      s(:pair,
        s(:str, "side"),
        s(:str, "bottom")),
      s(:pair,
        s(:str, "fill"),
        s(:str, "x")),
      s(:pair,
        s(:str, "pady"),
        s(:str, "2m")))),
  s(:if,
    s(:send,
      s(:gvar, :$tk_version), :=~,
      s(:regexp,
        s(:str, "^4\\.[01]"),
        s(:regopt))), nil,
    s(:begin,
      s(:gvasgn, :$cscroll_grid,
        s(:block,
          s(:send,
            s(:const, nil, :TkFrame), :new,
            s(:lvar, :base_frame)),
          s(:args),
          s(:send, nil, :pack,
            s(:hash,
              s(:pair,
                s(:str, "expand"),
                s(:str, "yes")),
              s(:pair,
                s(:str, "fill"),
                s(:str, "both")),
              s(:pair,
                s(:str, "padx"),
                s(:int, 1)),
              s(:pair,
                s(:str, "pady"),
                s(:int, 1)))))),
      s(:send,
        s(:const, nil, :TkGrid), :rowconfigure,
        s(:gvar, :$cscroll_grid),
        s(:int, 0),
        s(:hash,
          s(:pair,
            s(:str, "weight"),
            s(:int, 1)),
          s(:pair,
            s(:str, "minsize"),
            s(:int, 0)))),
      s(:send,
        s(:const, nil, :TkGrid), :columnconfigure,
        s(:gvar, :$cscroll_grid),
        s(:int, 0),
        s(:hash,
          s(:pair,
            s(:str, "weight"),
            s(:int, 1)),
          s(:pair,
            s(:str, "minsize"),
            s(:int, 0)))))),
  s(:gvasgn, :$cscroll_canvas,
    s(:block,
      s(:send,
        s(:const, nil, :TkCanvas), :new,
        s(:lvar, :base_frame),
        s(:hash,
          s(:pair,
            s(:str, "relief"),
            s(:str, "sunken")),
          s(:pair,
            s(:str, "borderwidth"),
            s(:int, 2)),
          s(:pair,
            s(:str, "scrollregion"),
            s(:array,
              s(:str, "-11c"),
              s(:str, "-11c"),
              s(:str, "50c"),
              s(:str, "20c"))))),
      s(:args,
        s(:arg, :c)),
      s(:begin,
        s(:if,
          s(:send,
            s(:gvar, :$tk_version), :=~,
            s(:regexp,
              s(:str, "^4\\.[01]"),
              s(:regopt))),
          s(:send, nil, :pack,
            s(:hash,
              s(:pair,
                s(:str, "expand"),
                s(:str, "yes")),
              s(:pair,
                s(:str, "fill"),
                s(:str, "both")))),
          s(:send, nil, :grid,
            s(:hash,
              s(:pair,
                s(:str, "in"),
                s(:gvar, :$cscroll_grid)),
              s(:pair,
                s(:str, "padx"),
                s(:int, 1)),
              s(:pair,
                s(:str, "pady"),
                s(:int, 1)),
              s(:pair,
                s(:str, "row"),
                s(:int, 0)),
              s(:pair,
                s(:str, "column"),
                s(:int, 0)),
              s(:pair,
                s(:str, "rowspan"),
                s(:int, 1)),
              s(:pair,
                s(:str, "columnspan"),
                s(:int, 1)),
              s(:pair,
                s(:str, "sticky"),
                s(:str, "news"))))),
        s(:block,
          s(:send,
            s(:const, nil, :TkScrollbar), :new,
            s(:lvar, :base_frame),
            s(:hash,
              s(:pair,
                s(:str, "command"),
                s(:block,
                  s(:send, nil, :proc),
                  s(:args,
                    s(:restarg, :args)),
                  s(:send,
                    s(:lvar, :c), :yview,
                    s(:splat,
                      s(:lvar, :args))))))),
          s(:args,
            s(:arg, :vs)),
          s(:begin,
            s(:send,
              s(:lvar, :c), :yscrollcommand,
              s(:block,
                s(:send, nil, :proc),
                s(:args,
                  s(:arg, :first),
                  s(:arg, :last)),
                s(:send,
                  s(:lvar, :vs), :set,
                  s(:lvar, :first),
                  s(:lvar, :last)))),
            s(:if,
              s(:send,
                s(:gvar, :$tk_version), :=~,
                s(:regexp,
                  s(:str, "^4\\.[01]"),
                  s(:regopt))),
              s(:send, nil, :pack,
                s(:hash,
                  s(:pair,
                    s(:str, "side"),
                    s(:str, "right")),
                  s(:pair,
                    s(:str, "fill"),
                    s(:str, "y")))),
              s(:send, nil, :grid,
                s(:hash,
                  s(:pair,
                    s(:str, "in"),
                    s(:gvar, :$cscroll_grid)),
                  s(:pair,
                    s(:str, "padx"),
                    s(:int, 1)),
                  s(:pair,
                    s(:str, "pady"),
                    s(:int, 1)),
                  s(:pair,
                    s(:str, "row"),
                    s(:int, 0)),
                  s(:pair,
                    s(:str, "column"),
                    s(:int, 1)),
                  s(:pair,
                    s(:str, "rowspan"),
                    s(:int, 1)),
                  s(:pair,
                    s(:str, "columnspan"),
                    s(:int, 1)),
                  s(:pair,
                    s(:str, "sticky"),
                    s(:str, "news"))))))),
        s(:block,
          s(:send,
            s(:const, nil, :TkScrollbar), :new,
            s(:lvar, :base_frame),
            s(:hash,
              s(:pair,
                s(:str, "orient"),
                s(:str, "horiz")),
              s(:pair,
                s(:str, "command"),
                s(:block,
                  s(:send, nil, :proc),
                  s(:args,
                    s(:restarg, :args)),
                  s(:send,
                    s(:lvar, :c), :xview,
                    s(:splat,
                      s(:lvar, :args))))))),
          s(:args,
            s(:arg, :hs)),
          s(:begin,
            s(:send,
              s(:lvar, :c), :xscrollcommand,
              s(:block,
                s(:send, nil, :proc),
                s(:args,
                  s(:arg, :first),
                  s(:arg, :last)),
                s(:send,
                  s(:lvar, :hs), :set,
                  s(:lvar, :first),
                  s(:lvar, :last)))),
            s(:if,
              s(:send,
                s(:gvar, :$tk_version), :=~,
                s(:regexp,
                  s(:str, "^4\\.[01]"),
                  s(:regopt))),
              s(:send, nil, :pack,
                s(:hash,
                  s(:pair,
                    s(:str, "side"),
                    s(:str, "bottom")),
                  s(:pair,
                    s(:str, "fill"),
                    s(:str, "x")))),
              s(:send, nil, :grid,
                s(:hash,
                  s(:pair,
                    s(:str, "in"),
                    s(:gvar, :$cscroll_grid)),
                  s(:pair,
                    s(:str, "padx"),
                    s(:int, 1)),
                  s(:pair,
                    s(:str, "pady"),
                    s(:int, 1)),
                  s(:pair,
                    s(:str, "row"),
                    s(:int, 1)),
                  s(:pair,
                    s(:str, "column"),
                    s(:int, 0)),
                  s(:pair,
                    s(:str, "rowspan"),
                    s(:int, 1)),
                  s(:pair,
                    s(:str, "columnspan"),
                    s(:int, 1)),
                  s(:pair,
                    s(:str, "sticky"),
                    s(:str, "news")))))))))),
  s(:lvasgn, :bg,
    s(:send,
      s(:send,
        s(:gvar, :$cscroll_canvas), :configinfo,
        s(:str, "bg")), :[],
      s(:int, 4))),
  s(:block,
    s(:send,
      s(:begin,
        s(:irange,
          s(:int, 0),
          s(:int, 19))), :each),
    s(:args,
      s(:arg, :i)),
    s(:begin,
      s(:lvasgn, :x,
        s(:send,
          s(:int, -10), :+,
          s(:send,
            s(:int, 3), :*,
            s(:lvar, :i)))),
      s(:lvasgn, :y,
        s(:int, -10)),
      s(:block,
        s(:send,
          s(:begin,
            s(:irange,
              s(:int, 0),
              s(:int, 9))), :each),
        s(:args,
          s(:arg, :j)),
        s(:begin,
          s(:send,
            s(:const, nil, :TkcRectangle), :new,
            s(:gvar, :$cscroll_canvas),
            s(:dstr,
              s(:begin,
                s(:lvar, :x)),
              s(:str, "c")),
            s(:dstr,
              s(:begin,
                s(:lvar, :y)),
              s(:str, "c")),
            s(:dstr,
              s(:begin,
                s(:send,
                  s(:lvar, :x), :+,
                  s(:int, 2))),
              s(:str, "c")),
            s(:dstr,
              s(:begin,
                s(:send,
                  s(:lvar, :y), :+,
                  s(:int, 2))),
              s(:str, "c")),
            s(:hash,
              s(:pair,
                s(:str, "outline"),
                s(:str, "black")),
              s(:pair,
                s(:str, "fill"),
                s(:lvar, :bg)),
              s(:pair,
                s(:str, "tags"),
                s(:str, "rect")))),
          s(:send,
            s(:const, nil, :TkcText), :new,
            s(:gvar, :$cscroll_canvas),
            s(:dstr,
              s(:begin,
                s(:send,
                  s(:lvar, :x), :+,
                  s(:int, 1))),
              s(:str, "c")),
            s(:dstr,
              s(:begin,
                s(:send,
                  s(:lvar, :y), :+,
                  s(:int, 1))),
              s(:str, "c")),
            s(:hash,
              s(:pair,
                s(:str, "text"),
                s(:dstr,
                  s(:begin,
                    s(:lvar, :i)),
                  s(:str, ","),
                  s(:begin,
                    s(:lvar, :j)))),
              s(:pair,
                s(:str, "anchor"),
                s(:str, "center")),
              s(:pair,
                s(:str, "tags"),
                s(:str, "text")))),
          s(:op_asgn,
            s(:lvasgn, :y), :+,
            s(:int, 3)))))),
  s(:send,
    s(:gvar, :$cscroll_canvas), :itembind,
    s(:str, "all"),
    s(:str, "Any-Enter"),
    s(:block,
      s(:send, nil, :proc),
      s(:args),
      s(:send, nil, :scrollEnter,
        s(:gvar, :$cscroll_canvas)))),
  s(:send,
    s(:gvar, :$cscroll_canvas), :itembind,
    s(:str, "all"),
    s(:str, "Any-Leave"),
    s(:block,
      s(:send, nil, :proc),
      s(:args),
      s(:send, nil, :scrollLeave,
        s(:gvar, :$cscroll_canvas)))),
  s(:send,
    s(:gvar, :$cscroll_canvas), :itembind,
    s(:str, "all"),
    s(:str, "1"),
    s(:block,
      s(:send, nil, :proc),
      s(:args),
      s(:send, nil, :scrollButton,
        s(:gvar, :$cscroll_canvas)))),
  s(:send,
    s(:gvar, :$cscroll_canvas), :itembind,
    s(:str, "all"),
    s(:str, "Any-Enter"),
    s(:block,
      s(:send, nil, :proc),
      s(:args),
      s(:send, nil, :scrollEnter,
        s(:gvar, :$cscroll_canvas)))),
  s(:send,
    s(:gvar, :$cscroll_canvas), :bind,
    s(:str, "2"),
    s(:block,
      s(:send, nil, :proc),
      s(:args,
        s(:arg, :x),
        s(:arg, :y)),
      s(:send,
        s(:gvar, :$cscroll_canvas), :scan_mark,
        s(:lvar, :x),
        s(:lvar, :y))),
    s(:str, "%x %y")),
  s(:send,
    s(:gvar, :$cscroll_canvas), :bind,
    s(:str, "B2-Motion"),
    s(:block,
      s(:send, nil, :proc),
      s(:args,
        s(:arg, :x),
        s(:arg, :y)),
      s(:send,
        s(:gvar, :$cscroll_canvas), :scan_dragto,
        s(:lvar, :x),
        s(:lvar, :y))),
    s(:str, "%x %y")),
  s(:def, :scrollEnter,
    s(:args,
      s(:arg, :c)),
    s(:begin,
      s(:lvasgn, :id,
        s(:send,
          s(:send,
            s(:send,
              s(:lvar, :c), :find_withtag,
              s(:str, "current")), :[],
            s(:int, 0)), :id)),
      s(:if,
        s(:send,
          s(:send,
            s(:lvar, :c), :gettags,
            s(:str, "current")), :include?,
          s(:str, "text")),
        s(:op_asgn,
          s(:lvasgn, :id), :-,
          s(:int, 1)), nil),
      s(:gvasgn, :$oldFill,
        s(:send,
          s(:send,
            s(:lvar, :c), :itemconfiginfo,
            s(:lvar, :id),
            s(:str, "fill")), :[],
          s(:int, 4))),
      s(:if,
        s(:send,
          s(:send,
            s(:const, nil, :TkWinfo), :depth,
            s(:lvar, :c)), :>,
          s(:int, 1)),
        s(:send,
          s(:lvar, :c), :itemconfigure,
          s(:lvar, :id),
          s(:hash,
            s(:pair,
              s(:str, "fill"),
              s(:str, "SeaGreen1")))),
        s(:begin,
          s(:send,
            s(:lvar, :c), :itemconfigure,
            s(:lvar, :id),
            s(:hash,
              s(:pair,
                s(:str, "fill"),
                s(:str, "black")))),
          s(:send,
            s(:lvar, :c), :itemconfigure,
            s(:send,
              s(:lvar, :id), :+,
              s(:int, 1)),
            s(:hash,
              s(:pair,
                s(:str, "fill"),
                s(:str, "white")))))))),
  s(:def, :scrollLeave,
    s(:args,
      s(:arg, :c)),
    s(:begin,
      s(:lvasgn, :id,
        s(:send,
          s(:send,
            s(:send,
              s(:lvar, :c), :find_withtag,
              s(:str, "current")), :[],
            s(:int, 0)), :id)),
      s(:if,
        s(:send,
          s(:send,
            s(:lvar, :c), :gettags,
            s(:str, "current")), :include?,
          s(:str, "text")),
        s(:op_asgn,
          s(:lvasgn, :id), :-,
          s(:int, 1)), nil),
      s(:send,
        s(:lvar, :c), :itemconfigure,
        s(:lvar, :id),
        s(:hash,
          s(:pair,
            s(:str, "fill"),
            s(:gvar, :$oldFill)))),
      s(:send,
        s(:lvar, :c), :itemconfigure,
        s(:send,
          s(:lvar, :id), :+,
          s(:int, 1)),
        s(:hash,
          s(:pair,
            s(:str, "fill"),
            s(:str, "black")))))),
  s(:def, :scrollButton,
    s(:args,
      s(:arg, :c)),
    s(:begin,
      s(:lvasgn, :id,
        s(:send,
          s(:send,
            s(:send,
              s(:lvar, :c), :find_withtag,
              s(:str, "current")), :[],
            s(:int, 0)), :id)),
      s(:if,
        s(:send,
          s(:send,
            s(:lvar, :c), :gettags,
            s(:str, "current")), :include?,
          s(:str, "text")), nil,
        s(:op_asgn,
          s(:lvasgn, :id), :+,
          s(:int, 1))),
      s(:send, nil, :print,
        s(:dstr,
          s(:str, "You buttoned at "),
          s(:begin,
            s(:send,
              s(:send,
                s(:lvar, :c), :itemconfiginfo,
                s(:lvar, :id),
                s(:str, "text")), :[],
              s(:int, 4))),
          s(:str, "\n"))))))

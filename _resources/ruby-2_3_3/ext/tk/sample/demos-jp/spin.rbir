s(:begin,
  s(:if,
    s(:and,
      s(:defined?,
        s(:gvar, :$spin_demo)),
      s(:gvar, :$spin_demo)),
    s(:begin,
      s(:send,
        s(:gvar, :$spin_demo), :destroy),
      s(:gvasgn, :$spin_demo,
        s(:nil))), nil),
  s(:gvasgn, :$spin_demo,
    s(:block,
      s(:send,
        s(:const, nil, :TkToplevel), :new),
      s(:args,
        s(:arg, :w)),
      s(:begin,
        s(:send, nil, :title,
          s(:str, "Spinbox Demonstration")),
        s(:send, nil, :iconname,
          s(:str, "spin")),
        s(:send, nil, :positionWindow,
          s(:lvar, :w))))),
  s(:lvasgn, :base_frame,
    s(:send,
      s(:send,
        s(:const, nil, :TkFrame), :new,
        s(:gvar, :$spin_demo)), :pack,
      s(:hash,
        s(:pair,
          s(:sym, :fill),
          s(:sym, :both)),
        s(:pair,
          s(:sym, :expand),
          s(:true))))),
  s(:send,
    s(:send,
      s(:const, nil, :TkLabel), :new,
      s(:lvar, :base_frame),
      s(:hash,
        s(:pair,
          s(:sym, :font),
          s(:gvar, :$font)),
        s(:pair,
          s(:sym, :wraplength),
          s(:str, "5i")),
        s(:pair,
          s(:sym, :justify),
          s(:sym, :left)),
        s(:pair,
          s(:sym, :text),
          s(:dstr,
            s(:str, "下には３種類のスピンボックスが表示されています。\n"),
            s(:str, "それぞれ、マウスで選択して文字を入力することができます。\n"),
            s(:str, "編集操作としては、Emacs 形式の多くに加えて、一般的な\n"),
            s(:str, "Motif 形式のキー操作がサポートされています。たとえば、\n"),
            s(:str, "Backspace と Control-h とは入力カーソルの左側の文字を\n"),
            s(:str, "削除し、Delete と Control-d とは右側の文字を削除します。\n"),
            s(:str, "入力枠の長さを越えるような長い文字列を入力した場合には、\n"),
            s(:str, "マウスのボタン２を押してドラッグすることで、入力文字列\n"),
            s(:str, "をスキャンすることが可能です。\n"),
            s(:str, "なお、最初のスピンボックスは、整数値とみなされるような\n"),
            s(:str, "文字列しか入力が許されないことに注意してください。また、\n"),
            s(:str, "３番目のスピンボックスで選択候補に現れるのはオーストラ\n"),
            s(:str, "リアの都市名のリストとなっています。\n"),
            s(:str, "もしあなたが使っている Ruby にリンクされている Tk ライ\n"),
            s(:str, "ブラリが spinbox ウィジェットを実装していない場合、この\n"),
            s(:str, "デモはうまく動かないはずです。その場合には spinbox ウィ\n"),
            s(:str, "ジェットが実装されているようなより新しいバージョンの Tk\n"),
            s(:str, "を組み合わせて試すようにしてください。\n"))))), :pack,
    s(:hash,
      s(:pair,
        s(:sym, :side),
        s(:sym, :top)))),
  s(:block,
    s(:send,
      s(:const, nil, :TkFrame), :new,
      s(:lvar, :base_frame)),
    s(:args,
      s(:arg, :f)),
    s(:begin,
      s(:send, nil, :pack,
        s(:hash,
          s(:pair,
            s(:sym, :side),
            s(:sym, :bottom)),
          s(:pair,
            s(:sym, :fill),
            s(:sym, :x)),
          s(:pair,
            s(:sym, :pady),
            s(:str, "2m")))),
      s(:send,
        s(:send,
          s(:const, nil, :TkButton), :new,
          s(:lvar, :f),
          s(:hash,
            s(:pair,
              s(:sym, :text),
              s(:str, "閉じる")),
            s(:pair,
              s(:sym, :width),
              s(:int, 15)),
            s(:pair,
              s(:sym, :command),
              s(:block,
                s(:send, nil, :proc),
                s(:args),
                s(:begin,
                  s(:send,
                    s(:gvar, :$spin_demo), :destroy),
                  s(:gvasgn, :$spin_demo,
                    s(:nil))))))), :pack,
        s(:hash,
          s(:pair,
            s(:sym, :side),
            s(:sym, :left)),
          s(:pair,
            s(:sym, :expand),
            s(:true)))),
      s(:send,
        s(:send,
          s(:const, nil, :TkButton), :new,
          s(:lvar, :f),
          s(:hash,
            s(:pair,
              s(:sym, :text),
              s(:str, "コード参照")),
            s(:pair,
              s(:sym, :width),
              s(:int, 15)),
            s(:pair,
              s(:sym, :command),
              s(:block,
                s(:send, nil, :proc),
                s(:args),
                s(:send, nil, :showCode,
                  s(:str, "spin")))))), :pack,
        s(:hash,
          s(:pair,
            s(:sym, :side),
            s(:sym, :left)),
          s(:pair,
            s(:sym, :expand),
            s(:true)))))),
  s(:lvasgn, :australianCities,
    s(:array,
      s(:str, "Canberra"),
      s(:str, "Sydney"),
      s(:str, "Melbourne"),
      s(:str, "Perth"),
      s(:str, "Adelaide"),
      s(:str, "Brisbane"),
      s(:str, "Hobart"),
      s(:str, "Darwin"),
      s(:str, "Alice Springs"))),
  s(:block,
    s(:send,
      s(:array,
        s(:send,
          s(:const, nil, :TkSpinbox), :new,
          s(:lvar, :base_frame),
          s(:hash,
            s(:pair,
              s(:sym, :from),
              s(:int, 1)),
            s(:pair,
              s(:sym, :to),
              s(:int, 10)),
            s(:pair,
              s(:sym, :width),
              s(:int, 10)),
            s(:pair,
              s(:sym, :validate),
              s(:sym, :key)),
            s(:pair,
              s(:sym, :validatecommand),
              s(:array,
                s(:block,
                  s(:send, nil, :proc),
                  s(:args,
                    s(:arg, :s)),
                  s(:or,
                    s(:send,
                      s(:lvar, :s), :==,
                      s(:str, "")),
                    s(:match_with_lvasgn,
                      s(:regexp,
                        s(:str, "^[+-]?\\d+$"),
                        s(:regopt)),
                      s(:lvar, :s)))),
                s(:str, "%P"))))),
        s(:send,
          s(:const, nil, :TkSpinbox), :new,
          s(:lvar, :base_frame),
          s(:hash,
            s(:pair,
              s(:sym, :from),
              s(:int, 0)),
            s(:pair,
              s(:sym, :to),
              s(:int, 3)),
            s(:pair,
              s(:sym, :increment),
              s(:float, 0.5)),
            s(:pair,
              s(:sym, :format),
              s(:str, "%05.2f")),
            s(:pair,
              s(:sym, :width),
              s(:int, 10)))),
        s(:send,
          s(:const, nil, :TkSpinbox), :new,
          s(:lvar, :base_frame),
          s(:hash,
            s(:pair,
              s(:sym, :values),
              s(:lvar, :australianCities)),
            s(:pair,
              s(:sym, :width),
              s(:int, 10))))), :each),
    s(:args,
      s(:arg, :sbox)),
    s(:send,
      s(:lvar, :sbox), :pack,
      s(:hash,
        s(:pair,
          s(:sym, :side),
          s(:sym, :top)),
        s(:pair,
          s(:sym, :pady),
          s(:int, 5)),
        s(:pair,
          s(:sym, :padx),
          s(:int, 10))))))

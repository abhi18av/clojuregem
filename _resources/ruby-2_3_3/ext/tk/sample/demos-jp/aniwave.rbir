s(:begin,
  s(:if,
    s(:and,
      s(:defined?,
        s(:gvar, :$aniwave_demo)),
      s(:gvar, :$aniwave_demo)),
    s(:begin,
      s(:send,
        s(:gvar, :$aniwave_demo), :destroy),
      s(:gvasgn, :$aniwave_demo,
        s(:nil))), nil),
  s(:gvasgn, :$aniwave_demo,
    s(:block,
      s(:send,
        s(:const, nil, :TkToplevel), :new),
      s(:args,
        s(:arg, :w)),
      s(:begin,
        s(:send, nil, :title,
          s(:str, "Animated Wave Demonstration")),
        s(:send, nil, :iconname,
          s(:str, "aniwave")),
        s(:send, nil, :positionWindow,
          s(:lvar, :w))))),
  s(:lvasgn, :base_frame,
    s(:send,
      s(:send,
        s(:const, nil, :TkFrame), :new,
        s(:gvar, :$aniwave_demo)), :pack,
      s(:hash,
        s(:pair,
          s(:sym, :fill),
          s(:sym, :both)),
        s(:pair,
          s(:sym, :expand),
          s(:true))))),
  s(:lvasgn, :msg,
    s(:block,
      s(:send,
        s(:const, nil, :TkLabel), :new,
        s(:lvar, :base_frame)),
      s(:args),
      s(:begin,
        s(:send, nil, :font,
          s(:gvar, :$font)),
        s(:send, nil, :wraplength,
          s(:str, "4i")),
        s(:send, nil, :justify,
          s(:str, "left")),
        s(:send, nil, :text,
          s(:str, "このデモでは、ラインアイテムが一つだけ描かれたキャンバスウィジェットが表示されています。アニメーション処理は、そのラインアイテムの座標値を変更することで実現しています。"))))),
  s(:send,
    s(:lvar, :msg), :pack,
    s(:hash,
      s(:pair,
        s(:str, "side"),
        s(:str, "top")))),
  s(:send,
    s(:block,
      s(:send,
        s(:const, nil, :TkFrame), :new,
        s(:lvar, :base_frame)),
      s(:args,
        s(:arg, :frame)),
      s(:begin,
        s(:send,
          s(:block,
            s(:send,
              s(:const, nil, :TkButton), :new,
              s(:lvar, :frame)),
            s(:args),
            s(:begin,
              s(:send, nil, :text,
                s(:str, "閉じる")),
              s(:send, nil, :command,
                s(:block,
                  s(:send, nil, :proc),
                  s(:args),
                  s(:begin,
                    s(:lvasgn, :tmppath,
                      s(:gvar, :$aniwave_demo)),
                    s(:gvasgn, :$aniwave_demo,
                      s(:nil)),
                    s(:send,
                      s(:lvar, :tmppath), :destroy)))))), :pack,
          s(:hash,
            s(:pair,
              s(:str, "side"),
              s(:str, "left")),
            s(:pair,
              s(:str, "expand"),
              s(:str, "yes")))),
        s(:send,
          s(:block,
            s(:send,
              s(:const, nil, :TkButton), :new,
              s(:lvar, :frame)),
            s(:args),
            s(:begin,
              s(:send, nil, :text,
                s(:str, "コード参照")),
              s(:send, nil, :command,
                s(:block,
                  s(:send, nil, :proc),
                  s(:args),
                  s(:send, nil, :showCode,
                    s(:str, "aniwave")))))), :pack,
          s(:hash,
            s(:pair,
              s(:str, "side"),
              s(:str, "left")),
            s(:pair,
              s(:str, "expand"),
              s(:str, "yes")))))), :pack,
    s(:hash,
      s(:pair,
        s(:str, "side"),
        s(:str, "bottom")),
      s(:pair,
        s(:str, "fill"),
        s(:str, "x")),
      s(:pair,
        s(:str, "pady"),
        s(:str, "2m")))),
  s(:class,
    s(:const, nil, :AnimatedWaveDemo), nil,
    s(:begin,
      s(:def, :initialize,
        s(:args,
          s(:arg, :frame),
          s(:optarg, :dir,
            s(:sym, :left))),
        s(:begin,
          s(:ivasgn, :@direction,
            s(:lvar, :dir)),
          s(:ivasgn, :@c,
            s(:send,
              s(:const, nil, :TkCanvas), :new,
              s(:lvar, :frame),
              s(:hash,
                s(:pair,
                  s(:sym, :width),
                  s(:int, 300)),
                s(:pair,
                  s(:sym, :height),
                  s(:int, 200)),
                s(:pair,
                  s(:sym, :background),
                  s(:str, "black"))))),
          s(:send,
            s(:ivar, :@c), :pack,
            s(:hash,
              s(:pair,
                s(:sym, :padx),
                s(:int, 10)),
              s(:pair,
                s(:sym, :pady),
                s(:int, 10)),
              s(:pair,
                s(:sym, :expand),
                s(:true)))),
          s(:ivasgn, :@waveCoords,
            s(:array)),
          s(:ivasgn, :@backupCoords,
            s(:array)),
          s(:lvasgn, :n,
            s(:int, 0)),
          s(:block,
            s(:send,
              s(:begin,
                s(:irange,
                  s(:int, -10),
                  s(:int, 300))), :step,
              s(:int, 5)),
            s(:args,
              s(:arg, :n)),
            s(:begin,
              s(:send,
                s(:ivar, :@waveCoords), :<<,
                s(:array,
                  s(:lvar, :n),
                  s(:int, 100))),
              s(:send,
                s(:ivar, :@backupCoords), :<<,
                s(:array,
                  s(:lvar, :n),
                  s(:int, 100))))),
          s(:lvasgn, :n,
            s(:int, 305)),
          s(:send,
            s(:ivar, :@waveCoords), :<<,
            s(:array,
              s(:lvar, :n),
              s(:int, 0))),
          s(:send,
            s(:ivar, :@backupCoords), :<<,
            s(:array,
              s(:lvar, :n),
              s(:int, 0))),
          s(:send,
            s(:ivar, :@waveCoords), :<<,
            s(:array,
              s(:send,
                s(:lvar, :n), :+,
                s(:int, 5)),
              s(:int, 200))),
          s(:send,
            s(:ivar, :@backupCoords), :<<,
            s(:array,
              s(:send,
                s(:lvar, :n), :+,
                s(:int, 5)),
              s(:int, 200))),
          s(:ivasgn, :@coordsLen,
            s(:send,
              s(:ivar, :@waveCoords), :length)),
          s(:ivasgn, :@line,
            s(:send,
              s(:const, nil, :TkcLine), :new,
              s(:ivar, :@c),
              s(:ivar, :@waveCoords),
              s(:hash,
                s(:pair,
                  s(:sym, :width),
                  s(:int, 1)),
                s(:pair,
                  s(:sym, :fill),
                  s(:str, "green")),
                s(:pair,
                  s(:sym, :smooth),
                  s(:true))))),
          s(:ivasgn, :@timer,
            s(:block,
              s(:send,
                s(:const, nil, :TkTimer), :new,
                s(:int, 10)),
              s(:args),
              s(:begin,
                s(:send, nil, :basicMotion),
                s(:send, nil, :reverser)))),
          s(:send,
            s(:ivar, :@c), :bindtags_unshift,
            s(:block,
              s(:send,
                s(:const, nil, :TkBindTag), :new,
                s(:str, "Destroy")),
              s(:args),
              s(:send,
                s(:ivar, :@timer), :stop))))),
      s(:def, :basicMotion,
        s(:args),
        s(:begin,
          s(:masgn,
            s(:mlhs,
              s(:ivasgn, :@backupCoords),
              s(:ivasgn, :@waveCoords)),
            s(:array,
              s(:ivar, :@waveCoords),
              s(:ivar, :@backupCoords))),
          s(:block,
            s(:send,
              s(:begin,
                s(:erange,
                  s(:int, 0),
                  s(:ivar, :@coordsLen))), :each),
            s(:args,
              s(:arg, :idx)),
            s(:if,
              s(:send,
                s(:ivar, :@direction), :==,
                s(:sym, :left)),
              s(:send,
                s(:send,
                  s(:ivar, :@waveCoords), :[],
                  s(:lvar, :idx)), :[]=,
                s(:int, 1),
                s(:send,
                  s(:send,
                    s(:ivar, :@backupCoords), :[],
                    s(:if,
                      s(:begin,
                        s(:send,
                          s(:send,
                            s(:lvar, :idx), :+,
                            s(:int, 1)), :==,
                          s(:ivar, :@coordsLen))),
                      s(:int, 0),
                      s(:send,
                        s(:lvar, :idx), :+,
                        s(:int, 1)))), :[],
                  s(:int, 1))),
              s(:send,
                s(:send,
                  s(:ivar, :@waveCoords), :[],
                  s(:lvar, :idx)), :[]=,
                s(:int, 1),
                s(:send,
                  s(:send,
                    s(:ivar, :@backupCoords), :[],
                    s(:if,
                      s(:begin,
                        s(:send,
                          s(:lvar, :idx), :==,
                          s(:int, 0))),
                      s(:int, -1),
                      s(:send,
                        s(:lvar, :idx), :-,
                        s(:int, 1)))), :[],
                  s(:int, 1))))),
          s(:send,
            s(:ivar, :@line), :coords,
            s(:ivar, :@waveCoords)))),
      s(:def, :reverser,
        s(:args),
        s(:if,
          s(:send,
            s(:send,
              s(:send,
                s(:ivar, :@waveCoords), :[],
                s(:int, 0)), :[],
              s(:int, 1)), :<,
            s(:int, 10)),
          s(:ivasgn, :@direction,
            s(:sym, :right)),
          s(:if,
            s(:send,
              s(:send,
                s(:send,
                  s(:ivar, :@waveCoords), :[],
                  s(:int, -1)), :[],
                s(:int, 1)), :<,
              s(:int, 10)),
            s(:ivasgn, :@direction,
              s(:sym, :left)), nil))),
      s(:def, :move,
        s(:args),
        s(:send,
          s(:ivar, :@timer), :start)),
      s(:def, :stop,
        s(:args),
        s(:send,
          s(:ivar, :@timer), :stop)))),
  s(:send,
    s(:send,
      s(:const, nil, :AnimatedWaveDemo), :new,
      s(:lvar, :base_frame),
      s(:sym, :left)), :move))

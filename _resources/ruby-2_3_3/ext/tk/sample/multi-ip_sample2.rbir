s(:begin,
  s(:send, nil, :require,
    s(:str, "multi-tk.rb")),
  s(:lvasgn, :th,
    s(:block,
      s(:send,
        s(:const, nil, :Thread), :new),
      s(:args),
      s(:send,
        s(:const, nil, :Tk), :mainloop))),
  s(:send,
    s(:send,
      s(:const, nil, :TkLabel), :new,
      s(:hash,
        s(:pair,
          s(:sym, :text),
          s(:str, "this is a primary master")))), :pack),
  s(:lvasgn, :ip1,
    s(:send,
      s(:const, nil, :MultiTkIp), :new_slave,
      s(:hash,
        s(:pair,
          s(:sym, :safe),
          s(:int, 1))))),
  s(:lvasgn, :ip2,
    s(:send,
      s(:const, nil, :MultiTkIp), :new_slave,
      s(:hash,
        s(:pair,
          s(:sym, :safe),
          s(:int, 2))))),
  s(:lvasgn, :cmd,
    s(:block,
      s(:send, nil, :proc),
      s(:args,
        s(:arg, :s)),
      s(:begin,
        s(:send, nil, :require,
          s(:str, "tk")),
        s(:send,
          s(:send,
            s(:const, nil, :TkButton), :new,
            s(:hash,
              s(:pair,
                s(:sym, :text),
                s(:str, "b1: p self")),
              s(:pair,
                s(:sym, :command),
                s(:block,
                  s(:send, nil, :proc),
                  s(:args),
                  s(:send, nil, :p,
                    s(:self)))))), :pack,
          s(:hash,
            s(:pair,
              s(:sym, :fill),
              s(:sym, :x)))),
        s(:send, nil, :sleep,
          s(:lvar, :s)),
        s(:send,
          s(:send,
            s(:const, nil, :TkButton), :new,
            s(:hash,
              s(:pair,
                s(:sym, :text),
                s(:str, "b2: p $SAFE")),
              s(:pair,
                s(:sym, :command),
                s(:block,
                  s(:send, nil, :proc),
                  s(:args),
                  s(:send, nil, :p,
                    s(:gvar, :$SAFE)))))), :pack,
          s(:hash,
            s(:pair,
              s(:sym, :fill),
              s(:sym, :x)))),
        s(:send, nil, :sleep,
          s(:lvar, :s)),
        s(:send,
          s(:send,
            s(:const, nil, :TkButton), :new,
            s(:hash,
              s(:pair,
                s(:sym, :text),
                s(:str, "b3: p MultiTkIp.ip_name")),
              s(:pair,
                s(:sym, :command),
                s(:block,
                  s(:send, nil, :proc),
                  s(:args),
                  s(:send, nil, :p,
                    s(:send,
                      s(:const, nil, :MultiTkIp), :ip_name)))))), :pack,
          s(:hash,
            s(:pair,
              s(:sym, :fill),
              s(:sym, :x)))),
        s(:send, nil, :sleep,
          s(:lvar, :s)),
        s(:send,
          s(:send,
            s(:const, nil, :TkButton), :new,
            s(:hash,
              s(:pair,
                s(:sym, :text),
                s(:str, "EXIT")),
              s(:pair,
                s(:sym, :command),
                s(:block,
                  s(:send, nil, :proc),
                  s(:args),
                  s(:send, nil, :exit))))), :pack,
          s(:hash,
            s(:pair,
              s(:sym, :fill),
              s(:sym, :x)))),
        s(:send,
          s(:const, nil, :Tk), :mainloop)))),
  s(:block,
    s(:send,
      s(:const, nil, :Thread), :new),
    s(:args),
    s(:send,
      s(:lvar, :ip1), :eval_proc,
      s(:lvar, :cmd),
      s(:float, 1.1))),
  s(:block,
    s(:send,
      s(:const, nil, :Thread), :new),
    s(:args),
    s(:send,
      s(:lvar, :ip2), :eval_proc,
      s(:lvar, :cmd),
      s(:float, 0.3))),
  s(:send,
    s(:lvar, :cmd), :call,
    s(:float, 0.7)),
  s(:send,
    s(:lvar, :th), :join))

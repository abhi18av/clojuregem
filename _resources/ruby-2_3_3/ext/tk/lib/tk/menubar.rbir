s(:begin,
  s(:send, nil, :require,
    s(:str, "tk")),
  s(:send, nil, :require,
    s(:str, "tk/frame")),
  s(:send, nil, :require,
    s(:str, "tk/composite")),
  s(:send, nil, :require,
    s(:str, "tk/menuspec")),
  s(:class,
    s(:const, nil, :TkMenubar),
    s(:const,
      s(:const, nil, :Tk), :Frame),
    s(:begin,
      s(:send, nil, :include,
        s(:const, nil, :TkComposite)),
      s(:send, nil, :include,
        s(:const, nil, :TkMenuSpec)),
      s(:def, :initialize,
        s(:args,
          s(:optarg, :parent,
            s(:nil)),
          s(:optarg, :spec,
            s(:nil)),
          s(:optarg, :options,
            s(:hash))),
        s(:begin,
          s(:if,
            s(:send,
              s(:lvar, :parent), :kind_of?,
              s(:const, nil, :Hash)),
            s(:begin,
              s(:lvasgn, :options,
                s(:lvar, :parent)),
              s(:lvasgn, :parent,
                s(:nil)),
              s(:lvasgn, :spec,
                s(:if,
                  s(:begin,
                    s(:send,
                      s(:lvar, :options), :has_key?,
                      s(:str, "spec"))),
                  s(:send,
                    s(:lvar, :options), :delete,
                    s(:str, "spec")),
                  s(:nil)))), nil),
          s(:send, nil, :_symbolkey2str,
            s(:lvar, :options)),
          s(:lvasgn, :menuspec_opt,
            s(:hash)),
          s(:block,
            s(:send,
              s(:const,
                s(:const, nil, :TkMenuSpec), :MENUSPEC_OPTKEYS), :each),
            s(:args,
              s(:arg, :key)),
            s(:if,
              s(:send,
                s(:lvar, :options), :has_key?,
                s(:lvar, :key)),
              s(:send,
                s(:lvar, :menuspec_opt), :[]=,
                s(:lvar, :key),
                s(:send,
                  s(:lvar, :options), :delete,
                  s(:lvar, :key))), nil)),
          s(:super,
            s(:lvar, :parent),
            s(:lvar, :options)),
          s(:ivasgn, :@menus,
            s(:array)),
          s(:if,
            s(:lvar, :spec),
            s(:block,
              s(:send,
                s(:lvar, :spec), :each),
              s(:args,
                s(:arg, :info)),
              s(:send, nil, :add_menu,
                s(:lvar, :info),
                s(:lvar, :menuspec_opt))), nil),
          s(:if,
            s(:lvar, :options),
            s(:block,
              s(:send,
                s(:lvar, :options), :each),
              s(:args,
                s(:arg, :key),
                s(:arg, :value)),
              s(:send, nil, :configure,
                s(:lvar, :key),
                s(:lvar, :value))), nil))),
      s(:def, :add_menu,
        s(:args,
          s(:arg, :menu_info),
          s(:optarg, :menuspec_opt,
            s(:hash))),
        s(:begin,
          s(:masgn,
            s(:mlhs,
              s(:lvasgn, :mbtn),
              s(:lvasgn, :menu)),
            s(:send, nil, :_create_menubutton,
              s(:ivar, :@frame),
              s(:lvar, :menu_info),
              s(:lvar, :menuspec_opt))),
          s(:lvasgn, :submenus,
            s(:send,
              s(:send, nil, :_get_cascade_menus,
                s(:lvar, :menu)), :flatten)),
          s(:send,
            s(:ivar, :@menus), :push,
            s(:array,
              s(:lvar, :mbtn),
              s(:lvar, :menu))),
          s(:send, nil, :delegate,
            s(:str, "tearoff"),
            s(:lvar, :menu),
            s(:splat,
              s(:lvar, :submenus))),
          s(:send, nil, :delegate,
            s(:str, "foreground"),
            s(:lvar, :mbtn),
            s(:lvar, :menu),
            s(:splat,
              s(:lvar, :submenus))),
          s(:send, nil, :delegate,
            s(:str, "background"),
            s(:lvar, :mbtn),
            s(:lvar, :menu),
            s(:splat,
              s(:lvar, :submenus))),
          s(:send, nil, :delegate,
            s(:str, "disabledforeground"),
            s(:lvar, :mbtn),
            s(:lvar, :menu),
            s(:splat,
              s(:lvar, :submenus))),
          s(:send, nil, :delegate,
            s(:str, "activeforeground"),
            s(:lvar, :mbtn),
            s(:lvar, :menu),
            s(:splat,
              s(:lvar, :submenus))),
          s(:send, nil, :delegate,
            s(:str, "activebackground"),
            s(:lvar, :mbtn),
            s(:lvar, :menu),
            s(:splat,
              s(:lvar, :submenus))),
          s(:send, nil, :delegate,
            s(:str, "font"),
            s(:lvar, :mbtn),
            s(:lvar, :menu),
            s(:splat,
              s(:lvar, :submenus))),
          s(:send, nil, :delegate,
            s(:str, "kanjifont"),
            s(:lvar, :mbtn),
            s(:lvar, :menu),
            s(:splat,
              s(:lvar, :submenus))))),
      s(:def, :[],
        s(:args,
          s(:arg, :index)),
        s(:return,
          s(:send,
            s(:ivar, :@menus), :[],
            s(:lvar, :index)))))))

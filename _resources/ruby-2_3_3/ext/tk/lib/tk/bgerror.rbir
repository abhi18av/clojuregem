s(:begin,
  s(:send, nil, :require,
    s(:str, "tk")),
  s(:module,
    s(:const, nil, :TkBgError),
    s(:begin,
      s(:send, nil, :extend,
        s(:const, nil, :Tk)),
      s(:casgn, nil, :TkCommandNames,
        s(:send,
          s(:array,
            s(:send,
              s(:str, "bgerror"), :freeze)), :freeze)),
      s(:def, :bgerror,
        s(:args,
          s(:arg, :message)),
        s(:send, nil, :tk_call,
          s(:str, "bgerror"),
          s(:lvar, :message))),
      s(:alias,
        s(:sym, :tkerror),
        s(:sym, :bgerror)),
      s(:alias,
        s(:sym, :show),
        s(:sym, :bgerror)),
      s(:send, nil, :module_function,
        s(:sym, :bgerror),
        s(:sym, :tkerror),
        s(:sym, :show)),
      s(:def, :set_handler,
        s(:args,
          s(:optarg, :hdlr,
            s(:send,
              s(:const, nil, :Proc), :new))),
        s(:send, nil, :tk_call,
          s(:str, "proc"),
          s(:str, "bgerror"),
          s(:str, "msg"),
          s(:send,
            s(:send, nil, :install_cmd,
              s(:lvar, :hdlr)), :+,
            s(:str, " $msg")))),
      s(:def, :set_default,
        s(:args),
        s(:kwbegin,
          s(:rescue,
            s(:send, nil, :tk_call,
              s(:str, "rename"),
              s(:str, "bgerror"),
              s(:str, "")),
            s(:resbody,
              s(:array,
                s(:const, nil, :RuntimeError)), nil, nil), nil))),
      s(:send, nil, :module_function,
        s(:sym, :set_handler),
        s(:sym, :set_default)))))

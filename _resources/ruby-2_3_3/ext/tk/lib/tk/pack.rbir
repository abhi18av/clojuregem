s(:begin,
  s(:send, nil, :require,
    s(:str, "tk")),
  s(:module,
    s(:const, nil, :TkPack),
    s(:begin,
      s(:send, nil, :include,
        s(:const, nil, :Tk)),
      s(:send, nil, :extend,
        s(:const, nil, :Tk)),
      s(:casgn, nil, :TkCommandNames,
        s(:send,
          s(:array,
            s(:send,
              s(:str, "pack"), :freeze)), :freeze)),
      s(:def, :configure,
        s(:args,
          s(:restarg, :args)),
        s(:begin,
          s(:if,
            s(:send,
              s(:send,
                s(:lvar, :args), :[],
                s(:int, -1)), :kind_of?,
              s(:const, nil, :Hash)),
            s(:lvasgn, :opts,
              s(:send,
                s(:lvar, :args), :pop)),
            s(:lvasgn, :opts,
              s(:hash))),
          s(:if,
            s(:send,
              s(:lvar, :args), :empty?),
            s(:send, nil, :fail,
              s(:const, nil, :ArgumentError),
              s(:str, "no widget is given")), nil),
          s(:lvasgn, :params,
            s(:array)),
          s(:block,
            s(:send,
              s(:send,
                s(:lvar, :args), :flatten,
                s(:int, 1)), :each),
            s(:args,
              s(:arg, :win)),
            s(:send,
              s(:lvar, :params), :push,
              s(:send, nil, :_epath,
                s(:lvar, :win)))),
          s(:block,
            s(:send,
              s(:lvar, :opts), :each),
            s(:args,
              s(:arg, :k),
              s(:arg, :v)),
            s(:begin,
              s(:send,
                s(:lvar, :params), :push,
                s(:dstr,
                  s(:str, "-"),
                  s(:begin,
                    s(:lvar, :k)))),
              s(:send,
                s(:lvar, :params), :push,
                s(:send, nil, :_epath,
                  s(:lvar, :v))))),
          s(:send, nil, :tk_call_without_enc,
            s(:str, "pack"),
            s(:str, "configure"),
            s(:splat,
              s(:lvar, :params))))),
      s(:alias,
        s(:sym, :pack),
        s(:sym, :configure)),
      s(:def, :forget,
        s(:args,
          s(:restarg, :args)),
        s(:begin,
          s(:if,
            s(:send,
              s(:send,
                s(:lvar, :args), :size), :==,
              s(:int, 0)),
            s(:return,
              s(:str, "")), nil),
          s(:lvasgn, :wins,
            s(:block,
              s(:send,
                s(:lvar, :args), :collect),
              s(:args,
                s(:arg, :win)),
              s(:send, nil, :_epath,
                s(:lvar, :win)))),
          s(:send, nil, :tk_call_without_enc,
            s(:str, "pack"),
            s(:str, "forget"),
            s(:splat,
              s(:lvar, :wins))))),
      s(:def, :info,
        s(:args,
          s(:arg, :slave)),
        s(:begin,
          s(:lvasgn, :slave,
            s(:send, nil, :_epath,
              s(:lvar, :slave))),
          s(:lvasgn, :ilist,
            s(:send, nil, :list,
              s(:send, nil, :tk_call_without_enc,
                s(:str, "pack"),
                s(:str, "info"),
                s(:lvar, :slave)))),
          s(:lvasgn, :info,
            s(:hash)),
          s(:while,
            s(:lvasgn, :key,
              s(:send,
                s(:lvar, :ilist), :shift)),
            s(:send,
              s(:lvar, :info), :[]=,
              s(:send,
                s(:lvar, :key), :[],
                s(:irange,
                  s(:int, 1),
                  s(:int, -1))),
              s(:send,
                s(:lvar, :ilist), :shift))),
          s(:return,
            s(:lvar, :info)))),
      s(:def, :propagate,
        s(:args,
          s(:arg, :master),
          s(:optarg, :mode,
            s(:const, nil, :None))),
        s(:begin,
          s(:lvasgn, :master,
            s(:send, nil, :_epath,
              s(:lvar, :master))),
          s(:if,
            s(:send,
              s(:lvar, :mode), :==,
              s(:const, nil, :None)),
            s(:send, nil, :bool,
              s(:send, nil, :tk_call_without_enc,
                s(:str, "pack"),
                s(:str, "propagate"),
                s(:lvar, :master))),
            s(:send, nil, :tk_call_without_enc,
              s(:str, "pack"),
              s(:str, "propagate"),
              s(:lvar, :master),
              s(:lvar, :mode))))),
      s(:def, :slaves,
        s(:args,
          s(:arg, :master)),
        s(:begin,
          s(:lvasgn, :master,
            s(:send, nil, :_epath,
              s(:lvar, :master))),
          s(:send, nil, :list,
            s(:send, nil, :tk_call_without_enc,
              s(:str, "pack"),
              s(:str, "slaves"),
              s(:lvar, :master))))),
      s(:send, nil, :module_function,
        s(:sym, :pack),
        s(:sym, :configure),
        s(:sym, :forget),
        s(:sym, :info),
        s(:sym, :propagate),
        s(:sym, :slaves)))))

s(:begin,
  s(:send, nil, :require,
    s(:str, "tk")),
  s(:send, nil, :require,
    s(:str, "tk/text")),
  s(:class,
    s(:const, nil, :TkTextImage),
    s(:const, nil, :TkObject),
    s(:begin,
      s(:send, nil, :include,
        s(:const,
          s(:const,
            s(:const, nil, :Tk), :Text), :IndexModMethods)),
      s(:def, :initialize,
        s(:args,
          s(:arg, :parent),
          s(:arg, :index),
          s(:arg, :keys)),
        s(:begin,
          s(:ivasgn, :@t,
            s(:lvar, :parent)),
          s(:if,
            s(:or,
              s(:send,
                s(:lvar, :index), :==,
                s(:str, "end")),
              s(:send,
                s(:lvar, :index), :==,
                s(:sym, :end))),
            s(:ivasgn, :@path,
              s(:send,
                s(:const, nil, :TkTextMark), :new,
                s(:ivar, :@t),
                s(:send, nil, :tk_call,
                  s(:send,
                    s(:ivar, :@t), :path),
                  s(:str, "index"),
                  s(:str, "end - 1 chars")))),
            s(:if,
              s(:send,
                s(:lvar, :index), :kind_of?,
                s(:const, nil, :TkTextMark)),
              s(:if,
                s(:send,
                  s(:send, nil, :tk_call_without_enc,
                    s(:send,
                      s(:ivar, :@t), :path),
                    s(:str, "index"),
                    s(:send,
                      s(:lvar, :index), :path)), :==,
                  s(:send, nil, :tk_call_without_enc,
                    s(:send,
                      s(:ivar, :@t), :path),
                    s(:str, "index"),
                    s(:str, "end"))),
                s(:ivasgn, :@path,
                  s(:send,
                    s(:const, nil, :TkTextMark), :new,
                    s(:ivar, :@t),
                    s(:send, nil, :tk_call_without_enc,
                      s(:send,
                        s(:ivar, :@t), :path),
                      s(:str, "index"),
                      s(:str, "end - 1 chars")))),
                s(:ivasgn, :@path,
                  s(:send,
                    s(:const, nil, :TkTextMark), :new,
                    s(:ivar, :@t),
                    s(:send, nil, :tk_call_without_enc,
                      s(:send,
                        s(:ivar, :@t), :path),
                      s(:str, "index"),
                      s(:send,
                        s(:lvar, :index), :path))))),
              s(:ivasgn, :@path,
                s(:send,
                  s(:const, nil, :TkTextMark), :new,
                  s(:ivar, :@t),
                  s(:send, nil, :tk_call_without_enc,
                    s(:send,
                      s(:ivar, :@t), :path),
                    s(:str, "index"),
                    s(:send, nil, :_get_eval_enc_str,
                      s(:lvar, :index))))))),
          s(:send,
            s(:ivar, :@path), :gravity=,
            s(:str, "left")),
          s(:ivasgn, :@index,
            s(:send,
              s(:ivar, :@path), :path)),
          s(:ivasgn, :@id,
            s(:send,
              s(:send, nil, :tk_call_without_enc,
                s(:send,
                  s(:ivar, :@t), :path),
                s(:str, "image"),
                s(:str, "create"),
                s(:ivar, :@index),
                s(:splat,
                  s(:send, nil, :hash_kv,
                    s(:lvar, :keys),
                    s(:true)))), :freeze)),
          s(:send,
            s(:ivar, :@path), :gravity=,
            s(:str, "right")))),
      s(:def, :id,
        s(:args),
        s(:send,
          s(:const,
            s(:const,
              s(:const, nil, :Tk), :Text), :IndexString), :new,
          s(:ivar, :@id))),
      s(:def, :mark,
        s(:args),
        s(:ivar, :@path)),
      s(:def, :[],
        s(:args,
          s(:arg, :slot)),
        s(:send, nil, :cget,
          s(:lvar, :slot))),
      s(:def, :[]=,
        s(:args,
          s(:arg, :slot),
          s(:arg, :value)),
        s(:begin,
          s(:send, nil, :configure,
            s(:lvar, :slot),
            s(:lvar, :value)),
          s(:lvar, :value))),
      s(:def, :cget,
        s(:args,
          s(:arg, :slot)),
        s(:send,
          s(:ivar, :@t), :image_cget,
          s(:ivar, :@index),
          s(:lvar, :slot))),
      s(:def, :cget_strict,
        s(:args,
          s(:arg, :slot)),
        s(:send,
          s(:ivar, :@t), :image_cget_strict,
          s(:ivar, :@index),
          s(:lvar, :slot))),
      s(:def, :configure,
        s(:args,
          s(:arg, :slot),
          s(:optarg, :value,
            s(:const, nil, :None))),
        s(:begin,
          s(:send,
            s(:ivar, :@t), :image_configure,
            s(:ivar, :@index),
            s(:lvar, :slot),
            s(:lvar, :value)),
          s(:self))),
      s(:def, :configinfo,
        s(:args,
          s(:optarg, :slot,
            s(:nil))),
        s(:send,
          s(:ivar, :@t), :image_configinfo,
          s(:ivar, :@index),
          s(:lvar, :slot))),
      s(:def, :current_configinfo,
        s(:args,
          s(:optarg, :slot,
            s(:nil))),
        s(:send,
          s(:ivar, :@t), :current_image_configinfo,
          s(:ivar, :@index),
          s(:lvar, :slot))),
      s(:def, :image,
        s(:args),
        s(:begin,
          s(:lvasgn, :img,
            s(:send, nil, :tk_call_without_enc,
              s(:send,
                s(:ivar, :@t), :path),
              s(:str, "image"),
              s(:str, "cget"),
              s(:ivar, :@index),
              s(:str, "-image"))),
          s(:if,
            s(:send,
              s(:const,
                s(:const, nil, :TkImage), :Tk_IMGTBL), :[],
              s(:lvar, :img)),
            s(:send,
              s(:const,
                s(:const, nil, :TkImage), :Tk_IMGTBL), :[],
              s(:lvar, :img)),
            s(:lvar, :img)))),
      s(:def, :image=,
        s(:args,
          s(:arg, :value)),
        s(:begin,
          s(:send, nil, :tk_call_without_enc,
            s(:send,
              s(:ivar, :@t), :path),
            s(:str, "image"),
            s(:str, "configure"),
            s(:ivar, :@index),
            s(:str, "-image"),
            s(:send, nil, :_get_eval_enc_str,
              s(:lvar, :value))),
          s(:lvar, :value))))),
  s(:casgn, nil, :TktImage,
    s(:const, nil, :TkTextImage)))

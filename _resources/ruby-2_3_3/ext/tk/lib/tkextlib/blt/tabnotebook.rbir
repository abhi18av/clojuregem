s(:begin,
  s(:send, nil, :require,
    s(:str, "tk")),
  s(:send, nil, :require,
    s(:str, "tkextlib/blt.rb")),
  s(:send, nil, :require,
    s(:str, "tkextlib/blt/tabset.rb")),
  s(:module,
    s(:const,
      s(:const, nil, :Tk), :BLT),
    s(:class,
      s(:const, nil, :Tabnotebook),
      s(:const, nil, :Tabset),
      s(:begin,
        s(:casgn, nil, :TkCommandNames,
          s(:send,
            s(:array,
              s(:send,
                s(:str, "::blt::tabnotebook"), :freeze)), :freeze)),
        s(:casgn, nil, :WidgetClassName,
          s(:send,
            s(:str, "Tabnotebook"), :freeze)),
        s(:or_asgn,
          s(:send,
            s(:const, nil, :WidgetClassNames), :[],
            s(:const, nil, :WidgetClassName)),
          s(:self)),
        s(:class,
          s(:const, nil, :Tab),
          s(:const,
            s(:const,
              s(:const,
                s(:const, nil, :Tk), :BLT), :Tabset), :Tab),
          s(:begin,
            s(:defs,
              s(:self), :new,
              s(:args,
                s(:arg, :parent),
                s(:optarg, :pos,
                  s(:nil)),
                s(:optarg, :name,
                  s(:nil)),
                s(:optarg, :keys,
                  s(:hash))),
              s(:begin,
                s(:if,
                  s(:send,
                    s(:lvar, :pos), :kind_of?,
                    s(:const, nil, :Hash)),
                  s(:begin,
                    s(:lvasgn, :keys,
                      s(:lvar, :pos)),
                    s(:lvasgn, :name,
                      s(:nil)),
                    s(:lvasgn, :pos,
                      s(:nil))), nil),
                s(:if,
                  s(:send,
                    s(:lvar, :name), :kind_of?,
                    s(:const, nil, :Hash)),
                  s(:begin,
                    s(:lvasgn, :keys,
                      s(:lvar, :name)),
                    s(:lvasgn, :name,
                      s(:nil))), nil),
                s(:lvasgn, :obj,
                  s(:nil)),
                s(:block,
                  s(:send,
                    s(:send,
                      s(:const, nil, :TabID_TBL), :mutex), :synchronize),
                  s(:args),
                  s(:if,
                    s(:and,
                      s(:and,
                        s(:lvar, :name),
                        s(:send,
                          s(:const, nil, :TabID_TBL), :[],
                          s(:send,
                            s(:lvar, :parent), :path))),
                      s(:send,
                        s(:send,
                          s(:const, nil, :TabID_TBL), :[],
                          s(:send,
                            s(:lvar, :parent), :path)), :[],
                        s(:lvar, :name))),
                    s(:begin,
                      s(:lvasgn, :obj,
                        s(:send,
                          s(:send,
                            s(:const, nil, :TabID_TBL), :[],
                            s(:send,
                              s(:lvar, :parent), :path)), :[],
                          s(:lvar, :name))),
                      s(:if,
                        s(:lvar, :pos),
                        s(:if,
                          s(:send,
                            s(:send,
                              s(:lvar, :pos), :to_s), :==,
                            s(:str, "end")),
                          s(:send,
                            s(:lvar, :obj), :move_after,
                            s(:str, "end")),
                          s(:send,
                            s(:lvar, :obj), :move_before,
                            s(:lvar, :pos))), nil),
                      s(:if,
                        s(:and,
                          s(:lvar, :keys),
                          s(:send,
                            s(:send,
                              s(:lvar, :keys), :empty?), :!)),
                        s(:send,
                          s(:lvar, :obj), :configure), nil)),
                    s(:block,
                      s(:send,
                        s(:begin,
                          s(:lvasgn, :obj,
                            s(:send,
                              s(:self), :allocate))), :instance_eval),
                      s(:args),
                      s(:begin,
                        s(:send, nil, :initialize,
                          s(:lvar, :parent),
                          s(:lvar, :pos),
                          s(:lvar, :name),
                          s(:lvar, :keys)),
                        s(:if,
                          s(:send,
                            s(:const, nil, :TabID_TBL), :[],
                            s(:ivar, :@tpath)), nil,
                          s(:send,
                            s(:const, nil, :TabID_TBL), :[]=,
                            s(:ivar, :@tpath),
                            s(:hash))),
                        s(:send,
                          s(:send,
                            s(:const, nil, :TabID_TBL), :[],
                            s(:ivar, :@tpath)), :[]=,
                          s(:ivar, :@id),
                          s(:self)))))),
                s(:lvar, :obj))),
            s(:def, :initialize,
              s(:args,
                s(:arg, :parent),
                s(:arg, :pos),
                s(:arg, :name),
                s(:arg, :keys)),
              s(:begin,
                s(:ivasgn, :@t,
                  s(:lvar, :parent)),
                s(:ivasgn, :@tpath,
                  s(:send,
                    s(:lvar, :parent), :path)),
                s(:if,
                  s(:lvar, :name),
                  s(:begin,
                    s(:ivasgn, :@path,
                      s(:ivasgn, :@id,
                        s(:lvar, :name))),
                    s(:if,
                      s(:begin,
                        s(:send,
                          s(:send, nil, :list,
                            s(:send, nil, :tk_call,
                              s(:ivar, :@tpath),
                              s(:str, "tab"),
                              s(:str, "names"),
                              s(:ivar, :@id))), :empty?)),
                      s(:send, nil, :fail,
                        s(:const, nil, :ArgumentError),
                        s(:dstr,
                          s(:str, "can't find tab \""),
                          s(:begin,
                            s(:ivar, :@id)),
                          s(:str, "\" in "),
                          s(:begin,
                            s(:ivar, :@t)))),
                      s(:begin,
                        s(:if,
                          s(:lvar, :pos),
                          s(:begin,
                            s(:lvasgn, :idx,
                              s(:send, nil, :tk_call,
                                s(:ivar, :@tpath),
                                s(:str, "index"),
                                s(:ivar, :@id))),
                            s(:if,
                              s(:send,
                                s(:send,
                                  s(:lvar, :pos), :to_s), :==,
                                s(:str, "end")),
                              s(:send, nil, :tk_call,
                                s(:ivar, :@tpath),
                                s(:str, "move"),
                                s(:lvar, :idx),
                                s(:str, "after"),
                                s(:str, "end")),
                              s(:send, nil, :tk_call,
                                s(:ivar, :@tpath),
                                s(:str, "move"),
                                s(:lvar, :idx),
                                s(:str, "before"),
                                s(:lvar, :pos)))), nil),
                        s(:send, nil, :tk_call,
                          s(:ivar, :@tpath),
                          s(:str, "tab"),
                          s(:str, "configure"),
                          s(:ivar, :@id),
                          s(:lvar, :keys))))),
                  s(:begin,
                    s(:if,
                      s(:lvar, :pos), nil,
                      s(:lvasgn, :pos,
                        s(:str, "end"))),
                    s(:ivasgn, :@path,
                      s(:ivasgn, :@id,
                        s(:send, nil, :tk_call,
                          s(:ivar, :@tpath),
                          s(:str, "insert"),
                          s(:lvar, :pos),
                          s(:lvar, :keys)))))))))),
        s(:def, :get_tab,
          s(:args,
            s(:arg, :index)),
          s(:if,
            s(:send,
              s(:begin,
                s(:lvasgn, :idx,
                  s(:send, nil, :tk_send_without_enc,
                    s(:str, "id"),
                    s(:send, nil, :tagindex,
                      s(:lvar, :index))))), :empty?),
            s(:nil),
            s(:send,
              s(:const,
                s(:const,
                  s(:const,
                    s(:const, nil, :Tk), :BLT), :Tabset), :Tab), :id2obj,
              s(:self),
              s(:lvar, :idx)))),
        s(:alias,
          s(:sym, :get_id),
          s(:sym, :get_tab)),
        s(:def, :get_tabobj,
          s(:args,
            s(:arg, :index)),
          s(:if,
            s(:send,
              s(:begin,
                s(:lvasgn, :idx,
                  s(:send, nil, :tk_send_without_enc,
                    s(:str, "id"),
                    s(:send, nil, :tagindex,
                      s(:lvar, :index))))), :empty?),
            s(:nil),
            s(:send,
              s(:const,
                s(:const,
                  s(:const,
                    s(:const, nil, :Tk), :BLT), :Tabnotebook), :Tab), :new,
              s(:self),
              s(:nil),
              s(:lvar, :idx)))),
        s(:alias,
          s(:sym, :index_name),
          s(:sym, :index)),
        s(:def, :insert,
          s(:args,
            s(:optarg, :pos,
              s(:nil)),
            s(:optarg, :keys,
              s(:hash))),
          s(:begin,
            s(:if,
              s(:send,
                s(:lvar, :pos), :kind_of?,
                s(:const, nil, :Hash)),
              s(:begin,
                s(:lvasgn, :keys,
                  s(:lvar, :pos)),
                s(:lvasgn, :pos,
                  s(:nil))), nil),
            s(:if,
              s(:send,
                s(:lvar, :pos), :nil?),
              s(:lvasgn, :pos,
                s(:str, "end")), nil),
            s(:send,
              s(:const,
                s(:const,
                  s(:const,
                    s(:const, nil, :Tk), :BLT), :Tabnotebook), :Tab), :new,
              s(:self),
              s(:nil),
              s(:send, nil, :tk_send,
                s(:str, "insert"),
                s(:send, nil, :tagindex,
                  s(:lvar, :pos)),
                s(:lvar, :keys))))),
        s(:undef,
          s(:sym, :insert_tabs)),
        s(:undef,
          s(:sym, :tab_pageheight),
          s(:sym, :tab_pagewidth))))))

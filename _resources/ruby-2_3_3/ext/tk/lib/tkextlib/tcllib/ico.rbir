s(:begin,
  s(:send, nil, :require,
    s(:str, "tk")),
  s(:send, nil, :require,
    s(:str, "tk/image")),
  s(:send,
    s(:const, nil, :TkPackage), :require,
    s(:str, "ico")),
  s(:module,
    s(:const, nil, :Tk),
    s(:module,
      s(:const, nil, :Tcllib),
      s(:class,
        s(:const, nil, :ICO),
        s(:const, nil, :TkImage),
        s(:begin,
          s(:casgn, nil, :PACKAGE_NAME,
            s(:send,
              s(:str, "ico"), :freeze)),
          s(:defs,
            s(:self), :package_name,
            s(:args),
            s(:const, nil, :PACKAGE_NAME)),
          s(:defs,
            s(:self), :package_version,
            s(:args),
            s(:kwbegin,
              s(:rescue,
                s(:send,
                  s(:const, nil, :TkPackage), :require,
                  s(:str, "ico")),
                s(:resbody, nil, nil,
                  s(:str, "")), nil))))))),
  s(:class,
    s(:const,
      s(:const,
        s(:const, nil, :Tk), :Tcllib), :ICO), nil,
    s(:begin,
      s(:defs,
        s(:self), :list,
        s(:args,
          s(:arg, :file),
          s(:optarg, :keys,
            s(:nil))),
        s(:send, nil, :tk_split_list,
          s(:send, nil, :tk_call_without_enc,
            s(:str, "::ico::getIconList"),
            s(:lvar, :file),
            s(:splat,
              s(:send, nil, :hash_kv,
                s(:lvar, :keys),
                s(:true)))))),
      s(:defs,
        s(:self), :icons,
        s(:args,
          s(:arg, :file),
          s(:optarg, :keys,
            s(:nil))),
        s(:block,
          s(:send,
            s(:send, nil, :tk_split_simplelist,
              s(:send, nil, :tk_call_without_enc,
                s(:str, "::ico::icons"),
                s(:lvar, :file),
                s(:splat,
                  s(:send, nil, :hash_kv,
                    s(:lvar, :keys),
                    s(:true))))), :map),
          s(:args,
            s(:arg, :elem)),
          s(:send, nil, :num_or_str,
            s(:lvar, :elem)))),
      s(:defs,
        s(:self), :get_members,
        s(:args,
          s(:arg, :file),
          s(:arg, :name),
          s(:optarg, :keys,
            s(:nil))),
        s(:block,
          s(:send,
            s(:send, nil, :tk_split_simplelist,
              s(:send, nil, :tk_call_without_enc,
                s(:str, "::ico::getMembers"),
                s(:lvar, :file),
                s(:lvar, :name),
                s(:splat,
                  s(:send, nil, :hash_kv,
                    s(:lvar, :keys),
                    s(:true))))), :map),
          s(:args,
            s(:arg, :elem)),
          s(:begin,
            s(:masgn,
              s(:mlhs,
                s(:lvasgn, :name),
                s(:lvasgn, :width),
                s(:lvasgn, :height),
                s(:lvasgn, :bpp)),
              s(:send, nil, :tk_split_simplelist,
                s(:lvar, :elem))),
            s(:array,
              s(:lvar, :name),
              s(:send, nil, :number,
                s(:lvar, :width)),
              s(:send, nil, :number,
                s(:lvar, :height)),
              s(:send, nil, :number,
                s(:lvar, :bpp)))))),
      s(:defs,
        s(:self), :get,
        s(:args,
          s(:arg, :file),
          s(:arg, :index),
          s(:optarg, :keys,
            s(:nil))),
        s(:send, nil, :tk_call_without_enc,
          s(:str, "::ico::getIcon"),
          s(:lvar, :file),
          s(:lvar, :index),
          s(:splat,
            s(:send, nil, :hash_kv,
              s(:lvar, :keys),
              s(:true))))),
      s(:defs,
        s(:self), :get_icon,
        s(:args,
          s(:restarg, :args)),
        s(:send, nil, :get,
          s(:splat,
            s(:lvar, :args)))),
      s(:defs,
        s(:self), :get_by_name,
        s(:args,
          s(:arg, :file),
          s(:arg, :name),
          s(:optarg, :keys,
            s(:nil))),
        s(:send, nil, :tk_call_without_enc,
          s(:str, "::ico::getIconByName"),
          s(:lvar, :file),
          s(:lvar, :name),
          s(:splat,
            s(:send, nil, :hash_kv,
              s(:lvar, :keys),
              s(:true))))),
      s(:defs,
        s(:self), :get_icon_by_name,
        s(:args,
          s(:restarg, :args)),
        s(:send, nil, :get_by_name,
          s(:splat,
            s(:lvar, :args)))),
      s(:defs,
        s(:self), :get_fileicon,
        s(:args,
          s(:arg, :file),
          s(:optarg, :keys,
            s(:nil))),
        s(:send, nil, :tk_call_without_enc,
          s(:str, "::ico::getFileIcon"),
          s(:lvar, :file),
          s(:splat,
            s(:send, nil, :hash_kv,
              s(:lvar, :keys),
              s(:true))))),
      s(:defs,
        s(:self), :get_image,
        s(:args,
          s(:arg, :file),
          s(:arg, :index),
          s(:optarg, :keys,
            s(:hash))),
        s(:begin,
          s(:lvasgn, :keys,
            s(:send, nil, :_symbolkey2str,
              s(:lvar, :keys))),
          s(:send,
            s(:lvar, :keys), :delete,
            s(:str, "format")),
          s(:send,
            s(:self), :new,
            s(:lvar, :file),
            s(:lvar, :index),
            s(:lvar, :keys)))),
      s(:defs,
        s(:self), :get_data,
        s(:args,
          s(:arg, :file),
          s(:arg, :index),
          s(:optarg, :keys,
            s(:hash))),
        s(:begin,
          s(:send,
            s(:lvar, :keys), :[]=,
            s(:str, "format"),
            s(:str, "data")),
          s(:send, nil, :tk_split_list,
            s(:send, nil, :tk_call_without_enc,
              s(:str, "::ico::getIcon"),
              s(:lvar, :file),
              s(:lvar, :index),
              s(:splat,
                s(:send, nil, :hash_kv,
                  s(:lvar, :keys),
                  s(:true))))))),
      s(:defs,
        s(:self), :write,
        s(:args,
          s(:arg, :file),
          s(:arg, :index),
          s(:arg, :depth),
          s(:arg, :data),
          s(:optarg, :keys,
            s(:nil))),
        s(:send, nil, :tk_call_without_enc,
          s(:str, "::ico::writeIcon"),
          s(:lvar, :file),
          s(:lvar, :index),
          s(:lvar, :depth),
          s(:lvar, :data),
          s(:splat,
            s(:send, nil, :hash_kv,
              s(:lvar, :keys),
              s(:true))))),
      s(:defs,
        s(:self), :copy,
        s(:args,
          s(:arg, :from_file),
          s(:arg, :from_index),
          s(:arg, :to_file),
          s(:arg, :to_index),
          s(:optarg, :keys,
            s(:nil))),
        s(:send, nil, :tk_call_without_enc,
          s(:str, "::ico::copyIcon"),
          s(:lvar, :from_file),
          s(:lvar, :from_index),
          s(:lvar, :to_file),
          s(:lvar, :to_index),
          s(:splat,
            s(:send, nil, :hash_kv,
              s(:lvar, :keys),
              s(:true))))),
      s(:defs,
        s(:self), :exe_to_ico,
        s(:args,
          s(:arg, :exe_file),
          s(:arg, :ico_file),
          s(:optarg, :keys,
            s(:nil))),
        s(:send, nil, :tk_call_without_enc,
          s(:str, "::ico::copyIcon"),
          s(:lvar, :exe_file),
          s(:lvar, :ico_file),
          s(:splat,
            s(:send, nil, :hash_kv,
              s(:lvar, :keys),
              s(:true))))),
      s(:defs,
        s(:self), :clear_cache,
        s(:args,
          s(:optarg, :file,
            s(:const, nil, :None))),
        s(:send, nil, :tk_call_without_enc,
          s(:str, "::ico::clearCache"),
          s(:lvar, :file))),
      s(:defs,
        s(:self), :transparent_color,
        s(:args,
          s(:arg, :image),
          s(:arg, :color)),
        s(:if,
          s(:send,
            s(:lvar, :image), :kind_of?,
            s(:const, nil, :Array)),
          s(:send, nil, :tk_split_list,
            s(:send, nil, :tk_call_without_enc,
              s(:str, "::ico::transparentColor"),
              s(:lvar, :image),
              s(:lvar, :color))),
          s(:send, nil, :tk_call_without_enc,
            s(:str, "::ico::transparentColor"),
            s(:lvar, :image),
            s(:lvar, :color)))),
      s(:defs,
        s(:self), :show,
        s(:args,
          s(:arg, :file),
          s(:optarg, :keys,
            s(:nil))),
        s(:send, nil, :tk_call_without_enc,
          s(:str, "::ico::Show"),
          s(:lvar, :file),
          s(:splat,
            s(:send, nil, :hash_kv,
              s(:lvar, :keys),
              s(:true))))),
      s(:def, :initialize,
        s(:args,
          s(:arg, :file),
          s(:arg, :index),
          s(:optarg, :keys,
            s(:nil))),
        s(:begin,
          s(:lvasgn, :keys,
            s(:send, nil, :_symbolkey2str,
              s(:lvar, :keys))),
          s(:if,
            s(:send,
              s(:lvar, :keys), :key?,
              s(:str, "name")),
            s(:ivasgn, :@path,
              s(:send,
                s(:send,
                  s(:lvar, :keys), :[],
                  s(:str, "name")), :to_s)),
            s(:block,
              s(:send,
                s(:send,
                  s(:const, nil, :Tk_Image_ID), :mutex), :synchronize),
              s(:args),
              s(:begin,
                s(:ivasgn, :@path,
                  s(:send,
                    s(:const, nil, :Tk_Image_ID), :join,
                    s(:send,
                      s(:const,
                        s(:const, nil, :TkCore), :INTERP), :_ip_id_))),
                s(:send,
                  s(:send,
                    s(:const, nil, :Tk_Image_ID), :[],
                    s(:int, 1)), :succ!)))),
          s(:send, nil, :tk_call_without_enc,
            s(:str, "::ico::getIcon"),
            s(:lvar, :file),
            s(:lvar, :index),
            s(:str, "-name"),
            s(:ivar, :@path),
            s(:str, "-format"),
            s(:str, "image"),
            s(:splat,
              s(:send, nil, :hash_kv,
                s(:lvar, :keys),
                s(:true)))),
          s(:send,
            s(:const, nil, :Tk_IMGTBL), :[]=,
            s(:ivar, :@path),
            s(:self)))),
      s(:def, :write,
        s(:args,
          s(:arg, :file),
          s(:arg, :index),
          s(:arg, :depth),
          s(:optarg, :keys,
            s(:nil))),
        s(:begin,
          s(:send,
            s(:const,
              s(:const,
                s(:const, nil, :Tk), :Tcllib), :ICO), :write,
            s(:lvar, :file),
            s(:lvar, :index),
            s(:lvar, :depth),
            s(:ivar, :@path),
            s(:lvasgn, :keys,
              s(:nil))),
          s(:self))),
      s(:def, :transparent_color,
        s(:args,
          s(:arg, :color)),
        s(:begin,
          s(:send, nil, :tk_call_without_enc,
            s(:str, "::ico::transparentColor"),
            s(:ivar, :@path),
            s(:lvar, :color)),
          s(:self))))))

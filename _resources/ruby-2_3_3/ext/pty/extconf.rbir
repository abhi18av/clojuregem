s(:begin,
  s(:send, nil, :require,
    s(:str, "mkmf")),
  s(:send,
    s(:gvar, :$INCFLAGS), :<<,
    s(:str, " -I$(topdir) -I$(top_srcdir)")),
  s(:if,
    s(:send,
      s(:regexp,
        s(:str, "mswin|mingw|bccwin|nacl"),
        s(:regopt)), :!~,
      s(:const, nil, :RUBY_PLATFORM)),
    s(:begin,
      s(:send, nil, :have_header,
        s(:str, "sys/stropts.h")),
      s(:send, nil, :have_func,
        s(:str, "setresuid")),
      s(:send, nil, :have_header,
        s(:str, "libutil.h")),
      s(:send, nil, :have_header,
        s(:str, "util.h")),
      s(:send, nil, :have_header,
        s(:str, "pty.h")),
      s(:send, nil, :have_library,
        s(:str, "util"),
        s(:str, "openpty")),
      s(:if,
        s(:or,
          s(:or,
            s(:or,
              s(:or,
                s(:send, nil, :have_func,
                  s(:str, "posix_openpt")),
                s(:send, nil, :have_func,
                  s(:str, "openpty"))),
              s(:send, nil, :have_func,
                s(:str, "_getpty"))),
            s(:send, nil, :have_func,
              s(:str, "ptsname"))),
          s(:send, nil, :have_func,
            s(:str, "ioctl"))),
        s(:send, nil, :create_makefile,
          s(:str, "pty")), nil)), nil))

s(:begin,
  s(:gvasgn, :$/,
    s(:nil)),
  s(:while,
    s(:lvasgn, :line,
      s(:send, nil, :gets)),
    s(:if,
      s(:match_with_lvasgn,
        s(:regexp,
          s(:str, "^((void|VALUE|int|char *\\*|ID|struct \\w+ *\\*|st_table *\\*) *)?\\n(\\w+)\\(.*\\)\\n\\s*((.+;\\n)*)\\{"),
          s(:regopt)),
        s(:lvar, :line)),
      s(:begin,
        s(:lvasgn, :line,
          s(:back_ref, :$')),
        s(:send, nil, :printf,
          s(:str, "%s %s("),
          s(:nth_ref, 2),
          s(:nth_ref, 3)),
        s(:lvasgn, :args,
          s(:array)),
        s(:for,
          s(:lvasgn, :arg),
          s(:send,
            s(:nth_ref, 4), :split,
            s(:regexp,
              s(:str, ";\\n\\s*"),
              s(:regopt))),
          s(:begin,
            s(:send,
              s(:lvar, :arg), :gsub!,
              s(:regexp,
                s(:str, " +"),
                s(:regopt)),
              s(:str, " ")),
            s(:if,
              s(:send,
                s(:lvar, :arg), :=~,
                s(:regexp,
                  s(:str, ","),
                  s(:regopt))),
              s(:begin,
                s(:if,
                  s(:send,
                    s(:lvar, :arg), :=~,
                    s(:regexp,
                      s(:str, "(([^*]+) *\\** *\\w+),"),
                      s(:regopt))),
                  s(:begin,
                    s(:lvasgn, :type,
                      s(:send,
                        s(:nth_ref, 2), :strip)),
                    s(:send,
                      s(:lvar, :args), :push,
                      s(:send,
                        s(:nth_ref, 1), :strip)),
                    s(:lvasgn, :arg,
                      s(:back_ref, :$'))),
                  s(:lvasgn, :type,
                    s(:str, ""))),
                s(:while,
                  s(:and,
                    s(:send,
                      s(:lvar, :arg), :sub!,
                      s(:regexp,
                        s(:str, "(\\** *\\w+)(,|$)"),
                        s(:regopt)),
                      s(:str, "")),
                    s(:gvar, :$~)),
                  s(:send,
                    s(:lvar, :args), :push,
                    s(:send,
                      s(:send,
                        s(:lvar, :type), :+,
                        s(:str, " ")), :+,
                      s(:send,
                        s(:nth_ref, 1), :strip))))),
              s(:send,
                s(:lvar, :args), :push,
                s(:send,
                  s(:lvar, :arg), :strip))))),
        s(:send, nil, :printf,
          s(:str, "%s);\n"),
          s(:send,
            s(:lvar, :args), :join,
            s(:str, ", "))),
        s(:redo)), nil)))

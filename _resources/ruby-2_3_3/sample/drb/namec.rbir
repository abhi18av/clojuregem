s(:begin,
  s(:send, nil, :require,
    s(:str, "drb/drb")),
  s(:kwbegin,
    s(:rescue,
      s(:lvasgn, :there,
        s(:or,
          s(:send,
            s(:const, nil, :ARGV), :shift),
          s(:send, nil, :raise))),
      s(:resbody, nil, nil,
        s(:begin,
          s(:send, nil, :puts,
            s(:dstr,
              s(:str, "usage: "),
              s(:begin,
                s(:gvar, :$0)),
              s(:str, " <server_uri>"))),
          s(:send, nil, :exit,
            s(:int, 1)))), nil)),
  s(:send,
    s(:const, nil, :DRb), :start_service),
  s(:lvasgn, :ro,
    s(:send,
      s(:const, nil, :DRbObject), :new,
      s(:nil),
      s(:lvar, :there))),
  s(:lvasgn, :seq,
    s(:send,
      s(:lvar, :ro), :[],
      s(:str, "seq"))),
  s(:lvasgn, :mutex,
    s(:send,
      s(:lvar, :ro), :[],
      s(:str, "mutex"))),
  s(:send, nil, :p,
    s(:lvar, :seq)),
  s(:send, nil, :p,
    s(:lvar, :mutex)),
  s(:block,
    s(:send,
      s(:lvar, :mutex), :synchronize),
    s(:args),
    s(:begin,
      s(:send, nil, :p,
        s(:send,
          s(:lvar, :seq), :next_value)),
      s(:send, nil, :p,
        s(:send,
          s(:lvar, :seq), :next_value)))),
  s(:send, nil, :puts,
    s(:str, "[return] to continue")),
  s(:send, nil, :gets),
  s(:block,
    s(:send,
      s(:lvar, :mutex), :synchronize),
    s(:args),
    s(:begin,
      s(:send, nil, :p,
        s(:send,
          s(:lvar, :seq), :next_value)),
      s(:send, nil, :p,
        s(:send,
          s(:lvar, :seq), :next_value)))))

s(:begin,
  s(:send, nil, :require,
    s(:str, "drb/drb")),
  s(:send, nil, :require,
    s(:str, "drb/eq")),
  s(:class,
    s(:const, nil, :Notify), nil,
    s(:begin,
      s(:send, nil, :include,
        s(:const, nil, :DRbUndumped)),
      s(:def, :initialize,
        s(:args,
          s(:arg, :biff),
          s(:arg, :command)),
        s(:begin,
          s(:ivasgn, :@biff,
            s(:lvar, :biff)),
          s(:ivasgn, :@command,
            s(:lvar, :command)),
          s(:send,
            s(:ivar, :@biff), :add_observer,
            s(:self)))),
      s(:def, :update,
        s(:args,
          s(:arg, :filename),
          s(:arg, :time)),
        s(:begin,
          s(:if,
            s(:gvar, :$DEBUG),
            s(:send, nil, :p,
              s(:array,
                s(:lvar, :filename),
                s(:lvar, :time))), nil),
          s(:send, nil, :system,
            s(:ivar, :@command)))),
      s(:def, :done,
        s(:args),
        s(:kwbegin,
          s(:rescue,
            s(:send,
              s(:ivar, :@biff), :delete_observer,
              s(:self)),
            s(:resbody, nil, nil, nil), nil))))),
  s(:def, :main,
    s(:args),
    s(:begin,
      s(:lvasgn, :command,
        s(:str, "eject")),
      s(:lvasgn, :uri,
        s(:str, "druby://localhost:19903")),
      s(:send,
        s(:const, nil, :DRb), :start_service),
      s(:lvasgn, :biff,
        s(:send,
          s(:const, nil, :DRbObject), :new,
          s(:nil),
          s(:lvar, :uri))),
      s(:lvasgn, :notify,
        s(:send,
          s(:const, nil, :Notify), :new,
          s(:lvar, :biff),
          s(:lvar, :command))),
      s(:block,
        s(:send, nil, :trap,
          s(:str, "INT")),
        s(:args),
        s(:send,
          s(:lvar, :notify), :done)),
      s(:send,
        s(:send,
          s(:const, nil, :DRb), :thread), :join))),
  s(:send, nil, :main))

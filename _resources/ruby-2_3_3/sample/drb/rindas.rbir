s(:begin,
  s(:send, nil, :require,
    s(:str, "drb/drb")),
  s(:send, nil, :require,
    s(:str, "rinda/rinda")),
  s(:def, :do_it,
    s(:args,
      s(:arg, :v)),
    s(:begin,
      s(:send, nil, :puts,
        s(:dstr,
          s(:str, "do_it("),
          s(:begin,
            s(:lvar, :v)),
          s(:str, ")"))),
      s(:send,
        s(:lvar, :v), :+,
        s(:lvar, :v)))),
  s(:lvasgn, :uri,
    s(:or,
      s(:send,
        s(:const, nil, :ARGV), :shift),
      s(:send, nil, :raise,
        s(:dstr,
          s(:str, "usage: "),
          s(:begin,
            s(:gvar, :$0)),
          s(:str, " <server_uri>"))))),
  s(:send,
    s(:const, nil, :DRb), :start_service),
  s(:lvasgn, :ts,
    s(:send,
      s(:const,
        s(:const, nil, :Rinda), :TupleSpaceProxy), :new,
      s(:send,
        s(:const, nil, :DRbObject), :new,
        s(:nil),
        s(:lvar, :uri)))),
  s(:while,
    s(:true),
    s(:begin,
      s(:lvasgn, :r,
        s(:send,
          s(:lvar, :ts), :take,
          s(:array,
            s(:str, "sum"),
            s(:nil),
            s(:nil)))),
      s(:lvasgn, :v,
        s(:send, nil, :do_it,
          s(:send,
            s(:lvar, :r), :[],
            s(:int, 2)))),
      s(:send,
        s(:lvar, :ts), :write,
        s(:array,
          s(:str, "ans"),
          s(:send,
            s(:lvar, :r), :[],
            s(:int, 1)),
          s(:send,
            s(:lvar, :r), :[],
            s(:int, 2)),
          s(:lvar, :v))))))

s(:begin,
  s(:send, nil, :require,
    s(:str, "drb")),
  s(:send, nil, :require,
    s(:str, "drb/ssl")),
  s(:lvasgn, :here,
    s(:or,
      s(:send,
        s(:const, nil, :ARGV), :shift),
      s(:str, "drbssl://localhost:3456"))),
  s(:class,
    s(:const, nil, :HelloWorld), nil,
    s(:begin,
      s(:send, nil, :include,
        s(:const, nil, :DRbUndumped)),
      s(:def, :hello,
        s(:args,
          s(:arg, :name)),
        s(:dstr,
          s(:str, "Hello, "),
          s(:begin,
            s(:lvar, :name)),
          s(:str, "."))))),
  s(:lvasgn, :config,
    s(:send,
      s(:const, nil, :Hash), :new)),
  s(:send,
    s(:lvar, :config), :[]=,
    s(:sym, :verbose),
    s(:true)),
  s(:kwbegin,
    s(:rescue,
      s(:begin,
        s(:lvasgn, :data,
          s(:block,
            s(:send, nil, :open,
              s(:str, "sample.key")),
            s(:args,
              s(:arg, :io)),
            s(:send,
              s(:lvar, :io), :read))),
        s(:send,
          s(:lvar, :config), :[]=,
          s(:sym, :SSLPrivateKey),
          s(:send,
            s(:const,
              s(:const,
                s(:const, nil, :OpenSSL), :PKey), :RSA), :new,
            s(:lvar, :data))),
        s(:lvasgn, :data,
          s(:block,
            s(:send, nil, :open,
              s(:str, "sample.crt")),
            s(:args,
              s(:arg, :io)),
            s(:send,
              s(:lvar, :io), :read))),
        s(:send,
          s(:lvar, :config), :[]=,
          s(:sym, :SSLCertificate),
          s(:send,
            s(:const,
              s(:const,
                s(:const, nil, :OpenSSL), :X509), :Certificate), :new,
            s(:lvar, :data)))),
      s(:resbody, nil, nil,
        s(:begin,
          s(:send,
            s(:gvar, :$stderr), :puts,
            s(:str, "Switching to use self-signed certificate")),
          s(:send,
            s(:lvar, :config), :[]=,
            s(:sym, :SSLCertName),
            s(:array,
              s(:array,
                s(:str, "C"),
                s(:str, "JP")),
              s(:array,
                s(:str, "O"),
                s(:str, "Foo.DRuby.Org")),
              s(:array,
                s(:str, "CN"),
                s(:str, "Sample")))))), nil)),
  s(:send,
    s(:const, nil, :DRb), :start_service,
    s(:lvar, :here),
    s(:send,
      s(:const, nil, :HelloWorld), :new),
    s(:lvar, :config)),
  s(:send, nil, :puts,
    s(:send,
      s(:const, nil, :DRb), :uri)),
  s(:send,
    s(:send,
      s(:const, nil, :DRb), :thread), :join))

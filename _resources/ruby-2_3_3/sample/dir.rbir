s(:begin,
  s(:lvasgn, :dirp,
    s(:send,
      s(:const, nil, :Dir), :open,
      s(:str, "."))),
  s(:for,
    s(:lvasgn, :f),
    s(:lvar, :dirp),
    s(:case,
      s(:lvar, :f),
      s(:when,
        s(:regexp,
          s(:str, "^\\."),
          s(:regopt)),
        s(:regexp,
          s(:str, "~$"),
          s(:regopt)),
        s(:regexp,
          s(:str, "\\.o"),
          s(:regopt)), nil),
      s(:send, nil, :print,
        s(:lvar, :f),
        s(:str, "\n")))),
  s(:send,
    s(:lvar, :dirp), :close))

s(:begin,
  s(:send, nil, :require,
    s(:str, "net/https")),
  s(:send, nil, :require,
    s(:str, "optparse")),
  s(:lvasgn, :options,
    s(:send,
      s(:const, nil, :ARGV), :getopts,
      s(:str, "C:"))),
  s(:lvasgn, :cert_store,
    s(:send,
      s(:lvar, :options), :[],
      s(:str, "C"))),
  s(:lvasgn, :uri,
    s(:send,
      s(:const, nil, :URI), :parse,
      s(:send,
        s(:const, nil, :ARGV), :[],
        s(:int, 0)))),
  s(:if,
    s(:lvasgn, :proxy,
      s(:send,
        s(:const, nil, :ENV), :[],
        s(:str, "HTTP_PROXY"))),
    s(:begin,
      s(:lvasgn, :prx_uri,
        s(:send,
          s(:const, nil, :URI), :parse,
          s(:lvar, :proxy))),
      s(:lvasgn, :prx_host,
        s(:send,
          s(:lvar, :prx_uri), :host)),
      s(:lvasgn, :prx_port,
        s(:send,
          s(:lvar, :prx_uri), :port))), nil),
  s(:lvasgn, :h,
    s(:send,
      s(:const,
        s(:const, nil, :Net), :HTTP), :new,
      s(:send,
        s(:lvar, :uri), :host),
      s(:send,
        s(:lvar, :uri), :port),
      s(:lvar, :prx_host),
      s(:lvar, :prx_port))),
  s(:if,
    s(:gvar, :$DEBUG),
    s(:send,
      s(:lvar, :h), :set_debug_output,
      s(:gvar, :$stderr)), nil),
  s(:if,
    s(:send,
      s(:send,
        s(:lvar, :uri), :scheme), :==,
      s(:str, "https")),
    s(:begin,
      s(:send,
        s(:lvar, :h), :use_ssl=,
        s(:true)),
      s(:if,
        s(:lvar, :cert_store),
        s(:if,
          s(:send,
            s(:const, nil, :File), :directory?,
            s(:lvar, :cert_store)),
          s(:send,
            s(:lvar, :h), :ca_path=,
            s(:lvar, :cert_store)),
          s(:send,
            s(:lvar, :h), :ca_file=,
            s(:lvar, :cert_store))), nil)), nil),
  s(:lvasgn, :path,
    s(:if,
      s(:send,
        s(:send,
          s(:lvar, :uri), :path), :empty?),
      s(:str, "/"),
      s(:send,
        s(:lvar, :uri), :path))),
  s(:block,
    s(:send,
      s(:lvar, :h), :get2,
      s(:lvar, :path)),
    s(:args,
      s(:arg, :resp)),
    s(:begin,
      s(:if,
        s(:send,
          s(:lvar, :h), :peer_cert),
        s(:send,
          s(:const, nil, :STDERR), :puts,
          s(:send,
            s(:send,
              s(:lvar, :h), :peer_cert), :inspect)), nil),
      s(:send, nil, :print,
        s(:send,
          s(:lvar, :resp), :body)))))

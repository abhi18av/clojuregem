s(:begin,
  s(:send, nil, :require,
    s(:str, "optparse")),
  s(:send, nil, :require,
    s(:str, "openssl")),
  s(:send, nil, :include,
    s(:const, nil, :OpenSSL)),
  s(:lvasgn, :options,
    s(:send,
      s(:const, nil, :ARGV), :getopts,
      s(:str, "c:k:C:"))),
  s(:lvasgn, :cert_file,
    s(:send,
      s(:lvar, :options), :[],
      s(:str, "c"))),
  s(:lvasgn, :key_file,
    s(:send,
      s(:lvar, :options), :[],
      s(:str, "k"))),
  s(:lvasgn, :ca_path,
    s(:send,
      s(:lvar, :options), :[],
      s(:str, "C"))),
  s(:lvasgn, :data,
    s(:send,
      s(:gvar, :$stdin), :read)),
  s(:lvasgn, :cert,
    s(:send,
      s(:const,
        s(:const, nil, :X509), :Certificate), :new,
      s(:send,
        s(:const, nil, :File), :read,
        s(:lvar, :cert_file)))),
  s(:lvasgn, :key,
    s(:send,
      s(:const,
        s(:const, nil, :PKey), :RSA), :new,
      s(:send,
        s(:const, nil, :File), :read,
        s(:lvar, :key_file)))),
  s(:lvasgn, :p7enc,
    s(:send,
      s(:const, nil, :PKCS7), :read_smime,
      s(:lvar, :data))),
  s(:lvasgn, :data,
    s(:send,
      s(:lvar, :p7enc), :decrypt,
      s(:lvar, :key),
      s(:lvar, :cert))),
  s(:lvasgn, :store,
    s(:send,
      s(:const,
        s(:const, nil, :X509), :Store), :new)),
  s(:send,
    s(:lvar, :store), :add_path,
    s(:lvar, :ca_path)),
  s(:lvasgn, :p7sig,
    s(:send,
      s(:const, nil, :PKCS7), :read_smime,
      s(:lvar, :data))),
  s(:if,
    s(:send,
      s(:lvar, :p7sig), :verify,
      s(:array),
      s(:lvar, :store)),
    s(:send, nil, :puts,
      s(:send,
        s(:lvar, :p7sig), :data)), nil))

s(:begin,
  s(:send, nil, :require,
    s(:str, "openssl")),
  s(:send, nil, :include,
    s(:const,
      s(:const, nil, :OpenSSL), :X509)),
  s(:def, :cert2text,
    s(:args,
      s(:arg, :cert_str)),
    s(:begin,
      s(:block,
        s(:send,
          s(:array,
            s(:const, nil, :Certificate),
            s(:const, nil, :CRL),
            s(:const, nil, :Request)), :each),
        s(:args,
          s(:arg, :klass)),
        s(:kwbegin,
          s(:rescue,
            s(:begin,
              s(:send, nil, :puts,
                s(:send,
                  s(:send,
                    s(:lvar, :klass), :new,
                    s(:lvar, :cert_str)), :to_text)),
              s(:return)),
            s(:resbody, nil, nil, nil), nil))),
      s(:send, nil, :raise,
        s(:send,
          s(:const, nil, :ArgumentError), :new,
          s(:str, "Unknown format."))))),
  s(:if,
    s(:send,
      s(:const, nil, :ARGV), :empty?),
    s(:send, nil, :cert2text,
      s(:send,
        s(:const, nil, :STDIN), :read)),
    s(:block,
      s(:send,
        s(:const, nil, :ARGV), :each),
      s(:args,
        s(:arg, :file)),
      s(:send, nil, :cert2text,
        s(:send,
          s(:const, nil, :File), :read,
          s(:lvar, :file))))))

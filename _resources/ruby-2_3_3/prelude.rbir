s(:begin,
  s(:class,
    s(:const, nil, :Thread), nil,
    s(:begin,
      s(:casgn, nil, :MUTEX_FOR_THREAD_EXCLUSIVE,
        s(:send,
          s(:const, nil, :Mutex), :new)),
      s(:defs,
        s(:self), :exclusive,
        s(:args),
        s(:begin,
          s(:send, nil, :warn,
            s(:str, "Thread.exclusive is deprecated, use Mutex"),
            s(:send, nil, :caller)),
          s(:block,
            s(:send,
              s(:const, nil, :MUTEX_FOR_THREAD_EXCLUSIVE), :synchronize),
            s(:args),
            s(:yield)))))),
  s(:class,
    s(:const, nil, :IO), nil,
    s(:begin,
      s(:def, :read_nonblock,
        s(:args,
          s(:arg, :len),
          s(:optarg, :buf,
            s(:nil)),
          s(:kwoptarg, :exception,
            s(:true))),
        s(:send, nil, :__read_nonblock,
          s(:lvar, :len),
          s(:lvar, :buf),
          s(:lvar, :exception))),
      s(:def, :write_nonblock,
        s(:args,
          s(:arg, :buf),
          s(:kwoptarg, :exception,
            s(:true))),
        s(:send, nil, :__write_nonblock,
          s(:lvar, :buf),
          s(:lvar, :exception))))))

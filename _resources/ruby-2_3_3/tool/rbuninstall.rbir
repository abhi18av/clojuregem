s(:begin,
  s(:preexe,
    s(:begin,
      s(:gvasgn, :$dryrun,
        s(:false)),
      s(:gvasgn, :$tty,
        s(:send,
          s(:const, nil, :STDOUT), :tty?)),
      s(:until,
        s(:send,
          s(:const, nil, :ARGV), :empty?),
        s(:begin,
          s(:case,
            s(:send,
              s(:const, nil, :ARGV), :[],
              s(:int, 0)),
            s(:when,
              s(:regexp,
                s(:str, "\\A--destdir=(.*)"),
                s(:regopt)),
              s(:gvasgn, :$destdir,
                s(:nth_ref, 1))),
            s(:when,
              s(:regexp,
                s(:str, "\\A-n\\z"),
                s(:regopt)),
              s(:gvasgn, :$dryrun,
                s(:true))),
            s(:when,
              s(:regexp,
                s(:str, "\\A--(?:no-)?tty\\z"),
                s(:regopt)),
              s(:gvasgn, :$tty,
                s(:send,
                  s(:nth_ref, 1), :!))),
            s(:break)),
          s(:send,
            s(:const, nil, :ARGV), :shift))),
      s(:gvasgn, :$dirs,
        s(:array)),
      s(:gvasgn, :$files,
        s(:array)))),
  s(:lvasgn, :list,
    s(:begin,
      s(:if,
        s(:send,
          s(:gvar, :$_), :chomp!,
          s(:str, "/")),
        s(:gvar, :$dirs),
        s(:gvar, :$files)))),
  s(:if,
    s(:gvar, :$destdir),
    s(:gvasgn, :$_,
      s(:send,
        s(:const, nil, :File), :join,
        s(:gvar, :$destdir),
        s(:gvar, :$_))), nil),
  s(:send,
    s(:lvar, :list), :<<,
    s(:gvar, :$_)),
  s(:postexe,
    s(:begin,
      s(:lvasgn, :status,
        s(:true)),
      s(:gvasgn, :$\,
        s(:lvasgn, :ors,
          s(:if,
            s(:begin,
              s(:and,
                s(:send,
                  s(:gvar, :$dryrun), :!),
                s(:gvar, :$tty))),
            s(:str, "\e[K\r"),
            s(:str, "\n")))),
      s(:block,
        s(:send,
          s(:gvar, :$files), :each),
        s(:args,
          s(:arg, :file)),
        s(:begin,
          s(:send, nil, :print,
            s(:dstr,
              s(:str, "rm "),
              s(:begin,
                s(:lvar, :file)))),
          s(:if,
            s(:gvar, :$dryrun), nil,
            s(:kwbegin,
              s(:rescue,
                s(:send,
                  s(:const, nil, :File), :unlink,
                  s(:lvar, :file)),
                s(:resbody,
                  s(:array,
                    s(:const,
                      s(:const, nil, :Errno), :ENOENT)), nil, nil),
                s(:resbody, nil, nil,
                  s(:begin,
                    s(:lvasgn, :status,
                      s(:false)),
                    s(:send, nil, :puts,
                      s(:gvar, :$!)))), nil))))),
      s(:lvasgn, :unlink,
        s(:hash)),
      s(:block,
        s(:send,
          s(:gvar, :$dirs), :each),
        s(:args,
          s(:arg, :dir)),
        s(:send,
          s(:lvar, :unlink), :[]=,
          s(:lvar, :dir),
          s(:true))),
      s(:while,
        s(:lvasgn, :dir,
          s(:send,
            s(:gvar, :$dirs), :pop)),
        s(:begin,
          s(:send, nil, :print,
            s(:dstr,
              s(:str, "rmdir "),
              s(:begin,
                s(:lvar, :dir)))),
          s(:if,
            s(:gvar, :$dryrun), nil,
            s(:kwbegin,
              s(:rescue,
                s(:kwbegin,
                  s(:rescue,
                    s(:begin,
                      s(:send,
                        s(:lvar, :unlink), :delete,
                        s(:lvar, :dir)),
                      s(:send,
                        s(:const, nil, :Dir), :rmdir,
                        s(:lvar, :dir))),
                    s(:resbody,
                      s(:array,
                        s(:const,
                          s(:const, nil, :Errno), :ENOTDIR)), nil,
                      s(:begin,
                        s(:if,
                          s(:send,
                            s(:const, nil, :File), :symlink?,
                            s(:lvar, :dir)), nil,
                          s(:send, nil, :raise)),
                        s(:send,
                          s(:const, nil, :File), :unlink,
                          s(:lvar, :dir)))), nil)),
                s(:resbody,
                  s(:array,
                    s(:const,
                      s(:const, nil, :Errno), :ENOENT),
                    s(:const,
                      s(:const, nil, :Errno), :ENOTEMPTY)), nil, nil),
                s(:resbody, nil, nil,
                  s(:begin,
                    s(:lvasgn, :status,
                      s(:false)),
                    s(:send, nil, :puts,
                      s(:gvar, :$!)))),
                s(:begin,
                  s(:lvasgn, :parent,
                    s(:send,
                      s(:const, nil, :File), :dirname,
                      s(:lvar, :dir))),
                  s(:if,
                    s(:or,
                      s(:send,
                        s(:lvar, :parent), :==,
                        s(:lvar, :dir)),
                      s(:send,
                        s(:lvar, :unlink), :[],
                        s(:lvar, :parent))), nil,
                    s(:send,
                      s(:gvar, :$dirs), :push,
                      s(:lvar, :parent))))))))),
      s(:gvasgn, :$\,
        s(:nil)),
      s(:send, nil, :print,
        s(:send,
          s(:lvar, :ors), :chomp)),
      s(:send, nil, :exit,
        s(:lvar, :status)))))

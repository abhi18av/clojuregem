s(:begin,
  s(:send,
    s(:const, nil, :ARGF), :binmode),
  s(:lvasgn, :source,
    s(:send,
      s(:const, nil, :ARGF), :read)),
  s(:lvasgn, :source,
    s(:block,
      s(:send,
        s(:lvar, :source), :gsub,
        s(:regexp,
          s(:str, "/\\*([!*])((?!\\*/).+?)\\*/"),
          s(:regopt, :m))),
      s(:args,
        s(:arg, :comment)),
      s(:begin,
        s(:masgn,
          s(:mlhs,
            s(:lvasgn, :marker),
            s(:lvasgn, :comment)),
          s(:array,
            s(:nth_ref, 1),
            s(:nth_ref, 2))),
        s(:if,
          s(:match_with_lvasgn,
            s(:regexp,
              s(:str, "^\\s*\\*\\s?\\-\\-\\s*$"),
              s(:regopt)),
            s(:lvar, :comment)), nil,
          s(:next,
            s(:dstr,
              s(:str, "/**"),
              s(:begin,
                s(:lvar, :comment)),
              s(:str, "*/")))),
        s(:lvasgn, :doxybody,
          s(:nil)),
        s(:block,
          s(:send,
            s(:lvar, :comment), :each_line),
          s(:args,
            s(:arg, :line)),
          s(:if,
            s(:lvar, :doxybody),
            s(:begin,
              s(:if,
                s(:match_with_lvasgn,
                  s(:regexp,
                    s(:str, "^\\s*\\*\\s?\\+\\+\\s*$"),
                    s(:regopt)),
                  s(:lvar, :line)),
                s(:break), nil),
              s(:send,
                s(:lvar, :doxybody), :<<,
                s(:lvar, :line))),
            s(:if,
              s(:match_with_lvasgn,
                s(:regexp,
                  s(:str, "^\\s*\\*\\s?--\\s*$"),
                  s(:regopt)),
                s(:lvar, :line)),
              s(:lvasgn, :doxybody,
                s(:str, "\n")), nil))),
        s(:dstr,
          s(:str, "/*"),
          s(:begin,
            s(:lvar, :marker)),
          s(:begin,
            s(:lvar, :doxybody)),
          s(:str, "*/"))))),
  s(:send, nil, :print,
    s(:lvar, :source)))

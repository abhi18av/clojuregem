s(:module,
  s(:const, nil, :JISX0208),
  s(:class,
    s(:const, nil, :Char), nil,
    s(:begin,
      s(:sclass,
        s(:self),
        s(:def, :from_sjis,
          s(:args,
            s(:arg, :sjis)),
          s(:begin,
            s(:if,
              s(:and,
                s(:send,
                  s(:int, 33088), :<=,
                  s(:lvar, :sjis)),
                s(:send,
                  s(:lvar, :sjis), :<=,
                  s(:int, 64764))), nil,
              s(:send, nil, :raise,
                s(:const, nil, :ArgumentError),
                s(:dstr,
                  s(:str, "out of the range of JIS X 0208: 0x"),
                  s(:begin,
                    s(:send,
                      s(:lvar, :sjis), :to_s,
                      s(:int, 16)))))),
            s(:masgn,
              s(:mlhs,
                s(:lvasgn, :sjis_hi),
                s(:lvasgn, :sjis_lo)),
              s(:array,
                s(:send,
                  s(:lvar, :sjis), :>>,
                  s(:int, 8)),
                s(:send,
                  s(:lvar, :sjis), :&,
                  s(:int, 255)))),
            s(:lvasgn, :sjis_hi,
              s(:send,
                s(:begin,
                  s(:send,
                    s(:lvar, :sjis_hi), :-,
                    s(:begin,
                      s(:if,
                        s(:begin,
                          s(:send,
                            s(:lvar, :sjis_hi), :<=,
                            s(:int, 159))),
                        s(:int, 128),
                        s(:int, 192))))), :<<,
                s(:int, 1))),
            s(:if,
              s(:send,
                s(:lvar, :sjis_lo), :<=,
                s(:int, 158)),
              s(:begin,
                s(:op_asgn,
                  s(:lvasgn, :sjis_hi), :-,
                  s(:int, 1)),
                s(:op_asgn,
                  s(:lvasgn, :sjis_lo), :-,
                  s(:if,
                    s(:begin,
                      s(:send,
                        s(:lvar, :sjis_lo), :<=,
                        s(:int, 126))),
                    s(:int, 63),
                    s(:int, 64)))),
              s(:op_asgn,
                s(:lvasgn, :sjis_lo), :-,
                s(:int, 158))),
            s(:return,
              s(:send,
                s(:self), :new,
                s(:lvar, :sjis_hi),
                s(:lvar, :sjis_lo)))))),
      s(:def, :initialize,
        s(:args,
          s(:arg, :row),
          s(:optarg, :cell,
            s(:nil))),
        s(:if,
          s(:lvar, :cell),
          s(:ivasgn, :@code,
            s(:send, nil, :row_cell_to_code,
              s(:lvar, :row),
              s(:lvar, :cell))),
          s(:ivasgn, :@code,
            s(:send,
              s(:lvar, :row), :to_int)))),
      s(:def, :==,
        s(:args,
          s(:arg, :other)),
        s(:begin,
          s(:if,
            s(:send,
              s(:send,
                s(:self), :class), :===,
              s(:lvar, :other)),
            s(:return,
              s(:send,
                s(:send, nil, :Integer,
                  s(:self)), :==,
                s(:send, nil, :Integer,
                  s(:lvar, :other)))), nil),
          s(:return,
            s(:super,
              s(:lvar, :other))))),
      s(:def, :to_int,
        s(:args),
        s(:return,
          s(:ivar, :@code))),
      s(:def, :hi,
        s(:args),
        s(:send,
          s(:send, nil, :Integer,
            s(:self)), :>>,
          s(:int, 8))),
      s(:def, :lo,
        s(:args),
        s(:send,
          s(:send, nil, :Integer,
            s(:self)), :&,
          s(:int, 255))),
      s(:def, :row,
        s(:args),
        s(:send,
          s(:send,
            s(:self), :hi), :-,
          s(:int, 32))),
      s(:def, :cell,
        s(:args),
        s(:send,
          s(:send,
            s(:self), :lo), :-,
          s(:int, 32))),
      s(:def, :succ,
        s(:args),
        s(:begin,
          s(:masgn,
            s(:mlhs,
              s(:lvasgn, :succ_hi),
              s(:lvasgn, :succ_lo)),
            s(:array,
              s(:send,
                s(:self), :hi),
              s(:send,
                s(:send,
                  s(:self), :lo), :+,
                s(:int, 1)))),
          s(:if,
            s(:send,
              s(:lvar, :succ_lo), :>,
              s(:int, 126)),
            s(:begin,
              s(:lvasgn, :succ_lo,
                s(:int, 33)),
              s(:op_asgn,
                s(:lvasgn, :succ_hi), :+,
                s(:int, 1))), nil),
          s(:return,
            s(:send,
              s(:send,
                s(:self), :class), :new,
              s(:send,
                s(:send,
                  s(:lvar, :succ_hi), :<<,
                  s(:int, 8)), :|,
                s(:lvar, :succ_lo)))))),
      s(:def, :to_sjis,
        s(:args),
        s(:begin,
          s(:masgn,
            s(:mlhs,
              s(:lvasgn, :h),
              s(:lvasgn, :l)),
            s(:array,
              s(:send,
                s(:self), :hi),
              s(:send,
                s(:self), :lo))),
          s(:lvasgn, :h,
            s(:send,
              s(:send,
                s(:begin,
                  s(:send,
                    s(:lvar, :h), :+,
                    s(:int, 1))), :/,
                s(:int, 2)), :+,
              s(:begin,
                s(:if,
                  s(:send,
                    s(:begin,
                      s(:irange,
                        s(:int, 33),
                        s(:int, 94))), :include?,
                    s(:lvar, :h)),
                  s(:int, 112),
                  s(:int, 176))))),
          s(:op_asgn,
            s(:lvasgn, :l), :+,
            s(:if,
              s(:send,
                s(:send,
                  s(:self), :hi), :odd?),
              s(:send,
                s(:int, 31), :+,
                s(:begin,
                  s(:if,
                    s(:begin,
                      s(:send,
                        s(:lvar, :l), :>=,
                        s(:int, 96))),
                    s(:int, 1),
                    s(:int, 0)))),
              s(:int, 126))),
          s(:return,
            s(:send,
              s(:send,
                s(:lvar, :h), :<<,
                s(:int, 8)), :|,
              s(:lvar, :l))))),
      s(:def, :inspect,
        s(:args),
        s(:dstr,
          s(:str, "#<JISX0208::Char:"),
          s(:begin,
            s(:send,
              s(:send,
                s(:self), :object_id), :to_s,
              s(:int, 16))),
          s(:str, " sjis="),
          s(:begin,
            s(:send,
              s(:send,
                s(:self), :to_sjis), :to_s,
              s(:int, 16))),
          s(:str, " jis="),
          s(:begin,
            s(:send,
              s(:send,
                s(:self), :to_int), :to_s,
              s(:int, 16))),
          s(:str, ">"))),
      s(:send, nil, :private),
      s(:def, :row_cell_to_code,
        s(:args,
          s(:arg, :row),
          s(:arg, :cell)),
        s(:begin,
          s(:if,
            s(:and,
              s(:send,
                s(:int, 0), :<,
                s(:lvar, :row)),
              s(:send,
                s(:begin,
                  s(:irange,
                    s(:int, 1),
                    s(:int, 94))), :include?,
                s(:lvar, :cell))), nil,
            s(:send, nil, :raise,
              s(:const, nil, :ArgumentError),
              s(:dstr,
                s(:str, "out of row-cell range: "),
                s(:begin,
                  s(:lvar, :row)),
                s(:str, "-"),
                s(:begin,
                  s(:lvar, :cell))))),
          s(:return,
            s(:send,
              s(:send,
                s(:begin,
                  s(:send,
                    s(:lvar, :row), :+,
                    s(:int, 32))), :<<,
                s(:int, 8)), :|,
              s(:begin,
                s(:send,
                  s(:lvar, :cell), :+,
                  s(:int, 32))))))))))
